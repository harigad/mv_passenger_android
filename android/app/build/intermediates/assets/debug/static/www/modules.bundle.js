(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('OneMVController', OneMVController);

    OneMVController.$inject = ['$location', '$scope', 'DivisionService', '$rootScope', '$interval', 'env', 'PageService', 'RedirectionService', '$log'];

    function OneMVController($location, $scope, DivisionService, $rootScope, $interval, env, PageService, RedirectionService, $log) {

        var vm = this;
        vm.division = "default";
        vm.PageService = PageService;
        vm.brand = 'base';
        if (env.ionic) {
            vm.ionic = env.ionic;
        } else {
            vm.ionic = {};
            vm.ionic.showMenu = false;
        }


        function activate() {
            if (DivisionService.getDivisionId())
                DivisionService
                     .getDivisionInfo()
                 .then(handleSuccess, handleFailure);
            else
                handleFailure();
        }

        function handleSuccess(response) {
            if (response.data.status === 1) {
                setDivisionValues(response.data.result);
            }
        }

        function handleFailure(error) {
            $location.path('/division');
        }

        function getMajorAppVersion(majorNo) {
            var _majorAppNo = null;
            if (majorNo) {
                var _arr = majorNo.split('v');
                if (_arr && _arr.length > 1) {
                    _majorAppNo = _arr[1];
                }
            } else {
                $log.error("App Version not setup correctly in DB.");
        };
            return _majorAppNo;
        }

        function getMajorSwVersion(majorNo) {
            var _majorSwNo = null;
            if (majorNo) {
                var _arr = majorNo.split('sw');
                if (_arr && _arr.length > 1) {
                    _majorSwNo = _arr[1];
                }
            }
            return _majorSwNo;
        };

        function isANumber(no) {
            return !isNaN(no);
        }

        function isMinVersion(division) {
            var isMinVersion = true;
            if (division.MinAppVersion) {
                var dbAppVersions = division.MinAppVersion.split('.');
                var currentVersions = env.appVersion.split('.');
                
                var dbNo = (getMajorAppVersion(dbAppVersions[0]) * 10000) + 
                            (eval(dbAppVersions[1]) * 100) +
                            (dbAppVersions[2] ? eval(dbAppVersions[2]) : 0)

                var currentAppNo = (getMajorAppVersion(currentVersions[0]) * 10000) +
                                    (eval(currentVersions[1]) * 100) +
                                    (currentVersions[2] ? eval(currentVersions[2]) : 0)

                isMinVersion = currentAppNo >= dbNo;
            };

            return isMinVersion;
        };

        function setDivisionValues(division) {
            var msg = {type:"checkMinAppVersion", data: division};
             try{
                console.dir(msg);
                window.postMessage(JSON.stringify(msg));
             }catch(e){
                console.log(e);
             }
            if (env.ionic && !isMinVersion(division)) {
                RedirectionService.redirectTo('/min-app-support');
                return false;
            }
            if (division.HasCustomSetup){
                vm.brand = division.DivisionID;
            } else {
                vm.brand = 'base';
            }

            vm.division = division.DivisionID;


            // document.title = division.MetaTitle;
            // vm.title = division.MetaTitle;;
            // vm.description = division.MetaDescription;
            $rootScope.supportPhoneNumber = division.SupportPhoneNumber;
    }


        if (DivisionService.getDivisionId())
            activate();

        $rootScope.$on('divisionChanged', activate);
        
    }

})();

(function() {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('dynamic', HtmlDirective);

    HtmlDirective.$inject = ['$compile'];
    
    function HtmlDirective($compile) {
        return {
            restrict: 'A',
            replace: true,
            link: function (scope, ele, attrs) {
                scope.$watch(attrs.dynamic, function (html) {
                    ele.html(html);
                    $compile(ele.contents())(scope);
                });
            }
        };
    }

})();
//var mod = angular.module('oneMVApp');
//mod.directive('onKeydown', function () {
//    return {
//        restrict: 'A',
//        link: function (scope, elem, attrs) {
//            // this next line will convert the string
//            // function name into an actual function
//            var functionToCall = scope.$eval(attrs.onKeydown);
//            elem.on('keydown', function (e) {
//                // on the keydown event, call my function
//                // and pass it the keycode of the key
//                // that was pressed
//                // ex: if ENTER was pressed, e.which == 13
//                functionToCall(e);
//            });
//        }
//    };
//});
/*global angular */
(function (ng) {
  'use strict';

  var app = ng.module('ngLoadScript', []);

  app.directive('script', function ($parse, $rootScope, $compile) {
      return {
          restrict: 'E',
          terminal: true,
          link: function (scope, element, attr) {
              if (attr.ngSrc) {
                  var domElem = '<script src="' + attr.ngSrc + '" async defer></script>';
                  $(element).append($compile(domElem)(scope));


              }
          }
      };
  });

}(angular));
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('phonenumberDirective', phonenumberDirective)
        .filter('phonenumber', phonenumber);
    phonenumberDirective.$inject = ['$filter', '$browser'];

    function phonenumberDirective($filter, $browser) {
        /*
		Intended use:
			<phonenumber-directive placeholder='prompt' model='someModel.phonenumber'></phonenumber-directive>
		Where:
			someModel.phonenumber: {String} value which to bind only the numeric characters [0-9] entered
				ie, if user enters 617-2223333, value of 6172223333 will be bound to model
			prompt: {String} text to keep in placeholder when no numeric input entered
		*/

        return {
            require: 'ngModel',
            link: function ($scope, $element, $attrs, ngModelCtrl) {
                var listener = function () {
                    var value = $element.val().replace(/[^0-9]/g, '');
                    $element.val($filter('phonenumber')(value, false));
                };

                // This runs when we update the text field
                ngModelCtrl.$parsers.push(function ($viewValue) {
                    return $viewValue.replace(/[^0-9]/g, '');
                });

                // This runs when the model gets updated on the scope directly and keeps our view in sync
                ngModelCtrl.$render = function () {
                    $element.val($filter('phonenumber')(ngModelCtrl.$viewValue, false));
                };

                $element.bind('change', listener);
                $element.bind('keydown', function (event) {
                    var key = event.keyCode;
                    // If the keys include the CTRL, SHIFT, ALT, or META keys, or the arrow keys, do nothing.
                    // This lets us support copy and paste too
                    if (key == 91 || (15 < key && key < 19) || (37 <= key && key <= 40)) {
                        return;
                    }
                    $browser.defer(listener); // Have to do this or changes don't get picked up properly
                });

                $element.bind('paste cut', function () {
                    $browser.defer(listener);
                });
            }

        };
    }

    function phonenumber() {
        /* 
	    Format phonenumber as: c (xxx) xxx-xxxx
	    	or as close as possible if phonenumber length is not 10
	    	if c is not '1' (country code not USA), does not use country code
	    */

        return function (number) {
            /* 
		    @param {Number | String} number - Number that will be formatted as telephone number
		    Returns formatted number: (###) ###-####
		    	if number.length < 4: ###
		    	else if number.length < 7: (###) ###
 
		    Does not handle country codes that are not '1' (USA)
		    */
            if (!number) { return ''; }

            number = String(number);

            // Will return formattedNumber. 
            // If phonenumber isn't longer than an area code, just show number
            var formattedNumber = number;

            // if the first character is '1', strip it out and add it back
            var c = (number[0] == '1') ? '1 ' : '';
            number = number[0] == '1' ? number.slice(1) : number;

            // # (###) ###-#### as c (area) front-end
            var area = number.substring(0, 3);
            var front = number.substring(3, 6);
            var end = number.substring(6, 10);

            if (front) {
                formattedNumber = (c + "(" + area + ") " + front);
            }
            if (end) {
                formattedNumber += ("-" + end);
            }
            return formattedNumber;
        };
    }


})();
(function () {
    //debugger;
    'use strict';

    angular.module('oneMVApp').factory('ConfigFactory', ConfigFactory);
    ConfigFactory.$inject = ['$http', '$q', 'env'];



function ConfigFactory($http, $q, env) {
    var Factory = {
        getOneMVApiURL: getOneMVApiURL,
        getOneMVApiURLPromise: getOneMVApiURLPromise,
        resetUserAndDivision: resetUserAndDivision,
        getCurrentUser: getCurrentUser,
        getCurrentDivision: getCurrentDivision,
        getCurrentDivisionTime: getCurrentDivisionTime,
        getDivisionParameters: getDivisionParameters
    };

    var configData;
    var currentUser;
    var currentDivision;
    var currentDivisionDate;
    var currentDivisionSysParams;
    var value;

    function getDivisionParameters(divisionId) {
        var defer = $q.defer();
            getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var _url = oneMVURL + 'division/' + divisionId + '/systemParameters?appType=desktop&rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    url: _url
                }).then(function successCallback(response) {
                    if (response.data.status == 1) {
                        defer.resolve(response.data.result);
                    } else {
                        defer.reject(response.data.result);
                    }
                }, function errorCallback(response) {
                    defer.reject(response);
                });
            }
        });
        return defer.promise;
    }
   
    //function getOneMVApiURLPromise() {
    //    var _url = '../clientappsettings.json';
    //    var defer = $q.defer();
    //    if (!configData) {
    //        $http({
    //            method: 'GET',
    //            url: _url
    //        }).then(function successCallback(response) {
    //            //TBD
    //            configData = response.data
    //            defer.resolve(configData.ApiURLs.OneMVApiURL);
    //        }, function errorCallback(response) {
    //            //Error handling TBD
    //            defer.reject(response);
    //        });
    //    } else {
    //        defer.resolve(configData.ApiURLs.OneMVApiURL);
    //    }
    //    return defer.promise;
    //}
    function getOneMVApiURLPromise() {
       
        var defer = $q.defer();
       
        defer.resolve(env.oneMVApiUrl);
       
        return defer.promise;
    }
    function getOneMVApiURL() {
        return configData.ApiURLs.OneMVApiURL;
    }
    function resetUserAndDivision() {
        currentUser = null;
        currentDivision = null;
    }
    function getCurrentUser() {
        _url = '../Operation/GetCurrentUserDetails?rnd=' + new Date().getTime();
        var defer = $q.defer();
        if (!currentUser) {
            $http({
                method: 'GET',
                url: _url
            }).then(function successCallback(response) {
                currentUser = response.data;
                if (!currentDivision)
                    currentDivision = {};
                currentDivision = currentUser.Divisions[0];
                if (currentUser.CurrentLogin && currentUser.CurrentLogin.Division) {
                    currentDivision = currentUser.CurrentLogin.Division;

                }

                defer.resolve(currentUser);
            }, function errorCallback(response) {
                //Error handling TBD
                defer.reject(response);
            });
        } else {
            defer.resolve(currentUser);
        }
        return defer.promise;

    }
    function getCurrentDivision() {
        var _url = '../Operation/GetCurrentUserDetails?rnd=' + new Date().getTime();
        var defer = $q.defer();
        if (!currentDivision) {
            $http({
                method: 'GET',
                url: _url
            }).then(function successCallback(response) {
                currentUser = response.data;
                if (!currentDivision)
                    currentDivision = {};
                currentDivision = currentUser.Divisions[0];
                if (currentUser.CurrentLogin && currentUser.CurrentLogin.Division) {
                    currentDivision = currentUser.CurrentLogin.Division;
                }
                defer.resolve(currentDivision);
            }, function errorCallback(response) {
                //Error handling TBD
                defer.reject(response);
            });
        } else {
            defer.resolve(currentDivision);
        }
        return defer.promise;
    }
    function getCurrentDivisionTime() {
        var defer = $q.defer();
        var _url = '../Operation/GetCurrentDivisionTime?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            url: _url
        }).then(function successCallback(response) {
            currentDivisionDate = response.data;
            defer.resolve(currentDivisionDate);
        }, function errorCallback(response) {
            defer.reject(currentDivisionDate);
        });

        return defer.promise;
    }

    getOneMVApiURLPromise(); //One manual call to set the URL. To get the guaranteed url we need to use the promise method.
    return Factory;
}

})();

(function () {
    //debugger;
    'use strict';

    angular.module('oneMVApp').factory('DataValidationFactory', DataValidationFactory);
    DataValidationFactory.$inject = ['$log', '$window', '$http'];


    function DataValidationFactory($log, $window, $http) {
        var factory = {
            validateZipCode: validateZipCode,
            validateZipCodeNew: validateZipCodeNew

        };

        return factory;



        function doPostHttpRequest(url) {
            var googleUrl = url;
            return $http({
                url: googleUrl,
                method: 'GET',
                withCredentials: false
            })
        }

        function validateZipCodeNew(zip) {
            var googleUrl = "//maps.googleapis.com/maps/api/geocode/json?address=" + zip + "&sensor=true";
            return doPostHttpRequest(googleUrl);
        }

        function validateZipCode(zip, vm) {
            var stateCode;
            var state;
            var googleUrl = "//maps.googleapis.com/maps/api/geocode/json?address=" + zip + "&sensor=true";
            return $http({
                method: 'GET',
                url: googleUrl,
                withCredentials: false
            }).then(function successCallback(response) {
                // this callback will be called asynchronously

                if (response.data != null) {
                    var addressComponents = response.data.results[0].address_components;

                    stateCode = addressComponents[addressComponents.length - 2].short_name;
                    state = addressComponents[addressComponents.length - 2].long_name;
                }
                if (stateCode != '') {
                    vm.stateabbr = stateCode;

                    return stateCode;
                } else
                    return '';

            }, function errorCallback(response) {
                return "N/A";
                // $scope.err = response;
                // called asynchronously if an error occurs
                // or server returns response with an error status.
            });
        }
    }

})();


(function () {
    'use strict';
    //debugger

    angular
        .module('oneMVApp')
        .factory('DateFactory', DateFactory);

    DateFactory.$inject = ['$log', 'UtilityFactory', '$rootScope'];

function DateFactory($log, UtilityFactory, $rootScope) {
    var factory = {
        getCustomTime: getCustomTime,
        getDateFromCustomTime: getDateFromCustomTime,
        getPreviousDate: getPreviousDate,
        getTimeDifference: getTimeDifference,
        isDayLightsavingOn: isDayLightsavingOn,
        getMinutesFromTimeString: getMinutesFromTimeString,
        getPromiseWindowTimeDisplay: getPromiseWindowTimeDisplay,
        getPromiseWindowEndTime: getPromiseWindowEndTime
        
    };

    return factory;

    //get difference in minutes from given dateTime and current browser datetime
    function getTimeDifference(divisionDate) {
        var today = new Date();
        var serverDate = new Date(Date.parse(divisionDate));  //get the date in correct format for Date function

        var difference = today - serverDate;

        //convert difference from milliseconds to minutes
        if (Math.abs(difference / 1000 / 60) < 1)
            difference = 0
        else {
            if (difference < 0)
                difference = Math.floor(difference / 1000 / 60);
            else
                difference = Math.ceil((difference / 1000) / 60)
        }
        //we only care if the time is 1 minute less or 1 minute more than should be because of rounding
        if (Math.abs(difference) % 10 > 0) {
            if (difference < 0) {
                if (Math.abs(difference) % 10 == 1)
                    difference = difference + 1;
                if (Math.abs(difference) % 10 == 9)
                    difference = difference - 1;
            }

            else {
                if (Math.abs(difference) % 10 == 1)
                    difference = difference - 1;
                if (Math.abs(difference) % 10 == 9)
                    difference = difference + 1;
            }
        }
        return difference;
    }

    // 33 hr display logic
    function getCustomTime(dateToRender, serviceDate) {
        var _customTime = "";

        try {
            if (dateToRender && serviceDate) {
                var _hrsToAdd = moment(dateToRender).hours();
                if (moment(dateToRender).date() != moment(serviceDate).date()) {
                    //Add the difference days * 24. Generic solution to handle more than 33 hrs.
                    var _diff = moment(dateToRender).diff(moment(serviceDate), 'days');
                    _hrsToAdd = _hrsToAdd + (_diff * 24);
                }
                if (_hrsToAdd < 0 && _hrsToAdd > -10)
                    _hrsToAdd = "-0" + (_hrsToAdd * -1)//When service date is less than datetoRender
                if (_hrsToAdd < 10)
                    _hrsToAdd = "0" + _hrsToAdd;

                _customTime = _hrsToAdd + ":" + moment(dateToRender).format('mm');
            }
        }
        catch (err) {
            console.log(err)
        }

        return _customTime
    };

    // Reverse of getCustomTime function
    // Using custom time and service date calculate the actual date
    // We need to figure out based on division so get difference from division time and adjust time accordingly
    function getDateFromCustomTime(customTime, serviceDate) {
        var date;
        var diff_Minutes;
        var _serviceDate;
        var difference = $rootScope.timeDifference;


        //Handling both moment date and native JS date format
        if (serviceDate._isAMomentObject)
            _serviceDate = serviceDate.startOf('day')
        else
            _serviceDate = serviceDate.setHours(0, 0, 0);
        if (typeof customTime == "string") {
            if (customTime.indexOf(':') == -1) {
                diff_Minutes = (parseInt(customTime[0] + customTime[1])) * 60 + parseInt(customTime[2] + customTime[3]);
                if (difference) {
                    diff_Minutes = diff_Minutes + difference;
                }
            }
            else if (customTime.indexOf(':') == 2) {
                diff_Minutes = (parseInt(customTime[0] + customTime[1])) * 60 + parseInt(customTime[3] + customTime[4]);
                if (difference) {
                    diff_Minutes = diff_Minutes + difference;
                }
            }
        } else if (typeof customTime == "date") {
            //handle date time
        }


        if (diff_Minutes) {
            date = moment(_serviceDate).add(diff_Minutes, 'm');
        }
        else {
            $log.error("getDateFromCustomTime: Time is invalid!, Cannot calulate actual time");
            $log.log("error details", "getDateFromCustomTime customTime: " + customTime);
            $log.log("error details", "getDateFromCustomTime serviceDate: " + _serviceDate);
        }
        return date;

    }
    function getPreviousDate(date) {
        if (date == null) date = new Date();
        date.setDate(date.getDate() - 1);
        return date;
    }
    function isDayLightsavingOn() {
        var today = new Date();
        var january = new Date(today.getFullYear(), 0, 1);
        var july = new Date(today.getFullYear(), 6, 1);
        var timezoneDiff = Math.max(january.getTimezoneOffset(), july.getTimezoneOffset());
        return today.getTimezoneOffset() < timezoneDiff;
    }

    function getMinutesFromTimeString(timeString) {
        var diff_Minutes = 0;
        if (typeof timeString == "string") {
            if (timeString.indexOf(':') == -1) {
                diff_Minutes = (parseInt(timeString[0] + timeString[1])) * 60 + parseInt(timeString[2] + timeString[3]);
            }
            else if (timeString.indexOf(':') == 2) {
                diff_Minutes = (parseInt(timeString[0] + timeString[1])) * 60 + parseInt(timeString[3] + timeString[4]);
            }
            return diff_Minutes;
        }
    }
  
    function getPromiseWindowTimeDisplay(scheduleTime, promiseWindow, serviceDate) {
        var scheduleTimeView = getCustomTime(scheduleTime, serviceDate);
        var formatDate = moment(scheduleTime).add(promiseWindow, 'minutes');
        var promiseWindowTime = scheduleTimeView + "-" + getCustomTime(formatDate, serviceDate);
        return promiseWindowTime;
    }

    //windowStartTime is expected to be in ISO string format
    //promiseWindow in minutes
    function getPromiseWindowEndTime(windowStartTime, promiseWindow) {
        var oldDateObj = moment(windowStartTime);
        var newDateObj = oldDateObj.add('m', promiseWindow);
        return newDateObj.format();
    }
};
})();
(function () {

    'use strict';

    angular.module('oneMVApp').factory('LocationFactory', LocationFactory);

    LocationFactory.$inject = ['$http', '$q', 'ConfigFactory', 'authService'];

    function LocationFactory($http, $q, ConfigFactory, authService) {

    var locationFrom = [];
    var locationTo = [];
    var AdLocationFrom = [];
    var AdLocationTo = [];
    var GoogleLocationFrom = [];
    var GoogleLocationTo = [];
    var addressRest = '';
    var locationFilter = '';
    var factory = {
        setadd: stt,
        getLocations: getLocations,
        findClosestLocation: findClosestLocation
    };

    return factory;

    function stt(newName) {
        addressRest = newName;

    }
    function setLocationFilter(filterStatus) {
        locationFilter = filterStatus;
    }

    function getAddress(AdLocationFrom, loc) {
        var addressDetails = "";
        if (loc) {
        	//var addressDetails = AdLocationFrom[loc].IsManuallyAdded ? (AdLocationFrom[loc].Name).toUpperCase() : '';
        	if (AdLocationFrom[loc].Name)
        		addressDetails = AdLocationFrom[loc].Name.toUpperCase();
        	if (AdLocationFrom[loc].AliasNames)
        		addressDetails = addressDetails + " (" + AdLocationFrom[loc].AliasNames + ")";
        }
        return addressDetails;
    }

    //move to UtilityFactory (may be)
    function isNullOrEmpty(input) {
        if (angular.isUndefined(input) || input === null || input == '')   //angular.equals(input, {});//empty object comparison
            return true;
        else
            return false;
    }

    function findClosestLocation(myposition, locations) {

        for (var i = 0; i < locations.length; i++) {
            locations[i].distance = rectilinearHaversine(myposition, locations[i].loc);
        }
        locations.sort(function (a, b) {
            return a.distance - b.distance;

        })
        return locations[0];
    }
    function haversineFormula(gpsLoc, bldg) {
        //position1 =  vm.position
        //position2 = stop
        var lat1 = gpsLoc.Latitude;
        var lon1 = gpsLoc.Longitude;
        var lat2 = bldg.Latitude;
        var lon2 = bldg.Longitude

        var R = 6371; // km 
        var x1 = lat2 - lat1;
        var dLat = x1 * Math.PI / 180;
        var x2 = lon2 - lon1;
        var dLon = x2 * Math.PI / 180;
        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                        Math.sin(dLon / 2) * Math.sin(dLon / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c * 0.62137; //convert to miles
        return d.toFixed(2);
    }

    function rectilinearHaversine(loc1, loc2) {
        var tempPoint = {
            "Latitude": loc1.Latitude,
            "Longitude": loc2.Longitude
        }

        var d1 = parseFloat(haversineFormula(loc1, tempPoint));
        var d2 = parseFloat(haversineFormula(tempPoint, loc2));
        return (d1 + d2).toFixed(2);
    }


    function checkIfValid(address) {
        for (var i in address.address_components) {
            if (address.address_components[i].types[0] == "street_number") {
                return true;
            }
        }
        return false;
    }
    // this is the only function that will be in use for both from and to locations, when the directive is in place.
    //The above 2 functions are only for the existing functionality, they can be cleaned up once the new advanced reservation is ready

    function getLocations(SearchTerm, locationfilter, divisionId, passengerId, googleOnly) {
        var defer = $q.defer();
        var locationData = [];
        if (googleOnly == true || googleOnly == "true") {
        	$http.get('https://maps.googleapis.com/maps/api/geocode/json', {
        		params: {
        			address: SearchTerm + ' ' + addressRest,
        			sensor: true,
        			key: 'AIzaSyCztqRTaQzgBxu0DMV9cDKq0IciqMaQI5E'
        		},
        		withCredentials: false,
        		skipAuthorization: true
        	}).then(function successCallback(response) {
        		GoogleLocationFrom = response.data.results;
        		for (var loc in GoogleLocationFrom) {
        		    if (checkIfValid(GoogleLocationFrom[loc])) {
        		        locationData.push(
                        {
                            address: GoogleLocationFrom[loc].formatted_address,
                            isGoogleLocation: true,
                            loc: GoogleLocationFrom[loc],
                            description: GoogleLocationFrom[loc].Name,
                            title: GoogleLocationFrom[loc].formatted_address
                        });
        		    }
        		}
        		defer.resolve({ "data": locationData });
        	});
        } else {
        	ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
        		if (oneMVURL && oneMVURL != "") {
        			var serviceUrl = oneMVURL + "location/" + divisionId + "/?SearchTerm=" + SearchTerm;

        			$http.get(serviceUrl)
			   .then(function successCallback(response) {
			   	AdLocationFrom = response.data.result;
			   	for (var loc in AdLocationFrom) {
			   		locationData.push(
						 {
						 	name: AdLocationFrom[loc].Name,
						 	address: AdLocationFrom[loc].Address +
                                 (!isNullOrEmpty(AdLocationFrom[loc].City) ? ", " + AdLocationFrom[loc].City : " ") +
                                 (!isNullOrEmpty(AdLocationFrom[loc].Zip) ? ", " + AdLocationFrom[loc].Zip : ""),
						 	isGoogleLocation: false,
						 	loc: AdLocationFrom[loc],
						 	title: getAddress(AdLocationFrom, loc),
						 	description: AdLocationFrom[loc].Address +
                                 (!isNullOrEmpty(AdLocationFrom[loc].City) ? ", " + AdLocationFrom[loc].City : " ") +
                                 (!isNullOrEmpty(AdLocationFrom[loc].Zip) ? ", " + AdLocationFrom[loc].Zip : "")
						 });
			   	}
			   	if (locationFilter == false || locationFilter == "false") {
			   		defer.resolve({ "data": locationData });
			   		return defer.promise;
			   	}
			   	else if (locationFilter == true || locationFilter == "true") {

			   		$http.get('https://maps.googleapis.com/maps/api/geocode/json', {
			   			params: {
			   				address: SearchTerm + ' ' + addressRest,
			   				sensor: true,
			   				key: 'AIzaSyCztqRTaQzgBxu0DMV9cDKq0IciqMaQI5E'
			   			},
			   			withCredentials: false,
			   			skipAuthorization: true
			   		}).then(function successCallback(response) {
			   			GoogleLocationFrom = response.data.results;
			   			for (var loc in GoogleLocationFrom) {
			   			    if (checkIfValid(GoogleLocationFrom[loc])) {
			   			        locationData.push(
                                     {
                                         address: GoogleLocationFrom[loc].formatted_address,
                                         isGoogleLocation: true,
                                         loc: GoogleLocationFrom[loc],
                                         description: GoogleLocationFrom[loc].Name,
                                         title: GoogleLocationFrom[loc].formatted_address
                                     });
			   			    }
			   			}
			   			defer.resolve({ "data": locationData });
			   		}, function errorCallback(err) {
			   			defer.reject(err);
			   		});
			   	}
			   }, function errorCallback(err) {
			   	defer.reject(err);
			   });


        		}
        	}, function errorhandler(err) {
        	});
        	setLocationFilter(locationfilter);
        }
        return defer.promise;
    };
}

})();
(function () {
    'use strict';

    angular.module('oneMVApp').factory('SecurityFactory', SecurityFactory);
    SecurityFactory.$inject = ['$http', '$q', '$cacheFactory', 'securityService'];


    function SecurityFactory($http, $q, $cacheFactory, securityService) {
        var _permissions = {};
        var cache = $cacheFactory("PermissionsCache");
        var service = {
            getPermissions: getPermissions,
            getLoadedPermissions: getLoadedPermissions,
            setupSession: setupSession
        };
        return service;

        function getPermissions(userId, divisionid) {
            var defer = $q.defer();
            _permissions = cache.get("permissions");
            if (_permissions) {
                defer.resolve(_permissions);
            } else {
                securityService.getPermissions(userId, divisionid).then(function (permissions) {
                    cache.put("permissions", permissions);
                    defer.resolve(permissions);
                });
            }
            return defer.promise;
        };

        function setupSession(userId, divisionid) {
            return securityService.setupSession(userId, divisionid);
        };

        function getLoadedPermissions() {
            return cache.get("permissions");
        };
    }


})();



(function () {

    'use strict';

    angular.module('oneMVApp').factory('UtilityFactory', UtilityFactory);
    UtilityFactory.$inject = ['$log', '$window'];
    function UtilityFactory($log, $window) {


        var service = {

            getData: getData,
            setData: setData,
            getAPIBaseUrl: getAPIBaseUrl,

            toastError: toastError,
            toastInfo: toastInfo,
            toastSuccess: toastSuccess,
            toastWarning: toastWarning,

            logError: logError,
            logInfo: logInfo,
            logSuccess: logSuccess,
            logWarning: logWarning,

            log: $log.log,

            getUsStates: getUsStates,
            getBrowserInfo: getBrowserInfo,

            isChrome: isChrome,
            isIE: isIE,
            isFirefox: isFirefox,
            isSafari: isSafari,

            usStates: [
                 {
                     "name": "Alabama",
                     "abbreviation": "AL"
                 },
                 {
                     "name": "Alaska",
                     "abbreviation": "AK"
                 },
                 {
                     "name": "American Samoa",
                     "abbreviation": "AS"
                 },
                 {
                     "name": "Arizona",
                     "abbreviation": "AZ"
                 },
                 {
                     "name": "Arkansas",
                     "abbreviation": "AR"
                 },
                 {
                     "name": "California",
                     "abbreviation": "CA"
                 },
                 {
                     "name": "Colorado",
                     "abbreviation": "CO"
                 },
                 {
                     "name": "Connecticut",
                     "abbreviation": "CT"
                 },
                 {
                     "name": "Delaware",
                     "abbreviation": "DE"
                 },
                 {
                     "name": "District Of Columbia",
                     "abbreviation": "DC"
                 },
                 {
                     "name": "Federated States Of Micronesia",
                     "abbreviation": "FM"
                 },
                 {
                     "name": "Florida",
                     "abbreviation": "FL"
                 },
                 {
                     "name": "Georgia",
                     "abbreviation": "GA"
                 },
                 {
                     "name": "Guam",
                     "abbreviation": "GU"
                 },
                 {
                     "name": "Hawaii",
                     "abbreviation": "HI"
                 },
                 {
                     "name": "Idaho",
                     "abbreviation": "ID"
                 },
                 {
                     "name": "Illinois",
                     "abbreviation": "IL"
                 },
                 {
                     "name": "Indiana",
                     "abbreviation": "IN"
                 },
                 {
                     "name": "Iowa",
                     "abbreviation": "IA"
                 },
                 {
                     "name": "Kansas",
                     "abbreviation": "KS"
                 },
                 {
                     "name": "Kentucky",
                     "abbreviation": "KY"
                 },
                 {
                     "name": "Louisiana",
                     "abbreviation": "LA"
                 },
                 {
                     "name": "Maine",
                     "abbreviation": "ME"
                 },
                 {
                     "name": "Marshall Islands",
                     "abbreviation": "MH"
                 },
                 {
                     "name": "Maryland",
                     "abbreviation": "MD"
                 },
                 {
                     "name": "Massachusetts",
                     "abbreviation": "MA"
                 },
                 {
                     "name": "Michigan",
                     "abbreviation": "MI"
                 },
                 {
                     "name": "Minnesota",
                     "abbreviation": "MN"
                 },
                 {
                     "name": "Mississippi",
                     "abbreviation": "MS"
                 },
                 {
                     "name": "Missouri",
                     "abbreviation": "MO"
                 },
                 {
                     "name": "Montana",
                     "abbreviation": "MT"
                 },
                 {
                     "name": "Nebraska",
                     "abbreviation": "NE"
                 },
                 {
                     "name": "Nevada",
                     "abbreviation": "NV"
                 },
                 {
                     "name": "New Hampshire",
                     "abbreviation": "NH"
                 },
                 {
                     "name": "New Jersey",
                     "abbreviation": "NJ"
                 },
                 {
                     "name": "New Mexico",
                     "abbreviation": "NM"
                 },
                 {
                     "name": "New York",
                     "abbreviation": "NY"
                 },
                 {
                     "name": "North Carolina",
                     "abbreviation": "NC"
                 },
                 {
                     "name": "North Dakota",
                     "abbreviation": "ND"
                 },
                 {
                     "name": "Northern Mariana Islands",
                     "abbreviation": "MP"
                 },
                 {
                     "name": "Ohio",
                     "abbreviation": "OH"
                 },
                 {
                     "name": "Oklahoma",
                     "abbreviation": "OK"
                 },
                 {
                     "name": "Oregon",
                     "abbreviation": "OR"
                 },
                 {
                     "name": "Palau",
                     "abbreviation": "PW"
                 },
                 {
                     "name": "Pennsylvania",
                     "abbreviation": "PA"
                 },
                 {
                     "name": "Puerto Rico",
                     "abbreviation": "PR"
                 },
                 {
                     "name": "Rhode Island",
                     "abbreviation": "RI"
                 },
                 {
                     "name": "South Carolina",
                     "abbreviation": "SC"
                 },
                 {
                     "name": "South Dakota",
                     "abbreviation": "SD"
                 },
                 {
                     "name": "Tennessee",
                     "abbreviation": "TN"
                 },
                 {
                     "name": "Texas",
                     "abbreviation": "TX"
                 },
                 {
                     "name": "Utah",
                     "abbreviation": "UT"
                 },
                 {
                     "name": "Vermont",
                     "abbreviation": "VT"
                 },
                 {
                     "name": "Virgin Islands",
                     "abbreviation": "VI"
                 },
                 {
                     "name": "Virginia",
                     "abbreviation": "VA"
                 },
                 {
                     "name": "Washington",
                     "abbreviation": "WA"
                 },
                 {
                     "name": "West Virginia",
                     "abbreviation": "WV"
                 },
                 {
                     "name": "Wisconsin",
                     "abbreviation": "WI"
                 },
                 {
                     "name": "Wyoming",
                     "abbreviation": "WY"
                 }
            ]

        };

        return service;


        //  *************  base api URL  **********************************
        // This will be removed and moved to a ConfigFactory and to USE a JSON data 
        var apiBaseUrl = 'https://onemvapi-dev.mvtransit.com/api/';

        function getAPIBaseUrl() {
            return apiBaseUrl;
        }


        // *********   session    *******************

        //set default values 1st  --- not using to remove 
        //data['isDispatch'] = false;
        //data['isReporting'] = false;
        //data['isUserManagement'] = false;

        var data = {};




        function getData(key) {
            return data[key];
        };

        function setData(key, value) {
            data[key] = value;
        };



        // *************   ---    get browser information 

        function getBrowserInfo() {

            var userAgent = $window.navigator.userAgent;

            var browsers = { chrome: /chrome/i, safari: /safari/i, firefox: /firefox/i, ie: /internet explorer/i };

            for (var key in browsers) {
                if (browsers[key].test(userAgent)) {
                    return key;
                }
            };

            return 'unknown';

        }

        // *************   ---    detect browsers information 
        function isChrome() {
            return !!window.chrome && !!window.chrome.webstore;
        }
        function isIE() {
            return false || !!document.documentMode;
        }
        function isFirefox() {
            return typeof InstallTrigger !== 'undefined';
        }
        function isSafari() {
            return Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;
        }

        //  *********   Toaster    *******************

        function toastError(title, message, timeout) {
                
            timeout = timeout || 1000;
            toastr.error(message, title, { timeOut: timeout });

            $log.error('Error: - ' + title + '  - ' + message, '')
        }

        function toastInfo(title, message, timeout) {

            timeout = timeout || 1000;

            toastr.info(message, title, {
                timeOut: timeout
            });
        }

        function toastSuccess(title, message) {
            toastr.success(message, title);
            $log.debug('Success: - ' + title + '  - ' + message, '')
        }

        function toastWarning(title, message) {
            toastr.warning(message, title);
            $log.warn('Warning: - ' + title + '  - ' + message, '')
        }


        //  *********   Logging    *******************

        function logError(message, data) {
            $log.error('Error:' + message, data)
        }

        function logInfo(message, data) {
            $log.info('Info:' + message, data)
        }

        function logSuccess(message, data) {
            $log.debug('Success:' + message, data)
        }

        function logWarning(message, data) {
            $log.warn('Warning:' + message, data)
        }


        //  *********   US State    *******************


        function getUsStates() {
            //debugger;
            return service.usStates;
        }

    };

})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('authInterceptorService', authInterceptorService);

    authInterceptorService.$inject = ['$q', '$injector', '$location', '$rootScope', 'localStorageService'];

    function authInterceptorService($q, $injector,$location,$rootScope, localStorageService) {
        var authInterceptorServiceFactory = {};

        var _request = function (config) {

            config.headers = config.headers || {};


            if (!config.url.includes('https://maps.googleapis.com')) {
            	var authData = localStorageService.get('authorizationData');
            	if (authData) {
            		config.headers.Authorization = 'Bearer ' + authData.token;
            	}
            }

            return config;
        }

        var _responseError = function (rejection) {
            if (rejection.status === 401) {
                var authService = $injector.get('authService');
                var authData = localStorageService.get('authorizationData');

                authService.logOut().then(function () {
                    $rootScope.$broadcast('loggedout', null);
                    $location.path('/login');
                });
                
            }
            return $q.reject(rejection);
        }

        authInterceptorServiceFactory.request = _request;
        authInterceptorServiceFactory.responseError = _responseError;

        return authInterceptorServiceFactory;
    }
})();
(function () {
    'use strict';

    //var authApp = angular.module('authApp', []);

    angular
   .module('oneMVApp')
        .factory('authService', authService);

    authService.$inject = ['$rootScope','$http', '$q' ,'localStorageService', 'env'];

    function authService($rootScope, $http, $q, localStorageService, env) {
        var serviceBase = env.authServerUrl;
        var authServiceFactory = {};

        var _authentication = {
            isAuth: false,
            passengerId: "",
            userId: "",
            useRefreshTokens: false
        };

        var _externalAuthData = {
            provider: "",
            userName: "",
            externalAccessToken: "",
            firstName: "",
            lastName: ""
        };
       
        $rootScope.$on('loggedIn', function (data) {
            debugger;
            console.log('loggedIn', data);
            var msg = {};
            msg.type = "register_push";
            msg.alias = localStorage.getItem("ls.alias");
            msg.division = localStorage.getItem("ls.division");
            var authData = localStorage.getItem("ls.authorizationData");
            try{
                var authDataObj = JSON.parse(authData);
                msg.passengerId = authDataObj.passengerId;
                window.postMessage(JSON.stringify(msg));
            }catch(e){
                console.log("error calling push registration");
            }
        });
       
        var _saveRegistration = function (registration) {

            _logOut();

            return $http.post(serviceBase + 'account/register', registration).then(function (response) {
                return response;
            });

        };

        var _login = function (loginData) {

            var data = "grant_type=password&username=" + loginData.userName + "&password=" + loginData.password;

            if (loginData.useRefreshTokens) {
                data = data + "&client_id=" + "mobiWeb";
            }

            var deferred = $q.defer();

            $http.post(serviceBase + 'token', data, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).success(function (response) {

                if (loginData.useRefreshTokens) {
                    localStorageService.set('authorizationData',
                        {
                            token: response.access_token,
                            userName: loginData.userName,
                            refreshToken: response.refresh_token,
                            useRefreshTokens: true
                        });
                }
                else {
                    localStorageService.set('authorizationData',
                        {
                            token: response.access_token,
                            userName: loginData.userName,
                            refreshToken: "",
                            useRefreshTokens: false
                        });
                }
                _authentication.isAuth = true;
                _authentication.userName = loginData.userName;
                _authentication.useRefreshTokens = loginData.useRefreshTokens;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
            });

            return deferred.promise;

        };


        var _clearUpSession = function () {            

            localStorageService.remove('authorizationData');

            _authentication.isAuth = false;
            _authentication.passengerId = "";
            _authentication.useRefreshTokens = false;
            _authentication.userId = "";
            _authentication.loginProvider = "";
        }

        var _logOut = function () {

            var deferred = $q.defer();

            $http.post(env.authServerUrl + 'account/signout', {}).then(function (response) {

                _clearUpSession();

                deferred.resolve(response);
            }, function (err) {
                console.log('Unable to logout user.');
                deferred.reject(err);
        });
            return deferred.promise;
        };


        var _fillAuthData = function () {

            var authData = localStorageService.get('authorizationData');
            if (authData) {
                _authentication.isAuth = true;
                _authentication.useRefreshTokens = authData.useRefreshTokens;
                _authentication.userId = authData.userId;
                _authentication.passengerId = authData.passengerId;
                _authentication.loginProvider = authData.loginProvider;
        }

        };

        var _isLoggedIn = function () {
            var authData = localStorageService.get('authorizationData');
            if (authData && authData.userId !== "") return true;
            return false;
        }


        var _refreshToken = function () {
            var deferred = $q.defer();

            var authData = localStorageService.get('authorizationData');

            if (authData) {

                if (authData.useRefreshTokens) {

                    var data = "grant_type=refresh_token&refresh_token=" +authData.refreshToken + "&client_id=" +ngAuthSettings.clientId;

                    localStorageService.remove('authorizationData');

                    $http.post(serviceBase + 'token', data, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).success(function (response) {

                        localStorageService.set('authorizationData', {
                            token: response.access_token,
                            refreshToken: response.refresh_token,
                            useRefreshTokens: true,
                            loginProvider: response.loginProvider
                    });

                        deferred.resolve(response);

                    }).error(function (err, status) {
                        _logOut();
                        deferred.reject(err);
                });
            }
        }

            return deferred.promise;
        };
        var _checkUserHasRegistered = function (externalData) {
            var deferred = $q.defer();
            $http.get(serviceBase + 'account/CheckUserHasRegistered',
                            {
                                params:
                                    {
                                        provider: externalData.provider,
                                        providerKey: externalData.providerKey,
                                        divisionId: externalData.divisionId,
                                        userName: externalData.userName,
                                        divisionSupportsFeed: externalData.divisionSupportsFeed
                                    }
                            }).success(function (success) {
                                deferred.resolve(success);
                            }).error(function (err, status) {
                                deferred.reject(err);
                            });
            return deferred.promise;
        }
        var _obtainAccessToken = function (externalData) {

            var deferred = $q.defer();

            $http.get(serviceBase + 'account/ObtainLocalAccessToken',
                {
                    params:
                        {
                            provider: externalData.provider,
                            externalAccessToken: externalData.externalAccessToken,
                            divisionId: externalData.divisionId,
                            userName:externalData.userName
                        }
                })
                .success(function (response) {                    
                    localStorageService.set('authorizationData',
                        {
                            token: response.access_token,
                            refreshToken: "",
                            useRefreshTokens: false,
                            userId: response.userId,
                            passengerId: response.passengerId,
                            loginProvider: response.loginProvider
                        });

                _authentication.isAuth = true;
                _authentication.useRefreshTokens = false;
                _authentication.userId = response.userId;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;
                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
        });

            return deferred.promise;

        };

        var _registerExternal = function (registerExternalData) {

            var deferred = $q.defer();

            $http.post(serviceBase + 'account/registerexternal', registerExternalData).success(function (response) {

                localStorageService.set('authorizationData',
                    {
                        token: response.access_token,
                        refreshToken: "",
                        useRefreshTokens: false,
                        userId: response.userId,
                        passengerId: response.passengerId,
                        loginProvider: response.loginProvider
                    });

                _authentication.isAuth = true;
                _authentication.userId = response.userId;
                _authentication.useRefreshTokens = false;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
        });

            return deferred.promise;
        };

        function _registerOneMv(registrationObject)
        {
            var deferred = $q.defer();
            $http.post(serviceBase + 'account/Register', registrationObject).success(function (response) {

                localStorageService.set('authorizationData',
                    {
                        token: response.access_token,
                        refreshToken: "",
                        useRefreshTokens: false,
                        userId: response.userId,
                        passengerId: response.passengerId,
                        loginProvider: response.loginProvider
                    });

                _authentication.isAuth = true;
                _authentication.userId = response.userId;
                _authentication.useRefreshTokens = false;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
            });

            return deferred.promise;
        }
        function _loginOneMv(loginData)
        {
            var deferred = $q.defer();
            $http.post(serviceBase + 'account/LoginOneMv', loginData).success(function (response) {

                localStorageService.set('authorizationData',
                    {
                        token: response.access_token,
                        refreshToken: "",
                        useRefreshTokens: false,
                        userId: response.userId,
                        passengerId: response.passengerId,
                        loginProvider: response.loginProvider
                    });

                _authentication.isAuth = true;
                _authentication.userId = response.userId;
                _authentication.useRefreshTokens = false;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function _verifyCaptcha(captcha) {
            var deferred = $q.defer();
            $http.post(serviceBase + 'account/VerifyCaptcha', '"' + captcha + '"').success(function (response) {

                deferred.resolve(response);

            }).error(function (err, status) {
                
                deferred.reject(err);
            });

            return deferred.promise;
        }
        authServiceFactory.saveRegistration = _saveRegistration;
        authServiceFactory.login = _login;
        authServiceFactory.logOut = _logOut;
        authServiceFactory.fillAuthData = _fillAuthData;
        authServiceFactory.authentication = _authentication;
        authServiceFactory.refreshToken = _refreshToken;

        authServiceFactory.obtainAccessToken = _obtainAccessToken;
        authServiceFactory.externalAuthData = _externalAuthData;
        authServiceFactory.registerExternal = _registerExternal;
        authServiceFactory.isLoggedIn = _isLoggedIn;
        authServiceFactory.loginOneMV = _loginOneMv;
        authServiceFactory.registerOneMV = _registerOneMv;
        authServiceFactory.verifyCaptcha = _verifyCaptcha;
        authServiceFactory.checkUserHasRegistered = _checkUserHasRegistered;

        return authServiceFactory;
    }
})();
(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('CommonService', CommonService);

	CommonService.$inject = ['$http', '$q', 'env'];

	function CommonService($http, $q, env) {
		var serviceBase = env.oneMVApiUrl;

		var service = {
		    GetAllStates: GetAllStates,
		    GetStatesWithDivisions: GetStatesWithDivisions,
		    ScheduleType: GetScheduleTypes()
		};

		return service;

		function GetAllStates() {
			var deferred = $q.defer();
			var url = serviceBase + 'common/GetAllStates';

			$http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime(),
			}).then(function (response) {
				if (response.status == 200) {
					deferred.resolve(response.data.result);
				} else {
					deferred.reject(response);
				}
			}, function (err) {
				deferred.reject(err);
			});

			return deferred.promise;
		}
		function GetStatesWithDivisions()
		{
		    var deferred = $q.defer();
		    var url = serviceBase + 'common/GetStatesWithDivisions';

		    $http({
		        method: 'GET',
		        url: url + '?rnd=' + new Date().getTime(),
		    }).then(function (response) {
		        if (response.status == 200) {
		            deferred.resolve(response.data.result);
		        } else {
		            deferred.reject(response);
		        }
		    }, function (err) {
		        deferred.reject(err);
		    });

		    return deferred.promise;
		}

		function GetScheduleTypes() {
		    return Object.freeze({ 'Morning': 'AM', 'Evening': 'PM' });
		}

	}
})();

(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('CommunicationsService', CommunicationsService);
    CommunicationsService.$inject = ['$http', '$q', 'ConfigFactory'];

    function CommunicationsService($http, $q, ConfigFactory) {
        var service = {
            contactDriver: contactDriver
        };
        return service;

        function contactDriver(tripId) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "communications/contactdriver/" + tripId + "?rnd=" + new Date().getTime();
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        if (response && response.data && response.data.status && (response.data.status == 1 || response.data.status == 2)) {
                            defer.resolve(response.data);
                        } else {
                          defer.reject(response);
                        }
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
//(function () {
//    'use strict';

//    angular
//        .module('oneMVApp')
//        .factory('DateUtilityService', DateUtilityService);

//    DateUtilityService.$inject = [];

//    function DateUtilityService() {
//        var service = {
//            addDays: addDays,
//            getWeek: getWeek,
//            getDayOfYear: getDayOfYear
//        };

//        return service;

//        function addDays(input, numOfDays) {
//            var dat = new Date(input);
//            dat.setDate(dat.getDate() + numOfDays);
//            return dat;
//        }

//        function getWeek(input) {
//            var date = new Date(input.getTime());
//            date.setHours(0, 0, 0, 0);
//            // Thursday in current week decides the year.
//            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
//            // January 4 is always in week 1.
//            var week1 = new Date(date.getFullYear(), 0, 4);
//            // Adjust to Thursday in week 1 and count number of weeks from date to week1.
//            return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000
//                                  - 3 + (week1.getDay() + 6) % 7) / 7);
//        }

//        function getDayOfYear(input) {
//            var now = new Date(input);
//            var start = new Date(now.getFullYear(), 0, 0);
//            var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
//            var oneDay = 1000 * 60 * 60 * 24;
//            var day = Math.floor(diff / oneDay);
//            return day;
//        }
//    }
//})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('DivisionService', DivisionService);

    DivisionService.$inject = [ '$http', '$q', '$rootScope', 'localStorageService', 'env', 'authService'];

    function DivisionService($http, $q, $rootScope,  localStorageService, env, authService) {
        var service = {
            setDivision: _setDivision,
            getDivisionInfo: _getDivisionInfo,            
            getDivisions: _getAllDivisions,
            getDivisionId: _getDivisionIdFromLocalStorage,
            getTimeZone: _getTimeZoneFromLocalStorage,            
            getAllowedServices: _getAllowedServicesFromLocalStorage,
            getDivisionAlias: _getDivisionAliasFromLocalStorage,
            getSupportPhoneNumber: _getSupportPhoneNumberFromLocalStorage,
            getSystemParameters: _getSystemParametersFromLocalStorage,
            getServiceDateByDivisionTime: _getServiceDateByDivisionTime,
            getCurrentDivisionTime: _getCurrentDivisionTime,
            getDivisionByState: _getDivisionByState,
            getDivisionsByLocation: _getDivisionsByLocation,
            isWaitlistAllowedByDivision: _isWaitlistAllowedByDivision
        };

        return service;

        function _getCurrentDivisionTime() {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiOrgUrl + 'division/' + _getDivisionIdFromLocalStorage() + '/currentTime?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {                    
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }



        function _setDivision(inputAlias) {
            var deferred = $q.defer();

			// get division info
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/v1?alias=' + inputAlias
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    var hasDivisionChanged = _hasDivisionChanged(inputAlias);
                	var division = response.data.result;

                	// get division system parameters
                    $http({
                    	method: 'GET',
                    	'url': env.oneMVApiUrl + '/division/' + division.DivisionID +'/systemParameters?appType=Desktop'
                    }).then(function (paramResponse) {
                    	if (paramResponse.status == 200) {
                    		division.SystemParameters = paramResponse.data.result;
							// convert boolean text to boolean
                    		for (var param in division.SystemParameters) {
                    			var value = division.SystemParameters[param];
                    			if (value != null) {
                    				value = value.toLowerCase();
                    				if (value == "true") {
                    					division.SystemParameters[param] = true;
                    				} else if (value == "false") {
                    					division.SystemParameters[param] = false;
                    				}
                    			}
                    		}

                    	    // remember division properties for future access
                    		_setDivisionProperties(division);
                    		_setServices(response);

                    		_broadcastDivisionChanged(hasDivisionChanged);
                    		deferred.resolve(response);
                    	}
                    	else deferred.reject('division not found');
                    }, function (err) {
                    	deferred.reject('division not found');
                    });
                }
                else deferred.reject('division not found');
            }, function (err) {
                deferred.reject('division not found');
            });

            return deferred.promise;
        }
        
        function _hasDivisionChanged(inputAlias) {
            var localStorageAlias = _getDivisionAliasFromLocalStorage();
            
            if(angular.isUndefined(localStorageAlias) 
                ||  localStorageAlias === null 
                || localStorageAlias.trim() === '') 
                return true;

            return inputAlias.toLowerCase() !== localStorageAlias.toLowerCase();
        }

        function _getDivisionInfo() {            

            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/' + _getDivisionIdFromLocalStorage()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    _setServices(response);
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function _getAllDivisions() {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/all/v1'
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {                   
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;                     
        }

        function _getServiceDateByDivisionTime(divisionId, divisionTime) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/' + divisionId + '/' + divisionTime + '/serviceDateByDivisionTime?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function _getDivisionByState(stateCode)
        {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/GetDivisionsByState/' + stateCode + '?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function _getDivisionsByLocation(latitude, longitude)
        {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/' + latitude + '/' + longitude + '/GetClosestDivisions?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function _setDivisionProperties(division) {
            localStorageService.set('division', division.DivisionID);
            localStorageService.set('timeZone', division.TimeZone);
            //localStorageService.set('allowedServices', division.AllowedServices.toLowerCase());
            //
            // Test stuf because it is broken. 
            // Do not publish this.
            //
            if (division.CommuterDivisionId == null) {
                var mapCommuterDivisionId = '';
                var divisionID = division.DivisionID;
                switch (divisionID) {
                    case '206':
                        mapCommuterDivisionId = '206'
                        break;
                    case '1001':
                        mapCommuterDivisionId = '1001.1'
                        break;
                    case '1002':
                        mapCommuterDivisionId = '1002.1'
                        break;
                    case '1003':
                        mapCommuterDivisionId = '1003.1'
                        break;
                    case '1004':
                        mapCommuterDivisionId = '1004.1'
                        break;
                    case '1005':
                        mapCommuterDivisionId = '1005.1'
                        break;
                    default:
                        mapCommuterDivisionId = '-999'
                        break;
                }; division.CommuterDivisionId = mapCommuterDivisionId;
            }
            localStorageService.set('cid', division.CommuterDivisionId);
            localStorageService.set('supportPhoneNumber', division.SupportPhoneNumber);
            localStorageService.set('alias', division.Alias);
            localStorageService.set('systemParameters', division.SystemParameters);
        }

        function _setServices(response) {
            var serviceInfo = [];    
            for (var i = 0; i < response.data.result.DivisionServices.length; i++) {
                var svcInfo =   response.data.result.DivisionServices[i].Service;              
                serviceInfo.push(
                    {
                        id: svcInfo.Id,
                        name:svcInfo.Name,
                        alias: response.data.result.DivisionServices[i].Alias || svcInfo.Name
                    });
                }
            localStorageService.set("serviceInfo",serviceInfo);            
        }

        function _broadcastDivisionChanged(hasDivisionChanged) {
            if (authService.isLoggedIn() && hasDivisionChanged) {
                authService
                    .logOut()
                    .then(function () {
                        $rootScope.$broadcast('divisionChanged');
                    });
            }
            else if (hasDivisionChanged)
            {
                // only broadcast if the division has actually changed.
                $rootScope.$broadcast('divisionChanged');
            }

                
        }

        function _getTimeZoneFromLocalStorage() {
            return localStorageService.get('timeZone');
        }

        function _getDivisionIdFromLocalStorage() {
            return localStorageService.get('division');
        }

        function _getAllowedServicesFromLocalStorage() {
            return localStorageService.get('serviceInfo');
        }

        function _getDivisionAliasFromLocalStorage() {
            return localStorageService.get('alias');
        }

        function _getSupportPhoneNumberFromLocalStorage() {
        	return localStorageService.get('supportPhoneNumber');
        }

        function _getSystemParametersFromLocalStorage() {
        	return localStorageService.get('systemParameters');
        }    
             
        function _isWaitlistAllowedByDivision() {

            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiOrgUrl + 'division/' + _getDivisionIdFromLocalStorage()
                        + '/systemParameters/allowcommuterwaitlist' + '?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response.data.result == 'true');
                }
                else deferred.reject(false);
            }, function (err) {
                deferred.reject(false);
            });
            return deferred.promise;
        }

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('DynamicContentService', DynamicContentService);

    DynamicContentService.$inject = ['$http', '$q', 'env', 'DivisionService'];

    function DynamicContentService($http, $q, env, DivisionService) {
        var service = {
            getWhatsNewData: getWhatsNewData,
            getData: getData,
            getSupportFAQ: getSupportFAQ
        };

        return service;

        function getSupportFAQ() {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'common/' + DivisionService.getDivisionId() + '/supportFAQ';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getWhatsNewData() {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'whatsNew/GetCurrentWhatsNewList/' + DivisionService.getDivisionId();
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getData(page) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/dynamic/' + page;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('GeoLocationService', GeoLocationService);

    GeoLocationService.$inject = ['$rootScope','$q', '$window', '$timeout'];

    function GeoLocationService($rootScope, $q, $window, $timeout) {
        var service = {
            getCurrentPosition: getCurrentPosition
        };

        return service;

        function getCurrentPosition() {
            var deferred = $q.defer();
            //
            // We have multiple people calling this function to determine if GPS is turned on.
            // This is an issue in Android environment.  I added a Broadcast so that anyone can
            // listen to find out if GPS is turned on, or off.
            //
            if (!$window.navigator.geolocation) {
                $rootScope.$broadcast('GeoLocationService.gpsIsAvailable', { gpsIsEnabled: false, lastPosition: {}, timestamp: new Date() });
                deferred.reject('Geolocation not supported');
            } else {
               var timeoutPromise =  $timeout(function () {
                   deferred.reject('User cancelled');                   
                }, 10000);
                    $window.navigator.geolocation.getCurrentPosition(function (position) {
                        $rootScope.$broadcast('GeoLocationService.gpsIsAvailable', { gpsIsEnabled: true, lastPosition: position, timestamp: new Date() });
                        $timeout.cancel(timeoutPromise);
                        deferred.resolve(position);
                    }, function (err) {
                        $rootScope.$broadcast('GeoLocationService.gpsIsAvailable', { gpsIsEnabled: false, lastPosition: {}, timestamp: new Date() });
                        $timeout.cancel(timeoutPromise);
                        deferred.reject(err);
                    },{maximumAge: 0, enableHighAccuracy: true });
                
            }
            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('LoginService', LoginService);

    LoginService.$inject = ['$http','$q','env'];

    function LoginService($http, $q,env) {
        var service = {
            authenticate: authenticate
        };

        return service;

        function authenticate(provider, returnUrl) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'account/ExternalLogin?provider=' + provider + '&returnUrl=' + returnUrl;
            $http({
                method: 'POST',
                'url': serviceUrl,
                headers: {
                    'Content-Type': 'text/plain'
                },
                data: {}
            }).then(function (response) {
               
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('LuumLinkedService', LuumLinkedService);

    LuumLinkedService.$inject = ['$http', '$q', 'env','$rootScope','$uibModal','$location'];

    function LuumLinkedService($http, $q, env, $rootScope, $uibModal, $location) {

        var service = {
            verify: verify,
            getNewPassengerLuumLinkageInfo: getNewPassengerLuumLinkageInfo,
            displayNewPassengerMessage : displayNewPassengerMessage
        };

        return service;


        function displayNewPassengerMessage(message) {
             $uibModal.open({
            template: '<div class="modal-header" >' +
                            '<h3 class="modal-title">OneMV-LUUM Integration Info</h3>' +
                          ' </div>' +
                          '<div class="modal-body">' +
                            '<p>' +message + '</p>' +
                          '</div>' +
                          '<div class="modal-footer">' +
                          '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                              ' </div>',
                                  replace : true,
                              controller: function ($scope, $uibModalInstance) {
                                  $scope.close = function () {
                                      $uibModalInstance.close();
                                      $location.replace().path('dashboard/');
                                      };
                                      },
                                          backdrop: 'static',
                                          keyboard: false
                                      });
        }

        function getNewPassengerLuumLinkageInfo(divisionId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'division/' + divisionId + '/newPassengerMessage';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }


        function verify(passengerId) {
            var url = env.oneMVApiOrgUrl + 'passenger/luumLinkage/' + passengerId;
            return $http({
                method: 'GET',
                url: url + '?rnd=' + new Date().getTime()
            }).then(function (response) {

                if (response && response.data.status == 1) {
                    //execute iff, division need or current date has passed start date for applicable division.
                    if (response.data.result && response.data.result.verify) {
                        if (!response.data.result.isLinkedToLuum) {

                            var message = response.data.result.message;

                            $uibModal.open({
                                template: '<div class="modal-header" >' +
                                            '<h3 class="modal-title">OneMV-LUUM Integration Info</h3>' +
                                          ' </div>' +
                                          '<div class="modal-body">' +
                                            '<p>' + message + '</p>' +
                                          '</div>' +
                                          '<div class="modal-footer">' +
                                          '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                                replace: true,
                                controller: function ($scope, $uibModalInstance) {
                                    $scope.close = function () {
                                        $uibModalInstance.close();

                                        if (response.data.result.disableCommuterNavigation) {
                                            var path = $location.path();
                                            if (path.indexOf('/commuter/selected-stop') > -1
                                                || path.indexOf('/passenger-trips') > -1
                                                || path.indexOf('/commuter/adv-schedule-setup') > -1
                                                || path.indexOf('/commuter/my-vehicles') > -1) {

                                                $rootScope.passengerNotified = true;
                                                $location.replace().path('dashboard/');
                                            }

                                            // return;
                                        }

                                    };
                                },
                                backdrop: 'static',
                                keyboard: false
                            });
                        }
                    }
                }
            }, function (err) {
            });
        }
    }
})();

(function () {

    'use strict';

    angular.module('oneMVApp')
    .factory('MapIconService', MapIconService);

    MapIconService.$inject = ['PortalUtilityService'];

    function MapIconService(PortalUtilityService) {                        

        var service = {
            getCommuterStopIcon : _getCommuterStopIcon,
            getCommuterHubIcon: _getCommuterHubIcon,
            getDrtPickupIcon: _getDrtPickupIcon,
            getDrtDropoffIcon: _getDrtDropoffIcon
        };

        function _getCommuterHubIcon() {
            return PortalUtilityService.isIE() ? 'images/pin-hub.png' : 'images/pin-hub.svg';
        }

        function _getCommuterStopIcon() {
            return PortalUtilityService.isIE() ? 'images/pin-busstop-green.png' : 'images/pin-busstop-green.svg';
        }

        function _getDrtPickupIcon() {
            return 'images/default/i-drt-pin-b.png';
        }

        function _getDrtDropoffIcon() {
            return 'images/default/i-drt-pin-g.png';
        }

        return service;
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('MapService', MapService);

    MapService.$inject = ['$timeout', 'uiGmapIsReady', 'googleMapsConfig'];

    function MapService($timeout, uiGmapIsReady, googleMapsConfig) {


        var _map = undefined;


        var service = {
            setMapBounds: setMapBounds,
            initializeMap: _setMap,
        };

        return service;

        function setMapBounds(markers, events) {

            if (angular.isUndefined(_map) || angular.isUndefined(markers) || markers.length == 0)
                return;

            var bounds = new google.maps.LatLngBounds();
            angular.forEach(markers, function (marker) {
                bounds.extend({
                    'lat': marker.latitude,
                    'lng': marker.longitude
                });
            });


            if (events) 
                _map.markerEvent = setMarkerEvents(events);

            _map.control.getGMap().fitBounds(bounds);
            _map.control.getGMap().setZoom(_map.control.getGMap().getZoom() - 1);
        }


        function _setMap() {

            _map = {
                center:
                    {
                        latitude: 47.6216026,
                        longitude: -122.342862
                    },
                zoom: 15,
                mapOptions: {
                    mapTypeControl: false,
                    zoomControl: false,
                    streetViewControl: false,
                    styles: googleMapsConfig.mapStyles
                },
                control: {},
            }
            return _map;
        }

        function setMarkerEvents(events) {
            var evntObj = {};

            angular.forEach(events, function (e) {
                if (e.event && typeof e.callback === 'function')
                    evntObj[e.event] = function (gMarker, eventName, model) {
                        if (model.$id) {
                            e.callback(model);
                        }
                    };
            });

            return evntObj;
        }

    }
})();

(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('MessageBox', MessageBox);

	MessageBox.$inject = ['$q', '$uibModal', '$uibModalStack'];

	function MessageBox($q, $uibModal, $uibModalStack) {
		var service = {
			info: info
		};

		return service;

		function info(title, message) {
			var template =
			'<div class="modal__content">\
				<div class="modal__header">\
					<h4 class="modal-title">' + title + '</h4>\
				</div>\
				<div class="modal__body">\
					<p>' + message + '</p>\
					<button type="button" ng-click="ok()" class="btn btn--primary">Ok</button>\
				</div>\
			</div>';

			var deferred = $q.defer();

			var messageBox = $uibModal.open({
				backdrop: false, // prevent user from dismissing messagebox by clicking background
				template: template,
				size:'-fs',
				controller: function ($scope) {
					$scope.ok = function () {
						$uibModalStack.dismissAll();
					};
				}
			}).closed.then(function () {
				deferred.resolve();
			});

			return deferred.promise;
		}
	}
})();

(function(){
    'use strict';

    angular
        .module('oneMVApp')
        .factory('OneMvServices',OneMvServices);

    OneMvServices.$inject = ['DivisionService'];

    function OneMvServices(DivisionService){
        var service = {
            getCommuterInfo :_getCommuterServiceInfo,
            getFixedRouteInfo :_getFixedRouteServiceInfo,
            getDrtInfo :_getDrtServiceInfo       
        };

        return service;

        function _getCommuterServiceInfo(){            
            return find('commuter');
        }

        function _getFixedRouteServiceInfo(){            
            return find('fixed');
        }

        function _getDrtServiceInfo(){
            return find('drt');    
        }

        function find(serviceName){
            var services = DivisionService.getAllowedServices() || [] ;

            for(var i = 0; i<services.length;i++){
                if(services[i].name.toLowerCase() == serviceName.toLowerCase())
                    return services[i];
            }

            return undefined;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PageService', PageService);

    PageService.$inject = [];

    function PageService() {
        var title = '';
        var headline = '';
        var product = '';
        return {
            title: function () { return title; },
            setTitle: function (newTitle) { title = newTitle; },

            headline: function () { return headline; },
            setHeadline: function (newHeadline) { headline = newHeadline; },

            product: function () { return product; },
            setProduct: function (newProduct) { product = newProduct; }
        };
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PasswordService', PasswordService);

    PasswordService.$inject = ['$http', '$q', 'env', 'DivisionService', 'authService'];

    function PasswordService($http, $q, env, DivisionService, authService) {
        var service = {
            ChangePassword: changePassword,
            VerifyAndUpdatePassword: updateAndVerifyPassword,
            SendPasscode: sendPasscode
        };

        return service;

        function updateAndVerifyPassword(verifyAndUpdateVM) {
            var deferred = $q.defer();
            var divisionId = DivisionService.getDivisionId();
            var url = env.oneMVApiUrl + 'password/' + divisionId + '/updatePasswordWithTempCode';
            $http({
                method: 'POST',
                url: url + '?rnd=' + new Date().getTime(),
                data: JSON.stringify(verifyAndUpdateVM)
            }).then(function (response) {
                deferred.resolve(response);  //put all hte if statments here also what to resolve.

            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function changePassword(changePwdVM) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + "/passenger/" + authService.authentication.passengerId + "/changePassword";
            $http({
                method: 'POST',
                'url': serviceUrl + '?rnd=' + new Date().getTime(),
                headers: {
                    'Content-Type': 'text/json'
                },
                data: JSON.stringify(changePwdVM)
            }).then(function (response) {

                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;

        }

        function sendPasscode(email)
        {
            var deferred = $q.defer();
            var divisionId = DivisionService.getDivisionId();
            var serviceUrl = env.oneMVApiUrl + "password/"  + divisionId + "/sendTemporaryCode";
            //$http({
            //    method: 'POST',
            //    'url': serviceUrl + '?rnd=' + new Date().getTime(),
            //    data: JSON.stringify({ email })
            //})
            
            $http.post(serviceUrl, '"' + email + '"').then(function (response) {

                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

    }
    
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PortalUtilityService', PortalUtilityService);

    PortalUtilityService.$inject = ['$window'];

    function PortalUtilityService($window) {
        var service = {
            hasValue: hasValue,
            isIE :isIE
        };

        return service;

        function hasValue(input) {
            return input != null && input != undefined && input != '';
        }


        function isIE() {
            return $window.navigator.userAgent.indexOf("Trident") > 0
                    || $window.navigator.userAgent.indexOf("MSIE") > 0;
        }
    }
})();
(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('ProfileService', ProfileService);

	ProfileService.$inject = ['$http', '$q', 'env', 'DivisionService', 'ConfigFactory', 'authService'];

	function ProfileService($http, $q, env, DivisionService, ConfigFactory, authService) {
		var serviceBase = env.oneMVApiUrl;

		var service = {
			// passenger profile, including home address
			GetProfile: GetProfile,
			UpdateProfile: UpdateProfile,
            GetPassengerAge: getPassengerAge,

			// home address only
			GetHomeAddress: GetHomeAddress,
			UpdateHomeAddress: UpdateHomeAddress,

			AllowEditHomeAddress: AllowEditHomeAddress,
			ShowHomeAddress: ShowHomeAddress,
			GetDefaultMobilityAids: GetDefaultMobilityAids
		};

		return service;

		// determine if home location should be displayed
		function ShowHomeAddress() {
			var divisionParameters = DivisionService.getSystemParameters();
			return divisionParameters.DropoffHomeLocationOnly;
		}

		// determine if the given passenger may change his home location
		function AllowEditHomeAddress() {
			var divisionParameters = DivisionService.getSystemParameters();
			var allowEditProfile = divisionParameters.DropoffHomeLocationOnly
				&& divisionParameters.DropoffHomeLocationEdit;
			return allowEditProfile;
		}

		function getPassengerAge(passengerId)
		{
		    var url = serviceBase + 'passenger/' + passengerId + '/age';

		    return $http({
		        method: 'GET',
		        url: url + '?rnd=' + new Date().getTime()
		    }).then(function (response) {
		        if (response.status == 200) {
		            return response;
		        }
		    }, function (err) {
		        throw err;
		    });
		}
		function GetHomeAddress(passengerId) {
			var url = serviceBase + 'passenger/GetHomeAddress/' + passengerId;

			return $http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime()
			}).then(function (response) {
				if (response.status == 200) {
					return response.data.result;
				} else {
					return response;
				}
			}, function (err) {
				throw err;
			});
		}

		function GetProfile(passengerId) {
			var url = serviceBase + 'passenger/GetProfile/' + passengerId;

			return $http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime()
			}).then(function (response) {
				if (response.status == 200) {
					return response.data.result;
				} else {
					return response;
				}
			}, function (err) {
				return null;
			});
		}

		function UpdateHomeAddress(passengerId, homeAddress) {
			return $http.post(serviceBase + 'passenger/UpdateHomeAddress/' + passengerId, homeAddress)
				.then(function (response) {
					if (response.status == 200) {
						return response;
					}
				});
		}

		function UpdateProfile(profile) {
			return $http.post(serviceBase + 'passenger/UpdateProfile', profile)
				.then(function (response) {
					if (response.status == 200) {
						return response;
					}
				});
		}

		function GetDefaultMobilityAids(divisionId, passengerId) {
			var url = serviceBase + 'passenger/GetDefaultMobilityAids/' + divisionId + '/' + passengerId;
			return $http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime()
			}).then(function (response) {
				if (response.status == 200) {
					return response.data.result;
				} else {
					return response;
				}
			}, function (err) {
				return null;
			});
		}
	}
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('RedirectionService', RedirectionService);

    RedirectionService.$inject = ['$location','localStorageService'];

    function RedirectionService($location,localStorageService) {
        var service = {
            save: save,
            redirect: redirect,
            redirectTo: redirectTo
        };

        return service;

        function save(path) {
            localStorageService.set('coming-from', path);
        }

        function redirect() {
            var comingFrom = localStorageService.get('coming-from');
            if (comingFrom)
                localStorageService.remove('coming-from');
            else
                comingFrom = 'dashboard/';

            redirectTo(comingFrom);
        }

        function redirectTo(url) {
            $location.path(url);
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('ReservationService', ReservationService);

    ReservationService.$inject = ['$http', '$q', 'env','DivisionService'];

    function ReservationService($http, $q, env, DivisionService) {
        var service = {
            cancelReservation: cancelReservation,
            getAllReservationsForPassenger: getAllReservationsForPassenger,
            getStopInfoforReservations: getStopInfoforReservations,
            getPassengerReservationsForToday: getPassengerReservationsForToday,
            getUserReservationFor: getUserReservationFor,
            getUserReservationsByDuration: getUserReservationsByDuration,
            getTripTimingsByDuration: getTripTimingsByDuration,
            addReservations: addReservations,
            manageParkingForReservation: manageParkingForReservation,            
            getAllTripsForCurrentReservation: getAllTripsForCurrentReservation,
            modifyReservation: modifyReservation,
            getAdvReservationAllowedWeeks: getAdvReservationAllowedWeeks,
            getReservationById: getReservationById,
            addWaitlistedReservations: addWaitlistedReservations,
            getAvailableSeatsForTrip: getAvailableSeatsForTrip,
            getPassengerTemplates: getPassengerTemplates,
            addPassengerTemplate:addPassengerTemplate
        };

        return service;


        function getAdvReservationAllowedWeeks() {
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/advReservationWindow?rnd=' + new Date().getMilliseconds();
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }


        function modifyReservation(reservationId,newTripId, passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() +
                                '/reservations/' + reservationId + '/changePickup/' + newTripId + '/' +passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'                
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }


        function getAllTripsForCurrentReservation(reservationId, passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/' + reservationId + '/altTrips/' + passengerId +
                '?rnd' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }


        function getUserReservationFor(passengerId, scheduleType, reservationDate) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/for/' + passengerId + '/' + scheduleType +
                '/' + reservationDate + '/' + '?rnd' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
                }).then(function (response) {
                    deferred.resolve(response);
                    }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
            }
       
        function addReservations(passengerId, reservations) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/add/' + passengerId;
            $http({
                method: 'POST',
                url: serviceUrl,
                contentType: 'application/json',
                data: JSON.stringify(reservations),
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        };

        function addWaitlistedReservations(passengerId, reservations) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/waitlist/add/' + passengerId;
            $http({
                method: 'POST',
                url: serviceUrl,
                contentType: 'application/json',
                data: JSON.stringify(reservations),
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        };

        function cancelReservation(passengerId,reservationId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId()  + '/' + passengerId + '/reservations/' + reservationId + '/cancel';
            $http({
                method: 'DELETE',
                url: serviceUrl,
                contentType: 'application/json',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function getAllReservationsForPassenger(passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/all/' + passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getStopInfoforReservations(incidentId,stopId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'reservation/' + DivisionService.getDivisionId() + '/stopInfo/' + incidentId + '/' + stopId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }

        function getPassengerReservationsForToday( passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/today/' + passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getUserReservationsByDuration(userId, scheduleType, duration) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'reservation/' + DivisionService.getDivisionId() + '/user/' + userId + '/' + scheduleType + '?duration=' + duration;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getTripTimingsByDuration(fromStopId, toStopId, scheduleType, duration) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'reservation/' + DivisionService.getDivisionId() + '/tripTimings/' + fromStopId + '/' + toStopId + '/' + scheduleType + '?duration=' + duration;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        };


        function manageParkingForReservation(passengerId, reservationId, vehicleId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/' + passengerId + '/' + reservationId + '/manageParkingReservation/' + vehicleId;
            $http({
                method: 'PUT',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        };

        
        function getReservationById(passengerId, id) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/' + passengerId + '/reservations/' + id;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getAvailableSeatsForTrip(tripId, reservationDate) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/availableSeats/' + tripId + '/' + reservationDate;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        };

        function getPassengerTemplates(passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservationTemplates/' + passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function addPassengerTemplate(passengerId, template) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservationTemplates/' + passengerId;
            $http({
                method: 'POST',
                url: serviceUrl,
                contentType: 'application/json',
                data: template,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        };        
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('ServiceAreaService', ServiceAreaService);

    ServiceAreaService.$inject = ['$http','$q','env'];

    function ServiceAreaService($http,$q,env) {
        var service = {
            isInServiceArea: isInServiceArea
        };

        return service;

        function isInServiceArea(divisionId, lat, lon) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'servicearea/canRegisterOrLogin/' + divisionId + '/' + lat + '/' + lon;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .controller('AllStopsController', AllStopsController)
        .controller('infoWindowController', infoWindowController);

    infoWindowController.$inject = ['$location', '$scope', 'StopDataService'];
    function infoWindowController($location, $scope, StopDataService) {
       
        $scope.navigateToSelectedStop = function (stop) {
            StopDataService.setStop(stop);
            $location.path('/commuter/selected-stop');
        };
        $scope.getDirectionsToSelectedStop = function (stop) {
            StopDataService.setStop(stop);
            $location.path('/commuter/directions');
        };
        $scope.openMapApp = function (stop) {
            var url = "";
            if ((navigator.platform.indexOf("iPhone") != -1)
                || (navigator.platform.indexOf("iPod") != -1)
                || (navigator.platform.indexOf("iPad") != -1)) {
                url = "http://maps.apple.com/?q=" + stop.latitude + "," + stop.longitude;
            } else {
                url = "http://maps.google.com/?q=" + stop.latitude + "," + stop.longitude;
            }
                
            if (url.length > 0) {
                // For Ionic
                if ($('body').hasClass('platform-cordova')) {
                    window.open(url, '_system', '');
                } else {
                    window.open(url);
                }
            }
        };    
    }
    //address not in service area
    AllStopsController.$inject = ['$location', 'GeoLocationService', 'StopDataService',
        'uiGmapIsReady', 'LocationService', '$http', '$timeout', '$window', 'MessageService', '$filter', 'PageService','OneMvServices'];

    function AllStopsController($location, GeoLocationService, StopDataService,
        uiGmapIsReady, LocationService, $http, $timeout, $window, MessageService, $filter, PageService,OneMvServices) {
        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Find a bus stop');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);
        vm.stops = [];
        vm.closestBusStop = [];
       // vm.otherBusStops = [];
        vm.allOtherStops = [];
        vm.search = '';
        vm.isLoading = true;
        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.position = null;
        vm.location = null;
        vm.selectedLocation = null;
        vm.showList = true;
        
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0)
        {
            closestPin = 'images/pin-busstop-green.png';
            otherPin = 'images/pin-busstop-grey.png';
            locationPin = 'images/pin-location.png';
            myLocationPin = 'images/pin-my-location.png';
            hubIcon = 'images/pin-hub.png';
        }
        else
        {
            closestPin = 'images/pin-busstop-green.svg';
            otherPin = 'images/pin-busstop-grey.svg';
            locationPin = 'images/pin-location.svg';
            myLocationPin = 'images/pin-my-location.svg';
            hubIcon = 'images/pin-hub.svg';
        }
        //if close to amazon current location does not apply
        // if you are way out current Location does not apply
        //havershine formula to get distance
        vm.zoom = 15;
        vm.myStyles = [
        {
            featureType: "poi",
            elementType: "labels",
            stylers: [
                  { visibility: "off" }
            ]
        },
        {
            "featureType": "transit",
            "elementType": "labels.icon",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        }
        ];

        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: true,
            streetViewControl: false,
            styles: vm.myStyles
            
        };
        vm.mapControl = {}; //this object gets the map control instance so that we can manipulate it
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        
        activate();

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                
                        return GeoLocationService.getCurrentPosition();
                }, function (err) {
                    MessageService.showError('Map cannot be loaded.');
                })
            .then(function (position) {
               
                if (position == undefined || position == null)
                    return StopDataService.getAllBusStops();
                vm.position = {
                        "coords": {
                            "latitude": position.coords.latitude,
                            "longitude": position.coords.longitude
                        },
                        "icon": vm.myLocationIcon
                    };

                    var selectedPos = StopDataService.getGeoLocation();
                    if (selectedPos == undefined || selectedPos == null || selectedPos.isAddress == undefined || selectedPos.isAddress == false)
                    {
                        vm.selectedLocation = vm.position;
                   
                    } else {
                        vm.location = selectedPos;
                        vm.selectedLocation = vm.location;
                        vm.search = selectedPos.formatted_address
                    }
               // vm.center = vm.position;
                    return StopDataService.getAllBusStops()
            }, function (err) {
                vm.selectedLocation = StopDataService.getGeoLocation() || null;
                if (vm.selectedLocation != null && vm.selectedLocation.isAddress)
                    vm.search = vm.selectedLocation.formatted_address;
                else {
                    vm.selectedLocation = null;
                    StopDataService.clearItem('currLocation');
                }
                

                StopDataService
                   .getAllBusStops()
                       .then(function (response) {
                           fillStops(response);

                       }, function (err) {
                           vm.isLoading = false;
                           MessageService.showError('Error loading stops. Please try again later');
                           //alert(err);
                       })
            })
            .then(function (response) {
                if (response)
                    fillStops(response);

            }, function (err) {
                vm.isLoading = false;
                MessageService.showError('Error loading stops. Please try again later.');
                //alert(err);
            });
        }
        //marker click function
        vm.markerEvent = {
                click: function (gMarker, eventName, model) {
                if (model.$id) {
                    //navigateToSelectedStop(model.coords);
                    
                    if(vm.selectedLocation)
                        StopDataService.setGeoLocation(vm.selectedLocation);
                    StopDataService.setStop(model.coords);
                    vm.coords = model.coords;
                    vm.show = true;
                }
              
            }
        };

        vm.navigateToClosestStop = function (index) {
            vm.navigateToSelectedStop(vm.closestBusStop[index]);
        }
        vm.getDirectionsToClosestStop = function (index) {
            vm.getDirectionsToSelectedStop(vm.closestBusStop[index]);
        }
        vm.getDirectionsToOtherStop = function (index) {
            vm.getDirectionsToSelectedStop(vm.allOtherStops[index]);
        }
        //vm.getDirectionsToSelectedStop = function (stop) {
        //    StopDataService.setStop(stop);
        //    StopDataService.setGeoLocation(vm.selectedLocation);
        //    $location.path('/commuter/directions');
        //};
        vm.displayMap = function () {
            
           
            vm.showList = false;
            $timeout(function () {
                google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                resetMap();
            }, 50);
            
            
        };
      
        vm.navigateToOtherStop = function (index) {
            vm.navigateToSelectedStop(vm.allOtherStops[index]);
        };
        
        vm.locationSearch = function () {
            vm.selectedLocation = null;
            vm.show = false;
            if (vm.search.trim() == '')
            {
                StopDataService.clearItem('currLocation')
                if(vm.position != null)
                    vm.selectedLocation = vm.position;
                else {
                    vm.selectedLocation = null;
                }
                vm.location = null;
                populateStops();
                return;
            }
            LocationService.getLocation(vm.search).then(function (response) {
                if(response.length > 0)
                {
                    vm.search = response[0].formatted_address;
                    var locationIcon = {
                        url: locationPin

                    };
                    vm.location = {
                        "coords": {
                            "latitude": response[0].geometry.location.lat(),
                            "longitude": response[0].geometry.location.lng()
                        },
                        "isAddress": true,
                        "formatted_address": response[0].formatted_address, 
                        "icon": locationIcon
                    };
                    vm.selectedLocation = vm.location;
                    StopDataService.setGeoLocation(vm.selectedLocation);
                }
                populateStops();

            }, function (err) {
                MessageService.showError('Cannot find the location');
                        //alert(err);
            });
        };

        

       vm.navigateToSelectedStop = function (stop) {
            StopDataService.setStop(stop);
                //if (vm.position != undefined && vm.position != null)
            StopDataService.setGeoLocation(vm.selectedLocation)
            $location.path('/commuter/selected-stop');
        }
       //vm.openMapApp = function (stop) {
       //    var url = "";
       //    if ((navigator.platform.indexOf("iPhone") != -1)
       // || (navigator.platform.indexOf("iPod") != -1)
       //        || (navigator.platform.indexOf("iPad") != -1)) {
       //        url = "http://maps.apple.com/?q=" + stop.latitude + "," + stop.longitude;
       //    }
       //    else {
       //        url = "http://maps.google.com/?q=" + stop.latitude + "," + stop.longitude;
       //    }
                       
       //    if (url.length > 0) {
       //        // For Ionic
       //        if ($('body').hasClass('platform-cordova')) {
       //            window.open(url, '_system', '');
       //        } else {
       //            window.open(url);
       //        }
       //    }
       //}
      
        function fillStops(response) {
            
            var stops = response.data.result.stops;
            for (var i = 0; i < stops.length; i++) {
                if (stops && stops[i].id) {
                    var stop = stops[i];
                    stop.distance = null;
                    stop.icon = 'images/pin_pickup@1x.png';
                    vm.stops.push(stop);
                }
            }
            populateStops();
        }

      function populateStops() {
            if (vm.stops.length == 0)
                    return;
            vm.mapControl.getGMap().markers =[];
            vm.closestBusStop = [];
            vm.allOtherStops = [];
            var stopsToCheck = [];
           

            for (var i = 0; i < vm.stops.length; i++) {
                if (vm.selectedLocation != undefined && vm.selectedLocation != null) {//here cull the ones with long distances
                    var d = rectilinearHaversine(vm.selectedLocation.coords, vm.stops[i]);
                    if (d <= vm.distance) {
                        vm.stops[i].distance = d;
                        stopsToCheck.push(vm.stops[i])
                    } else {
                        vm.stops[i].distance = null;
                        vm.allOtherStops.push(vm.stops[i]);
                    }

                }
                else {
                    vm.stops[i].distance = null;
                    vm.allOtherStops.push(vm.stops[i]);
                }
                    
            }
        
            
            if (vm.selectedLocation != null && stopsToCheck.length > 0) {
                LocationService.getDrivingDistances(vm.selectedLocation.coords, stopsToCheck)
                    .then(function (response) {
                        for (var i = 0; i < response.rows[0].elements.length; i++) {
                            stopsToCheck[i].distance = (parseFloat(response.rows[0].elements[i].distance.value) / 1000 * 0.621371).toFixed(2);
                            if (stopsToCheck[i].distance > vm.distance) {
                                stopsToCheck[i].distance = null;
                                if(vm.allOtherStops.indexOf(stopsToCheck[i]) < 0)
                                    vm.allOtherStops.push(stopsToCheck[i]);
                            }
                            else {
                                vm.closestBusStop.push(stopsToCheck[i]);
                            }
                        }

                        updateStops();


                    }, function (err) {
                        //when location services err.
                        Array.prototype.push.apply(vm.allOtherStops, vm.stops);
                         var otherStopIcon = {
                             url: otherPin,
                             size: new google.maps.Size(34, 60),
                             origin: new google.maps.Point(0, 0),
                             anchor: new google.maps.Point(24, 57)
                        };

                        vm.allOtherStops.sort(function (a, b) {
                            if(a.distance == null || b.distance == null)
                                return 10000
                             return a.distance -b.distance
                        });
       
                         angular.forEach(vm.allOtherStops, function (stop) {
                             stop.icon = otherStopIcon;
                             stop.distance = null;
                        });
                        google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                        resetMap();
                        
                    });
            } else {
                updateStops();
            }
                 
           
        }

      
      function updateStops()
      {
          vm.closestBusStop.sort(function (a, b) {
              if(a.distance == null || b.distance == null)
                  return 10000      
              return a.distance - b.distance
          });
          
          vm.allOtherStops.sort(function (a, b) {
              return (a.name < b.name) ? -1 : (a.name > b.name) ? 1 : 0;
          });
          
          var otherStopIcon = {
              url: otherPin,
              size: new google.maps.Size(34, 60),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(23, 57)
          };
          var closestStopIcon = {
              url: closestPin,
              size: new google.maps.Size(34, 60),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(23, 57)
          };
          angular.forEach(vm.closestBusStop, function (stop) {
              if (stop.isHub)
                  stop.icon = hubIcon;
              else
                  stop.icon = closestStopIcon;
          });
          angular.forEach(vm.allOtherStops, function (stop) {
              if (stop.isHub)
                  stop.icon = hubIcon;
              else
                  stop.icon = otherStopIcon;
          });
          vm.closestCount = $filter('filter')(vm.closestBusStop, { isHub: false }).length;
          vm.otherCount = $filter('filter')(vm.allOtherStops, { isHub: false }).length;

          google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
          resetMap();
         
      }

      function resetMap()
      {
          var bounds = new google.maps.LatLngBounds();

          angular.forEach(vm.stops, function (stop) {
              bounds.extend(new google.maps.LatLng(stop.latitude, stop.longitude));
          });
         
          if (vm.selectedLocation != undefined && vm.selectedLocation != null && vm.stops[0].distance != null && vm.stops[0].distance < vm.distance) {
              bounds.extend(new google.maps.LatLng(vm.selectedLocation.coords.latitude, vm.selectedLocation.coords.longitude));
          }
          vm.mapControl.getGMap().fitBounds(bounds);
          vm.mapControl.getGMap().setZoom(vm.mapControl.getGMap().getZoom() - 1); 
          vm.isLoading = false;
        }
      function haversineFormula(origin, stop) {
          //position1 =  vm.position
          //position2 = stop
          var lat1 = origin.latitude;
          var lon1 = origin.longitude;
          var lat2 = stop.latitude;
          var lon2 = stop.longitude

          var R = 6371; // km 
          var x1 = lat2 - lat1;
          var dLat = x1 * Math.PI / 180;
          var x2 = lon2 - lon1;
          var dLon = x2 * Math.PI / 180;
          var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                          Math.sin(dLon / 2) * Math.sin(dLon / 2);
          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
          var d = R * c * 0.62137; //convert to miles
          return d.toFixed(2);
      }

      function rectilinearHaversine(loc1, loc2) {
          var tempPoint = {
              "latitude": loc1.latitude,
               "longitude": loc2.longitude
          }
            
          var d1 = parseFloat(haversineFormula(loc1, tempPoint));
          var d2 = parseFloat(haversineFormula(tempPoint, loc2));
          return (d1 + d2).toFixed(2);
       }

 function activate()
    {
     $http.get('clientappsettings.json').then(function (response) {
         vm.distance = response.data.stopDistance;
         vm.myStyles = response.data.googleMapOptons;
         getMap();
     }, function (err) {
         MessageService.showError('Error Loading Stops.')
         //alert(err);
     });
 }

        // Start of code for Ionic
         vm.ionicInclude = 'app/modules/commuter/all-stops/all-stops.html';
         vm.ionicCustomClassName = '';
         vm.ionicHideNavBar = false;
         vm.ionicUseRefresher = false;
        // End of code for Ionic

 
    }
   
   

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('DirectionsController', DirectionsController);

    DirectionsController.$inject = ['$rootScope','$location', '$stateParams', 'ScheduleService', 'StopDataService', 'uiGmapIsReady'];

    function DirectionsController($rootScope,$location, $stateParams, ScheduleService, StopDataService, uiGmapIsReady) {

        var vm = this;
        
        vm.selectedStop = StopDataService.getStop();
        vm.hasStopDescription = false;

        //if (vm.selectedStop == undefined || vm.selectedStop == null || vm.selectedStop.latitude == undefined || vm.selectedStop.latitude == null)
        //    vm.selectedStop = {
        //        latitude: 40.651739,
        //        longitude: -73.953148
        //    }
        var currentLocation = StopDataService.getGeoLocation();
        //currentLocation = {
        //    coords: {
        //        latitude: 32.604777,
        //        longitude: -99.4343127
        //    }
        //}

        vm.fromLocation = currentLocation != null ? currentLocation.coords.latitude + ',' + currentLocation.coords.longitude : '';
        
        vm.center = {
            latitude: 40.651739,
            longitude: -73.953148
        };

        vm.zoom = 14;
        vm.mapControl = {};
        var myStyles = [
           {
               featureType: "poi",
               elementType: "labels",
               stylers: [
                     { visibility: "off" }
               ]
           },
           {
               "featureType": "transit",
               "elementType": "labels.icon",
               "stylers": [
                   {
                       "visibility": "off"
                   }
               ]
           }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: myStyles

        };
        vm.options = {};
        vm.markerEvents = function () {
            //for future?
        };
        vm.showDirections = currentLocation == null;

        var bounds = new google.maps.LatLngBounds();
        var directionsDisplay;
        var directionsService;
        uiGmapIsReady.promise().then(function (maps) {

            directionsDisplay = new google.maps.DirectionsRenderer;
            directionsService = new google.maps.DirectionsService;
            var directions = document.getElementById('directions');

            directionsDisplay.setMap(vm.mapControl.getGMap());
            directionsDisplay.setPanel(directions);

            if (vm.showDirections) {
                bounds.extend(new google.maps.LatLng(vm.selectedStop.latitude, vm.selectedStop.longitude));
                vm.center.latitude = vm.selectedStop.latitude;
                vm.center.longitude = vm.selectedStop.longitude;
              //  vm.mapControl.getGMap().fitBounds(bounds);
                google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            }
            else {
                mapDirection(vm.fromLocation);
            }
        });

        vm.getDirection = function () {

            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({ 'address': vm.fromLocation },
                function (response, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        mapDirection(response[0].geometry.location.lat() + ',' + response[0].geometry.location.lng());
                    }
                });
        };

        var mapDirection = function (start) {

            

            directionsService.route({
                origin: start,
                destination: vm.selectedStop.latitude + ',' + vm.selectedStop.longitude,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    vm.stopDescription = vm.selectedStop.description;
                    if (vm.stopDescription !== "" && !angular.isUndefined(vm.stopDescription))
                        vm.hasStopDescription = true;
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };


        //vm.navigateToTripPage = function (index) {
        //    var incident = vm.nonPerformedIncidents[index];
        //    $location.path('/selected-trip/' + 249.1 + '/' + incident.BlockId + '/' + incident.IncidentId);
        //}

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/directions/directions.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();

/// <reference path="home.html" />


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('CommuterHomeController', CommuterHomeController);

    CommuterHomeController.$inject =
        ['$scope', '$rootScope', '$location', 'ReservationService', 'authService',
             '$uibModal', 'MessageService', 'env', 'vehicleService', 'PageService','OneMvServices'];

    function CommuterHomeController($scope, $rootScope, $location, ReservationService,
        authService, 
        $uibModal, MessageService, env, vehicleService, PageService,OneMvServices) {

        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Dashboard');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);
        vm.isUserLoggedIn = authService.isLoggedIn();
        vm.reservationsAllowed = env.reservationsAllowed;
        vm.passengerId = '';
        vm.passengerReservations = [];
        vm.isLoading = true;
        vm.vehicles = [];
        vm.updatingVehicleInfo = [];
        vm.commuterFeatures = [

                                {
                                    "class": "carousel__item--all-stops",
                                    "headline": "Explore",
                                    "title": "Bus Stops",
                                    "description": "Find a bus stop near you.",
                                    "link": "commuter/all-stops",
                                    "cta" : "View Stops"
                                },
                                {
                                    "class": "carousel__item--advanced-reservations",
                                    "headline": "Book",
                                    "title": "Reservations",
                                    "description": "Up to two weeks in advance.",
                                    "link": "commuter/adv-schedule-setup",
                                    "cta": "Get Started"
                                },
                                {
                                    "class": "carousel__item--commuter-schedule",
                                    "headline": "View",
                                    "title": "Published Schedules",
                                    "description": "See all of the published schedule times at a glance.",
                                    "link": "commuter/published-schedule",
                                    "cta": "Show Schedule"
                                }
                            ];


        
        //method exposed to view
        vm.showCommuterTrip = showCommuterTrip;

        //var vm = this;

        $scope.carouselOptions = {
            navText: ["", ""],
            responsiveClass: false,
            nav: true,

            responsive: {
                0: {
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                375: {
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                768: {
                    items: 2,
                    stagePadding: 16,
                    startPosition: 1,
                    center: true,
                },
                992: {
                    items: 3,
                    stagePadding: 0,
                    center: false,
                }

            }
        };


        function getUserReservations(callback) {
            ReservationService.getPassengerReservationsForToday(vm.passengerId)
            .then(function (response) {
                if (response && response.data && response.data.status == 1 && response.data.result.reservations) {
                    vm.passengerReservations = response.data.result.reservations;
                    if (callback)
                        callback();
                    else
                        vm.isLoading = false;
                } else {
                    vm.passengerReservations = [];
                }
            }, function (err) {
                if (err.status !== 401) {
                    MessageService.showError('Sorry! Could not load your Reservation!');
                }
                vm.isLoading = false;
            });

        };


        function getVehicles() {
            vehicleService.getVehiclesForPassenger(vm.passengerId)
            .then(function (response) {
                if (response.data && response.data.status == 1 && response.data.result != null)
                    vm.vehicles = response.data.result;
                vm.isLoading = false;
            }, function (error) {
                vm.isLoading = false;
            });
        };

        function showCommuterTrip(trip) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: false,
                keyboard: false,
                resolve: {
                    tripId: trip.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getUserReservations(getVehicles);
                }
            });
        }
        function activate() {
            if (vm.isUserLoggedIn) {
                vm.passengerId = authService.authentication.passengerId;
                getUserReservations(getVehicles);
            }
        }


        vm.updateParkingVehicle = function (reservation, index) {
            vm.updatingVehicleInfo[index] = true;
            ReservationService
                .updateVehicleForReservation(reservation.ReservationId, reservation.VehicleId)
                .then(function (response) {
                    vm.updatingVehicleInfo[index] = false;
                }, function (error) {
                    vm.updatingVehicleInfo[index] = false;
                });
        };

        vm.showStopsMap = function (inc) {
            var modalGetMap = $uibModal.open({
                animation: true,
                windowClass: 'map-modal',
                templateUrl: 'app/modules/commuter/modals/reservation-map-modal/reservation-map.html',
                controller: 'ReservationMapController as vm',
                backdrop: 'static',
                resolve: {
                    reservation_stops: function () {
                        return inc;
                    }
                }
            });

            modalGetMap.result.then(function (isDone) {
                if (isDone) {
                }

            }, function () {

            });
        };

        vm.login = function () {
            $location.path('/login');
        };
        vm.ctaAction = function(link){
            $location.path(link);
        };
        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/home/home.html';
        vm.ionicCustomClassName = 'ionic-top-padding';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh';
        vm.ionicRefreshingText = 'Loading';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            vm.isLoading = true;
            vm.title = 'Home';
            vm.isUserLoggedIn = authService.isLoggedIn();
            vm.reservationsAllowed = env.reservationsAllowed;
            vm.passengerId = '';
            vm.userReservations = {};
            vm.vehicles = [];
            vm.updatingVehicleInfo = [];
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
            vm.isLoading = false;
        }
        // End of code for Ionic
    }
})();


(function () {
    'use strict';

    angular
   .module('oneMVApp')
   .controller('AdvScheduleConfirmationController', AdvScheduleConfirmationController);

    AdvScheduleConfirmationController.$inject = ['$state', '$stateParams', '$filter', '$uibModal',
        'ReservationService', 'DivisionService', 'authService', 'StopDataService'];

    function AdvScheduleConfirmationController($state, $stateParams, $filter, $uibModal,
        ReservationService, DivisionService, authService, StopDataService) {

        var vm = this;
        vm.title = 'Advance Reservations Confirmation';
        if (isNotFromAdvSchedule()) {
            $state.go('adv-schedule-setup');
            return;
        }

        var selectedConfig = $stateParams.obj.config;
        var weeks = $stateParams.obj.reservationInfo;
        var reservations = [];
        var passengerId = authService.authentication.passengerId;
        vm.divisionAllowsWaitlist = true;
       
        vm.successAnime = successAnime;
        vm.schedule = selectedConfig.schedule;
        vm.reserve = reserve;

        vm.showReservation = showReservation;
        vm.bookReturnTrip = bookReturnTrip;
        vm.back = back;
        vm.pickup = selectedConfig.pickup;
        vm.dropoff = selectedConfig.dropoff;
        vm.weeksToDisplay = filterSelectedTrips();
        vm.reserving = false;

        //Success Animation
        function successAnime(){
            setTimeout(function(){
            anime({
                targets: '.anim--success .lines path',
                strokeDashoffset: [anime.setDashoffset, 0],
                easing: 'easeInOutSine',
                duration: 1500,
                direction: 'alternate',
                loop: false
            });
        }, 0);
        }


        DivisionService
               .isWaitlistAllowedByDivision()
           .then(function (response) {
               vm.divisionAllowsWaitlist = response;
           });
        

        function bookReturnTrip() {

            StopDataService.getPickupForReturnTrip(selectedConfig.pickup.id, selectedConfig.dropoff.id)
            .then(function (response) {

                selectedConfig.schedule = "PM";
                selectedConfig.dropoff = angular.copy(vm.pickup);
                selectedConfig.pickup = mapPickup(response);
                selectedConfig.vehicle = { 'licenceplate': '--', 'vehicleId': undefined };

                $state.go('adv-schedule-setup', { obj: { config: selectedConfig } });

            }, function (error) {
                console.log("error fetching pickup for return trip.");
            });
        }

        function mapPickup(response) {
            if (response && response.data.status == 1 && response.data.result)
                return response.data.result;
            else
                return angular.copy(vm.dropoff);

        }


        function filterSelectedTrips() {

            var result = [];

            angular.forEach(weeks, function (week) {
                var selectedRecords = { from: '', to: '', days: [] };
                selectedRecords.from = $filter('date')(week[0].date, 'MM/dd/yyyy');
                selectedRecords.to = $filter('date')(week[week.length - 1].date, 'MM/dd/yyyy');
                angular.forEach(week, function (day) {                    
                    if (canReserve(day))
                        selectedRecords.days.push({
                            date: day.date,
                            vehicle: day.vehicle,
                            trip: getTrip(day),
                            isReserved: false,
                            isWaitlist: isWaitlistRequest(day),
                            waitlistCount: getWaitlistCount(day),
                        });
                });
                result.push(selectedRecords);
            });

            return result;
        }


        function isWaitlistRequest(day) {
            var waitlistCount = getWaitlistCount(day);

            return (day.vehicle.id && day.availableParking <= 0) || (waitlistCount != undefined && waitlistCount >= 0);
        }

        function getWaitlistCount(day) {

            var trip = getTrip(day);
            if (trip.availableCapacity <= 0) return trip.numberOfWaitlists;

            return undefined;
        }


        function getTrip(day) {
            if (day.trips && day.selectedTrip) {
                for (var i = 0; i < day.trips.length; i++) {
                    if (day.trips[i].tripId == day.selectedTrip)
                        return day.trips[i];
                }
            }

            return undefined;
        }

        function back() {
            $state.go('adv-schedule', { obj: $stateParams.obj });
        }

        function isNotFromAdvSchedule() {
            return $stateParams.obj == undefined || $stateParams.obj == null ||
                $stateParams.obj.reservationInfo == null || $stateParams.obj.reservationInfo == undefined;
        }

        function canReserve(day) {

            var selectedTrip = getTrip(day);

            return day.isOpen && selectedTrip != null && selectedTrip.totalPassengers > 0;
        }

        function createReservationRequest() {

            var reservations = [];

            var weekIndex = 0;
            angular.forEach(weeks, function (week) {
                var dayIndex = 0;
                angular.forEach(week, function (day) {
                    if (canReserve(day)) {

                        var trip = getTrip(day);

                        var reservation = {
                            reservationDate: day.date,
                            tripId: trip.tripId,
                            pickupStopId: vm.pickup.id,
                            dropoffStopId: vm.dropoff.id,
                            passengerId: passengerId,
                            routeId: trip.routeId,
                            schedule :vm.schedule,
                            divisionId: DivisionService.getDivisionId(),
                            vehicleId: day.vehicle != null ? day.vehicle.id : null,
                            isAdvance: true
                        };
                        reservations.push(
                            {
                                'reservation': reservation,
                                'id': weekIndex + '_' + dayIndex
                            });
                        dayIndex++;
                    }
                });
                weekIndex++;
            });
            return reservations;
        }

        function resetReservationVariables(id) {
            var day = getDayIdentifier(id);
            day.reservationFailed = false;
            day.reservationError = '';
            day.isReserved = false;
        }

        function reserve() {
            var reservations = createReservationRequest();

            if (reservations && reservations.length > 0)
                vm.reserving = true;

            for (var i = 0; i < reservations.length; i++) {
                (createReservation)(reservations[i].reservation, reservations[i].id);
                
            }
        }
        function createReservation(request, id) {

            resetReservationVariables(id);

            ReservationService.addReservations(passengerId, [request])
                    .then(function (response) {
                        if (response && response.data && response.data.status == 1
                            && response.data.result.errors.length == 0){
                            markReserved(id, response.data.result.id[0]);
                            successAnime();
                        }else {
                            setReservationFailureMessage(id, response.data.result.errors ? response.data.result.errors[0] : response.data.result);
                        }
                    }, function (error) {
                        setReservationFailureMessage(id, error);
                    });
        }

        function getDayIdentifier(dayIdentifier) {
            var idParts = dayIdentifier.split('_');
            var week = idParts[0];
            var day = idParts[1];
            return vm.weeksToDisplay[week].days[day];
        }

        function setReservationFailureMessage(dayIdentifier, errorMessage) {
            var day = getDayIdentifier(dayIdentifier);
            day.reservationFailed = true;
            day.reservationError = errorMessage; 
        }

        function markReserved(dayIdentifier, reservationId) {
            var day = getDayIdentifier(dayIdentifier);
            day.isReserved = true;
            day.reservation = reservationId;
        }


        function showReservation(id) {

            ReservationService.getReservationById(passengerId, id)
            .then(function (response) {

                if (response && response.data.status == 1)
                    var modalReserve = $uibModal.open({
                        animation: true,
                        size: '-fs',
                        backdrop: false,
                        templateUrl: 'app/modules/commuter/adv-schedule/reservation-modal.html',
                        controller: 'ReservationModalController as vm',
                        resolve: {
                            reservation: response.data.result
                        }
                    });
            });


        }

    }

})();
(function () {

    'use strict';
    angular
    .module('oneMVApp')
    .controller('AdvScheduleController', AdvScheduleController);
    AdvScheduleController.$inject = ['$scope', '$state', '$stateParams', '$q', '$location', '$anchorScroll', '$timeout', '$uibModal',
        'authService', 'StopDataService', 'vehicleService', 'PageService',
        'ReservationService', 'DivisionService', 'MessageService', 'CommonService', 'ScheduleService', 'smoothScroll'];

    function AdvScheduleController($scope, $state, $stateParams, $q, $location, $anchorScroll, $timeout, $uibModal,
        authService, StopDataService, vehicleService, PageService,
        ReservationService, DivisionService, MessageService, CommonService, ScheduleService, smoothScroll) {

        var vm = this;
        vm.PageService = PageService;

        if (isNotFromAdvSetup() && !isFromAdvConfirm()) {
            $state.go('adv-schedule-setup');
            return;
        }

        var passengerId = undefined;
        var passengerReservations = [];
        var pickup = undefined;
        var dropoff = undefined;
        var advWeeks = undefined;
        var divisionDate = moment();


        function init() {

            //event bindings
            vm.reserve = reserve;
            vm.filterWeekend = filterWeekend;
            vm.showSchedule = showSchedule;
            vm.dayClass = applyClass;
            vm.resetPassengerVehicle = resetPassengerVehicle;
            vm.back = back;
            vm.showReservationInfo = showReservationInfo;

            //global variables
            vm.noVehicle = { 'licenceplate': '--', 'id': undefined };
            vm.carouselOptions = setCarouselOptions();
            vm.selectedConfig = $stateParams.obj.config;
            vm.passengerVehicles = $stateParams.obj.vehicles;
            vm.weeks = [];
            vm.divisionAllowsWaitlist = true;

            //local variables
            passengerId = authService.authentication.passengerId;
            passengerReservations = [];
            pickup = vm.selectedConfig.pickup;
            dropoff = vm.selectedConfig.dropoff;
            advWeeks = vm.selectedConfig.numOfWeeks.name;

            vm.PageService.setTitle(pickup.name + '-' + dropoff.name);
        }

        function setCarouselOptions() {
            return {
                navText: ["", ""],
                responsiveClass: false,
                nav: true,
                loop: false,
                itemElement: 'cal__week',
                onDragged: carouselItemChangedEvent,
                items: 1
            };
        }

        function carouselItemChangedEvent(event) {
            var element = document.getElementById(event.page.index);
            var options = {
                duration: 700,
                easing: 'easeInQuad',
                offset: 120
            };
            smoothScroll(element, options);
        }


        function getStartDate(input) {
            var momentInput = moment(input);
            var day = momentInput.day();
            if (day == 6) return momentInput.add(1, 'days').toDate();
            if (day == 0) return momentInput.toDate();
            return momentInput.subtract(day, 'days').toDate();
        }

        function activate() {

            init();

            DivisionService
             .isWaitlistAllowedByDivision()
            .then(function (response) {
                    vm.divisionAllowsWaitlist = response;
                });

            getPassengerReservations()
              .then(function () {
                  populateWeeks();
              });
        }

        function getPassengerReservations() {
            var deferred = $q.defer();

            ReservationService
            .getAllReservationsForPassenger(passengerId)
            .then(function (response) {
                if (response.data.status == 1 && response.data.result.reservations)
                    passengerReservations = response.data.result.reservations.filter(reservationsForSchedule);
                deferred.resolve(response);
            });

            return deferred.promise;
        }

        function reservationsForSchedule(r) {
            return r.scheduleType.toLowerCase() == vm.selectedConfig.schedule.toLowerCase();
        }

        function reservationForDay(date) {
            var reservations = passengerReservations.filter(function (r) {
                return moment(r.reservationDate).dayOfYear() == date.dayOfYear() && r.status != 'Canceled';
            });
            return reservations == null || reservations.length == 0 ? undefined : reservations[0];
        }

        function populateWeeks() {
            ScheduleService.getServiceDateByDivision(DivisionService.getDivisionId())
                .then(function (response) {
                    divisionDate = response.data.result;
                    var startWeek = 0;
                    var endWeek = advWeeks;
                    var startDate = getStartDate(divisionDate);


                    populateCalendar(startWeek, endWeek, startDate, isInPast);

                    if (isWeekday(divisionDate)) {
                        startWeek = advWeeks;
                        endWeek = startWeek + 1;
                        startDate = (moment(startDate).add(7 * advWeeks, 'days')).toDate();
                        populateCalendar(startWeek, endWeek, startDate, isOutsideAllowedRange);
                    }
                    getTrips();
                    vm.weeksX = vm.weeks;
                    if (vm.selectedConfig.schedule == CommonService.ScheduleType.Morning)
                        getParking();

                });
        }

        function isWeekday(date) {

            var input = moment(date);
            return input.day() != 6 || input.day() != 0;
        }


        function populateCalendar(from, to, startDate, predicate) {
            var currentDate = moment(startDate);

            for (var week = from; week < to; week++) {
                var calendarDays = [];
                for (var day = 0; day < 7; day++) {
                    calendarDays.push({
                        'dayId': day,
                        'week': week,
                        'dayOfWeek': getWeekDay(currentDate),
                        'date': currentDate.toDate(),
                        'isOpen': setOpen(currentDate, predicate),
                        'disable': disable(currentDate, predicate),
                        'selectedTrip': undefined,
                        'trips': undefined,
                        'vehicle': vm.selectedConfig.vehicle,
                        'reservation': reservationForDay(currentDate)
                    });
                    currentDate = currentDate.add(1, 'days');
                }
                vm.weeks[week] = calendarDays;
            }
        }

        function disable(currentDate, predicate) {
            return predicate(currentDate) || reservationForDay(currentDate) != undefined;
        }

        function setOpen(currentDate, predicate) {
            return !predicate(currentDate) && wasSelected(currentDate) && reservationForDay(currentDate) === undefined;
        }

        function isInPast(date) {
            return date.dayOfYear() < moment(divisionDate).dayOfYear();
        }

        function isOutsideAllowedRange(date) {
            return date.dayOfYear() > moment(divisionDate).dayOfYear() + advWeeks * 7;
        }

        function getWeekDay(date) {
            var weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            return weekDays[date.weekday()];
        }

        function wasSelected(date) {
            for (var i = 0; i < vm.selectedConfig.weekDays.length; i++) {
                if (vm.selectedConfig.weekDays[i].id == date.day())
                    return true;
            }
            return false;
        }



        function getTrips() {
            for (var j = 0; j < vm.weeks.length; j++) {
                for (var i = 0; i < vm.weeks[j].length; i++) {
                    if (vm.weeks[j][i].isOpen && !vm.weeks[j][i].disable)
                        (getTripInfo)(j, i);
                }
            }
        }

        function getParking() {
            for (var j = 0; j < vm.weeks.length; j++) {
                for (var i = 0; i < vm.weeks[j].length; i++) {
                    if (vm.weeks[j][i].isOpen && !vm.weeks[j][i].disable)
                        (getAvailableParking)(j, i);
                }
            }
        }

        function getAvailableParking(week, day) {
            StopDataService
              .getAvailableParkingsForStop(pickup.id, Date.parse(vm.weeks[week][day].date))
          .then(function (response) {
              if (response.data.status == 1) {
                  vm.weeks[week][day].availableParking = response.data.result;
              }
          });
        }

        function getTripInfo(week, day) {
            StopDataService
              .getNonPerformedTrips(pickup.id, dropoff.id, vm.selectedConfig.schedule, Date.parse(vm.weeks[week][day].date))
          .then(function (response) {
              if (response.data.status == 1 && response.data.result) {
                  vm.weeks[week][day].trips = response.data.result.NonPerformedTrips;
                  mapSelectedTrip(week, day);
              }

              if (vm.weeks[week][day].trips == null) {
                  vm.weeks[week][day].isOpen = false;
                  vm.weeks[week][day].disable = true;
              }
          });
        }

        function mapSelectedTrip(week, day) {
            if (vm.weeks[week][day] == undefined || vm.weeks[week][day].trips == undefined)
                return;

            var trips = vm.weeks[week][day].trips;
            for (var i = 0; i < trips.length; i++) {
                if (vm.selectedConfig.tripTime.tripId == trips[i].tripId) {
                    vm.weeks[week][day].selectedTrip = trips[i].tripId;
                    return;
                }
            }
        }

        function applyClass(day) {
            if (isWeekend(day)) return 'cal__day--disabled';

            if (angular.isUndefined(day.trips) || !day.isOpen) return 'cal__day--inactive';
            return 'cal__day--active';
        }

        function showSchedule(day) {

            if (isWeekend(day) || day.disable) return;

            day.isOpen = !day.isOpen;

            if (!day.isOpen)
                day.trips = undefined;

            getTripInfo(day.week, day.dayId);
            getAvailableParking(day.week, day.dayId);

            var hash = day.dayId + '_' + day.week;
        }

        function filterWeekend() {
            return function (day) {
                return day.dayOfWeek != 'Sat' && day.dayOfWeek != 'Sun';
            };
        };

        function isWeekend(day) {
            day.dayOfWeek == 'Sat' || day.dayOfWeek == 'Sun'
        }

        function resetPassengerVehicle(day) {
            if (vm.passengerVehicles && vm.passengerVehicles.length > 0)
                day.vehicle = vm.passengerVehicles[0];
        }

        function isNotFromAdvSetup() {
            return $stateParams.obj == null
                || $stateParams.obj == undefined
                || $stateParams.obj.config == null
                || $stateParams.obj.config == undefined;
        }

        function isFromAdvConfirm() {
            return $stateParams.obj != null
                && $stateParams.obj != undefined
                && $stateParams.obj.reservationInfo != null
                && $stateParams.obj.reservationInfo != undefined;
        }

        function back() {
            $state.go('adv-schedule-setup');
        }

        function showReservationInfo(reservation) {
            $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/adv-schedule/reservation-modal.html',
                controller: 'ReservationModalController as vm',
                backdrop: false,
                size: '-fs',
                resolve: {
                    reservation: reservation
                }
            });
        }

        function reserve() {
            var allowReservation = false;
            angular.forEach(vm.weeks, function (week) {
                angular.forEach(week, function (day) {
                    if (day.isOpen && day.selectedTrip != null) {
                        allowReservation = true;
                    }
                });
            });

            if (allowReservation) {
                $state.go('adv-schedule-confirmation',
                {
                    obj:
                    {
                        config: vm.selectedConfig,
                        vehicles: vm.passengerVehicles,
                        reservationInfo: vm.weeks
                    }
                });
            }

        }
        activate();
    }
})();



(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('owlCarousel', MVOwlCarousel);

    MVOwlCarousel.$inject = [];

    function MVOwlCarousel() {
        return {
            restrict: 'E',
            transclude: false,
            link: function (scope) {
                scope.initCarousel = function (element) {
                    // provide any default options you want
                    var defaultOptions = {
                    };
                    var customOptions = scope.$eval($(element).attr('data-options'));
                    // combine the two options objects
                    for (var key in customOptions) {
                        defaultOptions[key] = customOptions[key];
                    }
                    // init carousel
                    angular.element(element).owlCarousel(defaultOptions);
                };
            }
        };
    }

})();

(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('owlCarouselItem', MVOwlCarouselItem);

    MVOwlCarouselItem.$inject = [];

    function MVOwlCarouselItem() {
        return {
            restrict: 'A',
            transclude: false,
            link: function (scope, element) {
                // wait for the last item in the ng-repeat then call init
                if (scope.$last) {
                    scope.initCarousel(element.parent());
                }
            }
        };
    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('AdvScheduleSetupController', AdvScheduleSetupController);

    AdvScheduleSetupController.$inject = ['$scope', '$state', '$uibModal', '$stateParams',
        'authService', 'StopDataService', 'vehicleService', 'CommonService',
        'ReservationService', 'MapService', 'MapIconService', 'PageService','LuumLinkedService','OneMvServices'];

    function AdvScheduleSetupController($scope, $state, $uibModal, $stateParams,
        authService, StopDataService, vehicleService, CommonService,
        ReservationService, MapService, MapIconService, PageService, LuumLinkedService,OneMvServices) {

        var vm = this;
        vm.PageService = PageService;             
        vm.PageService.setTitle('Advanced Reservations');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);
        var passengerId = authService.authentication.passengerId;
        var allStops = [];
        var noTripTime = { 'pickupTime': 'Optional', 'tripId': undefined };
        var noVehicle = { 'licenceplate': '--', 'vehicleId': undefined };
        var noStop = { 'id': undefined, 'name': '--', 'latitude': null, 'longitude': null };
        var markerEvents = [{ event: 'click', callback: iconClickHandler }];

        vm.map = MapService.initializeMap();
        vm.title = 'Advance Reservations Setup';
        vm.isLoading = false;
        vm.isPassengerLoggedIn = authService.isLoggedIn();
        vm.markers = [];
        vm.selectedConfig = getDefaultConfig();

        var returnTripConfig = getReturnTripConfig();

        vm.pickupStops = [];
        vm.dropoffStops = [];
        vm.tripTimes = [];
        vm.passengerVehicles = [];
        vm.coords = undefined;
        vm.numOfWeeks = [];
        vm.daysOfWeek =
                    [
                    { 'name': 'S', 'selected': false, 'id': 0 },
                    { 'name': 'M', 'selected': false, 'id': 1 },
                    { 'name': 'T', 'selected': false, 'id': 2 },
                    { 'name': 'W', 'selected': false, 'id': 3 },
                    { 'name': 'TH', 'selected': false, 'id': 4 },
                    { 'name': 'F', 'selected': false, 'id': 5 },
                    { 'name': 'S', 'selected': false, 'id': 6 }
                    ];

        vm.hasTemplates = false;
        vm.templates = [];
        vm.useDefaultTemplate = false;
        vm.overrideTemplate = false;
        vm.addTemplate = false;

        function isReturnTripRequest() {
            return $stateParams.obj != null
                && $stateParams.obj != undefined
                && $stateParams.obj.config != null
                && $stateParams.obj.config != undefined;
        }

        function getReturnTripConfig() {
            return isReturnTripRequest() ? $stateParams.obj.config : undefined;
        }

        function getDefaultConfig() {
            return {
                schedule: CommonService.ScheduleType.Morning,
                pickup: undefined,
                dropoff: undefined,
                weekDays: [],
                tripTime: undefined,
                numOfWeeks: undefined,
                vehicle: undefined
            };
        }


        vm.pickupChanged = function () {
            if (!vm.selectedConfig.pickup || !vm.selectedConfig.pickup.id) {
                vm.selectedConfig.dropoff = vm.pickupStops[0];
                vm.markers = [];
                vm.addTemplate = false;
                return;
            };
            
            vm.selectedConfig.dropoff = noStop;
            vm.show = false;
            setMarkers();
            MapService.setMapBounds(vm.markers, markerEvents);
            getDropoffs();
        }

        vm.dropoffChanged = function () {
            if (!vm.selectedConfig.pickup || !vm.selectedConfig.pickup.id) {                
                return
            };

            vm.show = false;
            if (vm.selectedConfig.dropoff && vm.selectedConfig.dropoff.id)
                getTripTimes();
            else
                vm.addTemplate = false;

            setMarkers();
            MapService.setMapBounds(vm.markers, markerEvents);
        }     

        $scope.$watch('vm.daysOfWeek|filter:{selected:true}', function (value) {
            vm.selectedConfig.weekDays = value.map(function (day) {
                return day;
            });
        }, true);

        $scope.$watch('vm.parkingSelected', function (value) {
            if (!value)
                vm.selectedConfig.vehicle = noVehicle;
        });



        $scope.$watch('vm.useDefaultTemplate', function (value) {

            if (!value)
                vm.parkingSelected = false;

            setSelectedTrip();
            filterPickups();
            resetWeekDays();
            setSelectedVehicle();
            

            if (vm.templates.length > 0 && vm.useDefaultTemplate) {
                var template = getTemplate();
                for (var i = 0; i < vm.daysOfWeek.length; i++) {
                    vm.daysOfWeek[i].selected = isWeekdaySelected(vm.daysOfWeek[i], template.daysOfWeek);
                }
            }
        });


        function getTemplate() {
            for (var i = 0; i < vm.templates.length; i++) {
                if (vm.templates[i].schedule == vm.selectedConfig.schedule)
                    return vm.templates[i];
            }

            return undefined;
        }

        vm.scheduleChanged = function () {
            vm.dropoffStops = [];
            vm.markers = [];
            vm.show = false;
            vm.useDefaultTemplate = false;
            filterPickups();
            resetWeekDays();
            resetTripTimes();
            setHasTemplate();
        }

        vm.clearWeekSelection = function () {
            resetWeekDays();
        }


        vm.next = function () {
            if (vm.addTemplate || vm.overrideTemplate) {

                var template = {
                    PickupStopId: vm.selectedConfig.pickup.id,
                    DropoffStopId: vm.selectedConfig.dropoff.id,
                    TripId: vm.selectedConfig.tripTime.tripId,
                    Schedule: vm.selectedConfig.schedule,
                    VehicleId : vm.selectedConfig.vehicle.id,
                    SelectedDays : getSelectedDays()
                };

                ReservationService.addPassengerTemplate(passengerId, template)
                .then(function () {
                    next();
                }, function () {
                    next();
                });
            }

            next();
        }


        function getSelectedDays() {

            var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            
            var selectedDays = {};
            for (var i = 0; i < vm.selectedConfig.weekDays.length; i++) {
                var key = weekdays[vm.selectedConfig.weekDays[i].id];
                selectedDays[key] = vm.selectedConfig.weekDays[i].selected;
            }

            return selectedDays;
        }


        function next() {
            $state.go('adv-schedule', {
                obj: {
                    config: vm.selectedConfig, vehicles: vm.passengerVehicles
                }
            });
        }


        vm.login = function () {
            redirectToLogin();
        }


        vm.showAddVehicleDialog = function () {
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html',
                controller: 'AddVehicleController as vm',
                size: "-fs",
                backdrop: false,
                resolve: {
                    atleastOneVehicleExist: vm.passengerVehicles.length > 0
                }
            });
            modalReserve.result.then(function (result) {
                if (result.isAdded)
                    getPassengerVehicles();
            });
        }

        function setMarkers() {
            vm.markers = [];

            if (vm.selectedConfig.pickup && vm.selectedConfig.pickup.id !== undefined)
                vm.markers.push({
                    latitude: vm.selectedConfig.pickup.latitude,
                    longitude: vm.selectedConfig.pickup.longitude,
                    icon: getMapIcon(vm.selectedConfig.pickup.isHub),
                    name: vm.selectedConfig.pickup.name,
                    address: vm.selectedConfig.pickup.address
                });

            if (vm.selectedConfig.dropoff && vm.selectedConfig.dropoff.id !== undefined)
                vm.markers.push({
                    latitude: vm.selectedConfig.dropoff.latitude,
                    longitude: vm.selectedConfig.dropoff.longitude,
                    icon: getMapIcon(vm.selectedConfig.dropoff.isHub),
                    name: vm.selectedConfig.dropoff.name,
                    address: vm.selectedConfig.dropoff.address
                });
        }


        function getMapIcon(isHub) {
            return isHub ? MapIconService.getCommuterHubIcon() :
                MapIconService.getCommuterStopIcon();
        }

        function resetWeekDays() {
            vm.selectedConfig.weekDays = [];
           
                angular.forEach(vm.daysOfWeek, function (dayOfWeek, key) {
                    dayOfWeek.selected = false;
                });
        }

        function resetTripTimes() {
            vm.selectedConfig.tripTime = {};
            vm.tripTimes = [];
        }


        function filterPickups() {
            vm.pickupStops = allStops.filter(function (stop) {
                return stop.isHub != (vm.selectedConfig.schedule == CommonService.ScheduleType.Morning);
            });
            vm.pickupStops.splice(0, 0, noStop);

            setPickupStop();            
        }

        function setPickupStop() {

            var pickupId = undefined;            

            if (isReturnTripRequest() && returnTripConfig)
                pickupId = returnTripConfig.pickup.id;
            else if (vm.templates.length > 0 && vm.useDefaultTemplate)
                pickupId = getTemplate().pickupId;
            
            var matchFound = false;
            for (var i = 0; i < vm.pickupStops.length; i++) {
                if (vm.pickupStops[i].id == pickupId){
                    vm.selectedConfig.pickup = vm.pickupStops[i];
                    matchFound =true;
                    break;
                }
            }

            if (!matchFound)
                vm.selectedConfig.pickup = vm.pickupStops[0];

            vm.pickupChanged();
        }


        function setDropoffStop() {

            var dropoffId = undefined;

            if (isReturnTripRequest() && returnTripConfig) 
                dropoffId = returnTripConfig.dropoff.id;            
            else if (vm.templates.length > 0 && vm.useDefaultTemplate)
                dropoffId = getTemplate().dropoffId;

            var matchFound = false;
            for (var i = 0; i < vm.dropoffStops.length; i++) {
                if (vm.dropoffStops[i].id == dropoffId) {
                    vm.selectedConfig.dropoff = vm.dropoffStops[i];
                    matchFound = true;
                    break;
                }
            }

            if(!matchFound)
                vm.selectedConfig.dropoff = vm.dropoffStops[0];

            vm.dropoffChanged();

        }

        function activate() {
            if (!vm.isPassengerLoggedIn)
                redirectToLogin();
            LuumLinkedService.verify(authService.authentication.passengerId);
            getPassengerTemplates();            
            getPassengerVehicles();
        }


        function getPassengerTemplates() {
            ReservationService.getPassengerTemplates(passengerId)
           .then(function (response) {
               if (response && response.data.status && response.data.result && response.data.result.length > 0) {                   
                   mapTemplates(response.data.result);
               }

               getAdvReservationWindow();
               getAllStops();

           });
        }


        function mapTemplates(templates) {
            for (var i = 0; i < templates.length; i++)
                vm.templates.push(templates[i]);

            setHasTemplate();
        }

        function setHasTemplate() {
            var found = false;
            for (var i = 0; i < vm.templates.length; i++) {
                if (vm.selectedConfig.schedule == vm.templates[i].schedule) {
                    found = true;
                    break;
                }
            }
            vm.hasTemplates = found;
        }


        function iconClickHandler(model) {
            vm.show = true;
            vm.coords = model.coords;
        }


        function getAdvReservationWindow() {
            vm.numOfWeeks = [];
            ReservationService.getAdvReservationAllowedWeeks()
            .then(function (response) {
                if (response.data.status == 1) {
                    var numWeeks = response.data.result;
                    for (var i = 1; i <= numWeeks; i++) {
                        vm.numOfWeeks.push({
                            'name': i
                        });
                    }

                    var  weekToSelect = vm.numOfWeeks[vm.numOfWeeks.length - 1];

                    if (isReturnTripRequest()) {
                        for (var i = 0; i < vm.numOfWeeks.length; i++) {
                            if (vm.numOfWeeks[i].name === returnTripConfig.numOfWeeks.name) {
                                weekToSelect = vm.numOfWeeks[i];
                                break;
                            }
                        }
                    }

                    vm.selectedConfig.numOfWeeks = weekToSelect;
                }
            });
        }

        function getAllStops() {
            StopDataService.getAllBusStops()
                .then(function (response) {
                    if (response.data.status == 1 && response.data.result) {
                        allStops = response.data.result.stops;

                        if (isReturnTripRequest() && returnTripConfig) {
                            vm.selectedConfig = angular.copy(returnTripConfig);
                            setHasTemplate();
                            for (var i = 0; i < vm.daysOfWeek.length; i++) {                                                                
                                vm.daysOfWeek[i].selected = isWeekdaySelected(vm.daysOfWeek[i], returnTripConfig.weekDays);
                            }
                        }                        

                        filterPickups();
                    }
                });
        }


        function isWeekdaySelected(input, configurationWeekDays) {
            for (var i = 0; i < configurationWeekDays.length; i++) {
                if (input.name == configurationWeekDays[i].name
                    && configurationWeekDays[i].selected)
                    return true;
            }
            return false;
        }

        function getPassengerVehicles() {
            vehicleService
                .getVehiclesForPassenger(passengerId)
            .then(function (response) {
                if (response.data && response.data.status == 1 && response.data.result.passengerVehicles)
                    vm.passengerVehicles = response.data.result.passengerVehicles;

                if (vm.passengerVehicles.length > 0)
                    vm.passengerVehicles.splice(0, 0, noVehicle);
                else
                    vm.passengerVehicles = [noVehicle];

                setSelectedVehicle();                
            });
        }

        function setSelectedVehicle() {

            var template = getTemplate();

            if (vm.useDefaultTemplate && template != undefined
                    && vm.selectedConfig.schedule == "AM" && template.vehicleId) {

                for (var i = 0; i < vm.passengerVehicles.length; i++) {
                    if (vm.passengerVehicles[i].id == template.vehicleId) {
                        vm.parkingSelected = true;
                        vm.selectedConfig.vehicle = vm.passengerVehicles[i];
                        break;
                    }
                }
            }

            else
                vm.selectedConfig.vehicle = vm.passengerVehicles[0];
        }


        function getDropoffs() {
            if (!vm.selectedConfig.pickup || !(vm.selectedConfig.pickup.id))
                return;

            StopDataService
                .getDropoffsForSelectedPickup(vm.selectedConfig.pickup.id)
            .then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    vm.dropoffStops = response.data.result.dropoffs;
                    vm.dropoffStops.splice(0, 0, noStop);

                    setDropoffStop();
                }
            });
        }

        function getTripTimes() {
            if (!vm.selectedConfig.pickup.id || !vm.selectedConfig.dropoff.id)
                return;

            StopDataService
                .getTripTimesForAdvancedReservation
                (vm.selectedConfig.pickup.id, vm.selectedConfig.dropoff.id, vm.selectedConfig.schedule)
                .then(function (response) {
                    if (response.data.status == 1 && response.data.result.allTrips) {
                        vm.tripTimes = response.data.result.allTrips;
                        vm.tripTimes.splice(0, 0, noTripTime);

                        setSelectedTrip();
                    }
                });
        }


        function setSelectedTrip() {
            if (vm.templates.length > 0 && vm.useDefaultTemplate) {
                var template = getTemplate();
                if (!template)
                    vm.selectedConfig.tripTime = vm.tripTimes[0];
                else {
                    for (var i = 0; i < vm.tripTimes.length; i++) {
                        if (vm.tripTimes[i].tripId == template.tripId) {
                            vm.selectedConfig.tripTime = vm.tripTimes[i];
                            break;
                        }
                    }
                }
            }
            else
                vm.selectedConfig.tripTime = vm.tripTimes[0];
        }

        function redirectToLogin() {
            $state.go('login');
        }

        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/adv-schedule/adv-schedule-setup.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Reservations';
        vm.ionicRefreshingText = 'Loading Reservations';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            vm.isLoading = true;
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
            vm.isLoading = false
        }
        // End of code for Ionic
    }

})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ReservationModalController', ReservationModalController);

    ReservationModalController.$inject = ['$uibModalInstance','reservation'];

    function ReservationModalController($uibModalInstance, reservation) {
        var vm = this;


        vm.passengerReservations = [reservation];

        vm.close = function () {
            $uibModalInstance.close();
        };
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LastLocationController', LastLocationController);

    LastLocationController.$inject = ['$rootScope','StopDataService', '$q', '$http', 'env', 'uiGmapIsReady', '$stateParams', '$interval', '$window', 'GeoLocationService', '$timeout', '$state', 'MessageService'];

    function LastLocationController($rootScope,StopDataService, $q, $http, env, uiGmapIsReady, $stateParams, $interval, $window, GeoLocationService, $timeout, $state, MessageService) {
        var vm = this;
        vm.mapControl = {};
        var myStyles = [
           {
               featureType: "poi",
               elementType: "labels",
               stylers: [
                     { visibility: "off" }
               ]
           },
           {
               "featureType": "transit",
               "elementType": "labels.icon",
               "stylers": [
                   {
                       "visibility": "off"
                   }
               ]
           }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: true,
            streetViewControl: false,
            styles: myStyles

        };
        var busPin, stopPin, locationPin, myLocationPin, pinHub;
        var k = 0.001;
        if($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            busPin = 'images/pin-vehicle-blue.png';
            stopPin = 'images/pin-busstop-grey.png';
            locationPin = 'images/pin-location.png';
            myLocationPin = 'images/pin-my-location.png';
            pinHub = 'images/pin-hub.png';
        }
        else {
            busPin = 'images/pin-vehicle-blue.svg';
            stopPin = 'images/pin-busstop-grey.svg';
            locationPin = 'images/pin-location.svg';
            myLocationPin = 'images/pin-my-location.svg';
            pinHub = 'images/pin-hub.svg';
        }

        vm.hubIcon = { url: pinHub };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.tripDetails = {
            busName: '',
            ETA: ''
            

        };
        vm.show = true;
        vm.markerEvent = {
            click: function (gMarker, eventName, model) {
               vm.show = !vm.show
                }
        };

        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.zoom = 4;
        vm.incident = StopDataService.getIncident();
        vm.vehicleId = StopDataService.getVehicleId();
      //  vm.vehicleId = '103';
        if (angular.isUndefined(vm.vehicleId) || vm.vehicleId == null)
            vm.show = false;
        vm.stop = StopDataService.getStop() || null;
        if (vm.stop != null && vm.stop.latitude != undefined && vm.stop.latitude != null)
            vm.stop.icon = { url: stopPin };
        else
            vm.stop = null;
        vm.vehicle = {};
        vm.myLocation = undefined;
        vm.busLocation = undefined;
       
        vm.hubs = [];
        

        if (vm.incident) {
            //check for -ve in string and say ago or in
            vm.tripDetails.ETA = (vm.incident.EstimatedTimeString.indexOf('-') > -1 ? 'Departed ' : '') + vm.incident.EstimatedTimeString.replace('-', '') + ' min' + (vm.incident.EstimatedTimeString.indexOf('-') > -1 ? ' ago' : '');
            vm.tripDetails.busName = (!angular.isUndefined(vm.incident.TheVehicle) && vm.incident.TheVehicle != null) ? vm.incident.TheVehicle.VehicleName : '';
            vm.schedType = vm.incident.AMPM;
            if (vm.incident.IncidentHubs && vm.incident.IncidentHubs.length > 0) {
                angular.forEach(vm.incident.IncidentHubs, function (hub) {
                    if (hub.latitude != 0 && hub.longitude != 0)
                        vm.hubs.push(hub);
                });
            }
                
        }
        else {
            vm.show = false;
        }

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                return StopDataService.getVehicle(vm.vehicleId)
            }, function (err) {
                MessageService.showError('Sorrry! Map could not be loaded.')
            })
            .then(function (vehicle) {
                vm.busLocation = {
                    latitude: parseFloat(vehicle.data.MDC.LastLatitude),
                    longitude: parseFloat(vehicle.data.MDC.LastLongitude),
                    icon: { url: busPin }
                };
                $timeout(function () {
                    google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                    resetMap()
                }, 50);

            },
                function (err) {
                    $timeout(function () {
                        google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                        resetMap()
                    }, 50);
                });
            //.then(function (position) {
            //     vm.myLocation = {
            //        coords: {
            //            latitude:position.coords.latitude,
            //            longitude: position.coords.longitude
            //        },
            //        icon: vm.myLocationIcon
            //     };
               
            //     $timeout(function () {
            //         google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
            //         resetMap()
            //     }, 50);
            //}, function (err) {
            //    $timeout(function () {
            //        google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
            //        resetMap();
            //    }, 50);
            //});
        }

        activate();

       function activate() {
           getMap();

            vm.promise = $interval(updateVehiclePosition, 15000);
       }

       vm.$onDestroy = function () {
           $interval.cancel(vm.promise);
       };
       function resetMap() {
           var bounds = new google.maps.LatLngBounds();
           
           if (vm.schedType == 'AM') {
               if (!angular.isUndefined(vm.stop) && vm.stop != null && vm.stop.latitude != null && vm.stop.latitude != 0)
                   bounds.extend(new google.maps.LatLng(vm.stop.latitude, vm.stop.longitude));
           }
           if (vm.busLocation != null && vm.busLocation.latitude != null && vm.busLocation.latitude != 0)
               bounds.extend(new google.maps.LatLng(vm.busLocation.latitude, vm.busLocation.longitude));
           if (vm.schedType == 'PM') {
               if (vm.hubs.length > 0) {
                   angular.forEach(vm.hubs, function (hub) {
                       bounds.extend(new google.maps.LatLng(hub.latitude, hub.longitude));
                   });
               }
           }
           if (!bounds.isEmpty()) {
               vm.mapControl.getGMap().fitBounds(bounds);
               vm.mapControl.getGMap().setZoom(vm.mapControl.getGMap().getZoom() - 1);
           }
           //if (vm.busLocation != null && vm.busLocation.latitude != null && vm.busLocation.latitude != 0) {
           //    vm.center = {
           //        latitude: vm.busLocation.latitude,
           //        longitude: vm.busLocation.longitude
           //    };
           //}

       }

       function updateVehiclePosition() {
           if($state.current.name != 'last-location')
           {
               $interval.cancel(vm.promise);
           }
           else
           {
               
               StopDataService.getVehicle(vm.vehicleId).then(function (vehicle) {
                   if (!angular.isUndefined(vehicle.data.MDC) && vehicle.data.MDC != null) {
                       vm.busLocation = {
                           latitude: parseFloat(vehicle.data.MDC.LastLatitude),
                           longitude: parseFloat(vehicle.data.MDC.LastLongitude),
                           icon: { url: busPin }
                       };
                   }
                   //vm.center = {
                   //    latitude: parseFloat(vehicle.data.MDC.LastLatitude),
                   //    longitude: parseFloat(vehicle.data.MDC.LastLongitude),
                   //};
              
               }, function (err) {
                   $interval.cancel(vm.promise);
               });
           }
       }

        // Start of code for Ionic
       vm.ionicInclude = 'app/modules/commuter/location/last-location.html';
       vm.ionicCustomClassName = '';
       vm.ionicHideNavBar = false;
       vm.ionicUseRefresher = false;
        // End of code for Ionic

    }

    
})();

(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('LocationService', LocationService);

	LocationService.$inject = ['$http', '$q'];

	function LocationService($http, $q) {

		var service = {
			getLocation: getLocationFromGoogle,
			getDrivingDistances: getDrivingDistances

		};

		function getDrivingDistances(position, destinations) {
			var deferred = $q.defer();
			var dests = [];
			angular.forEach(destinations, function (value, key) {
				dests.push({ 'lat': value.latitude, 'lng': value.longitude });
			});

			var service = new google.maps.DistanceMatrixService;
			service.getDistanceMatrix({
				origins: [{ 'lat': position.latitude, 'lng': position.longitude }],
				destinations: dests,
				travelMode: 'DRIVING',
				unitSystem: google.maps.UnitSystem.METRIC,
				avoidHighways: false,
				avoidTolls: false
			}, function (response, status) {
				if (status !== 'OK') {
					deferred.reject('Cannot calculate distance');
				} else {
					deferred.resolve(response);
				}
			});
			return deferred.promise;

		}


		function getLocationFromGoogle(searchTerm) {
			var deferred = $q.defer();
			//$http.get('https://maps.googleapis.com/maps/api/geocode/json', {
			//    params: {
			//        address: searchTerm,
			//        sensor: true,
			//        key: 'AIzaSyCA5jVfa7sJk7OYR_dUbTsZrGJA7E1AduI'
			//    }
			//}).then(function successCallback(response) {
			//    deferred.resolve(response);
			//}, function (err) {
			//    deferred.reject(err);
			//});
			//return deferred.promise;



			var geocoder = new google.maps.Geocoder;
			var address = searchTerm;

			if (geocoder) {
				geocoder.geocode({ 'address': address }, function (results, status) {
					if (status == google.maps.GeocoderStatus.OK) {
						deferred.resolve(results);
					}
					else {
						deferred.reject(status);
					}
				});


			}
			else
				deferred.reject('Geocoder service not available');
			return deferred.promise;


		}



		return service;

	}




})();





(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MessageController', MessageController);

    MessageController.$inject = ['$location', '$uibModalInstance', 'message'];

    function MessageController($location, $uibModalInstance, message) {
        var vm = this;
        vm.title = message.type;
        vm.content = message.message;

        vm.isError = false;
        vm.isInfo = false;
        vm.isSuccess = false;

        vm.cancel = cancel;
        function cancel() {
            $uibModalInstance.close();
        };

        switch (message.type) {
            case 'Error':
                vm.isError = true;
                break;
            case 'Information':
                vm.isInfo = true;
                break;
            case 'Success':
                vm.isSuccess = true;
                break;
        }
    };
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('MessageService', MessageService);

    MessageService.$inject = ['$http', '$uibModal'];

    function MessageService($http, $uibModal) {
        var service = {
            showError: showError,
            showInformation: showInformation,
            showSuccess: showSuccess
        };

        return service;

        function showError(message) {
            showMessage(message, 'Error');
        }
        function showInformation(message) {
            showMessage(message, 'Information');
        }
        function showSuccess(message) {
            showMessage(message, 'Success');
        }

        function showMessage(messageToDisplay, type) {
            var messageObj = {
                message: messageToDisplay,
                type: type
            };
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/message/message.html',
                controller: 'MessageController as vm',
                size: '-fs',
                backdrop: 'static',
                resolve: {
                    message: messageObj
                }
            });
            modalReserve.result.then(function () {
            });
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MyVehiclesController', MyVehiclesController);

    MyVehiclesController.$inject = ['$rootScope','$location', '$uibModal', 'authService', 'vehicleService', 'MessageService','LuumLinkedService', 'PageService'];

    function MyVehiclesController($rootScope, $location, $uibModal, authService, vehicleService, MessageService, LuumLinkedService, PageService) {
        var vm = this;
        var passengerId = authService.authentication.passengerId;

        vm.vehicles = [];
        vm.vehicleInfo = undefined;
        vm.isLoading = false;
        vm.isRemoving = false;
        vm.PageService = PageService;
        vm.PageService.setTitle('My Vehicles');
        vm.PageService.setHeadline('Manage Vehicles');

        vm.addNew = function () {
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html',
                controller: 'AddVehicleController as vm',
                backdrop: 'static',
                resolve: {
                    atleastOneVehicleExist: vm.vehicles.length > 0
                }
            });
            modalReserve.result.then(function (result) {
                if(result.isAdded)
                    getVehicles();
            });
        };
        
        
        vm.remove = function (id, index) {
            if (id) {
                var removeVehicleConfirmation = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/commuter/modals/remove-vehicle-modal/remove-vehicle-confirmation.html',
                    controller: 'RemoveVehicleConfirmationController as vm',
                    size: '-fs',
                    resolve: {
                        id: function () {
                            return id;
                        }
                    }
                });
                removeVehicleConfirmation.result.then(function (result) {
                    if (result.removed) {
                        vm.vehicles.splice(index, 1);
                    }

                    if (result.errorMessage) {
                        MessageService.showError(result.errorMessage);
                    }
                });
            }
        }

        var activate = function () {
            LuumLinkedService.verify(authService.authentication.passengerId);
            getVehicles();
        }

        vm.makeDefault = function (vId, index) {
            vehicleService.markDefault(vId, passengerId)
            .then(function (response) { 
                if (response.data.status == 1)
                    getVehicles();
            }, function (error) {
                essageService.showError(error.data.result);
            });
        };

        var getVehicles = function () {
            vm.isLoading = true;
            vehicleService.getVehiclesForPassenger(passengerId)
              .then(function (response) {
                  if (response.data && response.data.status == 1 && response.data.result.passengerVehicles != null) {
                      vm.vehicles = response.data.result.passengerVehicles;
                      if (vm.vehicles.length > 0) {
                          vm.selectedVehicle = vm.vehicles[0];
                          vm.hasVehicles = true;
                          vm.needsParking = false;
                  }
              }

                  vm.isLoading = false;
            }, function (error) {
                  vm.hasVehicles = false;
                  vm.isLoading = false;
            });
            };

        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/my-vehicles/my-vehicles.html';
        vm.ionicCustomClassName = 'is-myVehicles';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Vehicles';
        vm.ionicRefreshingText = 'Loading Vehicles';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            vm.isLoading = true;
            vm.vehicles = [];
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
            vm.isLoading = false;
        }
        // End of code for Ionic
       

    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('vehicleService', vehicleService);

    vehicleService.$inject = ['$http','$q','env','DivisionService'];

    function vehicleService($http, $q, env, DivisionService) {
        var service = {
            save: saveVehicle,
            getVehiclesForPassenger: getVehicles,
            removeVehicle: deactivateVehicle,
            canPark: getAvailableParkingForStop,
            markDefault :markDefault
        };        

        return service;

        function getVehicles(passengerId) {
            return $http({ method: 'GET', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' })
                .then(function (response) {
                    return response;
                }, function (err) { 
                    return err; });
        };

        function saveVehicle(vehicleInfo, passengerId) {
            return $http({ data: vehicleInfo, method: 'POST', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' })
                .then(function (response) {
                    return response;
            }, function (err) {
                    return err;
            });
        };

        function deactivateVehicle(vehicleId,passengerId) {            
            return $http({ method: 'PUT', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' + '/' + vehicleId + '/deactivate' })
                .then(function (response) {
                return response;
            }, function (err) {
                return err;
            });
        };       

        function markDefault(vehicleId,passengerId) {            
            return $http({ method: 'PUT', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' + '/' + vehicleId + '/markDefault' })
                .then(function (response) {
                return response;
            }, function (err) {
                return err;
            });
        };

        //move this out while working on selected stop page
        function getAvailableParkingForStop(stopId, reservationDate) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/stops/' + stopId + '/availableParking/' + reservationDate;
            return $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('PublishedScheduleController', PublishedScheduleController);

    PublishedScheduleController.$inject = ['$scope', '$location', 'PublishedScheduleService', '$uibModal', 'StopDataService',
        'MessageService', '$filter', '$anchorScroll', 'PageService','OneMvServices'];

    function PublishedScheduleController($scope, $location, PublishedScheduleService, $uibModal, StopDataService,
        MessageService, $filter, $anchorScroll, PageService,OneMvServices) {

        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Published Schedule');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);


        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1;
        var yyyy = today.getFullYear();
        vm.date = mm + '/' + dd + '/' + yyyy;
        vm.scheduleBlock = [];
        vm.publicSchedule = [];
        vm.allSchdeuleForStop = [];
        vm.stopsLatLong = [];
        vm.incidentRecords = [];
        vm.futureRoutes = [];
        vm.turnLatLong = [];
        vm.isLoading = true;
        vm.searchBy = "$";
        vm.selectedRoute = StopDataService.getRoute();

        vm.getDropOffPickUpClass = getDropOffPickUpClass;


        PublishedScheduleService.getSchedules(vm.date)
        .then(function (response) {
            vm.incidentRecords = response.data.result.routes;
            vm.filterChange();
            vm.isLoading = false;
        }, function (err) {
            MessageService.showError('Sorry! Could not load the schedules!');
            vm.isLoading = false;
        });

        PublishedScheduleService.getUpComingSchedules(vm.date)
        .then(function (response) {
            vm.futureRoutes = response.data.result;
            vm.isLoading = false;
        }, function (err) {
        });

        //filter users based on search result
        vm.filterChange = function () {
            if (vm.searchText != '' && vm.searchText != undefined) {
                var serchTerm = '{ "' + vm.searchBy + '" : "' + vm.searchText + '" }';
                var serchTermObj = JSON.parse(serchTerm);
                vm.filterIncidents = $filter('filter')(vm.incidentRecords, serchTermObj);

            } else {
                vm.filterIncidents = vm.incidentRecords;
            }

            sortRoutes();
            sortArrivals();

            if (vm.selectedRoute != null && vm.selectedRoute.routeId != null) {
                var newHash = vm.selectedRoute.routeId;
                if ($location.hash() !== newHash) {
                    // set the $location.hash to `newHash` and
                    // $anchorScroll will automatically scroll to it
                    $location.hash(newHash);
                } else {
                    // call $anchorScroll() explicitly,
                    // since $location.hash hasn't changed
                    $anchorScroll();
                }
            }
        };

        function sortRoutes() {
            if (vm.incidentRecords)
                vm.incidentRecords.sort(function (a, b) {
                    return (a.longName.toLowerCase() > b.longName.toLowerCase())
                        ? 1
                        : ((b.longName.toLowerCase() > a.longName.toLowerCase()) ? -1 : 0);
                });
        }

        function sortArrivals() {
            angular.forEach(vm.incidentRecords, function (route) {
                if (route.stops)
                    angular.forEach(route.stops, function (stop) {
                        if (stop.arrivals)
                            stop.arrivals.sort(function (a, b) {
                                return moment(a, 'h:mm a').isAfter(moment(b, 'h:mm a')) ? 1 :
                                    moment(a, 'h:mm a').isBefore(moment(b, 'h:mm a')) ? -1 : 0;
                            });
                    });
            })
        }


        vm.navigateToStop = function (selectedStop) {

            if (selectedStop.isHub) return;

            var stop = {
                'name': selectedStop.name,
                'id': selectedStop.stopId,
                'distance': null,
                'icon': 'images/pin-busstop.svg',
                'latitude': selectedStop.latitude,
                'longitude': selectedStop.longitude,
                'address': selectedStop.address
            };
            StopDataService.setStop(stop);
            var locationIcon = {
                url: 'images/pin-my-location.svg'
            };
            vm.position = {
                "coords": {
                    "latitude": selectedStop.latitude,
                    "longitude": selectedStop.longitude
                },
                "icon": locationIcon
            };
            //if (vm.position != undefined && vm.position != null)
            StopDataService.setGeoLocation(vm.position)
            $location.path('/commuter/selected-stop');
        };

        vm.getMap = function (index) {

            vm.stopsLatLong = vm.filterIncidents[index];

            PublishedScheduleService.getTurnLatLngs(vm.stopsLatLong.id)
            .then(function (response) {
                var routeData = response.data;
                //if (routeData.RouteDir1.Vertices.length > 0) {
                //    vm.turnLatLong = routeData.RouteDir1.Vertices
                //}
                //else
                //{
                //    MessageService.showError('Sorry! Could not load the map, cannot find the stops.');
                //}
                mapPage(routeData);

            }, function (err) {
            });
        };

        vm.getFutureRouteMap = function (route) {

            vm.stopsLatLong = route;

            PublishedScheduleService.getTurnLatLngs(vm.stopsLatLong.RouteId)
            .then(function (response) {
                var routeData = response.data;


                //else
                //{
                //    MessageService.showError('Sorry! Could not load the map, cannot find the stops.');
                //}
                mapPage(routeData);

            }, function (err) {
            });
        };

        function mapPage(routeData) {
            var modalGetMap = $uibModal.open({
                animation: true,
                windowClass: 'map-modal',
                templateUrl: 'app/modules/commuter/modals/stops-map-modal/stops-map.html',
                controller: 'StopsMapController as vm',
                backdrop: 'static',
                size: '-fs',
                resolve: {
                    schedule_stops: function () {
                        return vm.stopsLatLong;
                    },
                    routeData: function () {
                        return routeData;
                    },

                }
            });

            modalGetMap.result.then(function (isDone) {
                if (isDone) {
                }
            }, function () {
            });
        };
        activate();

        function activate() { }

        function getDropOffPickUpClass(isAM, isHub) {
            var className;
            if (isAM) {
                if (isHub)
                    className = 'dropoff';
                else
                    className = 'pickup';
            } else {
                if (isHub)
                    className = 'pickup';
                else
                    className = 'dropoff';
            }
            return className;
        }

        $scope.$on('$locationChangeStart', function (event) {
            StopDataService.setRoute(null);
        });
        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/published-schedule/published-schedule.html';
        vm.ionicCustomClassName = '';
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Schedule';
        vm.ionicRefreshingText = 'Loading Schedule';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            activate();
            $scope.$broadcast('scroll.refreshComplete');
        }
        // End of code for Ionic

    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PublishedScheduleService', PublishedScheduleService);

    PublishedScheduleService.$inject = ['$http', '$q', 'env','DivisionService'];

    function PublishedScheduleService($http, $q, env, DivisionService) {
        var service = {
            getSchedules: getSchedules,
            getIncidents: getIncidents,
            getAllScheduleForStop: getAllScheduleForStop,
            getTurnLatLngs: getTurnLatLngs,
            getUpComingSchedules: getUpComingSchedules
        };

        return service;

        function getSchedules(date) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/schedule/published';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getUpComingSchedules(date) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/schedule/upcoming';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getTurnLatLngs(routeId) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVFixedRouteApiUrl + 'route/shapesByRoute/' + routeId + '/206';// + DivisionService.getDivisionId();
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getIncidents(blockId, minIncId, incCount) {
            var deferred = $q.defer();
            var includeStops = true;
            //get the base url from config.
            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/incidents/' + blockId;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getAllScheduleForStop(stopId, routeId) {
            var deferred = $q.defer();
            var routeId = 0;
            //get the base url from config.
            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/stop/' + stopId + '?RouteId=' + routeId;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ScheduleController', ScheduleController);

    ScheduleController.$inject = ['$location', '$stateParams', '$uibModal',
        'ScheduleService', 'env', 'StopDataService', 'uiGmapIsReady', 'ReservationService','DivisionService'];

    function ScheduleController($location, $stateParams, $uibModal,
        ScheduleService, env, StopDataService, uiGmapIsReady, ReservationService, DivisionService) {
        
        var vm = this;

        vm.userId = 'b1c57df3-7604-47eb-bf51-317332a9f6a0' //hard-coding. Waiting for social login task to get over

        //default values set-up
        vm.ScheduleType = "AM";

        //functions exposed to view
        vm.reserve = reserve;
        vm.cancelReservation = cancelReservation;
        vm.changeSchedule = changeSchedule;
        
        //vm.selectedStop = StopDataService.getStop();
        vm.selectedStop = { "name": "Test Stop 1", "id": 152131145, "distance": null, "icon": { "url": "images/pin-busstop-grey.svg" }, "latitude": 43.75514221191406, "longitude": -116.57597351074219, "$$hashKey": "object:113" };
        var currentLocation = StopDataService.getGeoLocation();
        vm.fromLocation = currentLocation !=null ? currentLocation.coords.latitude + ',' + currentLocation.coords.longitude : '';

        vm.center = {
            latitude: 40.651739,
            longitude: -73.953148
        };

        vm.zoom = 10;
        vm.mapControl = {};
        vm.options = {};
        vm.markerEvents = function () {
            //for future?
        };
        vm.showDirections = currentLocation == null;

        var bounds = new google.maps.LatLngBounds();


        uiGmapIsReady.promise().then(function (maps) {       
            
            if(vm.showDirections){
                bounds.extend(new google.maps.LatLng(vm.selectedStop.latitude, vm.selectedStop.longitude));
                vm.mapControl.getGMap().fitBounds(bounds);
                google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            }
            else{
                mapDirection(vm.fromLocation);
            }
        });
        
        loadIncidents();

        vm.getDirection = function () {

            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({ 'address': vm.fromLocation },
                function (response, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        mapDirection(response[0].geometry.location.lat() + ',' + response[0].geometry.location.lng());
                    }
                });            
        };

        var mapDirection = function (start) {

            var directionsDisplay = new google.maps.DirectionsRenderer;
            var directionsService = new google.maps.DirectionsService;
            var directions = document.getElementById('directions');
            directionsDisplay.setPanel(directions);

            directionsService.route({
                origin: start,
                destination: vm.selectedStop.latitude + ',' + vm.selectedStop.longitude,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    directionsDisplay.setMap(vm.mapControl.getGMap());

                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };


        vm.navigateToTripPage = function (index) {
            var incident = vm.nonPerformedIncidents[index];
            $location.path('/commuter/selected-trip/' + DivisionService.getDivisionId() + '/' + incident.BlockId + '/' + incident.IncidentId);
        };


        
        function loadIncidents() {
            ScheduleService.getSchedule( vm.selectedStop.id, vm.userId, 0)
                          .then(function (response) {
                              vm.nonPerformedIncidents = response.data;
                          });
        };

        function reserve(incidentToReserve) {
            //alert(incidentToReserve.Vehicle.VehicleName);
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/reservation-modal/reservation.html',
                controller: 'ReservationController as vm',
                size: '',
                resolve: {
                    incidentToReserve: incidentToReserve,
                    isAdd: true
                }
            });
            modalReserve.result.then(function () {
                //refresh the grid to show the incident as reserved
                loadIncidents();
            });
        };

        function cancelReservation(incidentToCancel) {
            var _reservation = incidentToCancel.TheReservation;
            ReservationService.cancelReservation(_reservation.Id)
            .then(function (response) {
                if (response && response.data && response.data.status == 1) {
                    alert('Reservation Cancelled');
                    loadIncidents();
                } else {
                    alert(response.data.message)
                }
            });
        };


        function changeSchedule() {
            //alert(vm.ScheduleType);
        };
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SelectedTripController', SelectedTripController);

    SelectedTripController.$inject = ['SelectedTripService','$stateParams', 'uiGmapIsReady'];

    function SelectedTripController(SelectedTripService, $stateParams, uiGmapIsReady) {
        /* jshint validthis:true */
        var vm = this;
        vm.title = 'Selected Trip';
        var stopId = $stateParams.stopId;
        var startLocation = {};
        var endLocation = {};
        vm.center = {
            latitude: 40.651739,
            longitude: -73.953148
        };

        vm.zoom = 10;
        vm.mapControl = {};
        vm.stopsMarkerArray = [];

        //getMap();

        //function getMap() {
        //    var mapOptions = {
        //        zoom: vm.zoom,
        //        center: vm.center,
        //        mapTypeId: google.maps.MapTypeId.ROADMAP
        //    }
        //    vm.map = new google.maps.Map(document.getElementById('map'), mapOptions);
        //};

        uiGmapIsReady.promise().then(function (maps) {  
            //vm.mapControl.getGMap().fitBounds(bounds);
            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
        });

        SelectedTripService.getTrips($stateParams.blockId, $stateParams.minIncId, 5)
        .then(function (response) {
            vm.upComingStops = response.data;
            endLocation = vm.upComingStops.slice(-1)[0];
            vm.endStoplocation = endLocation.TheStop;

            for (var i = 0; i < vm.upComingStops.length; i++)
            {
                if (vm.upComingStops[i].TheStop.StopId == stopId)
                {
                    vm.startStopLocation = vm.upComingStops[i].TheStop;
                }
                else {
                    if (vm.upComingStops[i].TheStop.StopId != vm.endStoplocation.StopId) {
                        vm.stopsMarkers = { lat: vm.upComingStops[i].TheStop.Latitude, lng: vm.upComingStops[i].TheStop.Longitude }
                        vm.stopsMarkerArray.push({'location' : vm.stopsMarkers, 'stopover' : false});
                    }
                }                
            }
            mapDirection();
        }, function (err) {
            //alert(err);
        });

        var mapDirection = function () {
            var start = vm.startStopLocation.Latitude + ',' + vm.startStopLocation.Longitude;
            var end = vm.endStoplocation.Latitude + ',' + vm.endStoplocation.Longitude;
            var directionsDisplay = new google.maps.DirectionsRenderer({
                suppressMarkers: true
            });
            var directionsService = new google.maps.DirectionsService;            
            vm.stopsMarkerArray.splice(-1, 1);
            directionsService.route({
                origin: start,
                destination: end,
                waypoints: vm.stopsMarkerArray,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    directionsDisplay.setMap(vm.mapControl.getGMap());

                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };
    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('SelectedTripService', SelectedTripService);

    SelectedTripService.$inject = ['$http', '$q','env','DivisionService'];

    function SelectedTripService($http, $q, env, DivisionService) {
        var service = {
            getTrips: getTrips
        };

        return service;

        function getTrips(blockId, minIncId, incCount) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.commuterApiUrl + 'common' + DivisionService.getDivisionId() + '/incidents/' + blockId + '?minIncId=' + minIncId + '&incCount=' + incCount;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LandingController', LandingController);
    LandingController.$inject = ['$window', '$location',
        'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'StopService',
        'googleMapsConfig', 'GeoLocationService','PageService','OneMvServices'];
    function LandingController($window, $location,
        ScheduleService, uiGmapIsReady, DivisionService,StopService,
        googleMapsConfig, GeoLocationService, PageService,OneMvServices) {
        var vm = this;

        PageService.setTitle('Stops / Routes');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);
        vm.optionSelection = "stop";
        vm.gotoRoutes = gotoRoutes;
        vm.gotoStops = gotoStops;
        var divisionId;
        var gObject;
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {

            myLocationPin = 'images/pin-my-location.png';

        }
        else {

            myLocationPin = 'images/pin-my-location.svg';

        }
        vm.zoom = 15;
        vm.center = {
                latitude: 39.809860,
                longitude: -98.555183
        };
        vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};
        vm.allStops = [];

        function gotoRoutes() {
            $location.path('fixed-route/allRoutes');
        }

        function gotoStops() {
            $location.path('fixed-route/stops');
        }

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {


                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        coords: {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        },
                        icon: vm.myLocationIcon
                    };
                    vm.center.latitude = position.coords.latitude;
                    vm.center.longitude = position.coords.longitude;
                    getStops();

                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");


                }, function (err) {
                    //position error
                    ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                        if (response.data.status == 1) {
                            vm.center.latitude = response.data.result.Latitude;
                            vm.center.longitude = response.data.result.Longitude;
                            if (response.data.result.ZoomLevel !== undefined && response.data.result.ZoomLevel !== null && response.data.result.ZoomLevel != '')
                                vm.zoom = response.data.result.ZoomLevel;
                        }
                    });
                    getStops();
                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
                });
            });




        }

        function getStops() {
            var stopss = [];
            var map = vm.mapControl.getGMap();

            StopService.getAllStops(divisionId).then(function (result) {
                var allStops = result.data;
                for (var i = 0; i < allStops.length; i++) {                    
                    var stop = allStops[i];

                        var position = new google.maps.LatLng(stop.Latitude, stop.Longitude);

                        var stopMarker = new google.maps.Marker({
                            position: position,
                            map: map,
                            optimized: false,
                            icon: {
                                path: 'M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z',                                
                                fillOpacity: 1,
                                fillColor: '#F76F1E',
                                strokeWeight: 0,
                                anchor: new google.maps.Point(9, 21),
                                size: new google.maps.Size(20, 23)
                            },
                            zIndex: 5,
                            animation: google.maps.Animation.DROP
                        });

                        var icon = new google.maps.Marker({
                            position: position,
                            map: map,
                            optimized: false,
                            icon: {
                                path: 'M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z',
                                fillColor: '#fff',
                                fillOpacity: 1,
                                strokeWeight: 0,
                                anchor: new google.maps.Point(7, 19),
                                size: new google.maps.Size(16, 16)
                            },
                            zIndex: 6,
                            animation: google.maps.Animation.DROP
                        });

                        var shadow = new google.maps.Marker({
                            position: position,
                            map: map,
                            optimized: false,
                            icon: {
                                path: 'M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z',
                                fillColor: '#000',
                                fillOpacity: 0.10,
                                strokeWeight: 0,
                                anchor: new google.maps.Point(9, 21),
                                size: new google.maps.Size(21, 10)

                            },
                            zIndex: 4,
                            animation: google.maps.Animation.DROP
                        });
                    }               

            });
        }
        function activate(callback) {

            divisionId = DivisionService.getDivisionId();
            if (divisionId != null && divisionId != undefined && divisionId != '') {
                if (callback && typeof callback === "function")
                    callback();
            }
            else
                $location.path('dashboard/');
        }


        activate(getMap);

        // Start of code for Ionic
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.ionicInclude = 'app/modules/fixed-route/Landing/landing.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-landing';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    }
})();
(function () {
    "use strict";

    angular
        .module('oneMVApp')
        .directive('seatAvailability', seatAvailability);

    seatAvailability.$inject = [];

    function seatAvailability() {
        return {
            restrict: 'E',
            scope: {
                divisionAllowsWaitlist: '=',
                trip:'='
            },
            templateUrl: 'app/modules/commuter/stop/seat-availability.component.html'
        };
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SelectedStopController', SelectedStopController);

    SelectedStopController.$inject = ['$location', '$rootScope', '$scope', '$uibModal', '$interval', '$state',
                                      'StopDataService', 'ReservationService', 'authService',
                                       'DivisionService', 'MapService', 'CommonService', 'MapIconService', 'PageService',
                                       'VehicleDataService', 'ScheduleService', 'LuumLinkedService','OneMvServices'];

    function SelectedStopController($location, $rootScope, $scope, $uibModal, $interval, $state,
                                    StopDataService, ReservationService, authService,
                                    DivisionService, MapService, CommonService, MapIconService, PageService,
                                    VehicleDataService, ScheduleService, LuumLinkedService,OneMvServices) {
        var vm = this;
        vm.selectedStop = StopDataService.getStop();
        vm.PageService = PageService;
        vm.PageService.setTitle(vm.selectedStop.name);
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);

        vm.hubs = [];
        vm.selectedHub = undefined;
        vm.availableParking = 0;
        vm.nonPerformedTrips = [];
        vm.show = false;
        vm.calendarOpened = false;
        vm.passengerReservation = undefined;
        vm.isLoading = false;
        vm.calendar = {};
        vm.calendar.opened = false;
        vm.calendar.dateOptions = {};
        vm.isPassengerLoggedIn = authService.isLoggedIn();
        vm.hasReservation = false;
        vm.advReservationWindow = 14;
        vm.markers = [];
        vm.map = MapService.initializeMap();
        var divisionDate = undefined;
        var mapVehicles = [];
        var vehiclePoll = undefined;
        var markerEvents = [{ event: 'click', callback: iconClickHandler }];        
        vm.divisionAllowsWaitlist = true;
        vm.companionAllowed = false;
        vm.specialEvent = undefined;
        vm.selectGuestDay = selectGuestDay;


        vm.getDirectionsToSelectedStop = function () {
            StopDataService.setStop(vm.selectedStop);
            //StopDataService.setGeoLocation(vm.selectedLocation);
            $location.path('/commuter/directions');
        };

        vm.openMapApp = function () {
            var url = "";
            if ((navigator.platform.indexOf("iPhone") != -1)
         || (navigator.platform.indexOf("iPod") != -1)
                || (navigator.platform.indexOf("iPad") != -1)) {
                url = "http://maps.apple.com/?q=" + vm.selectedStop.latitude + "," + vm.selectedStop.longitude;
            }
            else {
                url = "http://maps.google.com/?q=" + vm.selectedStop.latitude + "," + vm.selectedStop.longitude;
            }

            if (url.length > 0) {
                // For Ionic
                if ($('body').hasClass('platform-cordova')) {
                    window.open(url, '_system', '');
                } else {
                    window.open(url);
                }
            }
        }

        function iconClickHandler(model) {
            vm.show = true;
            vm.coords = model.coords;
        }

        vm.openCalendar = function () {
            vm.calendar.opened = true;
        };

        var addDays = function (date, days) {
            var result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        };

        var setDate = function () {
            vm.calendar.dateOptions = {
                'minDate': divisionDate,
                'maxDate': addDays(divisionDate, vm.advReservationWindow)
            };

        };


        function selectGuestDay() {            
            vm.selectedReservationDate = moment(vm.specialEvent.date, 'YYYY-MM-DD HH:mm').toDate();
            vm.dateChanged();
        }

        var activate = function () {
            LuumLinkedService.verify(authService.authentication.passengerId);
            ScheduleService
                .getServiceDateByDivision(DivisionService.getDivisionId())
                .then(function (response) {
                    if (response.data.status == 1) {
                        divisionDate = moment(response.data.result, 'YYYY-MM-DD HH:mm').toDate();
                        vm.selectedReservationDate = divisionDate;

                        vm.selectedSchedule = new Date(response.data.result).getHours() < 12 ? CommonService.ScheduleType.Morning : CommonService.ScheduleType.Evening;

                        getMaxDaysForAdvReservation();
                    }
                    else {
                        //fallback 
                        divisionDate = new Date();
                    }
                }, function (err) {
                    divisionDate = new Date();
                });

            DivisionService
                .isWaitlistAllowedByDivision()
            .then(function (response) {
                vm.divisionAllowsWaitlist = response;
            });
            

            DivisionService
                .getCurrentDivisionTime()
                .then(function (response) {
                    if (response.data.status == 1) {
                        divisionDate = moment(response.data.result, 'YYYY-MM-DD HH:mm').toDate();
                        vm.selectedReservationDate = divisionDate;

                        vm.selectedSchedule = new Date(response.data.result).getHours() < 12
                            ? CommonService.ScheduleType.Morning
                            : CommonService.ScheduleType.Evening;

                        getMaxDaysForAdvReservation();

                        getSpecialEvent();

                    }
                    else {
                        //fallback 
                        divisionDate = new moment();
                    }
                }, function (err) {
                    divisionDate = new moment();
                });



        }

        function getSpecialEvent() {
            vm.specialEvent = undefined;
            StopDataService
                .getSpecialEvent(vm.selectedStop.id, vm.selectedSchedule)
                .then(function (response) {
                    if (response && response.data.status == 1 && response.data.result.date) {
                        vm.specialEvent = response.data.result;
                    }
                });
        }



        function getMaxDaysForAdvReservation() {
            StopDataService
                .getMaxDaysAllowedForReservation(vm.selectedStop.id, vm.selectedSchedule)
            .then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    vm.advReservationWindow = response.data.result;
                    setDate();
                }
            }, function (error) {

                setDate();
            });
        }

        vm.dateChanged = function () {
            //when user clicks on clear button on the calendar, the model is set to null, this will reset the model back to current date
            if (vm.selectedReservationDate == null) {
                vm.selectedReservationDate = divisionDate;
            }
            vm.selectedReservationDate = moment(moment(vm.selectedReservationDate).format('MM/DD/YYYY')).toDate();
			//vm.selectedReservationDate = moment(moment.tz(vm.selectedReservationDate, DivisionService.getTimeZone()).format('MM/DD/YYYY')).toDate();
			
            vm.selectedSchedule = CommonService.ScheduleType.Morning;
            getSpecialEvent();
            getNonPerformedTrips();
        }


        function getPickUp() {
            return vm.selectedSchedule == CommonService.ScheduleType.Morning ? vm.selectedStop : vm.selectedHub;

        }

        function getDropOff() {
            return vm.selectedSchedule == CommonService.ScheduleType.Morning ? vm.selectedHub : vm.selectedStop;
        }


        var getNonPerformedTrips = function () {
            vm.isLoading = true;
            vm.nonPerformedTrips = [];
            vm.passengerReservation = undefined;
            vm.hasReservation = false;
            vm.companionAllowed = false;


            if (vm.selectedHub && vm.selectedSchedule && vm.selectedReservationDate) {
                StopDataService
                .getNonPerformedTrips(getPickUp().id, getDropOff().id, vm.selectedSchedule, reservationTimespan())
                .then(function (response) {
                    if (response.data.status == 1 && response.data.result.NonPerformedTrips) {
                        vm.nonPerformedTrips = response.data.result.NonPerformedTrips;

                        companionsAllowed();

                        getPassengerReservationFor();

                        getCommuterVehicleInfoForTrips();
                        //every time new non performed events are retrieved stop polling for old and start polling
                        stopPolling();
                        pollVehiclesForRoute();
                    }

                    vm.isLoading = false;

                    vm.availableParking = 0;
                    if (vm.nonPerformedTrips.length > 0)
                        getAvailableParkingsForStop();

                }, function (error) {

                });
            }
        }

        function companionsAllowed() {
            for (var i = 0; i < vm.nonPerformedTrips.length; i++) {
                if (vm.nonPerformedTrips[i].allowedCompanions > 0) {
                    vm.companionAllowed = true;
                    break;
                }
            }
        }


        var getPassengerReservationFor = function () {
            if (!vm.isPassengerLoggedIn)
                return;

            ReservationService
            .getUserReservationFor(authService.authentication.passengerId, vm.selectedSchedule, reservationTimespan())
            .then(function (response) {
                if (response.data.status == 1 && response.data.result
                    && response.data.result.reservations) {
                    vm.passengerReservation = response.data.result.reservations[0];
                    vm.hasReservation = true;
                }
            }, function (error) {

            });
        }


        var getAvailableParkingsForStop = function () {
            StopDataService
                .getAvailableParkingsForStop(vm.selectedStop.id, reservationTimespan())
                    .then(
                        function (response) {
                            if (response.data.status == 1) {
                                vm.availableParking = response.data.result;
                            }
                        },
                        function (error) {

                        });
        }

        var getHubs = function () {

            StopDataService
            .getHubs(vm.selectedStop.id, vm.selectedSchedule, reservationTimespan())
            .then(function (response) {
                if (response.data.status == 1) {
                    vm.hubs = response.data.result.hubs;
                    if (vm.hubs.length > 0)
                        vm.selectedHub = vm.hubs[0];
                }
            }, function (error) {

            });
        }


        $scope.$watch('vm.selectedSchedule', function (value) {
            if (value) {
                getHubs();
                getSpecialEvent();
            }
        });


        $scope.$watch('vm.selectedHub', function (value) {
            if (value) {
                getNonPerformedTrips();
                setMarkers();
            }
        });


        function setMarkers() {
            vm.show = false;
            vm.markers = [];

            vm.markers.push({
                latitude: vm.selectedStop.latitude,
                longitude: vm.selectedStop.longitude,
                icon: MapIconService.getCommuterStopIcon(),
                name: vm.selectedStop.name,
                address: vm.selectedStop.address
            });
            vm.markers.push({
                latitude: vm.selectedHub.latitude,
                longitude: vm.selectedHub.longitude,
                icon: MapIconService.getCommuterHubIcon(),
                name: vm.selectedHub.name,
                address: vm.selectedHub.address
            });

            MapService.setMapBounds(vm.markers, markerEvents);
        }

        var reservationTimespan = function () {
            return Date.parse(vm.selectedReservationDate);
        }

        vm.reserve = function (trip) {

            if (!vm.isPassengerLoggedIn) {
                $state.go('login');
                return;
            }

            if (!canReserve(trip)) return;

            var modalReserve = $uibModal.open(getReservationModal(trip));

            modalReserve.result.then(function (result) {
                if (result && result.action === 'close' && result.isReserved) {
                    getNonPerformedTrips();
                }
                else if (result && result.action === 'reservation') {
                    $location.path('/passenger-trips');
                }
                else if (result && result.action === 'vehicle') {
                    showAddVehicleModal(trip);
                }

                $rootScope.$broadcast('reservationChanged');
            });
        }

        function canReserve(trip) {
            if(vm.hasReservation) return false;            

            if (vm.divisionAllowsWaitlist) {
                return trip.totalPassengers >0;
            }            
            else {
                return trip.availableCapacity > 0;
            }
        }


        vm.cancelReservation = function () {
            var reservationInfo =
                {
                    reservationId: vm.passengerReservation.id,
                    routeName: vm.passengerReservation.routeName,
                    passengerId: authService.authentication.passengerId,
                    startTime: vm.passengerReservation.pickupTime,
                    reservationDate: vm.passengerReservation.reservationDate
                };

            var modalCancelReservation = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/cancel-reservation-modal/cancel-reservation.html',
                controller: 'CancelReservationController as vm',
                size: '-fs',
                resolve: {
                    reservationInfo: function () {
                        return reservationInfo;
                    }
                }
            });

            modalCancelReservation.result.then(function (result) {
                if (result.isCancel) {
                    getNonPerformedTrips();
                    $rootScope.$broadcast('reservationChanged');
                }
            });
        };

        function getCommuterVehicleInfoForTrips() {
            var commuterVehiclesIds = [];
            var routeId = 0;

            if (vm.nonPerformedTrips.length > 0) {
                routeId = vm.nonPerformedTrips[0].routeId;
                angular.forEach(vm.nonPerformedTrips, function (trip) {
                    if (trip.vehicleId && trip.vehicleId != 0)
                        commuterVehiclesIds.push(trip.vehicleId);
                });

                if (commuterVehiclesIds.length > 0 && routeId != 0)
                    VehicleDataService.GetCommuterVehicles(commuterVehiclesIds, routeId).then(function (response) {
                        if (response && response.data.status == 1) {
                            var vehicles = response.data.result;
                            displayVehicles(vehicles);
                        }
                    }, function (err) {
                        //err here
                    });
            }
        };

        function displayVehicles(vehicles) {
            if (mapVehicles.length > 0)
                angular.forEach(mapVehicles, function (vehicleIcon) {
                    vehicleIcon.setMap(null);
                });
            mapVehicles = [];
            for (var i = 0; i < vehicles.length; i++) {
                var vehicleInfo = vehicles[i];

                var vehicle = new google.maps.Marker({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.map.control.getGMap(),
                    optimized: false,
                    flat: true,
                    icon: {
                        path: 'M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z',//google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                        scale: 1.1,
                        fillOpacity: 1,
                        fillColor: '#fff',
                        strokeWeight: 1,
                        strokeOpacity: .3,
                        rotation: vehicleInfo.heading,
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(vehicleInfo.heading)
                    },
                    zIndex: 2
                });

                var vehicleColor = new google.maps.Marker({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.map.control.getGMap(),
                    icon: {
                        path: 'M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z',
                        fillOpacity: 1,
                        strokeOpacity: 0,
                        fillColor: '#555',
                        scale: 1,
                    },

                    zIndex: 3
                });

                mapVehicles.push(vehicle);
                mapVehicles.push(vehicleColor);
            }
        };
        function pollVehiclesForRoute() {
            vehiclePoll = $interval(function () {
                getCommuterVehicleInfoForTrips();

            }, 30000);
        }
        function stopPolling() {
            if (angular.isDefined(vehiclePoll)) {
                $interval.cancel(vehiclePoll);
                vehiclePoll = undefined;
            }

        }

        function getReservationModal(trip) {
            return {
                animation: true,
                templateUrl: 'app/modules/commuter/modals/reservation-modal/reservation.html',
                controller: 'ReservationController as vm',
                size: '-fs',
                backdrop: 'static',
                resolve: {
                    reservationInfo: {
                        'divisionId': DivisionService.getDivisionId(),
                        'passengerId': authService.authentication.passengerId,
                        'pickupStop': getPickUp(),
                        'dropoffStop': getDropOff(),
                        'trip': trip,
                        'scheduleType': vm.selectedSchedule,
                        'reservationDate': vm.selectedReservationDate
                    },
                    isAdd: true
                }
            };
        }

        function showAddVehicleModal(trip) {
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html',
                controller: 'AddVehicleController as vm',
                backdrop: 'static',
                resolve: {
                    atleastOneVehicleExist: false
                }
            });
            modalReserve.result.then(function (result) {
                vm.reserve(trip);
            });
        }

        vm.goToSchedule = function () {
            StopDataService.setRoute(stop);
            $location.path('/commuter/published-schedule');
        };


        vm.viewReservation = function () {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: 'static',
                keyboard: false,
                resolve: {
                    tripId: vm.passengerReservation.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getNonPerformedTrips();
                    $rootScope.$broadcast('reservationChanged');
                }
            });
        }

        activate();

        $scope.$on('$destroy', function (event) {
            stopPolling();
        });

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/stop/selected-stop.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }


})();

(function() {
    "use strict";

    angular
        .module("oneMVApp")
        .directive("nonPerformedTripComponent", nonPerformedTripComponent);

    function nonPerformedTripComponent() {
        return {
            restrict: "E",
            scope: {
                trip: "=",
                divisionAllowsWaitlist : '='
            },
            templateUrl: "app/modules/commuter/stop/selectedStop-npt.component.html"
        };

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('StopDataService', StopDataService);

    StopDataService.$inject = ['$q', '$http', 'env', '$cacheFactory', 'localStorageService','DivisionService'];

    function StopDataService($q, $http, env, $cacheFactory, localStorageService, DivisionService) {

        var selectedStop = undefined;
        var cache = $cacheFactory('LocationCache');

        var setSelectedStop = function (stop) {
            //cache.put("stop", stop);
            localStorageService.set('stop', stop);
            selectedStop = stop;
        }
        var clearItemFromStorage = function (key) {
            localStorageService.remove(key);
        }
        var getSelectedStop = function () {
            //return cache.get("stop");
            return localStorageService.get('stop');
        }
        var getIncident = function () {
            return localStorageService.get('incident');
        }
        var setIncident = function (incident) {
            localStorageService.set('incident', incident);
        }
        var getRoute = function () {
            return localStorageService.get('route');
        }
        var setRoute = function (route) {
            localStorageService.set('route', route);
        }
        var getVehicleId = function () {
            return localStorageService.get('vehicle');
        }
        var setVehicleId = function (vehicleId) {
            localStorageService.set('vehicle', vehicleId);
        }
        var currGeoLocation = undefined;

        var setGeoLocation = function (currLocation) {
            localStorageService.set("currLocation", currLocation);
            currGeoLocation = currLocation
        }
        
        var getGeoLocation = function () {
            return localStorageService.get("currLocation");
        }

        function getStopDetails(stopId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/' + stopId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        };

        function getIncidentsForStop(stopId, day) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/incidents/' + stopId + '/' + day + '?rnd=' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }

        function getUserIncidentsForStop(stopId, day, userId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/incidents/' + stopId + '/' + day + '/' + userId + '?rnd=' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }

        function getUserIncidentsById(incidentId, userId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/incident/' + incidentId + '/' + userId + '?rnd=' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }
         function getVehicle(vehId)
        {
             var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/vehicle/' + vehId + '?rnd=' +new Date().getMilliseconds();
             var deferred = $q.defer();
             if (angular.isUndefined(vehId) || vehId == null)
                 deferred.reject('No Vehicle Found');
             else{
                $http({
                    method: 'GET',
                    'url': serviceUrl
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            return deferred.promise;
         }
        
         function getHubs(stopId, scheduleType, timespan) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' +  DivisionService.getDivisionId() + '/' + stopId + '/hubs/' + scheduleType + '/' + timespan + '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }

         function getAvailableParkingsForStop(stopId, reservationDate) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/stops/' + stopId + '/availableParking/' + reservationDate + '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }

         function getNonPerformedTrips(pickupStopId, dropoffStopId, scheduleType, scheduleDate){
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/stops/nonperformedtrips/' + pickupStopId + '/' 
                 + dropoffStopId + '/' + scheduleDate + '/' + scheduleType + '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }       


         function getMaxDaysAllowedForReservation(stopId,scheduleType) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/stops/' + stopId + '/advancedDays/' + scheduleType +  '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }


         function getDropoffsForSelectedPickup(stopId) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/' + stopId + '/dropOffs?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }


         function getTripTimesForAdvancedReservation(pickupStopId, dropoffStopId, scheduleType) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/alltrips/'
                                + pickupStopId + '/' + dropoffStopId + '/' + scheduleType + '/?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }

         function getAllBusStops() {
             var deferred = $q.defer();
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/stops/commuter/0';
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });

             return deferred.promise;
         }


         function getPickupForReturnTrip(amPickup, amHub) {
             var deferred = $q.defer();
             var serviceUrl = env.oneMVApiUrl + 'commuter/pickup/' + DivisionService.getDivisionId() + '/' + amPickup + '/' + amHub;
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });

             return deferred.promise;
         }



         function getSpecialEvent(stopId, schedule) {
             var deferred = $q.defer();
             var serviceUrl = env.oneMVApiUrl + 'commuter/specialEvent/' + DivisionService.getDivisionId() +  '/' + stopId + '/' + schedule;
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });

             return deferred.promise;
         }

        return {
            setStop: setSelectedStop,
            getStop: getSelectedStop,
            setGeoLocation: setGeoLocation,
            getGeoLocation: getGeoLocation,
            getStopDetails: getStopDetails,
            getIncidentsForStop: getIncidentsForStop,
            getUserIncidentsForStop: getUserIncidentsForStop,
            getUserIncidentsById: getUserIncidentsById,
            getVehicle: getVehicle,
            getIncident: getIncident,
            setIncident: setIncident,
            getRoute: getRoute,
            setRoute: setRoute,
            getVehicleId: getVehicleId,
            setVehicleId: setVehicleId,
            clearItem: clearItemFromStorage,
            getHubs: getHubs,
            getAvailableParkingsForStop: getAvailableParkingsForStop,
            getNonPerformedTrips: getNonPerformedTrips,
            getDropoffsForSelectedPickup: getDropoffsForSelectedPickup,
            getTripTimesForAdvancedReservation: getTripTimesForAdvancedReservation,
            getMaxDaysAllowedForReservation: getMaxDaysAllowedForReservation,
            getAllBusStops: getAllBusStops,
            getPickupForReturnTrip: getPickupForReturnTrip,
            getSpecialEvent: getSpecialEvent
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('VehicleDataService', VehicleDataService);

    VehicleDataService.$inject = ['$q', '$http', 'env', '$cacheFactory', 'localStorageService', 'DivisionService'];

    function VehicleDataService($q, $http, env, $cacheFactory, localStorageService, DivisionService) {
        return {
            GetCommuterVehicles : getCommuterVehicles
        };

        function getCommuterVehicles(vehiclesArray, routeId)
        {
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/CommuterVehicles';
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': serviceUrl,
                params: {
                    'vehicleIds': vehiclesArray,
                    'routeId': routeId
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('AllRoutesController', AllRoutesController);
    AllRoutesController.$inject = [ '$scope', '$filter','$location', '$interval',
        'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'RouteService', 'StopService', 'googleMapsConfig', 'PageService','OneMvServices'];
    function AllRoutesController($scope, $filter, $location, $interval,
        ScheduleService, uiGmapIsReady, DivisionService, RouteService, StopService, googleMapsConfig, PageService,OneMvServices) {
        var vm = this;
        var divisionId;
        var bounds;
        var infoWindow = new google.maps.InfoWindow({content: ''});
        vm.displaySelectedRoutes = displaySelectedRoutes;
        vm.displayRoute = displayRoute;
        vm.filterChange = filterChange;
        vm.gotoStops = goToStops;
       
        vm.displayButton = displayButton;
        vm.goToRoute = goToRoute;
        vm.hightlightRoute = hightlightRoute;
        vm.zoom = 15;
        vm.routes = [];
        vm.filteredRoutes = [];
        vm.loading = true;
        var vehiclePoll = undefined;
        var vehicleIconL1 = 'images/marker-bus-l1.svg';
        vm.PageService = PageService;
        vm.PageService.setTitle('Routes');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);

        vm.vehicles = [];
        vm.allStops = [];
        vm.toStops = [];
        vm.routesOnMap = [];
        vm.center = {
            latitude: 39.809860, 
            longitude: -98.555183
        };
        vm.myStyles = googleMapsConfig.mapStyles;
           
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.mapControl = {};
        
        function filterChange(item) {
            if (vm.search_text === undefined || vm.search_text === null || vm.search_text.trim() === '')
                return true;
            return item.name.toLowerCase().indexOf(vm.search_text.toLowerCase()) !== -1 || item.shortName.toLowerCase().indexOf(vm.search_text.toLowerCase()) !== -1;

        }

       
        function displayButton()
        {
            for (var i = 0; i < vm.routes.length; i++)
                if (vm.routes[i].displayOnMap)
                    return true;

            return false;

        }


        function getVehiclesByRoute(routeId) {
            if (vm.routesOnMap[routeId].vehicles !== undefined)
            {
                for (var i = 0; i < vm.routesOnMap[routeId].vehicles.length; i++)
                    vm.routesOnMap[routeId].vehicles[i].setMap(null);
            }
            vm.routesOnMap[routeId].vehicles = [];
           RouteService
                .getVehiclesForRoute(routeId)
                    .then(function (response) {
                        if (response && response.data && response.data.length > 0)
                            mapActiveVehicles(response, routeId);
                    }, vehiclesFailureHandler);
        }


        vm.highlightParent = function (e) {
            angular.element(e.target).parent().addClass('active');
        }
        vm.blurParent = function (e) {
            angular.element(e.target).parent().removeClass('active');
        }
        function hightlightRoute(routeId, show)
        {
            if (vm.routesOnMap[routeId] != undefined && vm.routesOnMap[routeId] != null) {
                if (vm.routesOnMap[routeId].displayOnMap) {
                    for (var index in vm.routesOnMap[routeId].lines) {
                        if (show)
                            vm.routesOnMap[routeId].lines[index].setOptions({ strokeOpacity: 0.8 });
                        else
                            vm.routesOnMap[routeId].lines[index].setOptions({ strokeOpacity: 0.5 });
                    }
                }
            }
        }
        function mapActiveVehicles(response, routeId) {
           

            for (var i = 0; i < response.data.length; i++) {
                var vehicleInfo = response.data[i];

                var vehicle = new google.maps.Marker ({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.mapControl.getGMap(),
                    optimized: false,
                    flat: true,
                    icon: {
                        path: 'M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z',//google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                        scale: 1.1,
                        fillOpacity: 1,
                        fillColor: '#fff',
                        strokeWeight: 1,
                        strokeOpacity: .3,
                        rotation: vehicleInfo.heading,
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(vehicleInfo.heading)
                    },
                   zIndex: 2
                });
                var vehicleColor = new google.maps.Marker({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.mapControl.getGMap(),
                    icon: {
                        path: 'M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z',
                        fillOpacity: 1,
                        strokeOpacity: 0,
                        fillColor: vm.routesOnMap[routeId].route.color,
                        scale: 1,
                    },
                   
                    zIndex: 3
                });
                vm.routesOnMap[routeId].vehicles.push(vehicleColor);
                vm.routesOnMap[routeId].vehicles.push(vehicle);
                
            }
        }

        function vehiclesFailureHandler() {

        }
       
      
        function getStopsByRoute(route)
        {
            StopService.getStopsByRoute(divisionId, route.id).then(function (result) {
                var stops = [];
                var routeStops = result.data;
                for (var i = 0; i < routeStops.length; i++)
                {
                    //icon path allows us to rotate icon.
                    var stop = new google.maps.Marker({
                        position: new google.maps.LatLng(routeStops[i].Latitude, routeStops[i].Longitude),
                        icon: {
                            path: 'M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z',
                            fillColor: vm.selectedRoute.color,
                            fillOpacity: 1,
                            strokeWeight: 0,
                            anchor: new google.maps.Point(9, 21),
                            size: new google.maps.Size(20, 23)
                        },
                        zIndex:5
                    });
                    var stopIcon = new google.maps.Marker({
                        position: new google.maps.LatLng(routeStops[i].Latitude, routeStops[i].Longitude),
                        icon: {
                            path: 'M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z',
                            fillColor: '#fff',
                            fillOpacity: 1,
                            strokeWeight: 0,
                            anchor: new google.maps.Point(7, 19),
                            size: new google.maps.Size(16, 16)
                        },
                        zIndex:6
                    });
                    var stopShadow = new google.maps.Marker({
                        position: new google.maps.LatLng(routeStops[i].Latitude, routeStops[i].Longitude),
                        icon: {
                            path: 'M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z',
                            fillColor: '#000',
                            fillOpacity: .10,
                            strokeWeight: 0,
                            anchor: new google.maps.Point(9, 21),
                            size: new google.maps.Size(21, 10)
                            
                        },
                        zIndex: 4
                    });
                    stop.setMap(vm.mapControl.getGMap());
                    stopIcon.setMap(vm.mapControl.getGMap());
                   stopShadow.setMap(vm.mapControl.getGMap());
                    //add event listner to call service and render info window.
                   google.maps.event.addListener(stopIcon, 'click', getArrivalsForStop(routeStops[i], stop));

                    stops.push(stop);
                    stops.push(stopIcon);
                    stops.push(stopShadow);

                }
                vm.routesOnMap[route.id].stops = stops;
                google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            });
        }

        function getArrivalsForStop(stop, marker)
        {
            return function () {
                StopService.getArrivalsByStopId(divisionId, stop.Id).then(function (result) {
                    var arrivals = result.data;
                    var content = '<span style="font-weight: bold;">' + stop.Name + '</span><br />';
                    for (var i = 0; i < arrivals.length; i++) {
                        
                        content += '<span style="color:' + arrivals[i].route.color + ';">' + arrivals[i].route.shortName + '</span><br />';
                        for (var j = 0; j < arrivals[i].trips.length; j++)
                            content += '&nbsp;&nbsp;' + (arrivals[i].trips[j].vehicle.name == null ? 'Bus' : arrivals[i].trips[j].vehicle.name) + ' in ' + arrivals[i].trips[j].etaInMins +
                                 ' minutes <br />';
                    }
                    if (content == '')
                        content = 'No current arrivals at this stop';
                    infoWindow.setContent(content);
                    infoWindow.open(vm.mapControl.getGMap(), marker);
                });
            }
        }
       

        //TODO: add remove lines for check unchcek.
        function displaySelectedRoutes()
        {
            bounds = new google.maps.LatLngBounds();
            for (var rt = 0; rt < vm.filteredRoutes.length; rt++)
            {
                var route = vm.filteredRoutes[rt];
                if(route.displayOnMap)
                {
                    mapRoute(route)
                }
                else {
                    hideRoute(route);
                }
            }
            
        }
        function displayRoute(route)
        {
            
            if (route.displayOnMap)
                mapRoute(route)
            else
                hideRoute(route);
            
        }
        function displayAllVehicles()
        {
            for(var routeId in vm.routesOnMap)
            {
                if (vm.routesOnMap[routeId].displayOnMap)
                {
                    getVehiclesByRoute(routeId);
                }
            }
        }
        function adjustMapBounds()
        {
            var numberOnMap = 0;
            bounds = new google.maps.LatLngBounds();
            for (var route in vm.routesOnMap)
            {
                if (vm.routesOnMap[route].displayOnMap)
                {
                    numberOnMap++;
                    for (var i = 0; i < vm.routesOnMap[route].lines.length; i++) {
                        bounds.union(getLineBounds(vm.routesOnMap[route].lines[i]));
                    }
                }
            }
            if(numberOnMap > 0) 
                vm.mapControl.getGMap().fitBounds(bounds);
        }

        function hideRoute(route)
        {
            if(vm.routesOnMap[route.id]!= undefined && vm.routesOnMap[route.id] != null)
            {
                if (vm.routesOnMap[route.id].displayOnMap) {
                    vm.routesOnMap[route.id].displayOnMap = false;
                    for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                        vm.routesOnMap[route.id].lines[i].setMap(null);
                    }
                    for (var i = 0; i < vm.routesOnMap[route.id].stops.length; i++) {
                        vm.routesOnMap[route.id].stops[i].setMap(null);
                    }
                    for (var i = 0; i < vm.routesOnMap[route.id].vehicles.length; i++)
                    {
                        vm.routesOnMap[route.id].vehicles[i].setMap(null);
                    }
                    vm.routesOnMap[route.id].vehicles = [];
                    adjustMapBounds();
                }
            }
        }
        function mapRoute(route)
        {
            if (vm.routesOnMap[route.id] != undefined && vm.routesOnMap[route.id] != null) {
                vm.routesOnMap[route.id].displayOnMap = true;
                for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                    vm.routesOnMap[route.id].lines[i].setMap(vm.mapControl.getGMap());
                }
                for (var i = 0; i < vm.routesOnMap[route.id].stops.length; i++) {
                    vm.routesOnMap[route.id].stops[i].setMap(vm.mapControl.getGMap());
                   
                }
                getVehiclesByRoute(route.id);
                adjustMapBounds();

            }
            else {
                vm.routesOnMap[route.id] = { route: route };
                var lines = [];
                vm.selectedRoute = route;
                RouteService.getShapesByRoute(route.id).then(function (result) {
                    var shapes = result.data;
                    for (var i = 0; i < shapes.length; i++) {
                        var decodedPath = google.maps.geometry.encoding.decodePath(shapes[i].line);

                        var line = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: route.color,
                            strokeOpacity: 0.5,
                            strokeWeight:5, 
                            icons: [{
                                icon: {
                                    path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
                                    strokeOpacity: 0,
                                    fillColor: route.color,
                                    fillOpacity: 1,
                                    scale: 2.5
                                },
                                offset: '25px',
                                repeat: '200px',
                              
                            }],
                            zIndex:1
                        });
                        var lineStroke = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: '#fff',
                            strokeOpacity: 1.0,
                            strokeWeight: 8,
                            zindex:0
                        });
                        line.setMap(vm.mapControl.getGMap());
                        lineStroke.setMap(vm.mapControl.getGMap());
                        lines.push(line);
                        lines.push(lineStroke);
                        //break;
                    }
                    vm.routesOnMap[route.id].lines = lines;
                    vm.routesOnMap[route.id].displayOnMap = true;
                   
                    getStopsByRoute(route);
                    getVehiclesByRoute(route.id);
                    adjustMapBounds();

                });
            }

        }
        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                    if (response.data.status == 1) {
                        vm.center.latitude = response.data.result.Latitude;
                        vm.center.longitude = response.data.result.Longitude;
                        if (response.data.result.ZoomLevel !== undefined && response.data.result.ZoomLevel !== null
                            && response.data.result.ZoomLevel != '')
                                vm.zoom = response.data.result.ZoomLevel;

                    }
                    getAllRoutes();                    
                });
            });

        }
        function goToRoute(routeId) {
            $location.path('fixed-route/route/' + routeId);
        }
        function goToStops()
        {
            $location.path('fixed-route/stops');
        }

        function getLineBounds(line) {
            var bound = new google.maps.LatLngBounds();
            line.getPath().forEach(function (item, index) {
                bound.extend(new google.maps.LatLng(item.lat(), item.lng()));
            });
            return bound;
        };

        function getRouteStatus()
        {
            RouteService
               .getRoutes()
                   .then(function (result) {
                       var routes = result.data;
                       for (var index in routes) {
                           var r = $filter('filter')(vm.filteredRoutes, { id: routes[index].id });
                           angular.forEach(r, function(value, key){
                               value.IsActive = routes[index].IsActive;
                            });
                       }

                   }, function () {
                   });
        };
       
        function getAllRoutes() {
            RouteService
                .getRoutes()
                    .then(function (result) {
                        vm.routes = result.data;               
                        vm.filteredRoutes = vm.routes;
                        vm.loading = false;
                        pollVehiclesForRoute();
                    }, function () {
                        vm.loading = false;
                    });
        };
        function getAllStops() {
            vm.allStops = [];
            var stopss = [];
            StopService.getAllStops().then(function (result) {
                var allStops = result.data;
                for (var i = 0; i < allStops.length; i++)
                {
                    if (!stopss.includes(allStops[i].Id))
                    {
                        vm.allStops.push(allStops[i]);
                        stopss.push(allStops[i].Id);
                    }
               }
                vm.allStops.sort(function (a, b) {
                    return a.Name > b.Name ? 1 : a.Name == b.Name ? 0 : -1;
                });
                vm.filteredStops = vm.allStops;

            });
        };
        
        function activate() {
            divisionId = DivisionService.getDivisionId();
            getMap();
        }

        $scope.$on('$destroy', function (event) {
            stopPolling();
        });

        function pollVehiclesForRoute() {
            vehiclePoll = $interval(function () {
                getRouteStatus();
                displayAllVehicles();
            }, 30000);
        }
        function stopPolling() {
            if (angular.isDefined(vehiclePoll)) {
                $interval.cancel(vehiclePoll);
                vehiclePoll = undefined;
            }

        }


        activate();

        // Start of code for Ionic
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.ionicInclude = 'app/modules/fixed-route/routes/all-routes.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-all-routes';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
  

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('FrScheduleController', FrScheduleController);

    FrScheduleController.$inject = ['$window', 'FrScheduleService', 'ScheduleService', 'DivisionService',
     'GeoLocationService', 'googleMapsConfig', 'uiGmapIsReady', 'PageService','OneMvServices'];

    function FrScheduleController($window, FrScheduleService, ScheduleService, DivisionService,
         GeoLocationService, googleMapsConfig, uiGmapIsReady, PageService,OneMvServices) {
        /* jshint validthis:true */
        var vm = this;
        vm.schedule;
        var divisionId;
        vm.scheduleView;
        vm.showBackButton = false;
        vm.showTrip = showTrip;
        vm.showSchedules = showSchedules;
        vm.filterEmptyTimes = filterEmptyTimes;
        vm.PageService = PageService;
        vm.PageService.setTitle('Schedule');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);
        //map stuff
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {

            myLocationPin = 'images/pin-my-location.png';

        }
        else {

            myLocationPin = 'images/pin-my-location.svg';

        }
        vm.zoom = 15;
        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};
        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {


                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        coords: {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        },
                        icon: vm.myLocationIcon
                    };
                    vm.center.latitude = position.coords.latitude;
                    vm.center.longitude = position.coords.longitude;

                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");


                }, function (err) {
                    //position error
                    ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                        if (response.data.status == 1) {
                            vm.center.latitude = response.data.result.Latitude;
                            vm.center.longitude = response.data.result.Longitude;
                        }
                    });
                });
            });
        }
        //map stuff

        activate();

        function activate() {
            divisionId = DivisionService.getDivisionId();
            if (divisionId != null && divisionId != undefined && divisionId != '') {
                populateSchedule();
                getMap();
            };

        }

        function populateSchedule() {
            FrScheduleService.getSchedule(divisionId)
                           .then(function (response) {
                               vm.schedule = response.data;
                               vm.scheduleView = angular.copy(vm.schedule);
                           }, function (error) {

                           });
        }

        function showSchedules() {
            if (vm.schedule) {
                vm.scheduleView = vm.schedule;
            } else {
                populateSchedule();
            }
            vm.showBackButton = false;
        }

        function showTrip(tripId) {
            var tripSchedule;
            for (var r = 0; r < vm.schedule.routes.length; r++) {
                for (var s = 0; s < vm.schedule.routes[r].stops.length; s++) {
                    for (var t = 0; t < vm.schedule.routes[r].stops[s].trips.length; t++) {
                        if (vm.schedule.routes[r].stops[s].trips[t].id == tripId) {
                            if (!tripSchedule) {
                                tripSchedule = {};
                                tripSchedule.routes = []
                                tripSchedule.routes.push(angular.copy(vm.schedule.routes[r]));
                                tripSchedule.routes[0].stops = [];
                                tripSchedule.routes[0].stops.push(angular.copy(vm.schedule.routes[r].stops[s]));
                                tripSchedule.routes[0].stops[0].trips = [];
                                tripSchedule.routes[0].stops[0].trips.push(angular.copy(vm.schedule.routes[r].stops[s].trips[t]));
                            } else {
                                var isStopFound = false
                                for (var ss = 0; ss < tripSchedule.routes[0].stops.length; ss++) {
                                    if (vm.schedule.routes[r].stops[s].id == tripSchedule.routes[0].stops[ss].id) {
                                        isStopFound = true;
                                        tripSchedule.routes[0].stops[ss].trips.push(angular.copy(vm.schedule.routes[r].stops[s].trips[t]));
                                    }
                                }
                                if (!isStopFound) {
                                    tripSchedule.routes[0].stops.push(angular.copy(vm.schedule.routes[r].stops[s]));
                                    tripSchedule.routes[0].stops[tripSchedule.routes[0].stops.length - 1].trips = [];
                                    tripSchedule.routes[0].stops[tripSchedule.routes[0].stops.length - 1].trips.push(angular.copy(vm.schedule.routes[r].stops[s].trips[t]));
                                }
                            }

                        }
                    }
                }
            }
            //Bind the trip schedule to the view
            vm.scheduleView = tripSchedule;
            vm.showBackButton = true;
        }

        function filterEmptyTimes(trip) {
            return trip.time.length > 0;
        }

        //UI INTERACTIONS
        //Adds and removes the active class to the parent of an element.
        vm.highlightParent = function (e) {
            angular.element(e.target).parent().addClass('active');
        }
        vm.blurParent = function (e) {
            angular.element(e.target).parent().removeClass('active');
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/fixed-route/schedule/fr-schedule.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-schedule';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .service('FixedRouteNotificationsService', FixedRouteNotificationsService);

    FixedRouteNotificationsService.$inject = ['$http', '$q', 'env'];

    function FixedRouteNotificationsService($http, $q, env) {
        var service = {
            get: _get
        };
        return service;

        function _get(divisionId) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + "notifications/" + divisionId
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .service('FrScheduleService', FrScheduleService);

    FrScheduleService.$inject = ['$http', '$q', 'env'];

    function FrScheduleService($http, $q, env) {
        var service = {

            getSchedule: _getSchedule

        };
        return service;

        function _get(urlSegment) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + urlSegment
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function _getSchedule(divisionId) {
            return _get('schedule/' + divisionId);
        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('RouteService', RouteService);
    RouteService.$inject = ['$http', '$q', 'env', 'DivisionService'];
    function RouteService($http, $q, env, DivisionService)
    {
        function _getRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            return _get(routeId + '/' + divisionId);
        }

        function _getRoutes() {
            var divisionId = DivisionService.getDivisionId();
            return _get('allRoutes/' + divisionId);
        }

        function _getShapesByRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            return _get('shapesByRoute/' + routeId + '/' + divisionId);
        }

        function _getRoutesForStop(stopId) {
            return _get('routesByStop/' + stopId + '/' + divisionId);
        }

        function _getArrivalsForRoute(routeId, divisionId) {
            return _get(divisionId + '/arrivalsForRoute/' + routeId);
        }

        function _getVehiclesForRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            return _get(divisionId + '/vehiclesByRoute/' + routeId);
        }


        function _get(urlSegment) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + 'route/' + urlSegment
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }


        var service = {
            getRouteInfo : _getRoute,
            getRoutes: _getRoutes,
            getShapesByRoute: _getShapesByRoute,
            getRoutesForStop: _getRoutesForStop,
            getArrivalsForRoute: _getArrivalsForRoute,
            getVehiclesForRoute : _getVehiclesForRoute
        };

        return service;        
    }
})();
(function () {
    'use strict';

    angular.module('oneMVApp')
           .factory('StopService', StopService);

    StopService.$inject = ['$http', '$q', 'env'];

    function StopService($http, $q, env) {
        var service = {

            getStopsByRoute: _getStopsByRoute,
            getArrivalsForStop: _getArrivalsForStop,
            getAllStops: _getAllStops,
            getStopsForStop: _getStopsForStop,
            getArrivalsByStopId: _getArrivalsByStopId,
            getUpcomingArrivalsForStop: _getUpcomingArrivalsForStop
        };
        return service;

        function _getAllStops(divisionId) {
            return _get('stops/' + divisionId);
        }

        function _getStopsByRoute(divisionId, routeId) {
            return _get('stops/' + divisionId + '/stopsByRoute/' + routeId);
        }

        function _getArrivalsForStop(divisionId, fromStopId, toStopId) {
            return _get('stops/' + divisionId + '/arrivalsByStop/' + fromStopId + '/' + toStopId);
        }

        function _getUpcomingArrivalsForStop(divisionId, fromStopId, toStopId, noOfArrivals) {
            return _get('stops/' + divisionId + '/arrivalsByStop/' + fromStopId + '/' + toStopId + '/' + noOfArrivals + '?rnd=' + new Date().getTime());
        }

        function _getStopsForStop(stopId) {
            return _get('stopsByStop/' + stopId);
        }
        function _getArrivalsByStopId(divisionId, stopId) {
            return _get('stops/' + divisionId + '/arrivals/' + stopId);
        }

       

        function _get(urlSegment) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + urlSegment
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }       
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('VehicleService', VehicleService);
    VehicleService.$inject = ['$http', '$q', 'ConfigFactory', 'env', 'DivisionService'];

    function VehicleService($http, $q, ConfigFactory, env, DivisionService)
    {

        var service = {
            
          
            getVehiclesForRoute: _getVehiclesForRoute
        
        };
        return service;
        
        
        
        
        function _getVehiclesForRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            var url = _getUrl();
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': url + 'fixedroute/' + divisionId + '/vehiclesByRoute/' + routeId
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function _getUrl()
        {
            return env.oneMVFixedRouteApiUrl;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('FrStopsController', FrStopsController);

    FrStopsController.$inject = ['$location', '$window', 'StopService', 'DivisionService', 'GeoLocationService',
        'ScheduleService', 'googleMapsConfig', 'uiGmapIsReady', 'RouteService', 'PageService','OneMvServices'];

    function FrStopsController($location, $window, StopService, DivisionService, GeoLocationService,
         ScheduleService, googleMapsConfig, uiGmapIsReady, RouteService, PageService,OneMvServices) {
        var vm = this;
        vm.selectedFromStop;
        vm.selectedToStop;
        vm.allStops;
        vm.fromStops;
        vm.toStops;
        vm.populateFromStops = populateFromStops;
        vm.selectFromStop = selectFromStop;
        vm.populateToStops = populateToStops;
        vm.selectToStop = selectToStop;
        vm.gotoRoutes = gotoRoutes;
        vm.gotoStops = gotoStops;
        vm.handleKeyPress = handleKeyPress;
        vm.mapRoute = mapRoute;
        vm.clearPins = clearPins;
        vm.loading = false;
        vm.upcomingSchedules;
        vm.showFromStops = true;
        vm.showToStops = false;
        vm.showRoutes = false;
        vm.divisionId = DivisionService.getDivisionId();
        var fromStopPin = 'images/bus-green.svg';
        var toStopPin = 'images/bus-darkblue.svg';
        var markers = [];
        var bounds;
        vm.routesOnMap = [];
        vm.activeSchedule;
        vm.isAnyRouteSelected = false;
        vm.PageService = PageService;
        vm.PageService.setTitle('Stops');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);
        //var infoWindow = new google.maps.InfoWindow({ content: '' });

        activate();

        //map stuff
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {

            myLocationPin = 'images/pin-my-location.png';

        }
        else {

            myLocationPin = 'images/pin-my-location.svg';

        }
        vm.zoom = 15;
        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};
        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        coords: {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        },
                        icon: vm.myLocationIcon
                    };
                    vm.center.latitude = position.coords.latitude;
                    vm.center.longitude = position.coords.longitude;

                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");


                }, function (err) {
                    //position error
                    ScheduleService.getServiceAreaLocation(vm.divisionId).then(function (response) {
                        if (response.data.status == 1) {
                            vm.center.latitude = response.data.result.Latitude;
                            vm.center.longitude = response.data.result.Longitude;
                        }
                    });
                });
            });
        }
        function getLineBounds(line) {
            var bound = new google.maps.LatLngBounds();
            line.getPath().forEach(function (item, index) {
                bound.extend(new google.maps.LatLng(item.lat(), item.lng()));
            });
            return bound;
        };
        function setMapBounds() {
            var bounds = new google.maps.LatLngBounds();
            for (var i = 0; i < markers.length; i++)
                bounds.extend(markers[i].position);
            vm.mapControl.getGMap().fitBounds(bounds);
            vm.mapControl.getGMap().setZoom(vm.mapControl.getGMap().getZoom() - 1);

        }
        function adjustMapBounds() {
            var numberOnMap = 0;
            bounds = new google.maps.LatLngBounds();
            for (var route in vm.routesOnMap) {
                if (vm.routesOnMap[route].displayOnMap) {
                    numberOnMap++;
                    for (var i = 0; i < vm.routesOnMap[route].lines.length; i++) {
                        bounds.union(getLineBounds(vm.routesOnMap[route].lines[i]));
                    }
                }
            }
            if (numberOnMap > 0)
                vm.mapControl.getGMap().fitBounds(bounds);
        }
        function hideRouteOnMap(route) {
            if (vm.routesOnMap[route.id] != undefined && vm.routesOnMap[route.id] != null) {
                if (vm.routesOnMap[route.id].displayOnMap) {
                    vm.routesOnMap[route.id].displayOnMap = false;
                    for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                        vm.routesOnMap[route.id].lines[i].setMap(null);
                    }
                    adjustMapBounds();
                }
            }
        }
        function clearAllRoutesOnMap() {
            for (var r = 0; r < vm.routesOnMap.length; r++) {
                if (vm.routesOnMap[r] != undefined && vm.routesOnMap[r] != null) {
                    if (vm.routesOnMap[r].displayOnMap) {
                        vm.routesOnMap[r].displayOnMap = false;
                        for (var i = 0; i < vm.routesOnMap[r].lines.length; i++) {
                            vm.routesOnMap[r].lines[i].setMap(null);
                        }
                        adjustMapBounds();
                    }
                }
            }
        }
        function showRouteOnMap(route) {
            if (vm.routesOnMap[route.id] != undefined && vm.routesOnMap[route.id] != null) {
                vm.routesOnMap[route.id].displayOnMap = true;
                for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                    vm.routesOnMap[route.id].lines[i].setMap(vm.mapControl.getGMap());
                }
                adjustMapBounds();

            } else {
                vm.routesOnMap[route.id] = {
                };
                var lines = [];
                RouteService.getShapesByRoute(route.id).then(function (result) {
                    var shapes = result.data;
                    for (var i = 0; i < shapes.length; i++) {
                        var decodedPath = google.maps.geometry.encoding.decodePath(shapes[i].line);

                        //var line = new google.maps.Polyline({
                        //    path: decodedPath,
                        //    strokeColor: route.color,
                        //    strokeOpacity: 1.0,
                        //    strokeWeight: 2,
                        //    icons: [{
                        //        icon: {
                        //            path: google.maps.SymbolPath.FORWARD_OPEN_ARROW
                        //        },
                        //        offset: '25px',
                        //        repeat: '100px'
                        //    }]

                        //});
                        var line = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: route.color,
                            strokeOpacity: 0.5,
                            strokeWeight: 5,
                            icons: [{
                                icon: {
                                    path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
                                    strokeOpacity: 0,
                                    fillColor: route.color,
                                    fillOpacity: 1,
                                    scale: 2.5
                                },
                                offset: '25px',
                                repeat: '200px',

                            }],
                            zIndex: 1
                        });
                        var lineStroke = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: '#fff',
                            strokeOpacity: 1.0,
                            strokeWeight: 8,
                            zindex: 0
                        });

                        line.setMap(vm.mapControl.getGMap());
                        lineStroke.setMap(vm.mapControl.getGMap());
                        lines.push(line);
                        lines.push(lineStroke);
                    }
                    vm.routesOnMap[route.id].lines = lines;
                    vm.routesOnMap[route.id].displayOnMap = true;
                    adjustMapBounds();

                });
            }
        };
        function dropStopMarker(stop, fromTo) {

          
            var stopMarker = new google.maps.Marker({
                position: new google.maps.LatLng(stop.Latitude, stop.Longitude),
                optimized: false,
                icon: { url: fromTo == "from" ? fromStopPin : toStopPin, scaledSize: new google.maps.Size(28, 24) },
                animation: google.maps.Animation.DROP
            });
            stopMarker.id = stop.Id;
           stopMarker.setMap(vm.mapControl.getGMap());
            markers.push(stopMarker);
            google.maps.event.addListener(stopMarker, 'click', showStopNameWindow(stop, stopMarker));
        };
        function showStopNameWindow(stop, marker) {
            var infoWindow = new google.maps.InfoWindow({ content: '' });
            return function () {
                var content = '<span style="font-weight: bold;">' + stop.Name + '</span><br />';
                infoWindow.setContent(content);
                infoWindow.open(vm.mapControl.getGMap(), marker);
            }
        };
        function deleteMarker(id) {
            //First clear all the routes on the map
            clearAllRoutesOnMap();
            //Find and remove the marker from the Array
            for (var i = 0; i < markers.length; i++) {
                if (markers[i].id == id) {
                    //Remove the marker from Map                  
                    markers[i].setMap(null);
                    //Remove the marker from array.
                    markers.splice(i, 1);
                    return;
                }
            }
        };
        //map stuff

        function gotoRoutes() {
            $location.path('fixed-route/allRoutes')
        }

        function gotoStops() {
            $location.path('fixed-route/stops')
        }

        function activate() {
            if (vm.divisionId != null && vm.divisionId != undefined && vm.divisionId != '') { getMap(); };
 
            $("#txtFromStopName").parent().addClass('active');//Activate the class to highlight the input control
            populateFromStops();//Load the from stops
        }

        //UI INTERACTIONS
        //Adds and removes the active class to the parent of an element.
        vm.highlightParent = function (e) {
            angular.element(e.target).parent().addClass('active');
        }
        vm.blurParent = function (e) {
            angular.element(e.target).parent().removeClass('active');
        }

        //Fix to handle user hitting backspace to clear the stop.
        function handleKeyPress(e, fromTo) {
            if ( (e && e.keyCode === 8) && //check for backspace
                 (e.currentTarget && e.currentTarget.selectionStart == 0 && e.currentTarget.selectionEnd == e.currentTarget.value.length)) { //check when backspace is hit, if the whole text is selected
                if (fromTo == "from") {
                    vm.fromStopName = "";
                    clearFromStop();
                } else {
                    vm.toStopName = "";
                    clearToStop();
                }
            }
        }


        function populateFromStops() {
            vm.showFromStops = true;
            vm.showToStops = false;
            vm.showRoutes = false;
            vm.loading = true;
            vm.fromStops = [];
            if (vm.selectedFromStop) {
                $("#txtFromStopName").select();
            }

            if (vm.allStops && vm.allStops.length > 0) {
                var filteredList = [];
                if (vm.selectedToStop) {
                    for (var i = 0; i < vm.allStops.length; i++) {
                        if (vm.allStops[i].Id != vm.selectedToStop.Id) {
                            filteredList.push(vm.allStops[i])
                        }
                    }
                } else {
                    filteredList = vm.allStops;
                }
                vm.loading = false;
                vm.fromStops = filteredList;
            } else {
                StopService.getAllStops(vm.divisionId)
                           .then(function (response) {
                               vm.loading = false;
                               vm.allStops = response.data;
                               vm.fromStops = vm.allStops;
                           }, function (error) {

                           });
            }
        }

        function populateToStops() {
            vm.showFromStops = false;
            vm.showToStops = true;
            vm.showRoutes = false;
            vm.loading = true;
            vm.toStops = [];
            if (vm.selectedToStop) {
                $("#txtToStopName").select();
            }

            if (vm.allStops && vm.allStops.length > 0) {
                var filteredList = [];
                if (vm.selectedFromStop) {
                    for (var i = 0; i < vm.allStops.length; i++) {
                        if (vm.allStops[i].Id != vm.selectedFromStop.Id) {
                            filteredList.push(vm.allStops[i])
                        }
                    }
                } else {
                    filteredList = vm.allStops;
                }
                vm.loading = false;
                vm.toStops = filteredList;
            } else {
                StopService.getAllStops(vm.divisionId)
                           .then(function (response) {
                               vm.loading = false;
                               vm.allStops = response.data;
                               vm.toStops = vm.allStops;
                           }, function (error) {

                           });
            }
        }

        function selectFromStop(stop) {
            if (vm.selectedFromStop) { deleteMarker(vm.selectedFromStop.Id) };
            vm.selectedFromStop = stop;
            vm.fromStopName = vm.selectedFromStop.Name;

            dropStopMarker(stop, "from");

            if (!vm.selectedToStop) {
                $("#txtToStopName").focus();
                $("#txtFromStopName").parent().removeClass('active');//Remove the class to highlight the input control
                $("#txtToStopName").parent().addClass('active');//Activate the class to highlight the input control

                populateToStops();
            } else {
                showRoutesForSelectedStops();
            };
        }

        function selectToStop(stop) {
            if (vm.selectedToStop) { deleteMarker(vm.selectedToStop.Id) };
            vm.selectedToStop = stop;
            vm.toStopName = vm.selectedToStop.Name;

            dropStopMarker(stop, "to");

            if (!vm.selectedFromStop) {
                $("#txtFromStopName").focus();
                populateFromStops();
            } else {
                showRoutesForSelectedStops();
            };
        };

        


        function mapRoute(schedule) {
            if (schedule.isSelected) {
                showRouteOnMap(schedule.route);
                vm.activeSchedule = schedule;
                vm.isAnyRouteSelected = true;
            } else {
                hideRouteOnMap(schedule.route);
                vm.activeSchedule = null;
            }
            vm.isHidden = schedule.isSelected;
        };

        function clearFromStop() {
            deleteMarker(vm.selectedFromStop.Id)
            vm.selectedFromStop = null;
            populateFromStops();
        };

        function clearToStop() {
            deleteMarker(vm.selectedToStop.Id)
            vm.selectedToStop = null;
            populateToStops();
        };

        function showRoutesForSelectedStops() {
            setMapBounds();
            if (!vm.selectedFromStop) {
                $("#txtFromStopName").focus();
                populateFromStops();
                return;
            };

            if (!vm.selectedToStop) {
                $("#txtToStopName").focus();
                populateToStops();
                return;
            };

            vm.showFromStops = false;
            vm.showToStops = false;
            vm.showRoutes = true;
            vm.loadingRoutes = true;
            StopService.getArrivalsForStop(vm.divisionId, vm.selectedFromStop.Id, vm.selectedToStop.Id)
                      .then(function (response) {
                          vm.loadingRoutes = false;
                          vm.upcomingSchedules = response.data;
                          for (var i = 0; i < vm.upcomingSchedules.length; i++) {
                              vm.upcomingSchedules[i].isSelected = false;
                          }
                          vm.isAnyRouteSelected = false;
                      }, function (error) {

                      });
        }

        function clearPins() {
            vm.isHidden = !vm.isHidden;
            if (!vm.isHidden) {
                for (var i = 0; i < vm.upcomingSchedules.length; i++) {
                    vm.upcomingSchedules[i].isSelected = false;
                }
                vm.isAnyRouteSelected = false;
                clearAllRoutesOnMap();
            }
        };

                // Start of code for Ionic
        vm.ionicInclude = 'app/modules/fixed-route/stops/fr-stops.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-stops';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('StopsForRouteController', StopsForRouteController);

    StopsForRouteController.$inject = ['$state', '$stateParams', '$interval', '$scope',
        'GeoLocationService', 'googleMapsConfig', 'uiGmapIsReady', 'RouteService',
         'DivisionService', 'ScheduleService', 'PortalUtilityService', 'PageService','OneMvServices'];

    function StopsForRouteController($state, $stateParams, $interval, $scope,
        GeoLocationService, googleMapsConfig, uiGmapIsReady, RouteService,
         DivisionService, ScheduleService, PortalUtilityService, PageService,OneMvServices) {

        var vm = this;        
        var vehiclePoll = undefined;
        var arrivalPoll = undefined;
        var divisionId = undefined;
        var routeId = undefined;
        var vehiclePollInterval = 20000;
        var arrivalPollInterval = 20000;
        var fixedRouteLandingRoute = 'fixed-route-landing';
        var stopsLoaded = false;

        vm.PageService = PageService;
        vm.PageService.setTitle('Stops for Route');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);

        function activate() {
            vm.route = {};
            vm.routeArrivals = [];
            vm.loading = true;
            vm.vehicleMarkers = [];
            vm.selectedStopId = '';

            vm.mapControl = {};
            vm.zoom = 15;
            vm.center = { latitude: 47.604356, longitude: -122.3360817 };
            vm.mapOptions = {
                mapTypeControl: false,
                zoomControl: false,
                streetViewControl: false,
                styles: googleMapsConfig.mapStyles
            };

            if (!PortalUtilityService.hasValue($stateParams.routeId))
                $state.go(fixedRouteLandingRoute);

            routeId = $stateParams.routeId;
            divisionId = DivisionService.getDivisionId();

            if (!PortalUtilityService.hasValue(divisionId))
                $state.go('division');

            RouteService
                .getRouteInfo(routeId)
                    .then(function (response) {
                        if (response && response.data) {
                            vm.route = response.data;
                            getMap();
                        }
                    }, function (error) {
                        $state.go(fixedRouteLandingRoute);
                    })
            .then(getStopArrivalsForRoute);
        }       
        function getPinUrl() {
            return PortalUtilityService.isIE() ?
                'images/pin-my-location.png'
                : 'images/pin-my-location.svg';
        }

        function getMap() {
            uiGmapIsReady
                .promise()
                    .then(getMapInfo)
                        .then(getShapeForRoute)
                            .then(getVehiclesForRoute)
                                .then(pollVehiclesForRoute);
        }

        function getMapInfo(maps) {
            GeoLocationService
                .getCurrentPosition()
                    .then(currentPositionSuccessHandler, currentPositionFailureHandler)
        }

        function currentPositionSuccessHandler(position, maps) {
            vm.position = {
                coords: {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude
                },
                icon: getLocationIcon()
            };
            vm.center.latitude = position.coords.latitude;
            vm.center.longitude = position.coords.longitude;

            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
        }

        function getLocationIcon() {
            return {
                url: getPinUrl(),
                size: new google.maps.Size(42, 42),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(20, 20)
            }
        }


        function currentPositionFailureHandler(err) {
            ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                if (response.data.status == 1) {
                    vm.center.latitude = response.data.result.Latitude;
                    vm.center.longitude = response.data.result.Longitude;
                }
            });
        }

        function getVehiclesForRoute() {
            RouteService
                .getVehiclesForRoute(routeId)
                    .then(vehiclesSuccessHandler, vehiclesFailureHandler);
        }


        function vehiclesSuccessHandler(response) {
            if (response && response.data && response.data.length > 0)
                mapActiveVehicles(response);
        }

        function mapActiveVehicles(response) {

            for (var i = 0; i < response.data.length; i++) {
                var vehicleInfo = response.data[i];                                                

                if (contains(vm.vehicleMarkers, vehicleInfo.id) > -1) {
                    var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

                    updateMarkers(vehicleInfo);
                }
                else {
                    var headingMarker = getHeadingMarker(vehicleInfo);
                    var vehicleMarker = getVehicleMarker(vehicleInfo);

                    vm.vehicleMarkers.push(headingMarker);
                    vm.vehicleMarkers.push(vehicleMarker);
                }
            }
        }


        function updateMarkers(vehicleInfo) {
            var markers = findAll(vm.vehicleMarkers, vehicleInfo.id);
            var map = vm.mapControl.getGMap();
            var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

            for (var i = 0; i < markers.length; i++) {

                var marker = markers[i];
                if (marker.markerType === 'heading') {
                    var icon = marker.getIcon();
                    icon.rotation = vehicleInfo.heading;
                    icon.anchor = new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(heading);
                    icon.origin = new google.maps.Point(0, 0);
                    marker.setIcon(icon);
                }
                 

                marker.setDuration(vehiclePollInterval);
                marker.setPosition(position);

                google.maps.event.trigger(map, "resize");
            }
        }

        function getHeadingMarker(vehicleInfo) {            
            var map = vm.mapControl.getGMap();
            var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

            return new google.maps.Marker({
                id: vehicleInfo.id,
                markerType: 'heading',
                position: position,
                map: map,
                flat:true,
                icon: {
                    path: 'M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z',//google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                    scale: 1.1,
                    fillOpacity: 1,
                    fillColor: '#fff',
                    strokeWeight: 1,
                    strokeOpacity: .3,
                    rotation: vehicleInfo.heading,
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(vehicleInfo.heading)
                },
                zIndex: 1
            });
        }       

        function getVehicleMarker(vehicleInfo) {
            var map = vm.mapControl.getGMap();
            var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

            var marker = new google.maps.Marker({
                id: vehicleInfo.id,
                markerType: 'vehicle',
                position: position,
                flat: true,
                map: map,
                icon: {
                    path: 'M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z',
                    fillOpacity: 1,
                    strokeOpacity: 0,
                    fillColor: vm.route.color,
                    scale: 1,
                },
                zIndex: 2
            });
            google.maps.event.addListener(marker, 'click', showVehicleNumber(map, marker, vehicleInfo.name));

            return marker;
        }

        function showVehicleNumber(map, marker, number) {

            var infoWindow = new google.maps.InfoWindow({ content: '' });
            return function () {
                var content = '<span style="font-weight: bold;">' + '#'+number + '</span><br />';
                infoWindow.setContent(content);
                infoWindow.open(map, marker);
            }
        }        

        function removeMarker(collection, marker) {
            
            var index = contains(collection, marker.id);
            collection[index].setMap(null);
            collection.splice(index, 1);
        }

        function contains(list, id) {
            for (var i = 0; i < list.length; i++) {
                if (list[i].id === id) return i;
            }
            return -1;
        }

        function findAll(list, id) {
            var markers = [];

            for (var i = 0; i < list.length; i++) {
                if (list[i].id === id)
                    markers.push(list[i]);
            }
            return markers;
        }


        function vehiclesFailureHandler() {

        }

        function pollVehiclesForRoute() {
            vehiclePoll = $interval(function () {
                getVehiclesForRoute();
            }, vehiclePollInterval);
        }


        function getStopArrivalsForRoute() {
            RouteService
                .getArrivalsForRoute(routeId, divisionId)
                       .then(handleArrivalSuccess, handleArrivalFailure)
                            .then(pollArrivalsForRoute);
        }

        function handleArrivalSuccess(response) {
            vm.routeArrivals = response.data.arrivals;
            vm.loading = false;

            if (!stopsLoaded)
                mapStopsForDisplay();;
        }


        function getShapeForRoute() {
            var map = vm.mapControl.getGMap();
            RouteService
                .getShapesByRoute(routeId)
                    .then(function (result) {
                        var shapes = result.data;

                        var line = new google.maps.Polyline({
                            path: google.maps.geometry.encoding.decodePath(shapes[0].line),
                            strokeColor: vm.route.color,
                            strokeOpacity: 4.0,
                            strokeWeight: 4,
                            map : map,
                            icons: [{
                                icon: {
                                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                                    scale: 3
                                },
                                offset: '25px',
                                repeat: '200px'
                            }]

                        });

                        map.fitBounds(getLineBounds(line));
                    }, function (error) {

                    });
        }


        function getLineBounds(line) {
            var bound = new google.maps.LatLngBounds();
            line.getPath().forEach(function (item, index) {
                bound.extend(new google.maps.LatLng(item.lat(), item.lng()));
            });
            return bound;
        };

        function handleArrivalFailure(error) {
            vm.loading = false;
        }

        function mapStopsForDisplay() {
            var map = vm.mapControl.getGMap();

            for (var i = 0; i < vm.routeArrivals.length; i++) {

                var stopInfo = vm.routeArrivals[i].stop;
                var position = new google.maps.LatLng(stopInfo.Latitude, stopInfo.Longitude);

                var stop = new google.maps.Marker({
                    id: stopInfo.Id,
                    position: position,
                    map: map,
                    optimized: false,
                    icon: {
                        path: 'M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z',
                        fillColor: vm.route.color,
                        fillOpacity: 1,
                        strokeWeight: 0,
                        anchor: new google.maps.Point(9, 21),
                        size: new google.maps.Size(20, 23)
                    },
                    zIndex: 5,
                    animation: google.maps.Animation.DROP
                });

                var icon = new google.maps.Marker({
                    id: stopInfo.Id,
                    position: position,
                    map: map,
                    optimized: false,
                    icon: {
                        path: 'M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z',
                        fillColor: '#fff',
                        fillOpacity: 1,
                        strokeWeight: 0,
                        anchor: new google.maps.Point(7, 19),
                        size: new google.maps.Size(16, 16)
                    },
                    zIndex: 6,
                    animation: google.maps.Animation.DROP
                });

                var shadow = new google.maps.Marker({
                    id: stopInfo.Id,
                    position: position,
                    map: map,
                    optimized: false,
                    icon: {
                        path: 'M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z',
                        fillColor: '#000',
                        fillOpacity: .10,
                        strokeWeight: 0,
                        anchor: new google.maps.Point(9, 21),
                        size: new google.maps.Size(21, 10)

                    },
                    zIndex: 4,
                    animation: google.maps.Animation.DROP
                });

                google.maps.event.addListener(icon, 'click', showStopInfo(map, icon, stopInfo.Name));
            }

            stopsLoaded = true;
        }


        function showStopInfo(map, marker, name) {

            var infoWindow = new google.maps.InfoWindow({ content: '' });
            return function () {
                var content = '<span style="font-weight: bold;">'  + name + '</span><br />';
                infoWindow.setContent(content);
                infoWindow.open(map, marker);
            }
        }


        function onStopClick(marker, eventName, model) {
           
        }

        function pollArrivalsForRoute() {
            if (!PortalUtilityService.hasValue(arrivalPoll)) {
                arrivalPoll = $interval(function () {
                    getStopArrivalsForRoute()
                }, arrivalPollInterval);
            }
        }

        activate();

        $scope.$on('$destroy', function (event) {
            stopPolling();
        });

        function stopPolling() {
            if (angular.isDefined(vehiclePoll)) {
                $interval.cancel(vehiclePoll);
                vehiclePoll = undefined;
            }

            if (angular.isDefined(arrivalPoll)) {
                $interval.cancel(arrivalPoll);
                arrivalPoll = undefined;
            }
        }
        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/fixed-route/stops-for-route/stops-for-route.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-stops-for-route';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular.module('oneMVApp')
        .controller('ActiveTripController', activeTripController);

    activeTripController.$inject = ['$scope', '$location', '$interval', '$window', '$uibModal',
                'ConfigFactory', 'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'authService',
                'UtilityFactory', 'RedirectionService', 'CommunicationsService', 'SettingsService',  'PageService','OneMvServices'];

    function activeTripController($scope, $location, $interval, $window, $uibModal,
        ConfigFactory, ScheduleService, uiGmapIsReady, DivisionService, authService,
        UtilityFactory, RedirectionService, CommunicationsService, SettingsService,  PageService,OneMvServices) {

        var vm = this;

        PageService.setTitle('Active Trip');
        PageService.setHeadline(OneMvServices.getDrtInfo().alias);

        var options = undefined;
        var autoRefresh = undefined;
        vm.passengerId = authService.authentication.passengerId;
        vm.cancelTrip = cancelTrip;
        vm.getActiveTrip = getActiveTrip;
        vm.tryContactDriver = tryContactDriver;
        vm.isCancelling = false;
        vm.activeTrip;
        vm.contactingDriver = false;
        var divisionId = '';
        var operatorId = null;
        var directionsDisplay = new google.maps.DirectionsRenderer({ suppressMarkers: true, draggable: false });
        var directionsService = new google.maps.DirectionsService();
        vm.isLoading = false;
        vm.vehicleInfo = null;
        vm.drawerState = 1;

        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            closestPin = 'images/default/i-drt-pin-b.png';
            otherPin = 'images/default/i-drt-pin-g.png';
            locationPin = 'images/pin-location.png';
            myLocationPin = 'images/pin-my-location.png';
            hubIcon = 'images/pin-hub.png';
        }
        else {
            closestPin = 'images/default/i-pin-drt-b.svg';
            otherPin = 'images/default/i-drt-pin-g.svg';
            locationPin = 'images/pin-location.svg';
            myLocationPin = 'images/pin-my-location.svg';
            hubIcon = 'images/pin-hub.svg';
        }

        function setAutoRefresh() {
            autoRefresh = $interval(function () {
                getActiveTrip();
            }, 30000);
        }

        function tryContactDriver(type) {
            vm.contactingDriver = true;
            vm.type = type;
            SettingsService
               .getSettings(authService.authentication.passengerId)
           .then(function (response) {
               if (response.length >= 10) {
                   contactDriver();
               } else {
                   CollectPassengerMobile();
               }
           }, function (error) {
              
           });
            
        }
        
        $scope.swipeUp = function ($event) {
          if (vm.drawerState < 2) {
            vm.drawerState += 1;
          }
        };

        $scope.swipeDown = function ($event) {
          if (vm.drawerState > 0) {
            vm.drawerState -= 1;
          }
        };

        function showSupportPopUp() {
            // get help phone number
            var helpPhone = DivisionService.getSupportPhoneNumber();
            var message = "Could not contact driver. Please call Help desk at <a href='tel:" + helpPhone + "'>" + helpPhone + "</a>";
            
            $uibModal.open({
                template: '<div class="modal-header" >' +
                                '<h3 class="modal-title">Support</h3>' +
                              ' </div>' +
                              '<div class="modal-body">' +
                                '<p>' + message + '</p>' +
                              '</div>' +
                              '<div class="modal-footer">' +
                              '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                replace: true,
                controller: function ($scope, $uibModalInstance) {
                    $scope.close = function () {
                        $uibModalInstance.close();
                        //$location.replace().path('dashboard/');
                    };
                },
                backdrop: 'static',
                keyboard: false
            });
        }

        function contactDriver() {
            CommunicationsService.contactDriver(vm.activeTrip.TripID).then(function (response) {
                if (response.status == 1 && response.result) {
                    if (vm.type == "call")
                        document.location.href = "tel:" + response.result;
                    else if (vm.type == "sms")
                        document.location.href = "sms:" + response.result;
                } else if (response.status == 2) {
                    //Handle Validation 100001 = Driver phone missing
                    //Handle Validation 100002 = Passenger phone missing
                    showSupportPopUp();
                } else {
                    showSupportPopUp();
                }
                vm.contactingDriver = false;
            }, function (error) {
                vm.contactingDriver = false;
                showSupportPopUp();
            });
        }

        function CollectPassengerMobile() {

            var passengerMobileModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/on-demand/activeTrip/passenger-mobile-modal.html',
                controller: 'PassengerMobileController as vm',
                size: 'sm',
                resolve: {
                    settings: function () {
                        return {
                            passengerId: authService.authentication.passengerId,
                        };
                    }
                }
            });
            passengerMobileModal.result.then(function (response) {
                if (response == true) {
                    contactDriver();
                } else if(response == false){
                    UtilityFactory.toastError('Error', 'Could not update your mobile number.');
                }
            });
        }

        function getActiveTrip() {
            // vm.isLoading = false;
            ScheduleService.getlastripdetails(vm.passengerId).then(function (response) {
                if (response.data.status == 1) {
                    vm.activeTrip = response.data.result;

                    //var promiseWindow = options.promiseWindow;
                    var startPickupWindowTime = new moment(vm.activeTrip.StartPickupWindowTime);
                    var endPickupWindowTime = new moment(vm.activeTrip.EndPickupWindowTime);
                    vm.activeTrip.promiseWindowStartTime = startPickupWindowTime.format('h:mm A');
                    vm.activeTrip.promiseWindowEndTime = endPickupWindowTime.format('h:mm A');

                    mapTrip();
                }
                else {
                    vm.activeTrip = null;
                    vm.scheduleMarkers = [];
                    directionsDisplay.setMap(null);
                    $location.path('on-demand/reservations');
                }
                //getMap();

            }, function (err) {
                vm.activeTrip = null;
                vm.isLoading = false;
                // getMap();
            });
        }

        vm.zoom = 15;
        vm.center = {
            latitude: 39.809860,
            longitude: -98.555183
        };
        vm.myStyles = [
  {
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#ebe3cd"
        }
      ]
  },
  {
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#523735"
        }
      ]
  },
  {
      "elementType": "labels.text.stroke",
      "stylers": [
        {
            "color": "#f5f1e6"
        }
      ]
  },
  {
      "featureType": "administrative",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#c9b2a6"
        }
      ]
  },
  {
      "featureType": "administrative.land_parcel",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#dcd2be"
        }
      ]
  },
  {
      "featureType": "administrative.land_parcel",
      "elementType": "labels",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "administrative.land_parcel",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#ae9e90"
        }
      ]
  },
  {
      "featureType": "landscape.natural",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "poi",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "poi",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#93817c"
        }
      ]
  },
  {
      "featureType": "poi.business",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [
        {
            "color": "#a5b076"
        }
      ]
  },
  {
      "featureType": "poi.park",
      "elementType": "labels.text",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "poi.park",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#447530"
        }
      ]
  },
  {
      "featureType": "road",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#f5f1e6"
        }
      ]
  },
  {
      "featureType": "road.arterial",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#fdfcf8"
        }
      ]
  },
  {
      "featureType": "road.highway",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#f8c967"
        }
      ]
  },
  {
      "featureType": "road.highway",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#e9bc62"
        }
      ]
  },
  {
      "featureType": "road.highway.controlled_access",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#e98d58"
        }
      ]
  },
  {
      "featureType": "road.highway.controlled_access",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#db8555"
        }
      ]
  },
  {
      "featureType": "road.local",
      "elementType": "labels",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "road.local",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#806b63"
        }
      ]
  },
  {
      "featureType": "transit.line",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "transit.line",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#8f7d77"
        }
      ]
  },
  {
      "featureType": "transit.line",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
            "color": "#ebe3cd"
        }
      ]
  },
  {
      "featureType": "transit.station",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "water",
      "elementType": "geometry.fill",
      "stylers": [
        {
            "color": "#b9d3c2"
        }
      ]
  },
  {
      "featureType": "water",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#92998d"
        }
      ]
  }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.mapControl = {};

        function cancelTrip(trip) {

            var tripToCancel = {
                'tripId': trip.TripID,
                'passengerId': trip.PassengerID,
                'from': trip.StartAddressViewModel.Name,
                'to': trip.EndAddressViewModel.Name,
                'scheduledTime': trip.ScheduledPickupTime
            };

            var modalCancelTrip = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                controller: 'TripCancellationController as vm',
                size: '',
                resolve: {
                    tripToCancel: function () {
                        return tripToCancel;
                    },
                    showCancelOptions: vm.reservationFormOptions.showCancelOptions
                }
            });
            modalCancelTrip.result.then(function (result) {
                if (result.isCancel) {
                    UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                    $location.path('on-demand/reservations');
                }
                else
                    UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
            });

        }

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                ScheduleService.getServiceAreaLocation(vm.divisionId).then(function (response) {
                    if (response.data.status == 1) {
                        vm.center.latitude = response.data.result.Latitude;
                        vm.center.longitude = response.data.result.Longitude;
                    }

                    getActiveTrip();
                    setAutoRefresh();
                    /*if(vm.activeTrip != null)
                        mapTrip();*/
                });
            });

        }

        function mapTrip() {
            vm.scheduleMarkers = [];

            directionsDisplay.setMap(vm.mapControl.getGMap());

            vm.scheduleMarkers.push({
                'latitude': vm.activeTrip.StartAddressViewModel.Latitude, 'longitude': vm.activeTrip.StartAddressViewModel.Longitude,
                'icon': 'images/default/i-drt-pin-b.png', 'tripId': vm.activeTrip.TripID
            });
            vm.scheduleMarkers.push({
                'latitude': vm.activeTrip.EndAddressViewModel.Latitude, 'longitude': vm.activeTrip.EndAddressViewModel.Longitude,
                'icon': 'images/default/i-drt-pin-g.png', 'tripId': vm.activeTrip.TripID
            });

            var request = {
                origin: new google.maps.LatLng(vm.activeTrip.StartAddressViewModel.Latitude, vm.activeTrip.StartAddressViewModel.Longitude),
                destination: new google.maps.LatLng(vm.activeTrip.EndAddressViewModel.Latitude, vm.activeTrip.EndAddressViewModel.Longitude),
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };

            vm.vehicleInfo = {
                coords: {
                    'latitude': vm.activeTrip.VehicleLatitude,
                    'longitude': vm.activeTrip.VehicleLongitude,
                },
                icon: 'images/i-car-green.svg'
            };

            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            directionsService.route(request, function (response, status) {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                } else {
                    //window.alert('Directions request failed due to ' + status);
                }
            });
            vm.isLoading = false;
        };



        function activate(callback) {
            if (!authService.isLoggedIn()) {
                RedirectionService, save('/on-demand/active-trip');
                $location.path('login');
            }
            else {

                divisionId = DivisionService.getDivisionId();
                if (divisionId != null && divisionId != undefined && divisionId != '') {
                    if (callback && typeof callback === "function")
                        callback();
                }
            }
            }

        function populateDivisionParameters() {
            options = {
                DivisionId: divisionId,
                OperatorId: operatorId
            };
            ConfigFactory.getDivisionParameters(divisionId)
                     .then(function (params) {
                         if (params) {
                             options.passengersLimit = params.PassengersLimit ? eval(params.PassengersLimit) : 5;
                             options.allowWillCall = params.AllowWillCall ? eval(params.AllowWillCall.toLowerCase()): false;
                             options.allowEquipment = params.AllowEquipment ? eval(params.AllowEquipment.toLowerCase()) : false;
                             options.isAdvancedReservation = params.AllowAdvancedReservation ? eval(params.AllowAdvancedReservation.toLowerCase()) : false;
                             options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;
                             options.isWheelChair = params.HasWheelChair ? eval(params.HasWheelChair.toLowerCase()) : false;
                             options.isPCA = params.HasPersonalCareAssistant ? eval(params.HasPersonalCareAssistant.toLowerCase()) : false;
                             options.isServiceAnimal = params.HasServiceAnimal ? eval(params.HasServiceAnimal.toLowerCase()) : false;
                             options.isCompanion = params.HasCompanions ? eval(params.HasCompanions.toLowerCase()) : false;
							 options.companionsLimit = params.HasCompanions == false ? 0: params.CompanionsLimit ? eval(params.CompanionsLimit): 1;
                             options.allowCustomLocation = params.AllowCustomLocation ? eval(params.AllowCustomLocation.toLowerCase()) : false;
                             options.allowOnlySameDayAdvRes = params.AllowOnlySameDayAdvRes ? eval(params.AllowOnlySameDayAdvRes.toLowerCase()) : false;
                             options.promiseWindow = params.PromiseWindow ? eval(params.PromiseWindow) : 10;
                             options.showCancelOptions = params.CancelReasonRequired ? eval(params.CancelReasonRequired.toLowerCase()) : false;
                             options.reservationType = vm.reservationType;
                             options.allowFaring = params.AllowFaring ? eval(params.AllowFaring.toLowerCase()) : false;
                             options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes) : false;
                             options.allowPassengerToCall = params.AllowPCD ? eval(params.AllowPCD.toLowerCase()) : false;
                             options.allowPassengerToSms = params.AllowPSD ? eval(params.AllowPSD.toLowerCase()) : false;
                             options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                             vm.reservationFormOptions = options;

                         	//extra options only needed by user reservations directive.
                             options.isPassenger = true;
                             options.isReadOnly = true;
                             options.autoRefresh = true;
                             options.batchDays = params.BatchDays ? eval(params.BatchDays) : 7;
                             options.minFromDays = params.MinFromDays ? eval(params.MinFromDays) : 30;
                             vm.reservationFormOptions = options;
                         }
                     }, function (response) {
                         UtilityFactory.toastError('Error', response.data.ReturnMessage);
                     });
            getMap();
            //getActiveTrip();
        }
        activate(populateDivisionParameters);

        $scope.$on('$destroy', function (event) {
            if (angular.isDefined(autoRefresh)) {
                $interval.cancel(autoRefresh);
                autoRefresh = undefined;
            }
        });

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/on-demand/activeTrip/active-trip.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('PassengerMobileController', PassengerMobileController);

    PassengerMobileController.$inject = ['$location', '$uibModalInstance', 'settings', 'SettingsService', 'UtilityFactory'];

    function PassengerMobileController($location, $uibModalInstance, settings, SettingsService, UtilityFactory) {
        /* jshint validthis:true */
        var vm = this;
        vm.updateSettings = updateSettings;
        vm.cancel = cancel;
        vm.passengerId = settings.passengerId;
        vm.clientTelephone = '';
        vm.isUpdating = false;

        function cancel() {
            $uibModalInstance.close();
        };

        function updateSettings() {
            vm.isUpdating = true;
            if (vm.clientTelephone != "" && !isNaN(vm.clientTelephone) && vm.clientTelephone > 0) {
                var mobileNumber = "+1" + vm.clientTelephone;
                var settings = {
                    "PassengerId": vm.passengerId,
                    "ClientTelephone": mobileNumber
                }
                SettingsService
                   .updateSettings(settings)
               .then(function (response) {
                   vm.isUpdating = false;
                   closeModal(response);
               }, function (error) {
                   vm.isUpdating = false;
                   closeModal(false);
               });
            } else {
                vm.isUpdating = false; 
                UtilityFactory.toastError('Error', 'Please enter a valid number');
            }
        }

        var closeModal = function (response) {
            $uibModalInstance.close(response);
        }

        activate();

        function activate() { }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('TripCancellationController', TripCancellationController);

    TripCancellationController.$inject = ['$uibModalInstance', 'tripToCancel', 'showCancelOptions', 'UtilityFactory', 'ScheduleService'];

    function TripCancellationController($uibModalInstance, tripToCancel, showCancelOptions, UtilityFactory, ScheduleService) {
        var vm = this;
        vm.tripToCancel = tripToCancel;
        vm.showCancelOptions = showCancelOptions;
        vm.cancelError = false;
        vm.disable = false;
        vm.reasonComment = '';

        vm.cancelTrip = function () {
            vm.disable = true;
            var request = {
                    'TripID': tripToCancel.tripId,
                    'PassengerID': tripToCancel.passengerId,
                    'OperationID': null
                };
            if (vm.showCancelOptions)
            {
                if(vm.cancelReason)
                {
                    request.CancelReasonId = vm.cancelReason.ReasonId;
                    request.CancelReasonText = vm.cancelReason.Reason;
                    if(vm.reasonComment.trim() != '')
                    {
                        request.CancelReasonText += ' - ' + vm.reasonComment.trim().replace(/[^a-zA-Z\d,@!\.\(\)\-\* \s]/g, '');
                        if(request.CancelReasonText.length > 250)
                        {
                            UtilityFactory.toastError("Error!", "Comment too long. Please make it shorter");
                            vm.disable = false;
                            return;
                        }
                    }
                    else if (vm.cancelReason.Reason === 'Other' && vm.reasonComment.trim() === '') {
                        UtilityFactory.toastError("Error!", "You selected Other, please type a reason.");
                        vm.disable = false;
                        return;
                    }
                }
                else {
                    UtilityFactory.toastError("Error!", "Please provide a reason for cancellation");
                    vm.disable = false;
                    return;
                }
            }
            
           ScheduleService.cancelpost(request).then(function (response) {
                if (response && response.data && response.data.status == 1) {
                    $uibModalInstance.close({ 'action': 'close', 'isCancel': true });
                } else {
                    vm.cancelError = true;
                }
                vm.disable = false;
            }, function (error) {
                vm.disable = false;
                vm.cancelError = true;
            });
        };

        vm.cancel = function () {
            $uibModalInstance.dismiss('cancel');
        };

        this.MakeDisable = function () {
            if (vm.disable) {
                return true;
            }
            else {
                return false;
            }
        };

        vm.disallowSpecialChar = function()
        {
            if(vm.reasonComment.trim() !== '')
            {
                vm.reasonComment = vm.reasonComment.replace(/[^a-zA-Z\d,@!\.\(\)\-\* \s]/g, '');
            }
        }

        activate();
        function activate() {
            //first get parameter to check if trip cancel status is needed.
            //get trip cancellation statuses
          
            if (vm.showCancelOptions) {
                ScheduleService.getTripCancelStatusList().then(function (response) {
                    if (response.data.status == 1)
                        vm.cancelReasons = response.data.result;
                }, function (error) { });
            }
        }
    }
})();

(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.controller('FaringModalController', FaringModalController);

    FaringModalController.$inject = ['$scope', 'UtilityFactory', 'FaringService', '$log', '$uibModalInstance', 'DivisionService', 'ProfileService', 'reservationRequest', 'serviceDate'];

    function FaringModalController($scope, UtilityFactory, FaringService, $log, $uibModalInstance, DivisionService, ProfileService, reservationRequest, serviceDate ) {
        $scope.cancel = cancel;
        $scope.saveCompanions = saveCompanions;
        $scope.resetCompanions = resetCompanions;
        $scope.editCompanions = editCompanions;
        $scope.increaseCount = increaseCount;
        $scope.decreaseCount = decreaseCount;
        $scope.bookTrip = bookTrip;
        $scope.isHidden = true;
        $scope.locationNotes = { 'from': '', 'to': '' }

        $scope.maxCount = $scope.$parent.options.isCompanion ? $scope.$parent.options.companionsLimit : 0;
        $scope.companionCount = 0;
        $scope.reservationRequest = reservationRequest;  
        $scope.serviceDate = serviceDate.format('YYYY-MM-DD');
        $scope.companionFare = 0;
        $scope.baseFare = undefined;
        $scope.maxCompanionCountWarning = false;
        var lastFareTypes = undefined;
        var lastCompanionFare = 0;
        var lastCompanionCount = 0;
        var reservationTime = undefined;
        $scope.fareTypes = [];

        function increaseCount(index)
        {
            // Added check to make sure the user does not add more than $scope.maxCount
            if ($scope.companionCount < $scope.maxCount) {
                $scope.fareTypes[index].NumberOfPassengers++;
                $scope.companionFare = $scope.companionFare + $scope.fareTypes[index].Fare;
                $scope.companionCount++;
                $scope.maxCompanionCountWarning = false;
            } else {
                $scope.maxCompanionCountWarning = true;
            }

        }
        function decreaseCount(index) {
            // Added check to make sure the user does not remove less than 0.
            if ($scope.fareTypes[index].NumberOfPassengers > 0) {
                $scope.fareTypes[index].NumberOfPassengers--;
                $scope.companionFare = $scope.companionFare - $scope.fareTypes[index].Fare;
                $scope.companionCount--;
                $scope.maxCompanionCountWarning = false;
            }

        }
      
       
        var fromLocation = reservationRequest.fromLocation;
        var toLocation = reservationRequest.toLocation;

        function cancel() {
            $scope.reservationRequest.IsWheelChair = false;
            $scope.reservationRequest.IsPCA = false;
            $scope.reservationRequest.IsServiceAnimal = false;
            $scope.reservationRequest.TripFares = [];
            $scope.reservationRequest.BaseFare = undefined;
            $scope.maxCompanionCountWarning = false;
            $uibModalInstance.close($scope.reservationRequest);

            //reset companions and accessibility
        };
        
        
        function saveCompanions()
        {
            $scope.showCompanionSelection = !$scope.showCompanionSelection;
        }
        function resetCompanions()
        {
           
            $scope.fareTypes = angular.copy(lastFareTypes);
            //reset wheelchairs etc.
            $scope.companionFare = lastCompanionFare;
            $scope.companionCount = lastCompanionCount;
            $scope.showCompanionSelection = !$scope.showCompanionSelection;
            $scope.maxCompanionCountWarning = false;
            //companion object should be reset to 0 count
        }
        function editCompanions()
        {
            lastFareTypes = angular.copy($scope.fareTypes);
            lastCompanionFare = $scope.companionFare;
            lastCompanionCount = $scope.companionCount;
            $scope.showCompanionSelection = !$scope.showCompanionSelection;
        }

        function bookTrip()
        {
            if ($scope.baseFare == undefined)
            {
                UtilityFactory.toastError('Error', 'Can not get faring information. Please try again later.');
                return;
            }
            if ($scope.$parent.options.allowLocationNotes) {
               
                $scope.reservationRequest.locationNotes.from = $scope.locationNotes.from;
                $scope.reservationRequest.locationNotes.to = $scope.locationNotes.to;
            }
            $scope.reservationRequest.TripFares = $scope.fareTypes;
            $scope.reservationRequest.TotalTripFare = $scope.baseFare + $scope.companionFare;
            $scope.reservationRequest.CompanionsCount = $scope.companionCount;
            $scope.reservationRequest.BaseFare = $scope.baseFare;
            $scope.$parent.saveReservation($scope.reservationRequest);
            $uibModalInstance.close();
        }
        function getFares() {
            $scope.requestedTime = reservationTime.format('MM/DD/YYYY hh:mm A');
            if ($scope.reservationRequest.TripFares != null && $scope.reservationRequest.TripFares.length > 0) {
                $scope.fareTypes = $scope.reservationRequest.TripFares;
                $scope.baseFare = $scope.reservationRequest.BaseFare;
                angular.forEach($scope.fareTypes, function (value, key) {
                    if (value.NumberOfPassengers > 0) {
                        $scope.companionCount += value.NumberOfPassengers;
                        $scope.companionFare += (value.Fare * value.NumberOfPassengers);
                    }
                });
                if ($scope.reservationRequest.locationNotes && $scope.reservationRequest.locationNotes.from != '')
                {
                    $scope.locationNotes.from = $scope.reservationRequest.locationNotes.from;
                }
                if ($scope.reservationRequest.locationNotes && $scope.reservationRequest.locationNotes.to != '') {
                    $scope.locationNotes.to = $scope.reservationRequest.locationNotes.to;
                }
                return;
            }

            $scope.fareTypes = [];

            FaringService.GetZoneFares($scope.divisionId, $scope.reservationRequest.fromZone, $scope.reservationRequest.toZone, reservationTime.format("YYYY-MM-DD HHmmss"), $scope.serviceDate)
            .then(function (response) {
                if(response.data.status == 1)
                {
                    var fares = response.data.result;
                    angular.forEach(fares, function(value, key)
                    {
                        $scope.fareTypes.push({ PassengerFareTypeId: value.PassengerFareTypeId, NumberOfPassengers: 0, Name: value.FareType, Fare: value.Fare, ZoneFareId: value.ZoneFareId });
                    });
                    setBaseFare(fares);
                }
                else {
                    $scope.baseFare = undefined;
                }
            }, function error(err) {
                UtilityFactory.toastError('Error', 'Can not get faring information. Please try again later.');
                $scope.baseFare = undefined;
            });
        }

        
        activate(getFares);
        function setDefaultFare(fares)
        {
            for(var i = 0; i < fares.length; i++)
            {
                if (fares[i].IsDefault) {
                    $scope.baseFare = fares[i].Fare;
                    return;
                }
            }
            $scope.baseFare = undefined;
        }

        function setBaseFare(fares)
        {
            //default fare is set, if fare is found it will over write it
            setDefaultFare(fares);
            ProfileService.GetPassengerAge($scope.$parent.passenger.Id)
                .then(function (response){
                    if(response.data.status == 1)
                    {
                        var age = response.data.result;
                       
                            for (var i = 0; i < fares.length; i++) {

                                if (fares[i].FromAge == undefined)
                                    continue;
                                if (age >= fares[i].FromAge && (fares[i].ToAge == undefined || age <= fares[i].ToAge)) {
                                    $scope.baseFare = fares[i].Fare;
                                    break;
                                }

                            }
                        
                    }
                    
                }, function (err) {
                   
                });
                
        }

        function activate(callback) {
         
            $scope.divisionId = DivisionService.getDivisionId();
            if ($scope.divisionId != null && $scope.divisionId != undefined && $scope.divisionId != '') {
                
                if ($scope.reservationRequest.reservationType != $scope.$parent.reservationTypeEnum.ASAP)
                    reservationTime = $scope.$parent.getReservationDateTime($scope.reservationRequest);
                else
                    reservationTime = moment.tz(DivisionService.getTimeZone());
                DivisionService.getServiceDateByDivisionTime($scope.divisionId, reservationTime.format("YYYY-MM-DD HHmmss"))
                .then(function (response) {
                    $scope.serviceDate = moment(response.data.result).format("YYYY-MM-DD");
                    if (callback && typeof callback === "function")
                        callback();
                }, function (error) {
                    UtilityFactory.toastError('Error', 'Can not get faring information. Please try again later.');
                    $scope.baseFare = undefined;
                });
                }
                else
                    $location.path('dashboard/');
           
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('DashboardController', DashboardController);

    DashboardController.$inject = [
        '$scope',
        '$stateParams',
        '$location',
        '$uibModal',
        '$rootScope',        
        '$interval',
        'DivisionService',
        'ReservationService',
        'ScheduleService',
        'authService',
        'UtilityFactory',        
        'ConfigFactory',
        'env',
        'PageService',
        'OneMvServices'
    ];

    function DashboardController($scope, $stateParams, $location, $uibModal, $rootScope, $interval, DivisionService,
        ReservationService, ScheduleService, authService, UtilityFactory,ConfigFactory, env, PageService,OneMvServices) {


        var vm = this;
        vm.userId = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('Dashboard');
        vm.isUserLoggedIn = authService.isLoggedIn();
        vm.passengerReservations = [];
        vm.todaysTrips = [];
        vm.allowedServices = [];
        vm.loadingServices = false;
        vm.allowFaring = false;
        vm.passengerId = '';
        var autoRefresh = undefined;
        vm.currentYear = new Date().getFullYear();
        vm.showDrt = false;
        vm.showCommuter = false;        
        vm.commuterInfo = OneMvServices.getCommuterInfo();   
        vm.drtInfo = OneMvServices.getDrtInfo();

        var options = {};

        vm.login = function () {
            $location.path('/login');
        }

        vm.menuClass = function () {
            if (vm.allowedServices
                && vm.allowedServices.length > 0) {
                var elCount = vm.allowedServices.length;
                return 'col-sm-' + 12 / elCount;
            }
            return 'col-sm-12';
        }

        function populateDivisionParameters(callback) {
            var divisionId = DivisionService.getDivisionId();
            ConfigFactory.getDivisionParameters(divisionId)
                        .then(function (params) {
                            if (params) {
                                options.promiseWindow = params.PromiseWindow ? eval(params.PromiseWindow) : 10;
                                options.showCancelOptions = params.CancelReasonRequired ? eval(params.CancelReasonRequired.toLowerCase()) : false;
                                options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes.toLowerCase()) : false;
                                vm.allowFaring = params.AllowFaring ? eval(params.AllowFaring.toLowerCase()) : false;
                                options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                                options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;
                                fetchTripsAndReservations(callback);
                            }
                        }, function (response) {
                            UtilityFactory.toastError('Error', response.data.ReturnMessage);
                        });
        }

        var getPassengerTrips = function (callback) {
            ScheduleService.tripsForServiceDate(vm.passengerId)
             .then(function (response) {
                 if (response.data.status == 1 && response.data.result != null) {
                     vm.todaysTrips = response.data.result;
                     var promiseWindow = options.promiseWindow;
                     vm.todaysTrips.sort(function (a, b) {
                         return new Date(a.schedPickupTime).getTime() - new Date(b.schedPickupTime).getTime();
                     });
                     for (var i = 0; i < vm.todaysTrips.length; i++) {
                         vm.serviceDate = vm.todaysTrips[i].serviceDate;
                         if (vm.todaysTrips[i].estimatedPickupTime) {
                             //var pickupTime = vm.todaysTrips[i].schedPickupTime;
                             //var promiseWindowsEndTime = DateFactory.getPromiseWindowEndTime(pickupTime, promiseWindow);
                             //vm.todaysTrips[i].promiseWindowStartTime = $filter('date')(pickupTime, 'h:mm a');
                             //vm.todaysTrips[i].promiseWindowEndTime = $filter('date')(promiseWindowsEndTime, 'h:mm a');

                             var startPickupWindowTime = new moment(vm.todaysTrips[i].startPickupWindowTime);
                             var endPickupWindowTime = new moment(vm.todaysTrips[i].endPickupWindowTime);
                             vm.todaysTrips[i].promiseWindowStartTime = startPickupWindowTime.format('h:mm A');
                             vm.todaysTrips[i].promiseWindowEndTime = endPickupWindowTime.format('h:mm A');
                         }
                     }

                 }
                 if (!angular.isUndefined(callback) && callback != null)
                     callback();
             }, function (error) {
             });
        };
       
        //vm.allowCancel = function (trip) {
        //    return trip.Status !== 'Reserved';
        //}     

        var getPassengerReservationsForToday = function () {
            ReservationService.getPassengerReservationsForToday(vm.passengerId)
            .then(function (response) {
                if (response && response.data && response.data.status == 1 && response.data.result.reservations) {
                    vm.passengerReservations = response.data.result.reservations;                    
                }
                else {
                    vm.passengerReservations = [];
                }
            }, function (err) {
                if (err.status !== 401) {
                    UtilityFactory.toastError("Error!", "'Sorry! Could not load your Reservation!'");
                }
            });

        };
       
        function setAutoRefresh() {
            if (authService.isLoggedIn()) {
                autoRefresh = $interval(function () {
                    fetchTripsAndReservations();
                }, 30000);
            }
        }

        var activate = function () {
            vm.loadingServices = true;

            var alias = aliasNotFoundInRoute()
                ? DivisionService.getDivisionAlias()
                : $stateParams.division;

            DivisionService
                .setDivision(alias)
                .then(handleSuccess, handleFailure);     
        };

        function aliasNotFoundInRoute() {
            return angular.isUndefined($stateParams.division) 
                        || $stateParams.division === null 
                        || $stateParams.division.trim() === '';
        }

        function handleSuccess(response) {
            if (response.data.status == 1) {
                vm.allowedServices = sort(response.data.result.DivisionServices);
                vm.showCommuter = !angular.isUndefined(vm.commuterInfo);
                vm.showDrt = !angular.isUndefined(vm.drtInfo);
                if (vm.isUserLoggedIn)
                    fetchUserDetails();
                $rootScope.divisionName = (response.data.result.DivisionName ? response.data.result.DivisionName : 'One Portal');
                $rootScope.supportPhoneNumber = (response.data.result.SupportPhoneNumber ? response.data.result.SupportPhoneNumber : '');
                vm.loadingServices = false;

                //Sets the page name and headline from the database.
                
                vm.PageService.setHeadline($rootScope.divisionName);   
            }
            else {
                $location.path('division');
            }
        }

        function handleFailure(error) {
            vm.loadingServices = false;
            $location.path('division');
        }

        var sort = function (services) {
            return services.sort(function (a, b) {
                return parseInt(a.DisplayOrder) - parseInt(b.DisplayOrder);
            });
        }

        var fetchUserDetails = function () {
            vm.userId = authService.authentication.userId;
            vm.passengerId = authService.authentication.passengerId;
            populateDivisionParameters(setAutoRefresh);
        }


        vm.showStopsMap = function (inc) {
            var modalGetMap = $uibModal.open({
                animation: true,
                windowClass: 'map-modal',
                templateUrl: 'app/modules/commuter/modals/reservation-map-modal/reservation-map.html',
                controller: 'ReservationMapController as vm',
                backdrop: 'static',
                resolve: {
                    reservation_stops: function () {
                        return inc;
                    }
                }
            });

            modalGetMap.result.then(function (isDone) {
                if (isDone) {
                }

            }, function () {

            });
        };



        var fetchTripsAndReservations = function () {

            if (vm.showCommuter) getPassengerReservationsForToday();
            if (vm.showDrt) {
				// get all DRT trips of interest to the passenger
            	getPassengerTrips();
            	// get current trip
            	ScheduleService.getlastripdetails(vm.passengerId);
            }
        };


        $scope.$on('$destroy', function (event) {
            stopAutoRefresh();
        });


        var stopAutoRefresh = function () {
            if (angular.isDefined(autoRefresh)) {
                $interval.cancel(autoRefresh);
                autoRefresh = undefined;
            }            
        }

        $scope.$on('divisionChanged', stopAutoRefresh);

        vm.navigate = function (path, serviceType, serviceId) {
            //$rootScope.$broadcast(serviceId);
            if (serviceType === 'external')
                if ($('body').hasClass('platform-cordova')) {
                    // This is here for Ionic framework.
                    window.open(path, '_system', '');
                } else {
                    window.location = path;
                }
                
            else if (serviceType === 'internal')
                $location.path(path);
        }
      

        vm.showCommuterTrip = function (trip) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: 'static',
                keyboard: false,
                resolve: {
                    tripId: trip.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getPassengerReservationsForToday();
                }
            });

        }

        vm.showDrtTrip = function (trip) {
            var _tripModalRequest = {
                passengerTrip: trip,
                options: options,
                serviceDate: vm.serviceDate
            }
            var drtTripModal = $uibModal.open({
                templateUrl: 'app/modules/shared/trips/drt-trip-modal.html',
                controller: 'TripDetailsModalController as vm',
                size: '-fs',
                resolve: {
                    tripModalRequest: _tripModalRequest
                }
            });

            drtTripModal.result.then(function (result) {
                if (result && result.action === 'cancel') {
                    cancelTrip(trip);
                }
            });

        }


        function cancelTrip(trip) {
            var tripToCancel = {
                'tripId': trip.TripId,
                'passengerId': trip.PassengerId,
                'from': trip.startName,
                'to': trip.endName,
                'scheduledTime': trip.schedPickupTime
            };

            var modalCancelTrip = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                controller: 'TripCancellationController as vm',
                size: '-fs',
                resolve: {
                    tripToCancel: function () {
                        return tripToCancel;
                    },
                    showCancelOptions: options.showCancelOptions

                }
            });

            modalCancelTrip.result.then(function (result) {
                if (result.isCancel) {
                    UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                    getPassengerTrips();
                }
                else
                    UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
            });
        };


        activate();

        // Ionic parameters
        if (env.ionic) {
            vm.appVersion = env.ionic.appVersion;
            vm.appVersion += env.ionic.softwareVersion == null ? '' : ' ' + env.ionic.softwareVersion;
            vm.appVersion += env.ionic.environment == null ? '' : '.' + env.ionic.environment;
            vm.appVersion += env.ionic.localEnvironment == null ? '' : '.' + env.ionic.localEnvironment;

        } else {
            vm.appVersion = '';
        }
        vm.refresh = function (refresher) {
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
        }        

    }
})();

(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.controller('DisplayScheduledTripController', DisplayTripModalController);

    DisplayTripModalController.$inject = ['$scope', '$http', 'UtilityFactory', 'DateFactory',
        '$log', '$uibModalInstance', 'trip', 'ConfigFactory','options'];

    function DisplayTripModalController($scope, $http, UtilityFactory, DateFactory,
        $log, $uibModalInstance, trip,ConfigFactory, options) {

        var vm = this;
        vm.trip = trip;

        var systemParams = options;

        vm.allowFaring = systemParams.allowFaring;
        vm.allowChildren = systemParams.allowChildren;
        vm.allowLocationNotes = systemParams.allowLocationNotes; 

        var startTime = new moment(vm.trip.ScheduledPickupTime);
        vm.trip.promiseWindowStartTime = startTime.format('h:mm A');
        if (moment.isMoment(startTime))
            vm.trip.promiseWindowEndTime = startTime.add(parseInt(systemParams.promiseWindow), 'm').format('h:mm A');
        vm.cancel = cancel;
        vm.cancelTrip = cancelTrip;
        function cancel() {
            $uibModalInstance.close();
        };

        function cancelTrip(tripId)
        {

        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('FaringService', FaringService);
    FaringService.$inject = ['$http', '$q', 'ConfigFactory', 'authService'];

    function FaringService($http, $q, ConfigFactory, authService) {
        var service = {
            GetZoneIDForLocation: getZoneIDForLocation,
            GetZoneFares: getZoneFares
        };
        return service;

        function getZoneFares(divisionId, fromZone, toZone, reservationTime, serviceDate)
        {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "faring/" + divisionId + "/" + fromZone + "/" + toZone + "/" + reservationTime + "/" + serviceDate;
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        //if (response.data.status == 1) {
                        defer.resolve(response);
                        //} else {
                        //  defer.reject(response.data.result);
                        //}
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
            
        }
        function getZoneIDForLocation(latitude, longitude, divisionId)
        {
            //should have method in secured api 
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "faring/getZoneIdForLocation/" + divisionId + "/" + latitude + "/" + longitude + "/";
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        //if (response.data.status == 1) {
                        defer.resolve(response);
                        //} else {
                        //  defer.reject(response.data.result);
                        //}
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('FeedbackService', FeedbackService);
    FeedbackService.$inject = ['$http', '$q', 'ConfigFactory','authService','DivisionService'];

    function FeedbackService($http, $q, ConfigFactory, authService,DivisionService) {
        var service = {
            SaveFeedback: saveFeedback,
            addCommuterFeedback : addCommuterFeedback
        };
        return service;

        function saveFeedback(feedbackRequest) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "trip/" + authService.authentication.passengerId + "/feedback/save";
                    $http({
                        method: 'POST',
                        url: _url,
                        data: JSON.stringify(feedbackRequest),
                    }).then(function successCallback(response) {
                        //if (response.data.status == 1) {
                        defer.resolve(response);
                        //} else {
                        //  defer.reject(response.data.result);
                        //}
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }

        function addCommuterFeedback(feedbackRequest, reservationId) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    var _url = oneMVURL + "commuter/" + DivisionService.getDivisionId() +
                        "/reservations/feedback/" + authService.authentication.passengerId + "/" + reservationId;
                    $http({
                        method: 'POST',
                        url: _url,
                        data: feedbackRequest,
                    }).then(function successCallback(response) {
                        defer.resolve(response);
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('FixedRoutesController', FixedRoutesController);

    FixedRoutesController.$inject = [ '$uibModalInstance', 'upcomingSchedules', 'fromStopName','OneMvServices'];

    function FixedRoutesController( $uibModalInstance, upcomingSchedules, fromStopName,OneMvServices) {
        /* jshint validthis:true */
        var vm = this;
        vm.upcomingSchedules = upcomingSchedules;
        vm.fromStopName = fromStopName;
        vm.cancel = cancel;
        vm.frInfo = OneMvServices.getFixedRouteInfo();

        function cancel() {
            $uibModalInstance.close();
        };

        activate();

        function activate() { }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('locationSearchDirective', locationSearchDirective);

    locationSearchDirective.$inject = ['LocationFactory', '$rootScope', '$q', 'ScheduleService', 'UtilityFactory', 'authService', 'DivisionService'];

    function locationSearchDirective(LocationFactory, $rootScope, $q, ScheduleService, UtilityFactory, authService, DivisionService) {
        // Usage:
        //     <Location-search-directive></Location-search-directive>
        // Creates:
        // 
        //locationfilter=0 means Show Locations that are Manually added to the oneMV Database(for now)
        //locationfilter=1 means Show Locations both that are Manually added to the oneMV Database and also from the google api(for now)
        //locationfilter is dynamic enough to be expanded in future

        var directive = {
            link: link,
            controller: controller,
            replace: true,
            restrict: 'E',
            scope: {
                onLocationSelected: '&', minlength: '=minlength', locationfilter: '@',
                labelname: '=labelname', selectedlocation: '=selectedlocation', passengerId: '@', googleonly: '@'                
            },
            templateUrl: 'app/modules/on-demand/reservations/locationSearch.html'
        };
        return directive;

        function link(scope, element, attrs) {
            scope.type = attrs.labelname;
		}

        function controller($scope) {
            $scope.data = LocationFactory.getLocations;
            $scope.reservationRequest = {};
            $scope.initialValue = '';
        
            $scope.resultsAPI = function (userInputString, timeoutPromise) {
                //var defer = $q.defer();

            	return $scope.data(userInputString, $scope.locationfilter, $scope.divisionId, $scope.passengerId, $scope.googleonly, { timeout: timeoutPromise })
                //.then(function (result) {
                    //var filteredResult = result.data;
                    //if ($scope.selectedlocation) {
                        //var filteredResult = result.data.filter(function (location) {
                        //    return location.loc.LocationId != $scope.selectedlocation;
                        //});
                    //}
                  //  defer.resolve(filteredResult);
                //});
                //return defer.promise;

            }
            //Set selected location from Google Api
            $scope.selectedGoogleLocationFrom = function (address) {
                if (address != null) {
                    var add = "";
                    for (var i in address.address_components) {
                        if (address.address_components[i].types[0] == "street_number") {
                            add = add + " " + address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "route") {
                            add = add + " " + address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "locality") {
                            $scope.reservationRequest.City = address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "administrative_area_level_1") {
                            $scope.reservationRequest.State = address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "postal_code") {
                            $scope.reservationRequest.ZipCode = address.address_components[i].short_name;
                        }
                        else {
                            //do nothing
                        }
                    }
                    $scope.reservationRequest.Address1 = add;
                    $scope.reservationRequest.From = address.formatted_address;
                    $scope.reservationRequest.Latitude = address.geometry.location.lat;
                    $scope.reservationRequest.Longitude = address.geometry.location.lng;
                    $scope.reservationRequest.GooglePlaceId = address.place_id;
                }
            }
            $scope.onLocationSelectedNotify = function (Location) {
                $scope.reservationRequest = {};
                if (Location != undefined) {
                    var obj = Location.originalObject;
                    if (obj != null) {
                        if (obj.isGoogleLocation) {
                            $scope.selectedGoogleLocationFrom(obj.loc);
                        }
                        else {
                            $scope.reservationRequest = obj.loc;
                        }
                    }
                }
                if (typeof ($scope.onLocationSelected) == 'function') {
                    $scope.onLocationSelected({ location: $scope.reservationRequest });
                }
            };

            function getMapCenter() {
                ScheduleService.getServiceAreaLocation($scope.divisionId).then(function (response) {
                    if (response.data !== null &&  response.data.result != null) {
                        $scope.addressRest = response.data.result.Address;
                        LocationFactory.setadd($scope.addressRest);
                    }
                }, function (errormsg) {
                    UtilityFactory.toastError('Error', '');
                });
            };

            function activate(callback){
                if ($scope.addressRest == undefined || $scope.addressRest == '') {
                        $scope.divisionId = DivisionService.getDivisionId();
                        if ($scope.divisionId != null && $scope.divisionId != undefined && $scope.divisionId != '') {
                            if (callback && typeof callback === "function")
                                callback();
                        }                    
                }           
            }

            $scope.$on('closestLocation', function (event, location) {
                if ($scope.type === 'FROM')
                    $scope.initialValue = location.title;
            });
            
            $scope.$on('initialLocationValue', function (event, value) {
            	$scope.initialValue = value;
            });

            $scope.$on('homeLocationDisable', function (event, value) {
            	if ($scope.type != 'FROM') {
            		$scope.disableInput = value;
            	}
            });

            $scope.$on('homeLocationText', function (event, text) {
            	if ($scope.type != 'FROM') {
            		$scope.initialValue = text;
            	}
            });

            $scope.$on('toggle-from-address', function (event, value) {
                if ($scope.type == 'FROM') {
                    $scope.disableInput = !value;
                }
            });

            activate(getMapCenter);
		}
    }
})();
(function () { 

    'use strict';

    angular
        .module('oneMVApp')
        .factory('locationService', locationService);
    locationService.$inject = ['$http', '$q', 'ConfigFactory'];

function locationService($http, $q, ConfigFactory) {

    var service = {
        saveLocation: saveLocation,
        isAddressInService: isAddressInService,
        getLocationTypes: getLocationTypes,
        getReverseGeoCode: getReverseGeoCode,
        getGeoCode: getGeoCode,
        getLocationData: getLocationData,
        editManualLocation: editManualLocation
    };
    return service;



    function saveLocation(saveLocation) {
        console.log(saveLocation);
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Trip/SaveLocation';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(saveLocation),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function isAddressInService(Address) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Trip/IsAddressInService';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(Address),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function getLocationTypes() {
        var deferred = $q.defer();
        var serviceUrl = '../ServiceArea/GetLocationTypes';
        $http({
            method: 'GET',
            'url': serviceUrl,
            ContentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getReverseGeoCode(latlng) {
        var deferred = $q.defer();
        var serviceUrl = 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + latlng;
        $http.get('//maps.googleapis.com/maps/api/geocode/json', {
            params: {
                latlng: latlng,
                sensor: true
            },
            withCredentials: false
            //$http({
            //    method: 'GET',
            //    'url': serviceUrl,
            //    ContentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getGeoCode(address) {
        var deferred = $q.defer();
        var serviceUrl = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + address;
        $http.get('//maps.googleapis.com/maps/api/geocode/json', {
            params: {
                address: address,
                sensor: true
            },
            withCredentials: false
            //$http({
            //    method: 'GET',
            //    'url': serviceUrl,
            //    ContentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };
    function getLocationData(DivisionId) {
        var deferred = $q.defer();
        var serviceUrl = '';
        // if (Locationid > 0)
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                serviceUrl = oneMVURL + 'Trip/GetManualLocations/?DivisionId=' + DivisionId;
                //else
                //    serviceUrl = '../ServiceArea/GetManualLocations';
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });

        return deferred.promise;
    };

    function editManualLocation(locationId) {
        var deferred = $q.defer();
        var serviceUrl = '';
        // if (Locationid > 0)
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                serviceUrl = oneMVURL + 'Trip/EditManualLocation/?locationId=' + locationId;
                //else
                //    serviceUrl = '../ServiceArea/GetManualLocations';
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });

        return deferred.promise;
    };


}


})();
(function () {
    //debugger;

    'use strict';
    angular.module('oneMVApp').factory('MobilityAidsService', MobilityAidsService);
    MobilityAidsService.$inject = ['$http', '$q', 'ConfigFactory'];

    function MobilityAidsService($http, $q, ConfigFactory) {

        var service = {
            getDivisionAids: getDivisionAids,
            saveDivisionAids: saveDivisionAids
        }
        return service;

        function getDivisionAids(divisionId) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    var _url = oneMVURL + "MobilityAids/" + divisionId + "?rnd=" + new Date().getTime();
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        if (response.data.status == 1) {
                            defer.resolve(response.data.result);
                        } else {
                            defer.reject(response.data.result);
                        }
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }

        function saveDivisionAids(divisionId, aids) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    var _url = oneMVURL + "MobilityAids/" + divisionId + "?rnd=" + new Date().getTime();
                    $http({
                        method: 'POST',
                        data: aids,
                        url: _url
                    }).then(function successCallback(response) {
                        if (response.data.status == 1) {
                            defer.resolve(response.data.result);
                        } else {
                            defer.reject(response.data.result);
                        }
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('NegotiationController', NegotiationController);

    NegotiationController.$inject = ['$uibModalInstance', '$scope', '$filter','authService','DivisionService',
        'TripNegotiationLogService', 'DateFactory', 'negotiationRequest'];

    function NegotiationController($uibModalInstance, $scope, $filter,authService, DivisionService,
        TripNegotiationLogService, DateFactory, negotiationRequest) {
        var vm = this;

        vm.proposedSlots = negotiationRequest.proposedSlots;
        vm.selectedSlot = '';
        vm.reservation = angular.copy(negotiationRequest.reservationRequest);
        vm.selectedReservationType = '';

        var userId = 0;
        var tripRequestId = 0;
        var serviceDate = negotiationRequest.serviceDate;
        var promiseWindow = 0;

        //forced to use this as pax and ops portal reservation objects are not in sync.        
        var reservationTypeEnum = {
            1: "ASAP",
            2: "ADVANCED",
            3: "APPOINTMENT"
        };

        vm.toPromiseWindow = function (proposedSlot) {

            var startTime = $filter('date')(proposedSlot.ProposedStartWindow, 'h:mm a');
            //var endTime = DateFactory.getPromiseWindowEndTime(input, promiseWindow);
            var endTime = $filter('date')(proposedSlot.ProposedEndWindow, 'h:mm a');

            return startTime + ' - ' + endTime;
        };

        var toThirtyThreeHourClock = function (input) {
            return DateFactory.getCustomTime(input, serviceDate);
        };


        var activate = function () {
            tripRequestId = negotiationRequest.tripRequestId;

            userId = authService.authentication.userId;
            promiseWindow = DivisionService.getSystemParameters().PromiseWindow;

            vm.selectedReservationType = reservationTypeEnum[vm.reservation.reservationType];

        }

        var closeModal = function (response) {
            $uibModalInstance.close(response);
        }

        vm.reject = function () {

            TripNegotiationLogService
                    .addRejectionLog(tripRequestId, userId);

            closeModal({
                canNegotiate: false
            });
        };


        vm.close = function () {
            closeModal({
                canNegotiate: false
            });
        }

        vm.accept = function () {
            if (vm.selectedSlot != '') {
                var negotiationLogId = getNegotiatedLogId();

                TripNegotiationLogService
                    .addApprovalLog(tripRequestId, negotiationLogId, userId);

                closeModal(
                    {
                        canNegotiate: true,
                        selectedTime: vm.selectedSlot,
                        tripRequestId: tripRequestId,
                        negotiationLogId: negotiationLogId
                    });
            }
        }

        function getNegotiatedLogId() {
            if (vm.selectedSlot != '') {
                for (var i = 0; i < vm.proposedSlots.length; i++) {
                    if (vm.proposedSlots[i].ProposedDate == vm.selectedSlot)
                        return vm.proposedSlots[i].id;
                }
            }
            return -1;
        }

        activate();
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ReservationErrorModalController', ReservationErrorModalController);

    ReservationErrorModalController.$inject = ['$uibModalInstance', 'message'];

    function ReservationErrorModalController($uibModalInstance, message) {
        var vm = this;

        vm.msg = message.message.ErrorMessage;
        vm.header = message.header || "Information" ;
        vm.cancel = cancel;

        function cancel() {
            $uibModalInstance.close();
        };
    }
})();



(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('reservationFormDirective', reservationFormDirective);

    reservationFormDirective.$inject = ['$window', 'LocationFactory', 'UtilityFactory', 'ScheduleService',
        'DateFactory','$q', 'DivisionService', 'GeoLocationService', 'StopService', 'FaringService', '$timeout',
        'ProfileService','OneMvServices'];

    function reservationFormDirective($window, LocationFactory,  UtilityFactory, ScheduleService,
        DateFactory, $q, DivisionService, GeoLocationService, StopService, FaringService, $timeout,
        ProfileService,OneMvServices) {
        // Usage:
        //     <reservation-form-directive></reservation-form-directive>
        // Creates:
        //      An instance of the reservation form which can used to book a reservation.
        //      There are three variations of this form controlled by the variable 'reservationType'
        //      1. reservationType = 'past'
        //         This is the form which can be used when the operator wants to reconcile previous reservations
        //      2. reservationType = 'current'
        //         This is the form which can be used for booking a current reservation
        //      3. reservationType = 'future'
        //         This is the form which can be used to book future reservations
        var directive = {
            link: link,
            controller: controller,
            restrict: 'E',
            scope: { passenger: '<', options: '<', mode: '@', notifySucessfullReservation: '=onReservationSuccess' },
            replace: true,
            templateUrl: 'app/modules/on-demand/reservations/passengerReservationForm.html'
        };
        return directive;

        function link(scope, element, attrs) {
            // If scope.$watch('option') loads late, IE in a slow connection, then the watch NEVER fires.
            // This is here to run scope.activate() if on load, scope.options exists.
            if (scope.isLoading && scope.options) {
                scope.activate();
            };
            scope.$watch('options', function (newValue, oldValue) {
                if (newValue != oldValue && newValue) {
                    //if (typeof newValue == "string") {
                    //    scope.options = JSON.parse(newValue);
                    //}
                    //else if (typeof newValue == "object")
                    scope.options = newValue;

                    scope.activate();
                };
            });


            //scope.$watch('passenger', function (newValue, oldValue) {
            //    if (newValue != oldValue && newValue) {
            //        //if (typeof newValue == "string") {
            //        //    scope.passenger = JSON.parse(newValue);
            //        //}
            //        //else if (typeof newValue == "object") {
            //            scope.passenger = newValue;
            //        //}
            //        //if (newValue != oldValue)
            //            scope.resetForm();
            //    };
            //});
        }

        function controller($scope,$uibModal) {
            /*Methods exposed to view*/
        	$scope.reservationRequest = {};
        	$scope.aids = [];
        	$scope.assistants = [];
        	$scope.populateRuns = populateRuns;
        	$scope.populateCount = populateCount;
        	$scope.childrenCount = childrenCount;
            $scope.populateHours = populateHours;
            $scope.populateMinutes = populateMinutes;
            $scope.dataServiceFrom = LocationFactory.dataServiceFrom;
            $scope.dataServiceTo = LocationFactory.dataServiceTo;
            $scope.saveReservation = saveReservation;
            $scope.disableSaveButton = disableSaveButton;
            $scope.setPickupDateTime = setPickupDateTime;
            $scope.activate = activate;
            $scope.resetForm = resetForm;
            $scope.closeDateTimePicker = closeDateTimePicker;
            $scope.timepickerClicked = timepickerClicked;
            $scope.resetDateOptionFields = resetDateOptionFields;
            $scope.resetDates = resetDates;
            $scope.displayFaring = displayFaring;
            $scope.disableFaringButton = disableFaringButton;
            $scope.getReservationDateTime = getReservationDateTime;
            $scope.toggleOptions = toggleOptions;
            $scope.isLoading = true;
            $scope.isHidden = false;
            $scope.showCalendarButton = true;
            $scope.showCalendar = false;
            /*Methods exposed to view*/
            $scope.runs = [];
            $scope.loadingRuns = false;
            $scope.isSaving = false;
            $scope.division;
            $scope.operator;
            $scope.systemParameters;
            $scope.displayDateTimepicker = false;
            $scope.minDate = new Date();
            // $scope.options = undefined;
            $scope.requestDateTime = undefined;
            $scope.isDateSelected = false;
            $scope.isGpsEnabled = true;
            $scope.hasGpsBeenChecked = false;
            $scope.dateOptions = {
                formatYear: 'yy',
                minDate: new Date(),
                startingDay: 1,
                showWeeks: false
            };
            $scope.timepickerObject = {};
            $scope.isFRServiceActive = false;

            $scope.isUserAllowedToMakeAReservation = isUserAllowedToMakeAReservation;

            initializeLocationNotes();

            $scope.isAllowed = true;

            //enum to match enum in Server side code
            var reservationTypeEnum = {
                ASAP: 1,
                ADVANCED: 2,
                APPOINTMENT: 3
            };
            $scope.reservationTypeEnum = reservationTypeEnum;

            var timeFormat = 'h:mm A';


            function toggleOptions() {
                $scope.isHidden = !$scope.isHidden;
            }

            function populateCount(count) {
                return new Array(count);
            }

            function childrenCount(count) {
                var childrenArray = [];
                for (var i = 0; i <= count; i++) {
                    childrenArray.push(i);
                }
                return childrenArray;
            }


            function isCalenderButtonActive()
            {
                if (!$scope.options.isAdvancedReservation)
                    return false;

                if (!$scope.displayDateTimepicker && !$scope.isDateSelected)
                    return true;
                return false;
            }
            function activate() {

                //Find out if FR is active for this division. This will be used later on while reserving
                // DivisionService.getDivisionInfo()
                // .then(function (response) {
                //     var divisionInfo = response.data.result;
                //     for (var i = 0; i < divisionInfo.Services.length; i++) {
                //         if (divisionInfo.Services[i].ServiceId == "fixed") {
                //             $scope.isFRServiceActive = true;
                //         }
                //     }
                // }, function (error) {
                // });

                $scope.isFRServiceActive =!angular.isUndefined(OneMvServices.getFixedRouteInfo());

                getServiceDate()//promise chaining.
                    .then(
                    populateRuns);

                $scope.isStartDp = false;
                var dt = new Date();
                $scope.dateOptions.minDate = new Date(dt.setDate(dt.getDate() + $scope.options.passengerBookingMinDays));
                $scope.dateOptions.maxDate = new Date(dt.setDate(dt.getDate() + $scope.options.passengerBookingMaxDays));
                $scope.reservationRequest.ReservationDateView = $scope.dateOptions.minDate;
                $scope.showCalendar = !$scope.options.isAdvancedReservation;
                $scope.showCalendarButton = isCalenderButtonActive();
                //setReservationType();
                $scope.isLoading = false;
                resetForm();

            };
            //
            // Listen to Geolocationservice to find out if GPS is enabled.
            //
            $scope.$on('GeoLocationService.gpsIsAvailable', function (event, data) {
                $scope.isGpsEnabled = data.gpsIsEnabled;
                if (!data.gpsIsEnabled && $scope.options
                    && $scope.options.allowReservationOnlyWhenGpsIsOn) {
                    if (!$scope.isGpsEnabled) {
                        $scope.$broadcast('toggle-from-address', !$scope.options.allowReservationOnlyWhenGpsIsOn);
                        // Only show toast message once.
                        if (!document.getElementById('toast-container')) {
                            UtilityFactory.toastInfo('Information', 'Enable gps to make a reservation.', 10000);
                        };
                        // Wait 2 seconds, then hide any modals that may have been displayed, 
                        // IE. the 'Please find and select your home address'
                        $timeout(function () {
                            $('[uib-modal-window=modal-window]').remove();
                            $('body').removeClass('modal-open');
                        }, 3000);
                        // Display message for 15 seconds then redirect to dashboard.  Changed to 10 seconds per Jason request.
                        $timeout(function () {
                            if (!isUserAllowedToMakeAReservation()) {
                                $('[uib-modal-window=modal-window]').remove();
                                $('body').removeClass('modal-open');
                                $window.location.replace('#/');
                                $window.location.reload(true);  // I must do a hard refresh to wipe out any modals controllers that may or may not be loaded.
                            };
                        }, 15000);
                    };
                };
                $scope.hasGpsBeenChecked = true;
            })
            //
            // Function to determine if the division only allows reservation when GPS is on
            // AND if gps is on.
            //
            function isUserAllowedToMakeAReservation(){
                if(!$scope.hasGpsBeenChecked){
                    $scope.hasGpsBeenChecked = true;
                    GeoLocationService
                        .getCurrentPosition()
                }
                var r = true;
                if ($scope.options && $scope.options.allowReservationOnlyWhenGpsIsOn && $scope.hasGpsBeenChecked){
                    r = $scope.options.allowReservationOnlyWhenGpsIsOn ?$scope.isGpsEnabled : true;
                }
                return r;
            }

            function setCurrentTime()
            {
                var currentDate = moment.tz(DivisionService.getTimeZone());//new Date(new Date().getTime() + 10 * 60 * 1000);
                var currentHour = parseInt(currentDate.format('HH'));
                var currentMinute = parseInt(currentDate.format('mm'));
                var currentTime12Hr = (currentHour > 12 ? (currentHour - 12) : (currentHour == 0 ? 12 : currentHour));
                var currentTime5mInv = currentMinute == 0 ? 0 : (currentMinute == 5 ? 5 : (Math.ceil(currentMinute/5)*5));
                $scope.timepickerObject.AMPMView = currentDate.format('a').toUpperCase();
                $scope.timepickerObject.schedHrView = currentTime12Hr < 10 ? "0" + currentTime12Hr.toString(): currentTime12Hr.toString();
                $scope.timepickerObject.schedMinView = currentMinute < 5 ? "0" + currentTime5mInv.toString() : currentTime5mInv.toString();
                $scope.reservationRequest.ReservationDateView = $scope.dateOptions.minDate;
                $scope.schedHr =  $scope.timepickerObject.schedHrView;
                $scope.schedMin =  $scope.timepickerObject.schedMinView;
                $scope.AMPM =  $scope.timepickerObject.AMPMView;
                $scope.reservationRequest.ReservationDate = $scope.reservationRequest.ReservationDateView;
                
            } 

            function resetForm() {
                resetDateOptionFields();
                $scope.$broadcast('angucomplete-alt:clearInput');

            }

            $scope.clickMobilityAid = function (aid) {
            	if ($scope.aids && $scope.aids.length > 0) {
            		for (var i = 0; i < $scope.aids.length; i++) {
            			$scope.aids[i].IsSelected = false;
            		}
            		if (aid) {
            			aid.IsSelected = true;
            		}
            	}
            }

            function populateMobilityAids() {
            	$("#rdoNoMobilityAids").prop("checked", true);
            	ProfileService.GetDefaultMobilityAids($scope.options.DivisionId, $scope.passenger.Id)
                .then(function (defaultMobilityAids) {
                	// clear aids lists
                	$scope.aids.length = 0;
                	$scope.assistants.length = 0;

                	// create no aids choice
                	var noAids = {
                		IsSelected: true,
                		KeyName: "no aids",
						Group: 2,
                		DisplayName: "No Mobility Aid Required"
                	};
                	$scope.aids.push(noAids);

                	// append all aids allowed by division
                	var aidCount = 0;
                	for (var i = 0; i < defaultMobilityAids.length; i++) {
                    	var mobilityAid = defaultMobilityAids[i];
                    	if (mobilityAid.Group == 1) {
                    		mobilityAid.selected = mobilityAid.IsSelected;
                    		$scope.assistants.push(mobilityAid);
                    	} else if (mobilityAid.Group == 2) {
                    		if (mobilityAid.IsSelected == true) {
                    			if (aidCount > 0) {
                    				mobilityAid.IsSelected = false;
                    			}
                    			aidCount++;
                    		}
                    		mobilityAid.selected = mobilityAid.IsSelected;
                    		if (mobilityAid.IsSelected)
                    		    noAids.IsSelected = false;
                    		$scope.aids.push(mobilityAid);
                        }
                    }
                }, function (response) {
                    UtilityFactory.toastError('Error', response.Message);
                });
            }
            function resetDateOptionFields()
            {
                $scope.reservationRequest = {};

                $scope.reservationRequest.PassengerCount = "1";
                $scope.reservationRequest.CompanionsCount = "0";
                $scope.reservationRequest.mobilityAid = "none";
                $scope.reservationRequest.IsWheelChair = false;
                $scope.reservationRequest.IsPCA = false;
                $scope.reservationRequest.IsServiceAnimal = false;
                $scope.reservationRequest.TripFares = [];


                //$scope.reservationRequest.IsASAP = true;
                setReservationType();

                resetDates();

                initializeLocationNotes();
            }

            function initializeLocationNotes() {
                if ($scope.options && $scope.options.allowLocationNotes) {
                    $scope.reservationRequest.locationNotes = {
                        'from': '', 'to': ''
                    };
                    //$scope.showLocationNotes = {
                    //    'from': false, 'to': false
                    //};
                }
            }

           


            function resetDates() {
                setCurrentTime();
                if ($scope.options.isAdvancedReservation && ($scope.options.passengerBookingMinDays > 0)) {
                    if ($scope.reservationRequest.ReservationDate) {
                        setPickupDateTime();
                    }
                }
                else {
                    $scope.isDateSelected = false;
                    $scope.displayDateTimepicker = false;
                }
                $scope.showCalendarButton = isCalenderButtonActive();
            }

            function setReservationType() {
                if ($scope.options.isAdvancedReservation && ($scope.options.passengerBookingMinDays > 0)) {
                    $scope.reservationRequest.reservationType = $scope.reservationTypeEnum.ADVANCED;
                }
                else {
                    if ($scope.options.allowASAPReservations)
                        $scope.reservationRequest.reservationType = $scope.reservationTypeEnum.ASAP;
                    else if ($scope.options.isAdvancedReservation)
                        $scope.reservationRequest.reservationType = $scope.reservationTypeEnum.ADVANCED;
                }
            }

            function closeDateTimePicker() {
                if ($scope.options.isAdvancedReservation && ($scope.options.passengerBookingMinDays > 0)) {
                    resetDates();
                }
                else {
                    //get old dates time
                     $scope.timepickerObject.schedHrView = $scope.schedHr;
                     $scope.timepickerObject.schedMinView = $scope.schedMin;
                     $scope.timepickerObject.AMPMView = $scope.AMPM;
                    $scope.displayDateTimepicker = false;
                    $scope.reservationRequest.ReservationDateView = $scope.reservationRequest.ReservationDate;
                    if (!$scope.isDateSelected) {
                        setReservationType();
                    }
                    $scope.showCalendarButton = isCalenderButtonActive();
                }
            }
            function timepickerClicked() {

                $scope.displayDateTimepicker = !$scope.displayDateTimepicker;
                //$scope.reservationRequest.IsASAP = !$scope.displayDateTimepicker;
                if ($scope.options.isAdvancedReservation)
                    $scope.reservationRequest.reservationType = String(reservationTypeEnum.ADVANCED);
                else if($scope.options.allowAppointments)
                    $scope.reservationRequest.reservationType = String(reservationTypeEnum.APPOINTMENT);
                $scope.isDateSelected = false;
                $scope.showCalendarButton = false;
                setCurrentTime();
            }
            function getServiceDate() {
                return ScheduleService.getServiceDateByDivision($scope.options.DivisionId)
                        .then(function (response) {
                            if (response.data.status == 1) {
                                $scope.serviceDate = moment(response.data.result);
                                // $scope.reservationRequest.ReservationDate = new Date($scope.serviceDate;
                                if ($scope.mode == "reconciliation") {
                                    //$scope.reservationRequest.ReservationDate = $scope.serviceDate.subtract(1, 'days').format('MM-DD-YYYY');
                                    $scope.minDate = new Date(1990, 5, 22); //nor sure why this is hard-coded
                                    $scope.maxDateAllowed = $scope.serviceDate
                                } else {

                                };
                            }
                        }, function errorCallback(response) {
                            UtilityFactory.toastError("Error!", "Failed to get service date.");
                        });
            }
            function populateHours() {                
                return  new Array ('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12');
            }
            function populateMinutes()
            {
                var minutesArray = new Array();
                for (var i = 0; i < 60; i+=5) {
                    minutesArray.push(i < 10 ? ('0' + i.toString()) : i.toString());
                }
                return minutesArray;
            }


            function setPickupDateTime()
            {
                $scope.schedHr =  $scope.timepickerObject.schedHrView;
                $scope.schedMin =  $scope.timepickerObject.schedMinView;
                $scope.AMPM =  $scope.timepickerObject.AMPMView;
                $scope.reservationRequest.ReservationDate = $scope.reservationRequest.ReservationDateView;

                $scope.isDateSelected = true;
                if (angular.isUndefined($scope.reservationRequest) || $scope.reservationRequest === null || $scope.reservationRequest.reservationType == reservationTypeEnum.ASAP)
                    return false;
                var hrs = 0;
                if ($scope.AMPM === "PM" && parseInt($scope.schedHr) != 12)
                    hrs = parseInt($scope.schedHr) + 12;
                else if ($scope.AMPM === "AM" && parseInt($scope.schedHr) == 12)
                    hrs = 0;
                else
                    hrs = parseInt($scope.schedHr);

                $scope.requestDateTime = new Date($scope.reservationRequest.ReservationDate).setHours(hrs, parseInt($scope.schedMin), 0);              

                $scope.displaySelectedDate = true;
                $scope.displayDateTimepicker = false;
            };

            function populateRuns() {
                populateMobilityAids();
                if ($scope.passenger)
                    return;
                $scope.loadingRuns = true;
                // let runDate = moment($scope.reservationRequest.ReservationDate).format('MM-DD-YYYY');
                //let isoFormatRunDate = moment($scope.reservationRequest.ReservationDate, 'MM-DD-YYYY').format();

                if ($scope.mode == "reconciliation")
                {
                    ScheduleService.getPastRuns($scope.options.DivisionId, runDate)
                   .then(function (response) {
                       $scope.loadingRuns = false;
                       if (response.data != null) {
                           $scope.runs = response.data.result
                           for (var i = 0; i < $scope.runs.length; i++) {
                               $scope.runs[i].StartTimeDisplay = DateFactory.getCustomTime($scope.runs[i].StartTime, runDate);
                               $scope.runs[i].EndTimeDisplay = DateFactory.getCustomTime($scope.runs[i].EndTime, runDate);
                           };
                       }
                       else {
                           UtilityFactory.toastError('Error', response.data.ReturnMessage);
                       }
                   }, function (response) {
                       $scope.loadingRuns = false;
                       UtilityFactory.toastError('Error', response.data.ReturnMessage);
                   });
                }
                else
                {
                    ScheduleService.getActiveRuns($scope.options.DivisionId, runDate)
                   .then(function (response) {
                       $scope.loadingRuns = false;
                       if (response.data != null) {
                           $scope.runs = response.data.result
                           for (var i = 0; i < $scope.runs.length; i++) {
                               $scope.runs[i].StartTimeDisplay = DateFactory.getCustomTime($scope.runs[i].StartTime, runDate);
                               $scope.runs[i].EndTimeDisplay = DateFactory.getCustomTime($scope.runs[i].EndTime, runDate);
                           };
                           var reservationRuns = [];

                           angular.forEach($scope.runs, function (value, key) {
                               if (value.logisticStatus != '109' && value.Status != 'Frozen' && !value.IsDeleted) {
                                   reservationRuns.push(value);
                                   //$scope.runs.splice($scope.runs.indexOf(value)+1, 1);
                               }
                           });
                           $scope.runs = reservationRuns;
                       }
                       else {
                           UtilityFactory.toastError('Error', response.data.ReturnMessage);
                       }
                   }, function (response) {
                       $scope.loadingRuns = false;
                       UtilityFactory.toastError('Error', response.data.ReturnMessage);
                   });
                }

            }
            function onSucessfullReservation(trip, isASAP) {
                if (typeof ($scope.notifySucessfullReservation) == 'function') {
                    $scope.notifySucessfullReservation(trip, isASAP);
                }
            }
            function saveReservation(reservationRequest) {
                //
                // Double check to see if GPS is required and if GPS is enabled.
                //
                if($scope.options.allowReservationOnlyWhenGpsIsOn && isUserAllowedToMakeAReservation()){
                    GeoLocationService
                        .getCurrentPosition()
                        .then(function(){
                            if (!isUserAllowedToMakeAReservation()){
                                return;
                            };
                        });
                };
                if (reservationRequest.reservationType == reservationTypeEnum.ADVANCED || reservationRequest.reservationType == reservationTypeEnum.APPOINTMENT) {
                    if (!$scope.isDateSelected)
                    {
                        timepickerClicked();
                        return;
                    }
                }
                //reservationType 1, 2, 3
                if (!$scope.isDateSelected)
                    reservationRequest.IsASAP = true;

                $scope.isSaving = true;

                var hrs = getHours();

                var mins = $scope.schedMin;

                reservationRequest.ReservationTime = hrs.toString().length == 1 ? ("0" + hrs.toString() + mins) : (hrs.toString() + mins);

                if (validateRequest(reservationRequest)) {
                    //Check for FR exclusion
                    if ($scope.isFRServiceActive)//check if FR is active for this division
                    {
                        var checkFixedRoutes = $scope.options.checkFRBeforeDRT; //system parameter which tells whether to check for fixed route before booking a drt
                        var noOfArrivals = $scope.options.noOfFRArrivals; //system parameter which tells how many fixed rote arrivals to show
                        if (checkFixedRoutes) {
                            StopService.getUpcomingArrivalsForStop($scope.options.DivisionId,
                                                                    reservationRequest.FromLocation.LocationId,
                                                                    reservationRequest.ToLocation.LocationId,
                                                                    noOfArrivals)
                            .then(function (response) {
                                var upcomingSchedules = response.data;
                                if (upcomingSchedules.length > 0) {
                                    showFixedRoutes(upcomingSchedules, reservationRequest.FromLocation.Name);
                                    $scope.isSaving = false;
                                } else {
                                    reserveTrip(reservationRequest)
                                }
                            },
                            function (error) {

                            });
                        } else {
                            reserveTrip(reservationRequest)
                        }
                    } else {
                        reserveTrip(reservationRequest)
                    }

                } else {
                    $scope.isSaving = false;
                };
            }

            function getHours() {
                var hrs = 0;
                if ($scope.AMPM === "PM" && parseInt($scope.schedHr) != 12)
                    hrs = parseInt($scope.schedHr) + 12;
                else if ($scope.AMPM === "AM" && parseInt($scope.schedHr) == 12)
                    hrs = 0;
                else
                    hrs = parseInt($scope.schedHr);

                return hrs;
            }


            function getReservationDateTime(reservationRequest)
            {
                var hrs = getHours();

                var d = new Date(reservationRequest.ReservationDate.setHours(hrs, parseInt($scope.schedMin), 0));

                var curr_date = d.getDate();
                var curr_month = d.getMonth() +1;
                var curr_year = d.getFullYear();
                var inputDate = curr_year + "/" +curr_month + "/" + curr_date + " " +hrs.toString() + ":" +$scope.schedMin;

                return moment.tz(inputDate, "YYYY/M/D HH:mm", DivisionService.getTimeZone());
            }
            function reserveTrip(reservationRequest) {
                UtilityFactory.toastInfo("Creating Trip");
                var saveTripReq = {
                };
                var savedTrip = {
                };
                saveTripReq.PassengerID = parseInt($scope.passenger.Id);
                //here figure out from reservationType what ASAP, Advanced, Appointment

                if (reservationRequest && (reservationRequest.reservationType != reservationTypeEnum.ASAP) && reservationRequest.ReservationTime)
                {
                    // request advanced reservation
                    if ($scope.passenger)
                    {


                        var hrs = getHours();

                        var d = new Date(reservationRequest.ReservationDate.setHours(hrs, parseInt($scope.schedMin), 0));

                        var curr_date = d.getDate();
                        var curr_month = d.getMonth() + 1;
                        var curr_year = d.getFullYear();
                        var inputDate = curr_year + "/" + curr_month + "/" + curr_date + " " + hrs.toString() + ":" + $scope.schedMin;

                        saveTripReq.RequestedStartDateTime = moment.tz(inputDate, "YYYY/M/D HH:mm" ,DivisionService.getTimeZone());

                    }
                    else
                    saveTripReq.RequestedStartDateTime = DateFactory.getDateFromCustomTime(reservationRequest.ReservationTime, moment(reservationRequest.ReservationDate));//non asap field
                }
                saveTripReq.OperationID = ($scope.options.OperatorId != null) ? $scope.options.OperatorId : null;

                saveTripReq.NumOfPassengers = reservationRequest.PassengerCount;
                saveTripReq.NumOfWheelChairPassengers = 0;
                saveTripReq.NumOfXLWheelChairPassengers = 0;
                saveTripReq.NumOfScooterPassengers = 0;
                saveTripReq.NumOfWalkerPassengers = 0;
                saveTripReq.NumOfPCAs = 0;
                saveTripReq.NumOfServiceAnimals = 0;
                saveTripReq.NumOfBikePassengers = 0;
                if ($scope.options.allowEquipment) {
                    if ($scope.aids.length > 0) {
                    	for (var i = 0; i < $scope.aids.length; i++) {
                    		var mobilityAid = $scope.aids[i];
                    		if (mobilityAid.IsSelected) {
                    		    saveTripReq.SelectedMobilityAidId = mobilityAid.MVMobilityAidsId;
                    			var keyName = mobilityAid.KeyName.trim().toLowerCase()
                    			if (keyName == "wc") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfWheelChairPassengers = 1;
                    			} else if (keyName == "wcxl") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfXLWheelChairPassengers = 1;
                    			} else if (keyName == "sctr") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfScooterPassengers = 1;
                    			} else if (keyName == "wkr") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfWalkerPassengers = 1;
                    			} else if (keyName == 'birk') {
                    			    saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    			    saveTripReq.NumOfBikePassengers = 1;
                    			}
                    		}
                    	}
                    }

                    if ($scope.assistants.length > 0) {
                    	for (var i = 0; i < $scope.assistants.length; i++) {
                    		var assistant = $scope.assistants[i];
                    		if (assistant.IsSelected) {
                    			var keyName = assistant.KeyName.trim().toLowerCase()
                    			if (keyName == "sa") {
                                    saveTripReq.NumOfServiceAnimals = 1;
                    			} else if (keyName == "pca") {
                                    saveTripReq.NumOfPCAs = 1;
                                }
                            }
                        }
                    }
                }

                saveTripReq.NumOfCompanions = reservationRequest.CompanionsCount;
                saveTripReq.RunId = reservationRequest && reservationRequest.Run && reservationRequest.Run.RunId ? reservationRequest.Run.RunId : null;

                saveTripReq.StartAddressViewModel = reservationRequest.FromLocation;
                saveTripReq.EndAddressViewModel = reservationRequest.ToLocation;
                saveTripReq.ReservationType = reservationRequest.reservationType;
                if (angular.equals(saveTripReq.StartAddressViewModel, {}) || saveTripReq.StartAddressViewModel == undefined) {
                    UtilityFactory.toastError('Error', "Invalid location");
                    $scope.isSaving = false;
                    return false;
                }
                if (angular.equals(saveTripReq.EndAddressViewModel, {}) || saveTripReq.EndAddressViewModel == undefined) {
                    UtilityFactory.toastError('Error', "Invalid location");
                    $scope.isSaving = false;
                    return false;
                }
                if ($scope.options && $scope.options.allowLocationNotes) {
                    saveTripReq.StartAddressViewModel.LocationNote = reservationRequest.locationNotes.from.trim();
                    saveTripReq.EndAddressViewModel.LocationNote = reservationRequest.locationNotes.to.trim(); 
                }

                if (reservationRequest.TripFares != undefined)
                    saveTripReq.TripFares = reservationRequest.TripFares;
                if (reservationRequest.TotalTripFare != undefined)
                    saveTripReq.TotalTripFare = reservationRequest.TotalTripFare;


                saveTripReq.IsDivisionAdvanced = $scope.options.isAdvancedReservation;
                saveTripReq.ServiceDate = $scope.serviceDate;
                saveTripReq.IsWillCall = reservationRequest.IsWillCall;
                if ($scope.mode == "reconciliation") {
                    //Reconciliation Case
                    if (!saveTripReq.RunId)
                        saveTripReq.RunId = -1; //setting it to an int value, else the request object is going as null to the server
                    saveTripReq.RunDate = reservationRequest.ReservationDate;
                    var serviceDate = moment(reservationRequest.ReservationDate);
                    saveTripReq.ArrivePickUpDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.ArrivePickUpTime, serviceDate);
                    saveTripReq.PerformPickUpDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.PerformPickUpTime, serviceDate);
                    saveTripReq.ArriveDropOffDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.ArriveDropOffTime, serviceDate);
                    saveTripReq.PerformDropOffDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.PerformDropOffTime, serviceDate);

                    ScheduleService.savePastTrip(saveTripReq)
                    .then(function (response) {
                        if (response.data.status == 1) {
                            savedTrip = response.data.result;
                            resetForm();
                            UtilityFactory.toastSuccess(response.data.message);
                            onSucessfullReservation(savedTrip);
                        }
                        else {
                            UtilityFactory.toastInfo(response.data.message);
                        }
                        $scope.isSaving = false;
                    },
                    function (errormsg) {
                        UtilityFactory.toastError('Error', errormsg.data);
                        $scope.isSaving = false;
                    });


                } else if ($scope.mode == "reservation") {
                	// request demand reservation
                    ScheduleService.schedulepost(saveTripReq)
                    .then(function (response) {
                        if (response.data.status == 1) {
                            savedTrip = response.data.result;
                            resetForm();
                            UtilityFactory.toastSuccess(response.data.message);
                            onSucessfullReservation(savedTrip, parseInt(reservationRequest.reservationType) == reservationTypeEnum.ASAP);
                        }
                        else if (response.data.errors != null) {
                            var zoneExclIndex = -1;
                            var locExclIndex = -1;
                            var capacityError = false;
                            var negotiatedResponse = false;
                            $.each(response.data.errors, function (index, value) {
                                var errCode = value.ErrorCode;
                                //Show the over-ride pop-up
                                if (errCode == -8) {
                                    zoneExclIndex = index;
                                }
                                else if (errCode == -7) {
                                    locExclIndex = index;
                                }
                                else if (errCode == 9) {
                                    capacityError = true;
                                }
                                else if (errCode == 10) {
                                    negotiatedResponse = true;
                                }
                            });

                            if (zoneExclIndex >= 0) {
                                showReservationErrorModal(response.data.errors[zoneExclIndex])
                                    .then(function (retValue) {
                                        if (locExclIndex >= 0) {
                                            showOverrideModal(response.data.errors[locExclIndex]).then(function (retValue) {
                                            });
                                        }
                                        else {
                                        }
                                    });
                            }
                            else if (locExclIndex >= 0) {
                                showReservationErrorModal(response.data.errors[locExclIndex]).then(function (retValue) {
                                });
                            }
                            else if (negotiatedResponse)
                                manageNegotiation(response, saveTripReq);
                            else if (capacityError) {
                                showReservationErrorModal(response.data.errors[0], "Capacity Unavailable");
                            }
                            else {
                                UtilityFactory.toastError('Creating Reservation', response.data.message);
                            }
                        }
                        else {
                            UtilityFactory.toastError('Creating Reservation', response.data.message);
                        }
                        $scope.isSaving = false;
                    },
                    function (errormsg) {
                        UtilityFactory.toastError('Error', errormsg.data);
                        $scope.isSaving = false;
                    });
                }
            }
            function disableSaveButton() {
                return isSaving;
            }


            function manageNegotiation(response, tripRequest) {
                tripRequest.NegotiationInfo = undefined;

                if (response.data.result) {
                    displayNegotiationModal(response.data, tripRequest)
                    .then(function (negotiatedRequest) {
                        reserveNegotiatedTrip(negotiatedRequest, tripRequest);
                    });
                }
            };


            function reserveNegotiatedTrip(negotiatedRequest, tripRequest) {

                if (negotiatedRequest
                    && negotiatedRequest.NegotiationInfo
                    && negotiatedRequest.NegotiationInfo.IsNegotiated) {

                    tripRequest.NegotiationInfo = negotiatedRequest.NegotiationInfo;
                    tripRequest.RequestedStartDateTime = negotiatedRequest.NegotiationInfo.SelectedTime;

                    scheduleNegotiatedTrip(tripRequest);
                }
            }

            function scheduleNegotiatedTrip(tripRequest) {
                ScheduleService.schedulepost(tripRequest)
                   .then(function (response) {
                       if (response.data.status == 1) {
                           var savedTrip = response.data.result;
                           resetForm();
                           UtilityFactory.toastSuccess(response.data.message);
                           onSucessfullReservation(savedTrip, parseInt(tripRequest.ReservationType) == reservationTypeEnum.ASAP);
                       }
                       else
                           UtilityFactory.toastError('Creating Reservation', response.data.message);

                       $scope.isSaving = false;
                   }, function (errormsg) {
                       UtilityFactory.toastError('Error', errormsg.data);
                       $scope.isSaving = false;
                   });
            }


            function displayNegotiationModal(negotiationResponse) {
                var deferred = $q.defer();

                var negotiationModal = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/negotiation-modal.html',
                    controller: 'NegotiationController as vm',
                    size: '-fs',
                    resolve: {
                        negotiationRequest: function () {
                            return {
                                proposedSlots: negotiationResponse.result.ProposedSlots,
                                reservationRequest: $scope.reservationRequest,
                                tripRequestId: negotiationResponse.result.tripRequestId,
                                serviceDate: $scope.serviceDate
                            };
                        }
                    }
                });

                negotiationModal.result.then(function (response) {
                    if (!response.canNegotiate) {
                        deferred.resolve({
                            NegotiationInfo: {
                                IsNegotiated: false
                            }
                        });
                    }
                    else if (response.selectedTime && response.canNegotiate) {
                        deferred.resolve({
                            NegotiationInfo: {
                                IsNegotiated: true,
                                SelectedTime: response.selectedTime,
                                tripRequestId: response.tripRequestId,
                                NegotiationLogId: response.negotiationLogId
                            }
                        });
                    }
                });

                return deferred.promise;
            }




            function disableFaringButton() {
                if (!$scope.isAllowed || $scope.isSaving)
                    return true;
                if ($scope.reservationRequest.FromLocation == null || angular.equals($scope.reservationRequest.FromLocation, {})
                    || $scope.reservationRequest.ToLocation == null || angular.equals($scope.reservationRequest.ToLocation, {}))
                    return true;
                return false;
            }

            function displayFaring()
            {

                var modalOverride = $uibModal.open({
                    animation: true,

                    templateUrl: 'app/modules/on-demand/faring/faring-modal.html',
                    controller: 'FaringModalController as vm',
                    size: '-fs',
                    windowClass: 'phone-modal--fullscreen',
                    backdrop: 'static',
                    scope: $scope,
                    resolve: {
                        reservationRequest: function () {
                            return $scope.reservationRequest;
                        },
                        serviceDate: function () {
                            return $scope.serviceDate;
                        }
                    }
                });

                modalOverride.result.then(function (result) {
                    if (result)
                        $scope.reservationRequest = result;
                });

                // return deferred.promise;
            }
            function showReservationErrorModal(msg,header) {
                var deferred = $q.defer();

                var modalOverride = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/reservation-modal-message.html',
                    controller: 'ReservationErrorModalController as vm',
                    size: '-fs',
                    backdrop: 'static',
                    resolve: {
                        message: function () { return { message: msg, header:header };}
                    }
                });

                modalOverride.result.then(function (result) {
                    deferred.resolve(result);
                });

                return deferred.promise;

            };

            function showFixedRoutes(_upcomingSchedules, _fromStopName) {
                var deferred = $q.defer();

                var modalFR = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/fixed-routes.html',
                    controller: 'FixedRoutesController as vm',
                    size: '-fs',
                    backdrop: 'static',
                    resolve: {
                        upcomingSchedules: function () { return _upcomingSchedules },
                        fromStopName: function () { return _fromStopName }
                    }
                });

                modalFR.result.then(function (result) {
                    //deferred.resolve(result);
                });

                return deferred.promise;
            }

            function validateRequest(reservationRequest) {
                if (!$scope.passenger || !$scope.passenger.Id) {
                    UtilityFactory.toastInfo("Please select a Passenger");
                    return false;
                }
                if ($scope.passenger.IsDeactivated) {
                    UtilityFactory.toastInfo("Please select an Active Passenger");
                    return false;
                }
                if ($scope.mode == 'reservation') {
                    if (!reservationRequest.IsASAP && $scope.options.isAdvancedReservation) {

                        if (!reservationRequest.ReservationTime || reservationRequest.ReservationTime == undefined) {
                            UtilityFactory.toastInfo("Please enter a valid Reservation Time");
                            return false;
                        } else {
                            var timeZone = DivisionService.getTimeZone();
                            var req_date = reservationRequest.ReservationDate.getDate();
                            var req_month = reservationRequest.ReservationDate.getMonth() + 1;
                            var req_year = reservationRequest.ReservationDate.getFullYear();
                            var req_input = req_year + "/" + req_month + "/" + req_date + " " + reservationRequest.ReservationTime;
                            var requestDateTime = moment.tz(req_input, "YYYY/M/D HHmm", timeZone);


                            //var requestedDateTime = DateFactory.getDateFromCustomTime(reservationRequest.ReservationTime, moment(reservationRequest.ReservationDate));


                            var currentDateTime = moment.tz(timeZone);
                            // currentDateTime = currentDateTime.clone().tz("America/Seattle");//DivisionService.getTimeZone());

                            if (requestDateTime.isBefore(currentDateTime)) {
                                UtilityFactory.toastInfo("Please enter a Reservation Time which is greater than the current time");
                                return false;
                            }
                        }
                    } else {

                    }
                }
                if (!reservationRequest.FromLocation) {
                    UtilityFactory.toastInfo("Please enter a valid From Location");
                    return false;
                }
                if (!reservationRequest.ToLocation) {
                    UtilityFactory.toastInfo("Please enter a valid To Location");
                    return false;
                }
                if (reservationRequest.FromLocation.GooglePlaceId && reservationRequest.ToLocation.GooglePlaceId) {
                    if (reservationRequest.FromLocation.GooglePlaceId == reservationRequest.ToLocation.GooglePlaceId) {
                        UtilityFactory.toastInfo("From and To locations should not be same");
                        return false;
                    }
                } else {
                    if (reservationRequest.FromLocation.LocationId && reservationRequest.ToLocation.LocationId) {
                        if (reservationRequest.FromLocation.LocationId == reservationRequest.ToLocation.LocationId) {
                            UtilityFactory.toastInfo("From and To locations should not be same");
                            return false;
                        }
                    }
                }
                //Validations for reconciliation
                if ($scope.mode == "reconciliation") {
                    if (reservationRequest.ReservationDate == null || reservationRequest.ReservationDate == undefined) {
                        UtilityFactory.toastInfo("Please enter a valid Reservation Date");
                        return false;
                    }
                    if (!reservationRequest.ArrivePickUpTime || reservationRequest.ArrivePickUpTime == undefined) {
                        UtilityFactory.toastInfo("Please enter a valid Arrive PickUpTime");
                        return false;
                    }
                    if (!reservationRequest.PerformDropOffTime || reservationRequest.PerformDropOffTime == undefined) {
                        UtilityFactory.toastInfo("Please enter a valid Perform DropOffTime");
                        return false;
                    }
                    if (reservationRequest.Run == null || !reservationRequest.Run.RunId) {
                        UtilityFactory.toastInfo("Please select a Run");
                        return false;
                    }
                }
                return true;
            }
            function zoneForLocation(location, type)
            {

                FaringService
                    .GetZoneIDForLocation(location.Latitude, location.Longitude, $scope.options.DivisionId)
                    .then(function (response) {
                        if (type === 'from')
                            $scope.reservationRequest.fromZone = response.data.result == null ? 0: response.data.result;
                        else
                            $scope.reservationRequest.toZone = response.data.result == null ? 0 : response.data.result;
                    }, function error(err) {

                    });
            }

            $scope.selectedLocationFrom = function (location) {
                $scope.reservationRequest.FromLocation = location;
                $scope.isAllowed = true;
                if ($scope.options.allowReservationOnlyWhenGpsIsOn)
                    isSelectedLocationInAllowedBookingRange(location);

                zoneForLocation(location, 'from');
            }
            $scope.selectedLocationTo = function (location) {
                $scope.reservationRequest.ToLocation = location;
                zoneForLocation(location, 'to');
            }
            $scope.$on('closestLocation', function (event, location) {
                $scope.reservationRequest.FromLocation = location.loc;
                zoneForLocation(location.loc, 'from');
            });

            $scope.$on('homeLocation', function (event, location) {
                $scope.selectedLocationTo(location);
            });

            function isSelectedLocationInAllowedBookingRange(selectedLocation) {
                GeoLocationService
                        .getCurrentPosition()
                        .then(function (position) {
                            if (position) {
                                var hdistance = getHaversineDistanceInFeet(
                                                {
                                                    latitude: position.coords.latitude, longitude: position.coords.longitude
                                                },
                                                    {
                                                        latitude: selectedLocation.Latitude, longitude: selectedLocation.Longitude
                                                    });
                                var maxAllowedDistance = $scope.options.maxRadiusToAllowBooking;

                                if (hdistance > maxAllowedDistance) {
                                    UtilityFactory.toastError('Cannot book trip!', 'The pickup location must be within ' +
                                                                maxAllowedDistance + ' feet of your current location.', 15000);
                                    $scope.isAllowed = false;
                                }
                            }
                        });
            };

            function getHaversineDistanceInFeet(currentLocation, selectedLocation) {
                var lat1 = currentLocation.latitude;
                var lon1 = currentLocation.longitude;
                var lat2 = selectedLocation.latitude;
                var lon2 = selectedLocation.longitude

                var R = 6371;
                var x1 = lat2 - lat1;
                var dLat = x1 * Math.PI / 180;
                var x2 = lon2 - lon1;
                var dLon = x2 * Math.PI / 180;
                var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                                Math.sin(dLon / 2) * Math.sin(dLon / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                var p = 2 * Math.asin(Math.sqrt(a));
                var d = R * c * 0.62137 * 5280; //convert to feet
                return Number(d).toFixed(2);
            }

        }
    }
})();

+(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('reservationMapDirective', reservationMapDirective);

    reservationMapDirective.$inject = ['$window', '$http', '$filter', 'ConfigFactory', 'ScheduleService', 'DateFactory', 'uiGmapIsReady', 'UtilityFactory', '$interval'];

    function reservationMapDirective($window, $http, $filter, ConfigFactory, ScheduleService, DateFactory, uiGmapIsReady, UtilityFactory, $interval) {
        
        var directive = {
            link: {
                pre: preLink,
                post: postLink
            },
            controller: controller,
            restrict: 'E',
            scope: { passenger: '@', tripRequest: '@', currentTrip: '@', dispatchSelectedRunId: '@', dispatchSelectedTrip: '@'},
            templateUrl: 'app/modules/on-demand/reservations/reservationMap.html'
        };
        return directive;

        function controller($scope) {
            $scope.minlengthlimit = 3;
            $scope.map = {
                center: {
                    latitude: 40.680638,
                    longitude: -99.228516
                },
                zoom: 10,
                lineStyle: {
                    color: '#333',
                    weight: 5,
                    opacity: 0.7
                }                
            };

            $scope.showTraffic = false;
            if ($scope.dispatchSelectedRunId != null) {
                $scope.showTraffic = true;
            }
            $scope.mapControl = {};
            $scope.mapOptions = {
                mapTypeControl: false,
                zoomControl: false,
                streetViewControl: false
            };
            var currentDivision = "";
            $scope.stopMarker = [];
            $scope.addressRest = null;
            $scope.setMap = setMap;
            $scope.getCurrentActiveTrip = getCurrentActiveTrip;
            $scope.setCurrentTripMap = setCurrentTripMap;
            $scope.setSelectedTripMap = setSelectedTripMap;
            //$scope.setNewDispatchSelectedRunId = setNewDispatchSelectedRunId;
            $scope.clearMarkers = clearMarkers;
            var autoRefreshMarker = undefined;
            $scope.tripid = null;
            $scope.passengerId = null;
            $scope.activeTripRunId = null;
            var isTripActive;
            var isCancelable;
            $scope.passenger = {};
            $scope.tripRequest = {};
            $scope.currentTrip = {};
            $scope.dispatchSelectedRunId = null;
            $scope.dispatchSelectedTrip = [];
            $scope.activeTrip = false;
            $scope.cancelTrip = false;
            $scope.disableCancel = false;
            $scope.vehiclesMarkerDetails = [];
            $scope.selectedTripmarkerDetails = [];
            $scope.centerLatLong;
            //$scope.passengerDetails = $scope.passenger;
            // instantiate google map objects for directions
            var directionsDisplay = new google.maps.DirectionsRenderer({ suppressMarkers: true, draggable: false });
            var directionsService = new google.maps.DirectionsService();

            ConfigFactory.getCurrentDivision().then(function (divisionData) {
                currentDivision = divisionData;
            }, function () {
                //Error handling TBD
            });
            
            function setSelectedTripMap() {
                for (var i = 0; i < $scope.dispatchSelectedTrip.length; i++) {
                    if($scope.dispatchSelectedTrip[i].Type == 'pickup')
                    {
                        icon = '../../images/pickup.png';
                    }
                    else {
                        icon = '../../images/dropoff.png';
                    }
                    $scope.selectedTripmarkerDetails.push({
                        'tripId': $scope.dispatchSelectedTrip[i].TripID, 'scheduleTime': $scope.dispatchSelectedTrip[i].SchedTimeView,
                        'latitude': $scope.dispatchSelectedTrip[i].Latitude, 'longitude': $scope.dispatchSelectedTrip[i].Longitude,
                        'locationName': $scope.dispatchSelectedTrip[i].LoactionName, 'locationAddress': $scope.dispatchSelectedTrip[i].LoactionAddress,
                        'icon': icon
                    });
                }
                var icon = null;
                
                setBounds();
            };

            //marker click function
            $scope.tripMarkerEvent = {
                click: function (gMarker, eventName, model) {
                    if (model.$id) {
                        $scope.tripCoords = model.coords;
                        $scope.showTrip = true;
                    }
                }
            };

            function setCurrentTripMap() {
                $scope.tripRequest.FromLat = $scope.currentTrip.StartAddressViewModel.Latitude;
                $scope.tripRequest.FromLong = $scope.currentTrip.StartAddressViewModel.Longitude;
                $scope.tripRequest.ToLat = $scope.currentTrip.EndAddressViewModel.Latitude;
                $scope.tripRequest.ToLong = $scope.currentTrip.EndAddressViewModel.Longitude;
                $scope.tripRequest.tripId = $scope.currentTrip.TripID;
                $scope.tripId = $scope.currentTrip.TripID;
                scheduleTrip($scope.tripRequest);

            };

            function getCurrentActiveTrip() {
                $scope.passengerId = $scope.passenger.Id
                if ($scope.passenger.Id == null)
                {
                    UtilityFactory.toastError('Error', errormsg.data);
                    return;
                }
                ScheduleService.getlastripdetails($scope.passenger.Id)
                   .then(function (response) {
                       if (response.data.status == 1) {
                           var x = response.data;
                           $scope.activeTripRunId = response.data.result.RunID;
                           $scope.tripRequest.FromLat = (response.data.result.StartAddressViewModel.Latitude);
                           $scope.tripRequest.FromLong = (response.data.result.StartAddressViewModel.Longitude);
                           $scope.tripRequest.ToLat = (response.data.result.EndAddressViewModel.Latitude);
                           $scope.tripRequest.ToLong = (response.data.result.EndAddressViewModel.Longitude);
                           $scope.tripRequest.tripId = response.data.result.TripID;
                           $scope.tripId = response.data.result.TripID;
                           scheduleTrip($scope.tripRequest);
                       }
                       else {
                           //UtilityFactory.toastError('Error', response.data.message);
                           $scope.tripId = null;
                           $scope.tripRequest.From = null;
                           $scope.tripRequest.To = null;
                           $scope.scheduleMarkers = [];
                           directionsDisplay.setMap(null);
                       }
                   }, function (errormsg) {

                       UtilityFactory.toastError('Error', errormsg.data);
                   });
            };

            function setMap() {
                $scope.map = {
                    center: {
                        latitude: $scope.centerLatitude,
                        longitude: $scope.centerLongitude
                    },
                    zoom: 15,
                }
                if ($scope.isFleetMap) {
                    autoRefreshMarker = $interval(function () {
                        setFleetMarkers();
                    }, 5000);
                }
                else {
                    scheduleTrip($scope.tripRequest);
                }
            }           

            function scheduleTrip(tripRequest) {
                $scope.scheduleMarkers = [];

                directionsDisplay.setMap($scope.mapControl.getGMap());

                $scope.scheduleMarkers.push({
                    'latitude': tripRequest.FromLat, 'longitude': tripRequest.FromLong,
                    'icon': '../../images/pickup.png', 'tripId': $scope.tripRequest.tripId
                });
                $scope.scheduleMarkers.push({
                    'latitude': tripRequest.ToLat, 'longitude': tripRequest.ToLong,
                    'icon': '../../images/dropoff.png', 'tripId': $scope.tripRequest.tripId
                });

                var request = {
                    origin: new google.maps.LatLng(tripRequest.FromLat, tripRequest.FromLong),
                    destination: new google.maps.LatLng(tripRequest.ToLat, tripRequest.ToLong),
                    travelMode: google.maps.DirectionsTravelMode.DRIVING
                };
                directionsService.route(request, function (response, status) {
                    if (status === google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                        //directionsDisplay.setPanel(document.getElementById('directionsList'));
                        //$scope.directions.showList = true;
                        setBounds();
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            };

            uiGmapIsReady.promise().then(function (maps) {
                google.maps.event.trigger($scope.mapControl.getGMap(), "resize");
                
            });

            function setBounds() {
                var bounds = new google.maps.LatLngBounds();

                angular.forEach($scope.selectedTripmarkerDetails, function (stop) {
                    bounds.extend(new google.maps.LatLng(stop.latitude, stop.longitude));
                });

                $scope.mapControl.getGMap().fitBounds(bounds);
            };

            function clearMarkers() {               
                $scope.vehiclesMarkerDetails = [];
            };

            function setFleetMarkers() {
                clearMarkers();
                var lat = null;
                var long = null;

                if ($scope.tripId != null) {
                    ScheduleService.getDriverGPS($scope.tripId)
                        .then(function (response) {
                            if (response.data != null) {
                                $scope.activeTripRunId = response.data.RunId;
                                isTripActive = response.data.IsTripActive
                                if (!isTripActive) {
                                    var passengerId = $scope.passengerId
                                    ScheduleService.getlastripdetails($scope.passengerId)
                                        .then(function (response) {
                                              if (response.data.status == 1) {
                                                  $scope.tripRequest.From = response.data.result.StartAddressViewModel.Address1 + ', ' + response.data.result.StartAddressViewModel.City + ', ' + response.data.result.StartAddressViewModel.ZipCode;
                                                  $scope.tripRequest.To = response.data.result.EndAddressViewModel.Address1 + ', ' + response.data.result.EndAddressViewModel.City + ', ' + response.data.result.EndAddressViewModel.ZipCode;
                                                  $scope.tripRequest.FromLat = (response.data.result.StartAddressViewModel.Latitude);
                                                  $scope.tripRequest.FromLong = (response.data.result.StartAddressViewModel.Longitude);
                                                  $scope.tripRequest.ToLat = (response.data.result.EndAddressViewModel.Latitude);
                                                  $scope.tripRequest.ToLong = (response.data.result.EndAddressViewModel.Longitude);

                                                  $scope.activeTrip = true;
                                                  $scope.cancelTrip = false;
                                                  $scope.tripId = response.data.result.TripID;
                                                  $scope.tripRequest.Shuttle = response.data.result.VehicleName;
                                                  $scope.tripRequest.RunName = response.data.result.RunName;
                                                  $scope.tripRequest.StartTime = response.data.result.EstimatedPickupTime;
                                                  $scope.tripRequest.EndTime = response.data.result.EstimatedDestinationTime;
                                                  $scope.disableCancel = false;
                                                  scheduleTrip($scope.tripRequest);
                                              }
                                              else {
                                                  $scope.tripId = null;
                                                  $scope.tripRequest.From = null;
                                                  $scope.tripRequest.To = null;
                                                  $scope.activeTrip = false;
                                                  $scope.cancelTrip = true;
                                                  $scope.scheduleMarkers = [];
                                                  directionsDisplay.setMap(null);
                                                  //stopAutoRefreshMarker();
                                                  //window.location.reload();
                                                  return;
                                              }
                                          }, function (errormsg) {

                                              UtilityFactory.toastError('Error', errormsg.data);
                                          });
                                }
                                else {
                                    isCancelable = response.data.IsCancelable
                                    if (!isCancelable) {
                                        $scope.disableCancel = true;
                                    }
                                }
                            }
                            else {
                            }
                        }, function (errormsg) {
                        });
                }

                if ($scope.dispatchSelectedRunId != null)
                {
                    ScheduleService.getActiveRuns(currentDivision.DivisionID, null)
                    .then(function (response) {
                        if (response.data != null) {
                            for (var i = 0; i < response.data.result.length; i++) {
                                $scope.getActiveRuns = response.data.result[i]

                                if ($scope.getActiveRuns.RunId == $scope.dispatchSelectedRunId) {
                                    if ($scope.getActiveRuns.LatestVehicleLatitude != null & $scope.getActiveRuns.LatestVehicleLongitude != null)
                                    {
                                        var icon = '../../images/VehicleCurrentTrip.png'
                                        $scope.vehiclesMarkerDetails.push({
                                            'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                            'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                            'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                        });
                                    }
                                }
                            }
                        }
                        else {
                            UtilityFactory.toastError('Error', $scope.returnMsg);
                        }
                    }, function (errormsg) {
                        UtilityFactory.toastError('Error', $scope.returnMsg);
                    });
                }
                else {
                    ScheduleService.getActiveRuns(currentDivision.DivisionID, null)
                    .then(function (response) {
                        if (response.data != null) {
                            for (var i = 0; i < response.data.result.length; i++) {
                                $scope.getActiveRuns = response.data.result[i];

                                if ($scope.getActiveRuns.LatestVehicleLatitude != null & $scope.getActiveRuns.LatestVehicleLongitude != null)
                                {
                                    if ($scope.activeTripRunId != null && $scope.getActiveRuns.RunId == $scope.activeTripRunId && isTripActive) {
                                        var icon = '../../images/VehicleCurrentTrip.png'
                                        $scope.vehiclesMarkerDetails.push({
                                            'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                            'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                            'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                        });
                                    }
                                    else if ($scope.getActiveRuns.DriverId != null && $scope.getActiveRuns.VehicleId != null) {

                                        if ($scope.getActiveRuns.NumOfActiveTrips > 0) {
                                            var icon = '../../images/VehicleActiveTrips.png'
                                            $scope.vehiclesMarkerDetails.push({
                                                'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                                'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                                'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                            });
                                        }
                                        else {
                                            var icon = '../../images/VehicleNoTrips.png'
                                            $scope.vehiclesMarkerDetails.push({
                                                'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                                'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                                'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                            });
                                        }
                                    }
                                    else {
                                        //Do nothing
                                    }
                                }
                                
                            }
                        }
                        else {
                            UtilityFactory.toastError('Error', $scope.returnMsg);
                        }
                    }, function (errormsg) {
                        UtilityFactory.toastError('Error', $scope.returnMsg);
                    });
                }
                
            };

            //marker click function
            $scope.markerEvent = {
                click: function (gMarker, eventName, model) {
                    if (model.$id) {                        
                        $scope.coords = model.coords;
                        $scope.show = true;
                    }
                }
            };

            function stopAutoRefreshMarker() {
                if (angular.isDefined(autoRefreshMarker)) {
                    $interval.cancel(autoRefreshMarker);
                    autoRefreshMarker = undefined;
                }
            };

            $scope.$on('$destroy', function (event) {
                stopAutoRefreshMarker();
            });
            
        }

        function preLink(scope, element, attrs) {
            ScheduleService.getServiceAreaLocation()
                .then(function (response) {
                    if (response.data !== null) {
                        scope.centerLatitude = response.data.Latitude;
                        scope.centerLongitude = response.data.Longitude;
                        scope.addressRest = response.data.Address;
                        //LocationFactory.setadd($scope.addressRest);
                        //scope.mapCenter.latitude = latitude;
                        //scope.mapCenter.longitude = longitude;
                        
                        if (scope.tripRequest.length > 0){
                            if (typeof scope.tripRequest == "string")
                            {
                                scope.tripRequest = JSON.parse(scope.tripRequest);
                            }
                            scope.isFleetMap = false;
                            
                        }
                        else {
                            scope.isFleetMap = true;
                        }
                        scope.setMap();
                    }
                    else {
                        //UtilityFactory.toastError('Error', $scope.returnMsg);
                    }
                }, function (errormsg) {
                    UtilityFactory.toastError('Error', $scope.returnMsg);
                });
            
        };

        function postLink(scope, element, attrs) {
            scope.$watch("currentTrip", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string"){
                        scope.currentTrip = JSON.parse(newValue);
                    }                     
                    else if (typeof newValue == "object") {
                        scope.currentTrip = newValue;
                        scope.setCurrentTripMap();
                    }
                }
            });

            scope.$watch("passenger", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string")
                    {
                        scope.passenger = JSON.parse(newValue);
                    }                        
                    else if (typeof newValue == "object")
                    {
                        scope.passenger = newValue;
                        scope.getCurrentActiveTrip()
                    }
                }

            });

            scope.$watch("dispatchSelectedRunId", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string") {
                        scope.dispatchSelectedRunId = JSON.parse(newValue);
                        scope.clearMarkers();
                        scope.selectedTripmarkerDetails = [];
                    }
                    else if (typeof newValue == "object") {
                        scope.dispatchSelectedRunId = newValue;
                        //scope.setNewDispatchSelectedRunId()
                    }
                }

            });

            scope.$watch("dispatchSelectedTrip", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string") {
                        scope.dispatchSelectedTrip = JSON.parse(newValue);
                        scope.selectedTripmarkerDetails = [];
                    }
                    else if (typeof newValue == "object") {
                        scope.selectedTripmarkerDetails = [];
                        scope.dispatchSelectedTrip = newValue;
                        scope.setSelectedTripMap();
                    }
                }

            });
        }

        
    }

})();


(function () {
    'use strict';

    angular.module('oneMVApp')
        .controller('ReservationsController',
		['$location', '$scope', '$state', '$timeout', '$window', '$uibModal',
         'ConfigFactory', 'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'MessageBox',
         'UtilityFactory', 'authService', 'GeoLocationService', 'LocationFactory', 'RedirectionService', 'ProfileService', 'googleMapsConfig',
         'PageService',
          reservationsController]
        );

    function reservationsController
		($location, $scope, $state, $timeout, $window, $uibModal,
        ConfigFactory, ScheduleService, uiGmapIsReady, DivisionService, MessageBox,
		UtilityFactory, authService, GeoLocationService, LocationFactory, RedirectionService, ProfileService, googleMapsConfig
        ,PageService) {

        var vm = this;
        PageService.setTitle('New Reservation');
        PageService.setHeadline('On Demand');
        vm.reservationRequest = {};
        vm.reservationRequest.ReservationDate = new Date();
        vm.minDate = new Date();
        vm.maxDateAllowed = new Date(2017, 2, 28);

        vm.currentPassenger = { "Id": authService.authentication.passengerId };
        var operatorId = null;
        vm.userReservationOptions = {};
        vm.hasActiveTrip = false;
        vm.hasFutureTrips = false;
        vm.position = null;
        vm.reservationType = 'current';
        var divisionId = '';
        vm.homePassengerId = null;

        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            myLocationPin = 'images/pin-my-location.png';
        }
        else {
            myLocationPin = 'images/pin-my-location.svg';
        }

        var getActiveTrip = function () {
            ScheduleService.getlastripdetails(vm.currentPassenger.Id)
                .then(function (response) {
                    if (response.data.status === 1 && response.data.result) {
                        vm.hasActiveTrip = true;
                        
                    }
                    else {
                        ScheduleService.tripsForServiceDate(vm.currentPassenger.Id)
                        .then(function (response) {
                            if(response.data.status === 1 && response.data.result)
                            {
                                if (response.data.result.length > 0)
                                    vm.hasFutureTrips = true;
                            }

                        }, function (err) {
                            vm.hasFutureTrips = false;
                        });
                    }
                    //check current time and see if the window is in the future 
                }, function (err) {
                    vm.hasActiveTrip = false;
                    vm.hasFutureTrips = false;
                });
        }

        function populateDivisionParameters() {
            getActiveTrip();

            vm.userReservationOptions = {
                DivisionId: divisionId,
                OperatorId: operatorId
            };
            ConfigFactory.getDivisionParameters(divisionId)
                     .then(function (params) {
                         if (params) {
                             var options = vm.userReservationOptions;

                             options.passengersLimit = params.PassengersLimit ? eval(params.PassengersLimit) : 5;
                             options.allowWillCall = params.AllowWillCall ? eval(params.AllowWillCall.toLowerCase()) : false;
                             options.allowPassengerWillCall = params.AllowPassengerWillCall ? eval(params.AllowPassengerWillCall.toLowerCase()) : false;
                             options.allowEquipment = params.AllowEquipment ? eval(params.AllowEquipment.toLowerCase()) : false;
                             options.isAdvancedReservation = params.AllowAdvancedReservation ? eval(params.AllowAdvancedReservation.toLowerCase()) : false;
                             options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;
                             options.isWheelChair = params.HasWheelChair ? eval(params.HasWheelChair.toLowerCase()) : false;
                             options.isCompanion = params.HasCompanions ? eval(params.HasCompanions.toLowerCase()) : false;
							 options.companionsLimit = params.HasCompanions == false ? 0: params.CompanionsLimit ? eval(params.CompanionsLimit): 1;
                             options.isPCA = params.HasPCA ? eval(params.HasPCA.toLowerCase()) : false;
                             options.isServiceAnimal = params.HasServiceAnimal ? eval(params.HasServiceAnimal.toLowerCase()) : false;
                             options.allowCustomLocation = params.AllowCustomLocation ? eval(params.AllowCustomLocation.toLowerCase()) : false;
                             options.promiseWindow = params.PromiseWindow ? eval(params.PromiseWindow) : 10;
                             options.reservationType = vm.reservationType;
                             options.allowOnlySameDayAdvRes = params.AllowOnlySameDayAdvRes ? eval(params.AllowOnlySameDayAdvRes.toLowerCase()) : false;
                             options.dropoffHomeLocationOnly = params.DropoffHomeLocationOnly ? eval(params.DropoffHomeLocationOnly.toLowerCase()) : false;
                             options.homePassengerId = options.dropoffHomeLocationOnly ? vm.currentPassenger.Id : null;
                             options.checkFRBeforeDRT = params.CheckFRBeforeDRT ? eval(params.CheckFRBeforeDRT.toLowerCase()) : false;
                             options.noOfFRArrivals = params.NoOfFRArrivals ? eval(params.NoOfFRArrivals) : 3;
                             options.allowASAPReservations = params.AllowASAPReservations ? eval(params.AllowASAPReservations) : false;
                             options.allowAppointments = params.AllowAppointments ? eval(params.AllowAppointments) : false;
                             options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes) : false;
                             options.allowReservationOnlyWhenGpsIsOn = params.AllowBookingIffGpsIsOn ? eval(params.AllowBookingIffGpsIsOn) : false;
                             options.maxRadiusToAllowBooking = params.MaxRadiusToAllowBooking ? eval(params.MaxRadiusToAllowBooking) : false;
                             options.allowFaring = params.AllowFaring ? eval(params.AllowFaring) : false;

                             options.sameDayResLowerBound = params.SameDayResLowerBound ? params.SameDayResLowerBound : "00:00";
                             options.sameDayResUpperBound = params.SameDayResUpperBound ? params.SameDayResUpperBound : "24:00";
                             options.futureResLowerBound = params.FutureResLowerBound ? params.FutureResLowerBound : "00:00";
                             options.futureResUpperBound = params.FutureResUpperBound ? params.FutureResUpperBound : "24:00";
                             options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                             options.childrenLimit = params.ChildrenLimit ? eval(params.ChildrenLimit) : 3;

                             vm.reservationFormOptions = options;

                         	 // use TO home location if present
                             if (options.dropoffHomeLocationOnly) {
                             	$timeout(getDestinationHomeLocation, 0);
                             }

                             //extra options only needed by user reservations directive.
                             options.isPassenger = true;
                             options.isReadOnly = true;
                             options.autoRefresh = true;
                             options.batchDays = params.BatchDays ? eval(params.BatchDays) : 7;
                             options.minFromDays = params.MinFromDays ? eval(params.MinFromDays) : 30;
                             options.passengerBookingMinDays = params.PassengerBookingMinDays ? eval(params.PassengerBookingMinDays) : 0;
                             options.passengerBookingMaxDays = params.PassengerBookingMaxDays ? eval(params.PassengerBookingMaxDays) : 14;
                             vm.reservationFormOptions = options;
                         }
                     }, function (response) {
                         UtilityFactory.toastError('Error', response.data.ReturnMessage);
                     });

            getMap();
		}

        vm.onReservationSuccess = function (trip, isASAP) {
            vm.addedTrip = trip; //here we can display a trip on our existing map
            if (isASAP)
                $location.path('on-demand/active-trip');
            else {
                var scheduleTripDisplay = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/displayTrip-modal.html',
                    controller: 'DisplayScheduledTripController as vm',
                    size: '',
                    resolve: {
                        trip: function () {
                            return trip;
                        },
                        options :function(){
                            return vm.reservationFormOptions;
                        }                        
                    }
                });
                scheduleTripDisplay.result.then(function () {
                    //loadMasterRuns();
                });
                //open modal

            }
        };

        vm.showMap =false;
       vm.zoom = 15;
        vm.center = {
        latitude: 39.809860,
            longitude: -98.555183
            };
       vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                    if (response.data.status == 1) {
                        vm.center.latitude = response.data.result.Latitude;
                        vm.center.longitude = response.data.result.Longitude;
                        if (response.data.result.ZoomLevel !== undefined && response.data.result.ZoomLevel !== null
                                && response.data.result.ZoomLevel != '')
                                    vm.zoom = response.data.result.ZoomLevel;
                    }
                    vm.showMap = true;

                });

                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        "coords": {
                            "Latitude": position.coords.latitude,
                            "Longitude": position.coords.longitude
                        },
                        "icon": vm.myLocationIcon
                    };

                    //here get closest location
                    LocationFactory.getLocations('', 'false', divisionId).then(function (result) {
                    	var filteredResults = angular.copy(result.data);
                    	var filteredResult = LocationFactory.findClosestLocation(vm.position.coords, filteredResults);
                    	//show selected location iff the current gps is within 300 ft of a building
                    	//1 mile ~= 5280 ft
                    	if (filteredResult && parseFloat(filteredResult.distance) * 5280 <= 300)
                    		$scope.$broadcast('closestLocation', filteredResult);

                    	// get destination Home location
                    }, function (err) {
                    });
                }, function (err) {
                    //position error
                });
            });
        }
		
        function getDestinationHomeLocation() {
            
        	ProfileService.GetHomeAddress(vm.currentPassenger.Id)
				.then(function (homeAddress) {
					$scope.$broadcast('homeLocationDisable', true);
					if (homeAddress) {
					    // set TO address to the home address
						vm.reservationRequest.ToLocation = homeAddress;
						var toAddressDisplay = (homeAddress.Name || '') + " " + (homeAddress.Address || '') + " " + (homeAddress.City || '') + " " + (homeAddress.Zip || '');
					    //
					    // On slow cell connections, this gets broadcast before reservationFormDirective.js gets loaded.
                        // So the home address is NEVER DISPLAYED!!!  You can test this by throttling connection at 2000 kbs.
                        // We need to $broadcast after waiting 4 seconds.
					    //
						$scope.$broadcast('homeLocation', homeAddress);
						$scope.$broadcast('homeLocationText', toAddressDisplay);
						$timeout(function () {
						    $scope.$broadcast('homeLocation', homeAddress);
						    $scope.$broadcast('homeLocationText', toAddressDisplay);
						    $scope.$broadcast('homeLocationDisable', true);
						}, 4000)
					} else {
						// ask passenger to create a home address
						var divisionParameters = DivisionService.getSystemParameters();
						if (! divisionParameters.DropoffHomeLocationEdit) {
							// get help phone number
							var helpPhone = DivisionService.getSupportPhoneNumber();
							var message = "Please call Help desk at " + helpPhone + " and ask them to create a Home Address for you.";
							MessageBox.info('Home Address is Required', message).then(function () {
								$window.history.back();
							});
						} else {
							// passenger has not set his home location, and may edit it, so show home address editor as a modal
							$uibModal.open({
								animation: true,
								backdrop: false,
								templateUrl: 'app/modules/shared/profile/home-address-modal.html',
								controller: function () { },
								size: ''
							}).closed.then(function () {
								// home address was changed - reload the page
								$state.reload();
							});
						}
					}
				},
				function (err) {
				    console.log('Error getting home location');
				    console.log(err);
				});
        }

        function activate(callback) {
            if (!authService.isLoggedIn()) {
                RedirectionService.save('/on-demand/reservations');
                $location.path('login');
            }
            else {
                divisionId = DivisionService.getDivisionId();
                if (divisionId != null && divisionId != undefined && divisionId != '') {
                    if (callback && typeof callback === "function")
                        callback();
                }
                else
                    $location.path('dashboard/');
            }
        }

        activate(populateDivisionParameters);

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/on-demand/reservations/reservations.html';
        vm.ionicCustomClassName = '';
        vm.disableScroll = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    };

})();
(function () {
    //debugger;

    'use strict';

    angular.module('oneMVApp').factory('ScheduleService', ScheduleService);
    ScheduleService.$inject = ['$http', '$q', 'ConfigFactory', 'authService', 'env', 'localStorageService', '$rootScope'];

    function ScheduleService($http, $q, ConfigFactory, authService, env, localStorageService, $rootScope) {
    var service = {
        getCurrentUser: getCurrentUser,
        getPassdatall: getPassdatall,
        getpassenger: getpassenger,
        schedulepost: schedulepost,
        cancelpost: cancelpost,
        getlastripdetails: getlastripdetails,
        updateEmailPhoneandAddress: updateEmailPhoneandAddress,
        getActiveRuns: getActiveRuns,
        getServiceAreaLocation: getServiceAreaLocation,
        getDriverGPS: getDriverGPS,
        getSearchPassanger: getSearchPassanger,
        getPastRuns: getPastRuns,
        savePastTrip: savePastTrip,
        getPassengerTrips: getPassengerTrips,
        getServiceDateByDivision: getServiceDateByDivision,
        getStates: getStates,
        searchPassenger: searchPassenger,
        tripsForServiceDate: tripsForServiceDate,
        getTripCancelStatusList: getTripCancelStatusList
    };
    return service;
    var value;


    function tripsForServiceDate(passengerId) {
        var deferred = $q.defer();

        var url = env.oneMVApiUrl  + 'passenger/' + passengerId + '/tripsForServiceDate';

        $http({
            method: 'GET',
            url: url + '?rnd=' + new Date().getTime(),
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err);
        });

        return deferred.promise;
    };


    function searchPassenger(divisionInfo, passengerId) {
        var deferred = $q.defer();

        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            var url = oneMVURL + "passenger/search/" + passengerId;
            $http({
                method: 'GET',
                url: url + '?rnd=' + new Date().getTime(),
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
        }, function (error) {
            deferred.reject(error);
        });
        return deferred.promise;
    };


    function getStates() {
        var deferred = $q.defer();
        $http({
            method: 'GET',
            url: '../Passenger/getStates?rnd=' + new Date().getTime(),
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err);
        });
        return deferred.promise;
    };

    function getCurrentUser() {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Operation/GetCurrentUser';
        $http({
            method: 'GET',
            'url': serviceUrl
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getPassdatall() {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/getpassDataauto?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            'url': serviceUrl
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getpassenger(passengerId) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/GetPassDetailByPassId?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            'url': serviceUrl,
            params: { PassengerId: passengerId },
            dataType: "json",
            contentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };
    function getPassengerTrips(divisionId, passengerId, fromDate, toDate) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/' + passengerId +'/trips/' +
                                            fromDate + '/' + toDate + '?rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    //data: JSON.stringify(passengerTripParam),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function schedulepost(scheduleTripReqparam) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/' + scheduleTripReqparam.PassengerID + '/trip/schedule';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(scheduleTripReqparam),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to cancel trip
    function cancelpost(cancelreq) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/' + cancelreq.PassengerID + '/trip/cancel';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(cancelreq),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to get the last active trip details
    function getlastripdetails(passengerID) {
    		var deferred = $q.defer();
    		ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
    			if (oneMVURL && oneMVURL != "") {
    				//get the base url from config.
    				var serviceUrl = oneMVURL + 'passenger/' + parseInt(passengerID) + '/activeTrip?rnd=' + new Date().getTime();
    				$http({
    					method: 'GET',
    					'url': serviceUrl,
    					dataType: "json",
    					ContentType: "application/json; charset=utf-8"
    				}).then(function (response) {
    					$rootScope.$broadcast("hasActiveTripChanged", response.data.status == 1);
    					deferred.resolve(response);
    				}, function (err) {
    					deferred.reject(err)
    				});
    			}
    			else {
    				$log.error('Error: - Could not fetch service api url')
    				UtilityFactory.toastError("Could not fetch service api url");
    			}
    		});
    		return deferred.promise;
    };

    function updateEmailPhoneandAddress(newpassenger) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '/Passenger/UpdateEmailPhoneandAddress';
        $http({
            method: 'POST',
            'url': serviceUrl,
            data: JSON.stringify(newpassenger),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getServiceAreaLocation(divisionId) {
        var deferred = $q.defer();
        //get the base url from config.
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                var serviceUrl = oneMVURL + "division/" + divisionId + "/serviceArea?rnd=" + new Date().getTime();

                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
        });
        return deferred.promise;
    };

    function getDriverGPS(tripId) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/GetDriverGPS?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            'url': serviceUrl,
            params: {
                TripId: tripId
            },
            dataType: "json",
            contentType: "application/json; charset=utf-8",
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    //Search passanger  by clientpassangerid
    function getSearchPassanger(ClientPassangerID) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/GetSearchPassanger?ClientPassangerID=' + ClientPassangerID;
        $http({
            method: 'GET',
            'url': serviceUrl,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    //call api to get the active runs for current service date
    function getActiveRuns(divisionId) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Dispatch/GetRuns?rnd=' + new Date().getTime();
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify({ "DivisionId": divisionId, "ServiceDate": null }),
                    dataType: "json",
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to get the past runs for the service date
    function getPastRuns(divisionId, serviceDate) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Dispatch/GetPastRuns?rnd=' + new Date().getTime();
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify({ "DivisionId": divisionId, "ServiceDate": serviceDate }),
                    dataType: "json",
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to the trips in the past
    function savePastTrip(saveTripReqparam) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Dispatch/InsertPastTrip';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(saveTripReqparam),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to get the service date for the division
    function getServiceDateByDivision(divisionId) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'division/' + divisionId + '/serviceDate?rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function getTripCancelStatusList()
    {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/getCancellationReasons?rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;

    }
}
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('TripNegotiationLogService', TripNegotiationLogService);

    TripNegotiationLogService.$inject = ['$http', '$q', 'env'];

    function TripNegotiationLogService($http, $q, env) {
        var service = {
            addApprovalLog: addApprovalLog,
            addRejectionLog:addRejectionLog
        };
        return service;

        function addApprovalLog(tripRequestId, negotiationLogId, modifiedBy) {
            var defer = $q.defer();
            var _url = env.oneMVApiUrl + "tripNegotiationLog/accept/" + tripRequestId + '/' + negotiationLogId + '/' + modifiedBy;
            $http({
                method: 'PUT',
                url: _url
            }).then(function successCallback(response) {
                if (response.data.status == 1) {
                    defer.resolve(response.data.result);
                } else {
                    defer.reject(response.data.result);
                }
            });
            return defer.promise;
        }

        function addRejectionLog(tripRequestId, modifiedBy) {
            var defer = $q.defer();
            var _url = env.oneMVApiUrl + "tripNegotiationLog/reject/" + tripRequestId + '/' + modifiedBy;
            $http({
                method: 'PUT',
                url: _url
            }).then(function successCallback(response) {
                if (response.data.status == 1) {
                    defer.resolve(response.data.result);
                } else {
                    defer.reject(response.data.result);
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ForgotPasswordController', ForgotPasswordController);

    ForgotPasswordController.$inject = ['$scope', '$state', 'env', 'PasswordService', 'authService', 'vcRecaptchaService', 'DivisionService', 'PortalUtilityService', 'MessageService'];

    function ForgotPasswordController($scope, $state, env, PasswordService, authService, vcRecaptchaService, DivisionService, PortalUtilityService, MessageService) {
        var vm = this;
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;
        
        vm.verifyEmail = verifyEmail;
        vm.cancel = cancel;
        
        var widgetId = -1;

        function setCaptchaResponse(response) {
            authService.verifyCaptcha(response).then(function (result) {
                if (!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
                });
        }

        function widgetCreate(_widgetId) {
            widgetId = _widgetId;
        }
        function cancel() {
            $state.go('loginOneMV');
        }
        function verifyEmail() {

            PasswordService.SendPasscode(vm.Email).then(function (response) {
                if (response.data && response.data.result) {
                    if (response.data.result.ChangeStatus)
                        $state.go('verify-update-password', { obj: { email: vm.Email } });
                    else {
                        vm.isClicked = !vm.isClicked;
                        MessageService.showError(response.data.result.ChangeStatusDescription);
                        
                    }
                }
            }, function (err) {
                vm.isClicked = !vm.isClicked;
                MessageService.showError(err);
                
            });

        };

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/forgot-password.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic

        activate();

        function activate() {
            var divisionId = DivisionService.getDivisionId();
            if (!PortalUtilityService.hasValue(divisionId))
                $state.go("division");
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LoginController', LoginController);

    LoginController.$inject = ['$location', '$scope', '$rootScope', 
        'authService', 'env', 'MessageService', 'DivisionService', 'ConfigFactory',
        'GeoLocationService', 'ServiceAreaService', '$timeout', '$window','PageService'];

    function LoginController($location, $scope, $rootScope, 
                            authService, env, MessageService, DivisionService, ConfigFactory, GeoLocationService, ServiceAreaService,
                            $timeout, $window, PageService) {
        var vm = this;        
        var division = {};
        var divisionSupportsFeed = false;
        vm.message = "";
        //vm.alias = '';
        vm.providers = [];
        $scope.hideHeader = $location.path() === '/login';
        vm.isAmazonProvider = false;

        vm.navigateToHome = function () {
            window.history.back();
        };

        vm.allowedToLoginOrRegister = false;
        vm.loginOrRegisterMessage = '';
        vm.hasGpsBeenChecked = false;
        vm.PageService = PageService;
        vm.PageService.setTitle('Whats New');
        vm.PageService.setHeadline('Latest Service Updates');
        var activate = function () {

            DivisionService
                .getDivisionInfo()
                .then(onDivisionSuccess, onDivisionFailure);
        };

        function getSystemParams() {
            ConfigFactory
                .getDivisionParameters(division.DivisionID)
                .then(function (params) {
                    if (params) {
                        divisionSupportsFeed = params.DivisionSupportsFeed
                                                ? eval(params.DivisionSupportsFeed.toLowerCase())
                                                : true;

                        var allowRegisterIffGpsIsOn = params.AllowRegisterIffGpsIsOn
                                                        ? eval(params.AllowRegisterIffGpsIsOn)
                                                        : false;
                        if (allowRegisterIffGpsIsOn)
                        {
                            isGpsEnabled();
                        } else {
                            vm.allowedToLoginOrRegister = true;
                            vm.hasGpsBeenChecked = true;
                        }

                    }
                });
        }

        function isGpsEnabled() {
            GeoLocationService
                   .getCurrentPosition()
                   .then(function (position) {
                       if (position) {
                           isInServiceArea(position);
                       }
                       else
                           disableLogin('Your device is unable to determine your GPS location.');
                   }, function (err) {
                       disableLogin('GPS must be enabled to use this application.');
                   });
        }


        function isInServiceArea(position) {
            vm.hasGpsBeenChecked = true;
            ServiceAreaService
                .isInServiceArea(division.DivisionID, position.coords.latitude, position.coords.longitude)
                .then(function (response) {
                    if (response && !response.data.result) {
                        disableLogin('You must be within the service area to login or register.');
                    } else{
                        vm.allowedToLoginOrRegister = true;
                    }
                }, function (error) {
                    disableLogin('We are unable to verify your GPS location. Please try again later.');
                })
        }


        function disableLogin(message) {
            vm.hasGpsBeenChecked = true;
            vm.allowedToLoginOrRegister = false;
            vm.loginOrRegisterMessage = message;
            // navigate to dashboard after 10 seconds.
            vm.redirectTimeout = $timeout(function () {
                $window.location.replace('#/');
            }, 10000);
        }
        // kill the timeout if the user navigates away before 10 seconds.
        $scope.$on("$destroy", function () {
            if (vm.redirectTimeout) {
                $timeout.cancel(vm.redirectTimeout);
            }
        });
        function onDivisionSuccess(response) {
            if (response.data.status === 1) {
                division = response.data.result;
                vm.alias = division.Alias;
                var logins = response.data.result.AllowedLogins;
                var providers = logins.split(',');
                for (var i = 0; i < providers.length; i++) {
                    vm.isAmazonProvider = providers[i].toLowerCase() == "amazon";
                    vm.providers.push({ 'name': providers[i] });
                }

                getSystemParams();
            }            
        };

        function onDivisionFailure(error) {
            $location.path("dashboard/");
        }        

        activate();

        vm.ionicUseExternalLink = env.ionic == null ? false :  env.ionic.appVersion == 'v9.6.52';

        vm.authExternalProvider = function (provider) {
            if (provider == 'OneMV' || provider == 'One MV')
            {

                $location.path('loginOneMV');
                return;
            } else if (provider == 'Google' && $('body').hasClass('platform-cordova')) {
                $location.path('loginGoogleIonic');
                return;
            }
            var redirectUri = location.protocol + '//' + location.host + '';
            // for IONIC
            if ($('body').hasClass('platform-ios') || $('body').hasClass('platform-android')) {
                // for the mobile IONIC app iOS and Android version, 
                // this is a dummy URL that will work in the InAppBrowser plugin
                redirectUri = 'http://localhost/callback/';
            }
            if ($('body').hasClass('platform-browser')) {
                // for running IONIC version locally.
                redirectUri += '/index.ionic.html#';
            }

           var externalProviderUrl = env.authServerUrl  + "Account/ExternalLogin?provider=" + provider
                                                                        + "&response_type=token&client_id=" + env.audience
                                                                        + "&redirect_uri=" + redirectUri
                                                                        + "&divisionSupportsFeed=" + divisionSupportsFeed
                                                                        + "&divisionId=" + DivisionService.getDivisionId();
            // If body has class 'platform-cordova', then we are on a mobile device.
            // When on a mobile device, we need to use the cordova inappbrowser
            if ($('body').hasClass('platform-cordova')) {
                var target = '_blank';
                var options = 'location=no,toolbar=yes,clearcache=yes,clearsessioncache=yes,closebuttoncaption=Back to Passenger App,toolbar=yes,transitionstyle=coververtical';
                var ref = window.open(externalProviderUrl, target, options);
                ref.addEventListener('loadstart', function (event) {
                    if (event.url.indexOf('http://localhost/callback/#') == 0 || event.url.indexOf('file:///#/') == 0) {
                        var newLocation = event.url.substring(event.url.indexOf('#'), event.url.length);
                        ref.close();
                        window.location = newLocation;
                    }
                });
                ref.addEventListener('loaderror', function (event) {
                    console.log('loaderror:' + JSON.stringify(event));
                });
            } else {
                window.location = externalProviderUrl;
            }
        };

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/login.html';
        vm.ionicCustomClassName = 'ionic-login-class';
        vm.ionicHideNavBar = true;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
      
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('OneMVLoginController', OneMVLoginController);

    OneMVLoginController.$inject = ['$location', '$scope', '$rootScope', 
        'authService', 'env', 'MessageService', 'DivisionService', 'PageService'];

    function OneMVLoginController($location, $scope, $rootScope,
                            authService, env, MessageService, DivisionService, PageService) {
        var vm = this;
        vm.login = login;
        vm.cancel = cancel
        vm.divisionId = DivisionService.getDivisionId();
        vm.PageService = PageService;
        vm.PageService.setTitle('Login');
        vm.PageService.setHeadline('With your ONEMV account');
        function cancel()
        {
            $location.path('dashboard/');
        }
        function login() {
            //call one mv login
            var request = {
                UserName: vm.username,
                Password: vm.password,
                DivisionId: vm.divisionId,
                Provider: 'MvLogin'
            }
                     //will call a service
            authService.loginOneMV(request).then(function (response) {
                $rootScope.$broadcast('loggedIn', null);
                $location.path('dashboard/');
            }, function errorCallback(error) {
                //call message service
                vm.isClicked = !vm.isClicked
                if(error)
                    MessageService.showError(error.Message);
            });
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/onemv-login.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

        function activate() {
            
        }

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('VerifyUpdatePasswordController', VerifyUpdatePasswordController);

    VerifyUpdatePasswordController.$inject = ['$scope', '$state', '$stateParams', '$location','env', 'PasswordService', 'MessageService', 'authService'];

    function VerifyUpdatePasswordController($scope, $state, $stateParams, $location, env, PasswordService, MessageService, authService) {
        var vm = this;
        vm.submit = submit;
        
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;
        vm.email = ($stateParams.obj) ? $stateParams.obj.email : "";
        var queryString = $location.search();
        if (queryString)
        {
            if (queryString.email)
                vm.email = queryString.email;
            if (queryString.division)
                vm.division = queryString.division;
            
        }
      

        var widgetId = -1;

        function setCaptchaResponse(response) {
            authService.verifyCaptcha(response).then(function (result) {
                if (!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
                });
        }

        function widgetCreate(_widgetId) {
            widgetId = _widgetId;
        }



       
        function submit()
        {
            if (vm.newPassword != vm.repeatNewPassword)
            {
                MessageService.showError("New and Repeat Passwords don't match.")
                vm.isClicked = !vm.isClicked;
                return;
            }
            var passwordData = {
                TemporaryCode: vm.temporaryCode,
                Email: vm.email,
                NewPassword: vm.newPassword
            }
            PasswordService.VerifyAndUpdatePassword(passwordData).then(function (response) {
                if (response.data && response.data.result && response.data.result) {
                    if (response.data.result.ChangeStatus) {
                        $state.go("loginOneMV");
                    }
                    else {
                        vm.isClicked = !vm.isClicked;
                        MessageService.showError(response.data.result.ChangeStatusDescription);
                    }
                }
                else {
                    MessageService.showError("Could not update password");
                    vm.isClicked = !vm.isClicked;
                }
              
            }, function (err) {
                MessageService.showError(err);
                vm.isClicked = !vm.isClicked;
            });
          
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/verify-update-password.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic

        activate();

        function activate() {
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('DivisionsController', DivisionsController);

    DivisionsController.$inject = ['$window', '$scope', '$rootScope', '$location', 'DivisionService', 'GeoLocationService',
        'CommonService', 'env','UtilityFactory'];

    function DivisionsController($window, $scope, $rootScope, $location, DivisionService, GeoLocationService, CommonService, env,UtilityFactory) {
        //figure out gps is on or off. If on then find divisions in same state and state drop down
        var vm = this;
        vm.divisions = [];
        vm.selectedDivision = '';
        vm.isDivisionLoaded = false;
        vm.showDivisionDropdown = true;
        vm.states = [];
        var noDivision = { 'Alias': '--', 'DivisionName': '--' };
        var noState = { 'Name': '--', 'Id': '--' };
        vm.setDivision = setDivision;
        vm.fetchDivisionsForSelectedState = fetchDivisionsForSelectedState;

        activate();
        function populateDivisions(response) {

            if (response.data.result != null && response.data.result.length > 0) {
                vm.divisions = response.data.result;
                vm.divisions.splice(0, 0, noDivision);
                if (env.isIonic && env.isIonicDevice) {
                    // In passenger app, lets select Amazon, or remove amazon from
                    // the drop down based on env.ionic.divisionName
                    if (env.ionic.divisionName == 'amazon') {
                        // Its Amazon, select Amazon and GO
                        vm.selectedDivision = 'amazon';
                        vm.setDivision();
                    } else {
                        // Not Amazon, remove Amazon from the list.
                        var exclusions = [206]; // add any divisions that have their own app to this array.
                        angular.forEach(vm.divisions, function (value, key) {
                            if (exclusions.indexOf(parseInt(value.DivisionID)) != -1) {
                                var index = vm.divisions.indexOf(value);
                                if (index > -1) {
                                    vm.divisions.splice(index, 1);
                                }
                            }
                        })
                    }
                }


                vm.selectedDivision = vm.divisions[0].Alias;
                vm.isDivisionLoaded = true;
            }
        }

        function activate() {
            if (env.isIonic && env.isIonicDevice && env.ionic.divisionName == 'amazon') {
                // Its Amazon, select Amazon and GO
                vm.selectedDivision = 'amazon';
                vm.setDivision();
            }
            GeoLocationService.getCurrentPosition().then(function (position) {
                var latitude = position.coords.latitude
                var longitude = position.coords.longitude
                DivisionService.getDivisionsByLocation(latitude, longitude).then(populateDivisions, function (error) {
                    vm.isDivisionLoaded = true;
                    vm.showDivisionDropdown = false;
                });
            });
            CommonService.GetStatesWithDivisions().then(
                function (result) {
                    vm.states = result;
                    vm.states.splice(0, 0, noState);
                    vm.selectedState = vm.states[0].Id;
                },
                function (err) {
                    UtilityFactory.toastError('', "Could not load states list. Please try again later.")
                });
            //DivisionService.getDivisions()
            //    .then(populateDivisions, function (error) {
            //        vm.isDivisionLoaded = true;
            //        vm.showDivisionDropdown = false;
            //    })
        };

        $scope.reloadPage = function () { $window.location.reload(); };

        function setDivision() {
            if (vm.selectedDivision != noDivision.Alias) {
                var alias = vm.selectedDivision;
                $location.path('dashboard/' + alias);
            }
        }
        function fetchDivisionsForSelectedState() {
            if (vm.selectedState != noState.Id) {
                vm.divisions = [];
                vm.divisions.splice(0, 0, noDivision);
                DivisionService.getDivisionByState(vm.selectedState)
                    .then(populateDivisions, function (error) {
                        vm.isDivisionLoaded = true;
                        vm.showDivisionDropdown = false;
                    });
            }
        }
        // Start of code for Ionic
        if (env.isIonic) {
            vm.env = env.ionic.env;
        } else {
            vm.env = '';
        }
        vm.refresh = function (refresher) {
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
        }
        // End of code for Ionic

    }
    
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LogoutController', LogoutController);

    LogoutController.$inject = ['$location', '$rootScope', 'authService'];

    function LogoutController($location, $rootScope,authService) {
           var vm = this;
           authService.logOut().then(function () {
               $rootScope.$broadcast('loggedout', null);
               $location.path('dashboard/');
           }, function () {
               console.log('Unable to sign-out user.');
           })
           
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MinAppSupportController', MinAppSupportController);

    MinAppSupportController.$inject = ['$rootScope', '$location', 'DynamicContentService', 'PageService', 'DivisionService'];

    function MinAppSupportController($rootScope, $location, DynamicContentService, PageService, DivisionService) {
        debugger;
        var vm = this;
        vm.PageService = PageService;
        var _error = 'This version is no longer supported. Please download the latest version from app store';
        vm.PageService.setTitle('App Error');
        vm.PageService.setHeadline('This version is no longer supported');

        function activate() {
            if (DivisionService.getDivisionId())
                DivisionService
                     .getDivisionInfo()
                 .then(handleSuccess, handleFailure);
            else
                handleFailure();
        }

        function handleSuccess(response) {
            if (response.data.status === 1) {
                var division = response.data.result;
                vm.ErrorMessage = division.MinAppError
            }
        }

        function handleFailure() {
            vm.ErrorMessage = _error;
        }

        activate();

        // Start of code for Ionic
        //vm.ionicInclude = 'app/shared/whats-new/whats-new.html';
        //vm.ionicCustomClassName = 'ionic-whats-new card';
        //vm.ionicHideNavBar = false;
        //vm.ionicUseRefresher = true;
        //vm.ionicPullingText = 'Refresh';
        //vm.ionicRefreshingText = 'Loading';
        //vm.ionicSpinner = 'spiral'; // none to disable.
        //vm.refresh = function (refresher) {
        //    getData();
        //    $rootScope.$broadcast('scroll.refreshComplete');

        //}
        // End of code for Ionic
    }
})();

(function () {
    angular.module('oneMVApp').controller('nav', nav);


    nav.$inject = [ '$scope', '$location', '$rootScope', '$uibModal', '$timeout', '$interval',
                    'authService', 'ScheduleService', 'DivisionService','OneMvServices'];

    function nav($scope,$location, $rootScope, $uibModal, $timeout, $interval,
                    authService, ScheduleService, DivisionService,OneMvServices) {

        $scope.title = 'MOBI';
        $scope.hasActiveTrip = false;
        var autoRefresh = undefined;
        var modalVehicleArriving = false;
        var modalVehicleArrived = false;
        $scope.parentState = undefined;
        var allowedServices =  DivisionService.getAllowedServices();       

        var menus = [
            {
                "name": "commuter",
                "service": "commuter",
                "url": "commuter/home-commuter",
                "order": 6,
                "class": "link--commuter",
                "level": 1,
                "isServiceMenu" :true,
                "subPages": [
                  {
                      "name": "Advanced Reservations",
                      "url": "commuter/adv-schedule-setup",
                      "service": "commuter",
                      "showOffline": false,
                      "order": 7
                  },
                  {
                      "name": "Bus Stops",
                      "url": "commuter/all-stops",
                      "service": "commuter",
                      "order": 8
                  },
                  {
                      "name": "Published Schedule",
                      "url": "commuter/published-schedule",
                      "service": "commuter",
                      "order": 9
                  },
                ]
            },
          {
              "name": "drt",
              "isServiceMenu" :true,
              "order": 10,
              "url": "on-demand/reservations",
              "service": "drt",
              "class": "link--demand",
              "showOffline": false,
              "level": 1,
              "subPages": [
                {
                    "name": "Active Trip",
                    "url": "on-demand/active-trip",
                    "service": "drt",
                    "showOffline": false,
                    "showActive": false,
                    "order": 11
                }
              ]

          },
          {
              "name": "fixed",
              "isServiceMenu" :true,
              "url": "fixed-route/landing",
              "service": "fixed",
              "class": "link--fixed",
              "order": 12,
              "level": 1,
              subPages: [
                {
                    "name": "Routes",
                    "url": "fixed-route/allRoutes",
                    "service": "fixed",
                    "order": 13
                },
                {
                    "name": "Stops",
                    "url": "fixed-route/stops",
                    "service": "fixed",
                    "order": 14
                },
                {
                    "name": "Schedule",
                    "url": "fixed-route/schedule",
                    "service": "fixed",
                    "order": 15
                },
                {
                    "name": "Published Schedule",
                    "url": "http://thebus.mobi/content/documents/amz-published-schedule.pdf",
                    "service": "fixed",
                    "isExternal": true,
                    "order": 16
                }
              ]
          },
          {
              "name": "My Trips",
              "url": "passenger-trips",
              "service": "drt,commuter",
              "class": "link--trips",
              "order": 17,
              "showOffline": false,
              "level": 1           
          },

          //shared Pages
          {
              "name": "User Profile",
              "id": "menuProfile",
              "url": "shared/profile",
              "service": "commuter,fr,drt",
              "showOffline": false,
              "isProfileMenu": true,
              "order": 20,
              "level": 2
          },
          {
              "name": "Change Password",
              "id": "changePassword",
              "url": "change-password",
              "service": "commuter,fr,drt",
              "showOffline": false,
              "isOneMV": true,
              "order": 21,
              "level": 2
          },
          {
              "name": "Manage Vehicles",
              "url": "commuter/my-vehicles",
              "service": "commuter",
              "showOffline": false,
              "order": 22,
              "level": 2
          },
          {
              "name": "What's New",
              "url": "news",
              "service": "commuter,fr,drt",
              "order": 23,
              "level": 2
          },
          {
              "name": "Policies",
              "url": "commuter/policy",
              "service": "commuter",
              "order": 24,
              "level": 2
          },
          {
              "name": "Support",
              "url": "support",
              "service": "commuter",
              "order": 25,
              "level": 2
          },
          {
              "name": "Notifications",
              "url": "notifications",
              "service": "commuter,fr,drt",
              "order": 26,
              "level": 2
          },
          {
              "name": "Settings",
              "url": "settings",
              "service": "commuter,drt,fr",
              "showOffline": false,
              "order": 27,
              "level": 2
          },
          {
              "name": "Sign in",
              "url": "login",
              "service": "commuter,drt",
              "order": 28,
              "showOffline": true,
              "level": 2
          },
          {
              "name": "Sign out",
              "url": "logout",
              "service": "commuter,drt",
              "order": 29,
              "showOffline": false,
              "level": 2
          }

        ];

        $scope.pagelink = function (url, app, showAsModal, event, isExternal) {
            if (app != null) {
                $scope.ionicToggleMenu()
            }            

            //if we have multiple modals needed on menu clicks tomorrow, we need to pass controller and markup as menu properties.
            if (showAsModal) {
                showNotificationModal();
            } else if (!angular.isUndefined(isExternal) && isExternal) {
                window.open(url, '_system', '');
            } else {
                if (url)
                    $location.path(url);
                else $location.path('#');
            }
        }

        function showNotificationModal() {

            $uibModal.open({
                animation: true,
                templateUrl: 'app/shared/notification/notification.html',
                controller: 'NotificationController as vm',
                size: ''
            });
        }


        // returns true if the current router url matches the passed in url
        // so views can set 'active' on links easily
        $scope.isActive = function (name) {
            return isCommuterLink(name) || isMyTripsLink(name) || isDrtLink(name) || isFixedRouteLink(name);            
        };

        function isMyTripsLink(name){
            return name == 'My Trips' 
                    && ($location.path() == '/passenger-trips');
        }    

        function isDrtLink(name){
            return $location.path().indexOf('on-demand') > -1 && name === 'drt';
        }

        function isCommuterLink(name){
            return $location.path().indexOf('commuter') > -1 && name === 'commuter';
        }

        function isFixedRouteLink(name){
            return $location.path().indexOf('fixed-route') > -1 && name === 'fixed';
        }


        $scope.closeDropDown = function () {
            $scope.isopen = false;
        };

        $scope.goBack = function (event) {
            angular.element('#page-wrapper').addClass('back');
            $timeout(function () {
                angular.element('#page-wrapper').removeClass('back');
            }, 1000);
            window.history.back();
        };
       
        function onlineMenus(menu) {
            var result = angular.isUndefined(menu.showOffline) || !menu.showOffline;
            if (result && menu.isProfileMenu) {
                // show profile menu only if dropoff Home location only is true
                // note: remove this limitation when non home location items are added to Profile
                var param = DivisionService.getSystemParameters();
                result = param.DropoffHomeLocationOnly;
            }
            if (result && menu.isOneMV) {
                result = authService.authentication.loginProvider === "MvLogin";
            }
            return result;
        };


        function offlineMenus(menu) {
            return angular.isUndefined(menu.showOffline) || menu.showOffline;
        };

        function allowedForDivision(menu) {            
            if (allowedServices) {
                var menuServices = menu.service.split(',');

                for (var i = 0; i < menuServices.length; i++) {
                    for(var j = 0;j<allowedServices.length;j++){
                        if(allowedServices[j].name.toLowerCase() == menuServices[i].toLowerCase())
                        return true;
                    }                        
                }
                return false;
            }

            return false;
        }

        function sortByOrder(a, b) {
            return a.order > b.order;
        };

        function copy(o) {
            return Object.assign({}, o)
        };

        function toggleMenu() {
            var loginPredicate = authService.isLoggedIn() ? onlineMenus : offlineMenus;
            var divisionPredicate = allowedForDivision;

            var processedMenus = menus
              .map(copy)
              .filter(divisionPredicate)
              .filter(loginPredicate)
              .sort(sortByOrder);

            for (var i = 0; i < processedMenus.length; i++) {
                if (processedMenus[i].subPages)
                    processedMenus[i].subPages = processedMenus[i]
                    .subPages
                    .map(copy)
                    .filter(divisionPredicate)
                    .filter(loginPredicate)
                    .sort(sortByOrder);
            }

            $scope.pages = setPages(processedMenus);            
        }


        function setPages(pages) {

            if (!pages) return undefined;

            var menus = [];
            
            for (var i = 0; i < pages.length; i++) {
                var page = {
                    'alias': getMenuName(pages[i]),
                    'name' : pages[i].name,
                    'order': pages[i].order,
                    'service': pages[i].service,
                    'showAsModal': pages[i].showAsModal,
                    'class': pages[i].class,
                    'showActive': pages[i].showActive,
                    'level': pages[i].level
                };
                if (pages[i].url)
                    page.url = pages[i].url;
                if (pages[i].subPages)
                    page.subPages = setPages(pages[i].subPages);
                page.isExternal = pages[i].isExternal;
                menus.push(page);
            }
            return menus;
        }

        function getMenuName(menu){

            if(!menu.isServiceMenu) return menu.name;

            for(var i = 0;i <allowedServices.length;i++){
                if(menu.service.toLowerCase().includes(allowedServices[i].name.toLowerCase()))
                    return allowedServices[i].alias;
            }    
            return undefined;
        }

        function setActiveTripMenuItem(flag) {
            outer: for (var m in $scope.pages) {
                if ($scope.pages[m].name == "drt") {
                    inner: for (var subM in $scope.pages[m].subPages) {
                        if ($scope.pages[m].subPages[subM].name == "Active Trip") {
                            $scope.pages[m].subPages[subM].showActive = flag;
                            break outer;
                        }
                    }
                }
            }
        }

        function CheckVehicleStatusForTrip(passengerId) {
            if (!angular.isUndefined(OneMvServices.getDrtInfo()) && authService.isLoggedIn()) {
                var divisionId = '';
                ScheduleService.getlastripdetails(passengerId, divisionId).then(function (response) {
                    if (response.data.status === 1 && response.data.result) {
                        setActiveTripMenuItem(true);

                    } else {
                        setActiveTripMenuItem(false);
                    }
                    if (response.data.status == 1) {
                        var currentTripDetails = response.data.result;



                        if (!modalVehicleArriving && currentTripDetails.TripID != null && currentTripDetails.PickUpGeofenceTime != null && currentTripDetails.StartTime == null && currentTripDetails.OriginDepartTime == null) {
                            event.preventDefault();
                            $scope.modelinstance = $uibModal.open({
                                template: '<div class="modal__header" >' +
                                  '<h4 class="modal-title">Info</h4>' +
                                  ' </div>' +
                                  '<div class="modal__-body">' +
                                  '<p>Your vehicle will be arriving soon</p>' +
                                  '</div>' +
                                  '<div class="modal__footer">' +
                                  '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                                scope: $scope,
                                replace: true,
                                backdrop: 'static',
                                keyboard: false
                            });
                            modalVehicleArriving = true;
                        } else if (!modalVehicleArrived && currentTripDetails.TripID != null && currentTripDetails.StartTime != null && currentTripDetails.OriginDepartTime == null) {
                            if (modalVehicleArriving) {
                                modalVehicleArriving = false;
                                $scope.close();
                            };
                            event.preventDefault();
                            $scope.modelinstance = $uibModal.open({
                                template: '<div class="modal-header" >' +
                                  '<h3 class="modal-title">Info</h3>' +
                                  ' </div>' +
                                  '<div class="modal-body">' +
                                  '<p>Your vehicle has just arrived</p>' +
                                  '</div>' +
                                  '<div class="modal-footer">' +
                                  '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                                scope: $scope,
                                replace: true,
                                backdrop: 'static',
                                keyboard: false
                            });
                            modalVehicleArrived = true;
                            stopAutoRefresh();
                        }
                    }
                }, function (err) {
                    console.log('CheckVehicleStatusForTrip', err);
                });
            }


        };

        $scope.close = function () {
            $scope.modelinstance.close();
            modalVehicleArrived = false;
            modalVehicleArriving = false;

        }

        function refresh() {
            $scope.pages = [];
            allowedServices =  DivisionService.getAllowedServices();
            toggleMenu();

            if (angular.isUndefined(autoRefresh) && !$rootScope.navAutoRefreshIsRunning) {
                autoRefresh = $interval(function () {
                    CheckVehicleStatusForTrip(authService.authentication.passengerId);
                }, 15000);
                $rootScope.navAutoRefreshIsRunning = !angular.isUndefined(autoRefresh);
            };
        };

        $scope.$on('$destroy', function (event) {
            stopAutoRefresh()
        });

        function stopAutoRefresh() {
            if (angular.isDefined(autoRefresh)) {

                $interval.cancel(autoRefresh);
                autoRefresh = undefined;
                $rootScope.navAutoRefreshIsRunning = false;
            };
        };

        $scope.$on('loggedIn', function () {
            refresh();
        });
        $scope.$on('loggedout', function () {
            refresh();
            stopAutoRefresh();
        });
      
        $scope.$on('divisionChanged', function () {
            refresh();
        });

        // show active trip menu item only if user has an active trip
        $scope.$on('hasActiveTripChanged', function (event, hasActiveTrip) {
            if ($scope.hasActiveTrip != hasActiveTrip) {
                $scope.hasActiveTrip = hasActiveTrip;
                setActiveTripMenuItem(hasActiveTrip);
                refresh();
            }
        });       

        refresh();



        $scope.toggleGroupIonic = function (group, isParent) {
            if (!$scope.isGroupShownIonic(group)) {
                $scope.shownGroupIonic = group;
            } else if (isParent) {
                $scope.shownGroupIonic = null;
            }
        };
        $scope.wipeLocalStorageInfo = function () {
            console.log('go 1');
            $rootScope.$broadcast('ionicShowSplashScreen');
            $scope.ionicToggleMenu();
            var ionicCHCPOn = window.localStorage['ionicCHCPOn'] ? window.localStorage['ionicCHCPOn'] : 'true';
            var localEnv = window.localStorage['env'] ? window.localStorage['env'] : '-dev';
            window.localStorage.clear();
            window.localStorage['ionicCHCPOn'] = ionicCHCPOn;
            window.localStorage['env'] = localEnv;
            window.location.replace('#/nav/division');
            $timeout(function () {
                window.location.reload(true);
            }, 500)
        };
        $scope.isGroupShownIonic = function (group) {
            return $scope.shownGroupIonic === group;
        };

        $scope.ionicToggleMenu = function () {
            $rootScope.$broadcast('ionicToggleLeftMenu');
        };

    }

})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('NotificationController', NotificationController);

    NotificationController.$inject = ['$uibModal','NotificationService', 'PageService', 'authService','OneMvServices'];

    function NotificationController($uibModal, NotificationService, PageService, authService, OneMvServices) {

        var vm = this;
        vm.title = 'Notifications';
        vm.PageService = PageService;
        vm.PageService.setTitle('Notifications');
        vm.PageService.setHeadline('Service updates');
        vm.commuterAlerts = [];
        vm.frNotifications = [];

        vm.isFrNotificationLoading = true;
        vm.isCommuterAlertLoading = false;
        vm.isCommuterNotificationLoading = false;
        vm.isDRTNotificationLoading = false;           
        vm.hasCommuter = false;
        vm.hasFixedRoute = false;
        vm.hasDRT = false;

        vm.commuterInfo = OneMvServices.getCommuterInfo();
        vm.fixedRouteInfo = OneMvServices.getFixedRouteInfo();
        vm.drtInfo = OneMvServices.getDrtInfo();

        vm.cancel = function () {
          //  $uibModalInstance.dismiss('cancel');
        };

        activate();

        vm.showTripInfo = showTripInfo;


        function showTripInfo(notification) {
            showCommuterTripInfo(notification.LinkedId);
        }

        function showCommuterTripInfo(tripId) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: 'static',
                keyboard: false,
                resolve: {
                    tripId: tripId
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getCommuterNotifications();
                }
            });

        }

        function activate() {

        vm.isloggedIn = authService.isLoggedIn();
        
            if(!angular.isUndefined(vm.commuterInfo)){
                vm.hasCommuter = true;
                getCommuterNotifications();
            }
            if(!angular.isUndefined(vm.fixedRouteInfo)){
                vm.hasFixedRoute = true;
                getFixedRouteNotifications();
            }
            if(!angular.isUndefined(vm.drtInfo)){
                vm.hasDRT = true;
                getDRTNotifications();
            }
        }
        
        function getFixedRouteNotifications() {
            vm.isFrNotificationLoading = true;
            NotificationService
                .getFixedRouteNotification()
            .then(function (response) {
                vm.frNotifications = response.data.notifications;
                angular.forEach(vm.frNotifications, function (notification) {
                    notification.Title = notification.linkTitle;
                    notification.Message = notification.text;
                });
                vm.isFrNotificationLoading = false;
            }, function (error) {
                vm.isFrNotificationLoading = false;
            });
        }

        function getCommuterNotifications() {
            vm.isCommuterNotificationLoading = true;
            NotificationService
                .getCommuterNotifications()
             .then(function (response) {
                 vm.CommuterNotifications = response.data.result;
                 vm.isCommuterNotificationLoading = false;
             }, function (error) {
                 vm.isCommuterNotificationLoading = false;
             });
        };

        function getDRTNotifications() {
            vm.isDRTNotificationLoading = true;
            NotificationService
                .getDRTNotifications()
             .then(function (response) {
                 vm.DRTNotifications = response.data.result;
                 vm.isDRTNotificationLoading = false;
             }, function (error) {
                 vm.isDRTNotificationLoading = false;
             });
        };

    }
})();

(function () {
	"use strict";

	angular
        .module("oneMVApp")
        .directive("notificationItem", notificationItem);

	function notificationItem() {
		return {
			restrict: "E",
			scope: {
				data: "="
			},
			templateUrl: "app/modules/shared/notification/notification-item.component.html"
		};

	}
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('NotificationService', NotificationService);

    NotificationService.$inject = ['$http', '$q', 'env', 'authService', 'DivisionService'];

    function NotificationService($http, $q, env, authService, DivisionService) {

        var service = {
            getServiceAlerts: getServiceAlerts,
            getFixedRouteNotification: getFixedRouteNotification,
            getCommuterNotifications: getCommuterNotifications,
            getDRTNotifications: getDRTNotifications
        };
        return service;

        function getServiceAlerts() {
            var deferred = $q.defer();

            var route = authService.isLoggedIn() ? '/serviceAlertsForUser/' + authService.authentication.userId : '/serviceAlerts';

            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + route + "?rnd=" + Date.parse(new Date());
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        };
       
        function getFixedRouteNotification() {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + "notifications/" + DivisionService.getDivisionId()
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function getCommuterNotifications() {
            var deferred = $q.defer();
            var passengerId = authService.isLoggedIn() ? authService.authentication.passengerId : 0;
            var url = passengerId == 0
                ? env.oneMVApiUrl + "notifications/commuter/" + DivisionService.getDivisionId()
                : env.oneMVApiUrl + "notifications/commuter/" + DivisionService.getDivisionId() + '/' + passengerId;
            $http({
                method: 'GET',
                'url': url
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function getDRTNotifications() {
            var deferred = $q.defer();
            if (!authService.isLoggedIn())
                deferred.reject();
            else {
                var passengerId = authService.authentication.passengerId;
                var url = env.oneMVApiUrl + "notifications/DRT/" + DivisionService.getDivisionId() + '/' + passengerId;
                $http({
                    method: 'GET',
                    'url': url
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject();
                });
            }
            return deferred.promise;
           
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ChangePasswordController', ChangePasswordController);

    ChangePasswordController.$inject = ['$location',
        'authService', 'env', 'MessageService', 'DivisionService', 'PageService', 'PasswordService'];

    function ChangePasswordController($location,
                            authService, env, MessageService, DivisionService, PageService, PasswordService) {
        var vm = this;
        vm.changePassword = changePassword;
        vm.cancel = cancel;
        vm.divisionId = DivisionService.getDivisionId();
        vm.PageService = PageService;
        vm.PageService.setTitle('Change Password');
        vm.PageService.setHeadline('Update your password');
        function cancel() {
            $location.path('dashboard/');
        }
        function changePassword() {
            if (vm.newPassword !== vm.newPasswordRetype) {
                MessageService.showError("New Password and Retype Password do not match");
                vm.isClicked = !vm.isClicked;
                return;
            }
                //call one mv login
            var request = {
                UserName: vm.username,
                OldPassword: vm.oldPassword,
                NewPassword: vm.newPassword,
                DivisionId: vm.divisionId,
                PassengerId: authService.authentication.passengerId,
                Provider: 'MvLogin'
            }
            //will call a service
            PasswordService.ChangePassword(request).then(function (response) {
                vm.isClicked = !vm.isClicked
                if (response.data && response.data.result) {
                    if (response.data.result.ChangeStatus) {
                        MessageService.showSuccess("Password Changed successfully");
                        vm.oldPassword = "";
                        vm.newPassword = "";
                        vm.newPasswordRetype = "";
                    } else {
                        MessageService.showError(response.data.result.ChangeStatusDescription);
                    }
                }
            }, function errorCallback(error) {
                //call message service
                vm.isClicked = !vm.isClicked
                if (error)
                    MessageService.showError(error.Message);
            });
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/profile/change-password.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

        function activate() {

        }

    }
})();
(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .directive('homeAddressDirective', homeAddressDirective);

	homeAddressDirective.$inject = ['$window', 'DivisionService', 'LocationFactory', 'authService', 'ProfileService', 'CommonService', 'UtilityFactory', '$uibModalStack'];

	function homeAddressDirective($window, DivisionService, LocationFactory, authService, ProfileService, CommonService, UtilityFactory, $uibModalStack) {
		return {
			controller: homeAddressController,
			replace: true,
			restrict: 'E',
			scope: {
				HomeAddress: '=?data',
				invalid: '=?invalid'
			},
			templateUrl: 'app/modules/shared/profile/homeAddress.html'
		};
		
		function homeAddressController($scope, $uibModalStack) {
			// initialize bindings
			$scope.hasModalParent = $uibModalStack.getTop() !== undefined;
			$scope.loading = true;
			$scope.invalid = true;
			$scope.hasHomeAddress = false;
			$scope.isContainerManagingData = $scope.HomeAddress !== undefined;
            // If HomeAddress is passed from the caller, use it.
			$scope.HomeAddress = $scope.HomeAddress == null ? {} : $scope.HomeAddress;
			$scope.HomeAddressSearch = {};
			$scope.googleLocations = [];
			$scope.states = [];
			$scope.countries = [{ name: 'United States', code: 'USA' }];

			// initialize globals
			$scope.divisionId = DivisionService.getDivisionId();
			$scope.passengerId = authService.authentication.passengerId;
			$scope.submitted = false;
			$scope.AddEdit = true;
			$scope.zipcode = "";
			$scope.stateabbr = "";
			$scope.isValidZip = false;
			$scope.allowEditHomeAddress = false;
			$scope.showHomeAddress = false;
			$scope.dataServiceTo = LocationFactory.dataServiceTo;

			// populate States list
			CommonService.GetAllStates().then(
				function (result) {
					$scope.states = result;
				},
				function (err) {
					UtilityFactory.toastError('', "Could not load states list. Please try again later.")
				});

			// return user to previous screen
			$scope.Cancel = function () {
				$uibModalStack.dismissAll();
				$window.history.back();
			};

			// user selected a home location
			$scope.SelectedHomeAddress = function (location) {
				// remember suite
				var suite = $scope.HomeAddressSearch.Suite;

				// set home location
				$scope.HomeAddressSearch = angular.copy(location);
				$scope.HomeAddressSearch.Suite = suite;

				// get the state Id
				$scope.HomeAddressSearch.StateId = $scope.states.filter(function (s) { return s.Abbr == location.State })[0].Id;
				$scope.HomeAddress = angular.copy($scope.HomeAddressSearch);

				// click the list radio button for this address
				$scope.HomeAddressGooglePlaceId = location.GooglePlaceId;

				$scope.invalid = false;
			}

			// search for home locations based on user input to search fields
			$scope.GoogleSearch = function () {
				$scope.invalid = true;
				$scope.googleLocations = [];
				UtilityFactory.toastInfo("Home Address - Search", "Searching for matching addresses. Please wait.");
				var state = $scope.states.filter(function (s) { return s.Id == $scope.HomeAddressSearch.StateId; })[0];
				var searchString = ($scope.HomeAddressSearch.Address || "") + ', ' + ($scope.HomeAddressSearch.City || "") + ', ' + ((state && state.Abbr) || "") + ', ' + ($scope.HomeAddressSearch.Zip || "");
				LocationFactory.getLocations(searchString, true, $scope.divisionId, $scope.passengerId, true).then(function (locations) {
					// convert Google location search to OneMV Location object
					for (var l = 0; l < locations.data.length; l++) {
						var address = locations.data[l].loc;
						var location = {};
						var add = "", streetNumber = "", streetName = "";
						for (var i in address.address_components) {
							var addressComponent = address.address_components[i];
							if (addressComponent.types[0] == "street_number") {
								streetNumber = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "route") {
								streetName = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "locality") {
								location.City = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "administrative_area_level_1") {
								location.State = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "postal_code") {
								location.Zip = addressComponent.short_name;
							}
							else {
								//do nothing
								var t = addressComponent;
							}
						}
						location.Address = streetNumber + ' ' + streetName
						location.Name = address.formatted_address;
						location.Latitude = address.geometry.location.lat;
						location.Longitude = address.geometry.location.lng;
						location.GooglePlaceId = address.place_id;

						$scope.googleLocations.push(location);
					}

					if ($scope.googleLocations.length == 0) {
						AddressNotFound();
					} else {
						$scope.hasHomeAddress = true; //assume user will choose a home address
					}
				}, function (err) {
					AddressNotFound();
				});
			};

			// user message if no addresses are found
			function AddressNotFound() {
				UtilityFactory.toastError('Find Home Address', "Home location not found. Please change address and try again.")
			}

			// update home address
			$scope.UpdateHomeAddress = function () {
				ProfileService.UpdateHomeAddress($scope.passengerId, $scope.HomeAddress)
					.then(
					function (response) {
						var message = response.data.result;
						if (response.data.status == 1) {
							$scope.submitted = true;
							UtilityFactory.toastSuccess('Success', message);
							setTimeout(function () {
								if ($scope.hasModalParent) {
									$uibModalStack.dismissAll();
								} else {
									$window.history.back();
								}
							}, 0);
						} else {
							UtilityFactory.toastError('Error', message);
						}
					},
					function (err) {
						var message = err.data.Result;
						UtilityFactory.toastError('Error', message);
					});
			};

			var activate = function () {
				// determine if home location should be displayed
			    $scope.showHomeAddress = ProfileService.ShowHomeAddress();
			    if ($scope.showHomeAddress) {
					// determine if passenger may edit home location
					$scope.allowEditHomeAddress = ProfileService.AllowEditHomeAddress();
				}

			    // read current passenger home address if not in the Profile page
				if (!$scope.isContainerManagingData) {
				    ProfileService.GetHomeAddress($scope.passengerId)
					.then(function (response) {
					    $scope.HomeAddress = response == null ? {} : response;
					    $scope.invalid = false;
					},
					function (err) {
					    $scope.error = err.error_description;
					});
				} 
			};

			// update the Suite separately
			$scope.isUpdatingSuite = false;
			$scope.$watch(
			"HomeAddressSearch.Suite",
			function () {
				$scope.isUpdatingSuite = true;
				$scope.HomeAddress.Suite = $scope.HomeAddressSearch.Suite;
			}, true);

			// HomeAddress is loaded either from the containing page, or from this control
			$scope.$watch(
			"HomeAddress", 
            
			function (source, data) {
			    if ($scope.isUpdatingSuite == true) {
			        $scope.isUpdatingSuite = false;
			    }
			    $scope.hasHomeAddress = false;
			    $scope.HomeAddressSearch = {};
			    if ($scope.HomeAddress) {
			        $scope.hasHomeAddress = $scope.HomeAddress.GooglePlaceId;
			        $scope.HomeAddressSearch = angular.copy($scope.HomeAddress);
			        if ($scope.HomeAddress && $scope.HomeAddress.GooglePlaceId) {
			            // initialize globals
			            $scope.googleLocations = [];

			            // load and select the current home address, if any
			            if ($scope.HomeAddress && $scope.HomeAddress.GooglePlaceId && $scope.HomeAddress.GooglePlaceId != "") {
			                $scope.googleLocations.push($scope.HomeAddress);
			                $scope.invalid = false;
			            }

			            $scope.loading = false;
			        }
			    }
				
			}, true);

			
		    //
		    // $onInit does not work in Ionic world.
		    // must execute activate() otherwise, add function to $onInit.
		    //
			if ($('body').hasClass('is-ionic')) {
			    $(document).ready(function () {
			        activate();
			    })
			} else {
			    this.$onInit = activate;
			}
		}
	}
})();

(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .controller('ProfileController', ProfileController);

	ProfileController.$inject = ['$scope', '$rootScope', '$location', '$window', 'DivisionService', 'LocationFactory', 'authService', 'ProfileService', 'CommonService', 'UtilityFactory', 'LocationService', 'MessageService', 'RedirectionService','PageService'];

	function ProfileController($scope, $rootScope, $location, $window, DivisionService, LocationFactory, authService, ProfileService, CommonService, UtilityFactory, LocationService, MessageService, RedirectionService, PageService) {
		// initialize globals
		var vm = this;
		vm.PageService = PageService;
        vm.PageService.setTitle('Profile');
        vm.PageService.setHeadline('Latest Service Updates');
		vm.loading = true;
		vm.invalid = true;
		vm.passenger = {};
		vm.passenger.HomeAddress = {};
		vm.passengerId = authService.authentication.passengerId;
		vm.divisionId = DivisionService.getDivisionId();
		vm.submitted = false;

		// update profile
		vm.Cancel = function () {
			$window.history.back();
		};

		vm.UpdateProfile = function () {
			// update home address
			ProfileService.UpdateProfile(vm.passenger)
                .then(
                function (response) {
                	var message = response.data.result;
                	if (response.data.status == 1) {
                		vm.submitted = true;
                		UtilityFactory.toastSuccess('Success', message);
                		setTimeout(function () {
                			$window.history.back();
                		}, 0);
                	} else {
                		UtilityFactory.toastError('Error', message);
                	}
                },
                function (err) {
                	var message = err.data.Result;
                	UtilityFactory.toastError('Error', message);
                });
		};

		var activate = function () {
			if (!authService.isLoggedIn()) {
				RedirectionService.save('/shared/profile');
				$location.path('login');
			} else {
				vm.showHomeAddress = ProfileService.ShowHomeAddress();
				if (vm.showHomeAddress) {
					// determine if passenger may edit home location
				    vm.allowEditHomeAddress = ProfileService.AllowEditHomeAddress();
				}

				// read current passenger profile info
				ProfileService.GetProfile(vm.passengerId).then(function (response) {
				    vm.passenger = response;
				    vm.loading = false;

				},
				function (err) {
					vm.error = err.error_description;
					vm.loading = false;
				});
			}
		};
	    //
	    // $onInit does not work in Ionic world.
	    // must execute activate() otherwise, add function to $onInit.
	    //
		if ($('body').hasClass('is-ionic')) {
		    $(document).ready(function () {
		        activate();
		    })
		} else {
		    vm.$onInit = activate;
		}

		// Start of code for Ionic
		vm.ionicInclude = 'app/shared/profile/profile.html';
		vm.ionicCustomClassName = 'ionic-profile card';
		vm.ionicHideNavBar = false;
		vm.ionicUseRefresher = false;
		// End of code for Ionic
	}
})();

(function () {
    'use strict';
    angular.module('oneMVApp')
        .controller('DisplayPushMessageController', DisplayPushMessageController);

    DisplayPushMessageController.$inject = ['$uibModalInstance','messageTitle','messageBody','messageType'];

    function DisplayPushMessageController($uibModalInstance, messageTitle, messageBody, messageType) {
        var vm = this;
        vm.messageType = messageType;
        vm.messageTitle = messageTitle;
        vm.messageBody = messageBody;
        console.log('modal', vm);
        vm.close = function () {
            $uibModalInstance.close({ 'result': 'ok' });
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ExternalRegistrationController', ExternalRegistrationController);

    ExternalRegistrationController.$inject = ['$location', '$timeout', '$rootScope', 'vcRecaptchaService',
        'authService', 'VerificationService', 'env', 'DivisionService', 'ConfigFactory', 'RedirectionService', 'PageService'];

    function ExternalRegistrationController($location, $timeout, $rootScope, vcRecaptchaService, authService,
        VerificationService, env, DivisionService, ConfigFactory, RedirectionService, PageService) {

        var vm = this;

        var widgetId = -1;
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;

        vm.isClicked = false;
        vm.savedSuccessfully = false;

        vm.organisationIdLabel = '';
        vm.showOrganisationId = false;
        vm.showAllowSms = false;
        vm.showFirstName = false;
        vm.showLastName = false;
        vm.showClientTelephone = false;
        vm.allowSms = false;
        vm.telNum = '';
        vm.clientPassengerId = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('New Account');
        vm.PageService.setHeadline('Create a ONEMV Login');

        var feedType = '';
        var registrationFailedMsg = "Failed to register. Please try again later.";

        function setCaptchaResponse(response) {
            authService.verifyCaptcha(response).then(function (result) {
                if (!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
                });
        }

        function widgetCreate(_widgetId) {
            widgetId = _widgetId;
        }

        var activate = function () {
            var divisionId = DivisionService.getDivisionId();

            DivisionService.getDivisionInfo()
                   .then(function (response) {
                       feedType = response.data.result.DivisionFeedType.FeedType;
                   });

            vm.registerData = {
                userName: authService.externalAuthData.userName,
                provider: authService.externalAuthData.provider,
                externalAccessToken: authService.externalAuthData.externalAccessToken,                
                divisionId: divisionId,
                firstName: authService.externalAuthData.firstName,
                lastName: authService.externalAuthData.lastName
            };

            vm.firstName = vm.registerData.firstName;
            vm.lastName = vm.registerData.lastName;
            vm.provider = vm.registerData.provider;

            vm.PageService.setHeadline(vm.provider +' Sign Up');

            ConfigFactory
                .getDivisionParameters(divisionId)
                .then(function (params) {
                    if (params) {
                        vm.organisationIdLabel = params.OrganisationIdLabel ? params.OrganisationIdLabel : 'Client Passenger Id';
                        vm.showOrganisationId = params.ShowOrganisationId ? eval(params.ShowOrganisationId.toLowerCase()): false;
                        vm.showAllowSms = params.ShowAllowSms ? eval(params.ShowAllowSms.toLowerCase()): false;
                        vm.showFirstName = params.ShowFirstName ? eval(params.ShowFirstName.toLowerCase()) : false;
                        vm.showLastName = params.ShowLastName ? eval(params.ShowLastName.toLowerCase()) : true;
                        vm.showClientTelephone = params.ShowClientTelephone ? eval(params.ShowClientTelephone.toLowerCase()) : false;
                }
            });

        };

        activate();

        vm.cancel = function () {
            RedirectionService.redirectTo('dashboard/');
        }

        vm.registerExternal = function () {

            vm.message = '';
            vm.isClicked = true;            

            VerificationService
               .passengerExists(vm.clientPassengerId)
               .then(function (response) {

                   if (response.data.status != 1) {
                       vm.message = registrationFailedMsg;
                       vm.isClicked = false;
                       return;
                   }

                   if (feedType == 'FeedOnly' && !response.data.result) {
                       //can't register as passenger not found for division that is feed only/
                       vm.message = "Passenger not found.";
                       vm.isClicked = false;
                       return;
                   }

                   register(response.data.result);
               });
        };


        function register(divisionSupportsFeed) {

            var mobileNo = vm.telNum;
            if (mobileNo && mobileNo != '')
                mobileNo = "+1" + mobileNo;
          
            vm.registerData.telephoneNumber = mobileNo;
            vm.registerData.allowSms = vm.allowSms;
            vm.registerData.divisionSupportsFeed = divisionSupportsFeed;
            vm.registerData.clientPassengerId = vm.clientPassengerId;
            vm.registerData.firstName = vm.firstName;
            vm.registerData.lastName = vm.lastName;

            authService.registerExternal(vm.registerData).then(function (response) {
                vm.savedSuccessfully = true;
                startTimer();
            }, function (error) {
                vm.message = error.Message;
                vm.isClicked = false;
                vcRecaptchaService.reload(widgetId);
            });
        }



        var startTimer = function () {
            var timer = $timeout(function () {
                $timeout.cancel(timer);
                $rootScope.$broadcast('loggedIn', null);
                RedirectionService.redirect();
            }, 2000);
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/registration/external-registration.html';
        //TODO Kevin. Please add correct custom class name.
        vm.ionicCustomClassName = 'ionic-template-external-registration';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('OneMVRegistrationController', OneMVRegistrationController);

    OneMVRegistrationController.$inject = ['$location', '$scope', '$rootScope',
        'authService', 'env', 'MessageService', 'DivisionService', 'ConfigFactory', 'vcRecaptchaService','VerificationService', 'PageService'];

    function OneMVRegistrationController($location, $scope, $rootScope,
                            authService, env, MessageService, DivisionService, ConfigFactory, vcRecaptchaService, VerificationService, PageService) {
        var vm = this;
        vm.cancel = cancel;
        vm.register = register;        
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;
        vm.message = '';        
        vm.organisationIdLabel = '';
        vm.showOrganisationId = false;
        vm.showAllowSms = false;
        vm.showFirstName = false;
        vm.showLastName = false;
        vm.showClientTelephone = false;
        var widgetId = -1;
        var divisionId = -1;
        var feedType = '';
        vm.clientPassengerId = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('New Account');
        vm.PageService.setHeadline('Create a ONEMV Login');


        function cancel(){
            $location.path('dashboard/');
        }
        
        function setCaptchaResponse(response){
            authService.verifyCaptcha(response).then(function (result) {
                if(!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
            });
        }

        function widgetCreate(_widgetId){
            widgetId = _widgetId;
        }

        function register() {
            vm.message = '';
            vm.isClicked = true;
            VerificationService
               .passengerExists(vm.clientPassengerId)
               .then(function (response) {
                   if (response.data.status != 1) {
                       vm.message = "Failed to register. Please try again later.";
                       vm.isClicked = false;
                       return;
                   }

                   if (feedType == 'FeedOnly' && !response.data.result) {
                       //can't register as passenger not found for division that is feed only/
                       vm.message = "Passenger not found."
                       vm.isClicked = false;
                       return;
                   }

                   registerUser(response.data.result);
               });            
        }


        function registerUser(divisionSupportsFeed) {

            var mobileNo = vm.phoneNumber;
            if (mobileNo && mobileNo != '')
                mobileNo = "+1" + mobileNo;

            var registrationObject = {
                TelephoneNumber: mobileNo,
                AllowSMS: vm.sendSMS,
                UserName: vm.email,
                Password: vm.password,
                ConfirmPassword: vm.confirmPassword,
                ClientPassengerId: vm.clientPassengerId,
                DivisionId: divisionId,
                FirstName: vm.firstName,
                LastName: vm.lastName,
                Provider: 'MvLogin',
                DivisionSupportsFeed: divisionSupportsFeed
            };
            authService.registerOneMV(registrationObject).then(function (result) {
                $rootScope.$broadcast('loggedIn', null);
                $location.path('dashboard/');                
            }, function (error) {
                vm.message = error.Message;
                vm.isClicked = false;
                if (widgetId != -1) {
                    vcRecaptchaService.reload(widgetId);
                }                
            });
        }

        function activate() {

            divisionId = DivisionService.getDivisionId();


            DivisionService.getDivisionInfo()
         .then(function (response) {
             feedType = response.data.result.DivisionFeedType.FeedType;
         });


            ConfigFactory.getDivisionParameters(divisionId).then(function (params) {
                vm.organisationIdLabel = params.OrganisationIdLabel ? params.OrganisationIdLabel : 'Passenger Id';
                vm.showOrganisationId = params.ShowOrganisationId ? eval(params.ShowOrganisationId.toLowerCase()) : false;
                vm.showAllowSms = params.ShowAllowSms ? eval(params.ShowAllowSms.toLowerCase()) : false;
                vm.showFirstName = params.ShowFirstName ? eval(params.ShowFirstName.toLowerCase()) : false;
                vm.showLastName = params.ShowLastName ? eval(params.ShowLastName.toLowerCase()) : true;
                vm.showClientTelephone = params.ShowClientTelephone ? eval(params.ShowClientTelephone.toLowerCase()) : false;
            }, function (error) {
                vm.divisionHasFeed = false;
            });
        }

        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/registration/onemv-registration.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic


    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SettingsController', SettingsController);

    SettingsController.$inject = ['$rootScope', 'SettingsService', 'authService', 'UtilityFactory', 'PageService'];

    function SettingsController($rootScope, SettingsService, authService, UtilityFactory, PageService) {
        var vm = this;
        vm.isSettingsLoading = false;
        vm.isSettingsLoaded = false;
        vm.isSettingsUpdating = false;
        vm.settings = null;
        vm.updateSettings = updateSettings;
        vm.PageService = PageService;
        vm.PageService.setTitle('Settings');
        vm.PageService.setHeadline('Manage App Settings');
        
        function activate() {
            getSettings();
        }
        
        function getSettings() {
            vm.isSettingsLoading = true;
            vm.isSettingsLoaded = false;
            SettingsService
               .getSettings(authService.authentication.passengerId)
           .then(function (response) {
               if (response && response.length > 10)
                   response = response.substring((response.length-10));
               vm.clientTelephone = response;
               vm.isSettingsLoading = false;
               vm.isSettingsLoaded = true;
           }, function (error) {
               vm.isSettingsLoading = false;
           });
        }

        function updateSettings() {
            vm.isSettingsUpdating = true;
            var mobileNo = vm.clientTelephone;
            if (mobileNo != "" && !isNaN(mobileNo) && mobileNo > 0) {
                mobileNo = "+1" + mobileNo;
                var settings = {
                    "PassengerId": authService.authentication.passengerId,
                    "ClientTelephone": mobileNo
                }
                SettingsService
                   .updateSettings(settings)
               .then(function (response) {
                   if (response) {
                       UtilityFactory.toastSuccess('Success', 'Settings updates sucessfully');
                   } else {
                       UtilityFactory.toastError('Error', 'Could not update settings');
                   }
                   vm.isSettingsUpdating = false;
                   getSettings();
               }, function (error) {
                   UtilityFactory.toastError('Error', 'Could not update settings');
                   vm.isSettingsUpdating = false;
                   getSettings();
               });
            } else {
                UtilityFactory.toastError('Error', 'Please enter a valid number');
                vm.isSettingsUpdating = false;
            }
        }

        activate();
        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/settings/settings.html';
        vm.ionicCustomClassName = 'ionic-settings';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Settings';
        vm.ionicRefreshingText = 'Loading Settings';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
        }
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('SettingsService', SettingsService);

    SettingsService.$inject = ['$http', '$q', 'env'];

    function SettingsService($http, $q, env) {
        var service = {
            getSettings: getSettings,
            updateSettings: updateSettings
        };

        return service;

        function getSettings(passengerId) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl + "passenger/" + passengerId + '/settings' + "?rnd=" + Date.parse(new Date());
            $http.get(serviceUrl)
            .then(function (response) {
                if (response && response.data && response.data.status == 1)
                    deferred.resolve(response.data.result);
                else
                    deferred.reject(response.data.errors);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }


        
        function updateSettings(settings) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'passenger/settings';
            $http.post(serviceUrl, settings)
            .then(function (response) {
                if (response && response.data && response.data.status == 1)
                    deferred.resolve(response.data.result);
                else
                    deferred.reject(response.data.errors);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SupportController', SupportController);

    SupportController.$inject = ['$rootScope', '$location', 'DynamicContentService', 'PageService'];

    function SupportController($rootScope,$location, DynamicContentService, PageService) {
        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Support');
        vm.PageService.setHeadline('FAQ');
        
        function getData() {
            DynamicContentService.getSupportFAQ().then(function (response) {
                if(response.data.status == 1)
                    vm.data = response.data.result.FAQContent;
            }, function (err) { 
                console.log('something is wrong');
            });
        }

        getData();
        // // Start of code for Ionic
        // vm.ionicInclude = 'app/shared/support/support.html';
        // vm.ionicCustomClassName = 'ionic-support card';
        // vm.ionicHideNavBar = false;
        // vm.ionicUseRefresher = true;
        // vm.ionicPullingText = 'Refresh Support';
        // vm.ionicRefreshingText = 'Loading Support';
        // vm.ionicSpinner = 'spiral'; // none to disable.
        // vm.refresh = function (refresher) {
        //     getData();
        //     $rootScope.$broadcast('scroll.refreshComplete');
        // }
        // // End of code for Ionic
    }
})();

(
    function () {
        'use strict';

        angular.module('oneMVApp')
        .controller('CommuterTripModalController', CommuterTripModalController);

        CommuterTripModalController.$inject = ['$uibModalInstance', '$uibModal', '$rootScope', 'tripId', 'authService',
            'MapService', 'ReservationService', 'MapIconService', 'vehicleService'];

        function CommuterTripModalController($uibModalInstance, $uibModal, $rootScope, tripId, authService,
             MapService, ReservationService, MapIconService, vehicleService) {

            var vm = this;
            var passengerId = authService.authentication.passengerId;
            var isModified = false;
            var markerEvents = [{ event: 'click', callback: iconClickHandler }];
            var noVehicle = { id: null, licenceplate: '--' };

            vm.show = false;
            vm.reservationInfo = {};
            vm.details = true;
            vm.markers = [];
            vm.cancel = cancelCommuterTrip;
            vm.modifyReservation = modifyReservation;            
            vm.close = close;
            vm.loading = true;
            vm.passengerVehicles = [];
            var existingVehicleId = undefined;
            vm.vehicleForReservation = undefined;
            vm.isWaitlisted = true;
            vm.selectedRating = 0;
            vm.canRateTrip = canRateTrip;
            vm.showRatingModal = showRatingModal;



            function showRatingModal() {
                if (!canRateTrip()) {
                    return false;
                }

                var modalInstance = $uibModal.open({
                    templateUrl: 'app/modules/commuter/modals/feedback-modal/commuter-feedback-modal.html',
                    controller: 'CommuterFeedbackModalController as vm',
                    resolve: {
                        feedbackInfo: function () {
                            return {
                                reservationId: vm.reservationInfo.id,
                                rating: vm.selectedRating,
                                comment: ''
                            }
                        }
                    }
                });

                modalInstance.result.then(function (result) {
                    if (!angular.isUndefined(result) && result.isSaved) {
                        getReservation(vm.reservationInfo.id);
                    }

                }, function () {
                    // dismiss
                });
            }

            function initializeMap() {
                vm.map = MapService.initializeMap();
            }

            function activate() {
                getReservation(tripId);
                initializeMap();
            }

            function setMapData() {
                buildQrCode();
                setMarkers();

                vm.loading = false;
            }

            function getReservation(reservationId) {

                ReservationService.getReservationById(passengerId, reservationId)
                .then(function (response) {
                    if (response.data.status === 1) {
                        vm.reservationInfo = response.data.result;
                        setWaitlistedStatus();
                        existingVehicleId = vm.reservationInfo.vehicleId;
                        vm.selectedRating = vm.reservationInfo.feedbackRating;
                        getPassengerVehicles();
                        setMapData();
                        canRateTrip();
                    }
                });
            }


            function canRateTrip() {                
                return vm.reservationInfo.feedbackRating == null || vm.reservationInfo.feedbackRating == undefined;
            }

            function setWaitlistedStatus() {
                vm.isWaitlisted = vm.reservationInfo.status == 'Waitlisted';
            }

            function getPassengerVehicles() {
                vehicleService.getVehiclesForPassenger(passengerId)
                .then(function (response) {
                    if (response.data.status === 1 && response.data.result.passengerVehicles != null)
                        vm.passengerVehicles = response.data.result.passengerVehicles;

                    if (vm.passengerVehicles.length > 0)
                        vm.passengerVehicles.splice(0, 0, noVehicle);
                    else
                        vm.passengerVehicles.push(noVehicle);

                    for (var i = 0; i < vm.passengerVehicles.length; i++) {
                        if (vm.passengerVehicles[i].id == existingVehicleId) {
                            vm.vehicleForReservation = vm.passengerVehicles;
                            break;
                        }
                    }


                }, function (error) {
                });
            }




            function buildQrCode() {
                var el = document.getElementById('ticketQRcode');

                var lqrcode = new QRCode(el, {
                    width: 100,
                    height: 100,
                    text: vm.reservationInfo.encryptedId,
                    correctLevel: 1,
                    useSVG: true
                });

            }

            activate();

            function cancelCommuterTrip() {
                var reservation =
               {
                   reservationId: vm.reservationInfo.id,
                   routeName: vm.reservationInfo.routeName,
                   passengerId: passengerId,
                   startTime: vm.reservationInfo.pickupTime,
                   reservationDate: vm.reservationInfo.reservationDate
               };

                var modalCancelReservation = $uibModal.open({
                    templateUrl: 'app/modules/commuter/modals/cancel-reservation-modal/cancel-reservation.html',
                    controller: 'CancelReservationController as vm',
                    size: '-fs',
                    backdrop: true,
                    ariaLabelledBy: 'Cancel reservation',
                    resolve: {
                        reservationInfo: function () {
                            return reservation;
                        }
                    }
                });
                modalCancelReservation.result.then(function (result) {
                    if (result.isCancel) {
                        $rootScope.$broadcast('reservationChanged');
                        $uibModalInstance.close({
                            'cancelled': true
                        });
                    }
                });
            }

            function modifyReservation() {
                var modifyReservationModal = $uibModal.open({
                    templateUrl: 'app/modules/commuter/modals/modify-reservation-modal/modify-reservation-pickup.html',
                    controller: 'ModifyReservationPickup as vm',
                    ariaLabelledBy: 'Modify reservation time',
                    backdrop: false,
                    size: '-fs',
                    resolve: {
                        reservation: function () {
                            return vm.reservationInfo;
                        }
                    }
                });

                modifyReservationModal.result.then(function (response) {
                    if (response.refresh) {
                        isModified = true;
                        getReservation(response.reservationId);
                    }

                }, function () {

                });
            }

            function iconClickHandler(model) {
                vm.show = true;
                vm.coords = model.coords;
            }

            function setMarkers() {
                vm.show = false;
                populateMarkers();
                MapService.setMapBounds(vm.markers, markerEvents);
            }


            function populateMarkers() {
                vm.markers.push({
                    latitude: vm.reservationInfo.pickupLatitude,
                    longitude: vm.reservationInfo.pickupLongitude,
                    icon: getMapIcon('pickup', vm.reservationInfo.scheduleType),
                    name: vm.reservationInfo.pickupStopName,
                    address: vm.reservationInfo.pickupAddress
                });

                vm.markers.push(
                    {
                        latitude: vm.reservationInfo.dropoffLatitude,
                        longitude: vm.reservationInfo.dropoffLongitude,
                        icon: getMapIcon('dropoff', vm.reservationInfo.scheduleType),
                        name: vm.reservationInfo.dropoffStopName,
                        address: vm.reservationInfo.dropoffAddress
                    });
            }

            function close() {
                $uibModalInstance.close({
                    'isModified': isModified
                });
            }

            function getMapIcon(stoptype, schedule) {
                if (stoptype === 'pickup') {
                    if (schedule === 'AM')
                        return MapIconService.getCommuterStopIcon();
                    else
                        return MapIconService.getCommuterHubIcon();
                }
                else {
                    if (schedule === 'PM')
                        return MapIconService.getCommuterStopIcon();
                    else
                        return MapIconService.getCommuterHubIcon();
                }

            }

        }
    })();

(function () {
    'use strict';

    angular
    .module('oneMVApp')
    .controller('TripDetailsModalController', TripDetailsModalController);

    TripDetailsModalController.$inject = ['$uibModalInstance', '$timeout', 'tripModalRequest', 'uiGmapIsReady', 'MapService', 'MapIconService'];

    function TripDetailsModalController($uibModalInstance, $timeout, tripModalRequest, uiGmapIsReady, MapService, MapIconService) {

        var vm = this;
        var markerEvents = [{ event: 'click', callback: iconClickHandler }];


        vm.show = false;
        vm.passengerTrip = tripModalRequest.passengerTrip;
        vm.options = typeof tripModalRequest.options == 'string' ? JSON.parse(tripModalRequest.options) : tripModalRequest.options;
        vm.serviceDate = tripModalRequest.serviceDate;
        
        vm.map = MapService.initializeMap();
       

        $timeout(function () {
            vm.markers = [];
            vm.markers.push({
                latitude: vm.passengerTrip.startLatitude,
                longitude: vm.passengerTrip.startLongitude,
                icon: MapIconService.getDrtPickupIcon(),
                name: vm.passengerTrip.startName,
                address : vm.passengerTrip.startAddress
            });
            vm.markers.push({
                latitude: vm.passengerTrip.endLatitude,
                longitude: vm.passengerTrip.endLongitude,
                icon: MapIconService.getDrtDropoffIcon(),
                name: vm.passengerTrip.endName,
                address: vm.passengerTrip.endAddress
            });

            MapService.setMapBounds(vm.markers,markerEvents);
        }, 1000);

        function iconClickHandler(model) {
            vm.show = true;
            vm.coords = model.coords;
        }
        vm.cancel = function cancelTrip() {
            $uibModalInstance.close({
                'action': 'cancel'
            });

        };
        vm.closeModal = function () {
            $uibModalInstance.close({
                'action': 'close'
            });
        };

        vm.displayRatingOption = function () {
            return vm.passengerTrip.Status === 'End' ||
                (vm.passengerTrip.Status === 'Reserved' && (vm.serviceDate > vm.passengerTrip.serviceDate));
        };
    }
})();
(function () {

    'use strict';

    angular.module('oneMVApp')
    .controller('PassengerTripsCtrl', PassengerTripsCtrl);

    PassengerTripsCtrl.$inject = ['$state', '$uibModal', 'authService', 'ReservationService', 'PageService',
     'LuumLinkedService','OneMvServices','ConfigFactory','DivisionService'];

    function PassengerTripsCtrl($state, $uibModal, authService, ReservationService, PageService,
         LuumLinkedService,OneMvServices,ConfigFactory,DivisionService) {
        var vm = this;
        vm.pastTrips = [];
        vm.futureTrips = [];
        vm.todaysTrips = [];
        
        vm.PageService = PageService;
        PageService.setTitle('Passenger Trips');
        PageService.setHeadline('My Trips');

        vm.addressRest = null;
        vm.centerLatLong;
        vm.onTripCancelled = onTripCancelled;
        vm.showTripDetails = showTripDetails;

        var options = {};
        options.reservationType = 'current';
        options.OperatorId = '';
        options.isPassenger = true;
        options.reloadTrips = false;

        var divisionId = DivisionService.getDivisionId();
        var passengerId = authService.authentication.passengerId;
        vm.currentPassenger = { "Id": passengerId }; 
        
        
        if (!authService.isLoggedIn())
            $state.go('login');

        vm.commuterInfo = OneMvServices.getCommuterInfo();
        vm.drtInfo = OneMvServices.getDrtInfo();    

        vm.hasCommuter = !angular.isUndefined(vm.commuterInfo);
        vm.hasDrt = !angular.isUndefined(vm.drtInfo);
        
        vm.loading = true;        
        vm.totalTripsCount = 0;
    
        activate();

        function activate() {
            LuumLinkedService.verify(authService.authentication.passengerId);
            populateDivisionParameters();
            getUpcomingTrips();
        }

        function getUpcomingTrips() {
            ReservationService.getAllReservationsForPassenger(passengerId)
                .then(function (response) {
                    if (response.data.status === 1) {
                        populateTrips(response.data.result.reservations);
                    }
                    vm.loading = false;
                },
                    function () {
                        vm.loading = false;
                    });
        }

        function populateTrips(trips) {
            vm.pastTrips = [];
            vm.futureTrips = [];
            vm.todaysTrips = [];
            vm.totalTripsCount = 0;

            if (!trips) return;            

            vm.totalTripsCount = trips.length;

            for (var i = 0; i < trips.length; i++) {
                var trip = trips[i];                    
                var compare = moment().dayOfYear() - moment(trips[i].reservationDate).dayOfYear();

                if (compare > 0)
                    vm.pastTrips.push(trip);
                else if (compare < 0)
                    vm.futureTrips.push(trip);
                else
                    vm.todaysTrips.push(trips[i]);
            }
        }

        function showTripDetails(trip) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: false,
                keyboard :true,
                resolve: {
                    tripId: trip.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getUpcomingTrips();
                }
            });
        }     

        function populateDivisionParameters() {
            ConfigFactory.getDivisionParameters(divisionId)
            .then(function (params) {
            
                options.promiseWindow = params.PromiseWindow;
                options.DivisionId = divisionId;
                options.batchDays = params.BatchDays ? eval(params.BatchDays) : 7;
                options.minFromDays = params.MinFromDays ? eval(params.MinFromDays) : 30;
                options.isAdvancedReservation = params.AllowAdvancedReservation ? eval(params.AllowAdvancedReservation.toLowerCase()) : false;
                options.showCancelOptions = params.CancelReasonRequired ? eval(params.CancelReasonRequired.toLowerCase()) : false;
                options.allowFaring = params.AllowFaring ? eval(params.AllowFaring.toLowerCase()) : false;
                options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes) : false;
                options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;

        });
            vm.userReservationOptions = options;
        }

        function onTripCancelled() {}

        // Start of code for Ionic
        vm.ionicOnTouch = function () {
            // Need to resize the screen if one of the trip cards is clicked.
            $rootScope.$broadcast('ionicScrollResize', { action: 'resize' })
        }
        vm.ionicInclude = 'app/modules/on-demand/trips/my-trips.html';
        vm.ionicCustomClassName = 'ionic.my-trips';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Trips';
        vm.ionicRefreshingText = 'Loading Trips';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            //
            // change this flag to trigger the my-trips directive to reload.
            //
            options.reloadTrips = !options.reloadTrips;
            $rootScope.$broadcast('scroll.refreshComplete');
        }

    }

})();
(function () {
    'use strict';

    angular.module("oneMVApp").directive('tripCardDirective', tripCardDirective);
    tripCardDirective.$inject = ['$uibModal', 'UtilityFactory'];
    function tripCardDirective($uibModal, UtilityFactory) {
        var directive = {
            controller: controller,
            restrict: 'E',
            link: link,
            replace: true,
            scope: {
                trip: '@',
                options: '@',
                tripType: '@',
                divisionServiceDate: '=',
                allowTripRating: "=",
                notifyOnCancel: "=onTripCancel"
            },
            templateUrl: 'app/modules/shared/trips/tripCard.html'
        };
        return directive;

        function link(scope, element, attrs) {
            
           scope.$watch('trip', function (newValue, oldValue) {
                if (newValue != oldValue) {
                    if (typeof newValue == "string")
                        scope.passengerTrip = JSON.parse(newValue);
                    else if (typeof newValue == "object")
                        scope.passengerTrip = newValue;
                   
                }
            });

        }
        
        function controller($scope) {
            $scope.passengerTrip = JSON.parse($scope.trip);
            $scope.opts = JSON.parse($scope.options);
            $scope.serviceDate = $scope.divisionServiceDate;

            $scope.detailsModal = function () {
               var tripDetail =  $uibModal.open({
                    templateUrl: 'app/modules/shared/trips/drt-trip-modal.html',
                    controller: 'TripDetailsModalController as vm',
                    size: '-fs',
                    backdrop: false,
                    resolve: {
                        tripModalRequest : function()
                        {
                            return {
                                passengerTrip: $scope.passengerTrip,
                                options: $scope.options,
                                serviceDate: $scope.serviceDate
                            }
                        }
                    }
               });

               tripDetail.result.then(function (result) {
                   if(result && result.action === 'cancel')
                   {
                       $scope.cancel($scope.passengerTrip);
                   }
               });
            };
           
       
            $scope.getDisplayStatus = function (status) {
                var result = status;

                switch (status) {
                    case 'Cancel':
                        result = 'Cancelled';
                        break;
                    case 'No-show':
                        result = 'No show';
                        break;
                    case 'Un-scheduled':
                        result = 'Reserved';
                        break;
                }

                return result;
            };

            $scope.cancel = function (trip) {
                var tripToCancel = {
                    'tripId': trip.TripId,
                    'passengerId': trip.PassengerId,
                    'from': trip.startName,
                    'to': trip.endName,
                    'scheduledTime': trip.schedPickupTime
                };

                var modalCancelTrip = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                    controller: 'TripCancellationController as vm',
                    size: '-fs',
                    resolve: {
                        tripToCancel: function () {
                            return tripToCancel;
                        },
                        showCancelOptions: $scope.opts.showCancelOptions

                    }
                });
                modalCancelTrip.result.then(function (result) {
                    if (result.isCancel) {
                        UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                        if (typeof ($scope.notifyOnCancel) == 'function') {
                            $scope.notifyOnCancel();
                        }

                    }
                    else
                        UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
                });
            };
        }
    }
})();
(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('mvPassengerTrips', userReservationsDirective);

    userReservationsDirective.$inject = ['$filter', '$interval', '$uibModal',
        'UtilityFactory', 'ScheduleService', 'DivisionService', 'PageService'];

    function userReservationsDirective( $filter,  $interval, $uibModal, 
        UtilityFactory, ScheduleService,  DivisionService) {
        var directive = {
            controller: controller,
            link: link,
            restrict: 'E',
            replace: false,
            scope: {
                passenger: '@',
                newTrip: '@',
                options: '@',
                divisionId: '@',
                notifyTripCancelled: '=onTripCancelled',
                allowTripRating: "="
            },
            templateUrl: 'app/modules/shared/trips/userReservations.html'
        };
        return directive;

        function link(scope, element, attrs) {
            // This is here to trigger scope.init() when this event first occurs.
            // In the Mobile App, 'options' gets loaded so fast that by the time
            // the $watch('options') occurs, the value is the same.
            var initialRun = true; 
            scope.$watch('options', function (newValue, oldValue) {
                if (newValue != oldValue || initialRun) {
                    if (typeof newValue == "string")
                        scope.opts = JSON.parse(newValue);
                    else if (typeof newValue == "object")
                        scope.opts = newValue;
                    initialRun = false;
                    scope.init();
                }
            });
         
        }

        function controller($scope, OneMvServices) {
            var divisionId = undefined;
            var operatorId = undefined;
            var batchDays = 7; //get from system params
            var minFromDays = 30;
            var dateFormat = 'MM-DD-YYYY';
            $scope.isCancelling = false;
            $scope.loading = true;
            var autoRefresh = undefined;
            var autoRefreshActiveTrip = undefined;
            $scope.showTabs = false;

            $scope.commuterInfo = OneMvServices.getCommuterInfo();
            $scope.drtInfo = OneMvServices.getDrtInfo();    

            $scope.opts = undefined;

            $scope.activeTrip = {
                TripId: null
            };

            $scope.passengerFutureTrips = [];
            $scope.passengerPastTrips = [];
            $scope.passengerActiveTrips = [];

            if ($scope.passenger != '') {
                var pass = JSON.parse($scope.passenger);
                $scope.passengerId = pass ? pass.Id : undefined;
            }            
            $scope.showTabs = !angular.isUndefined($scope.commuterInfo) && !angular.isUndefined($scope.drtInfo);            
            $scope.getDisplayStatus = function (status) {
                var result = status;

                switch (status) {
                    case 'Cancel':
                        result = 'Canceled'
                        break;
                    case 'No-show':
                        result = 'No Show'
                        break;
                }

                return result;
            };

            $scope.activate = function (passenger) {
                $scope.passengerId = passenger.Id;
                $scope.loading = true;
                
                getServiceDateByDivision();
            };

            $scope.displayRatingOption = function (passengerTrip) {
                return passengerTrip.Status === 'End' ||
                    (passengerTrip.Status === 'Reserved'
                    && ($scope.serviceDate > passengerTrip.serviceDate));
            };

            $scope.cancel = function (trip) {
              
                var tripToCancel = {
                    'tripId': trip.TripId,
                    'passengerId': trip.PassengerId,
                    'from': trip.startName,
                    'to': trip.endName,
                    'scheduledTime': trip.schedPickupTime
                };

                var modalCancelTrip = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                    controller: 'TripCancellationController as vm',
                    size: '-fs',
                    backdrop: false,
                    resolve: {
                        tripToCancel: function () {
                            return tripToCancel;
                        },
                        showCancelOptions: $scope.opts.showCancelOptions

                    }
                });
                modalCancelTrip.result.then(function (result) {
                    if (result.isCancel) {
                        UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                        getTripsForPassenger(null, true);
                    }
                    else
                        UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
                });
            };


            $scope.init = function () {
                $scope.loading = true;
                $scope.isPassenger = $scope.opts.isPassenger;
                $scope.reservationType = $scope.opts.reservationType;
                divisionId = $scope.opts.DivisionId;
                operatorId = $scope.opts.OperatorId;
                batchDays = $scope.opts.batchDays;
                $scope.opts.autoRefresh = true;
                minFromDays = $scope.opts.minFromDays;
                
                $scope.isStartDp = false;
                $scope.isEndtDp = false;
                $scope.date = { 'from': undefined, 'to': undefined };
                $scope.minFromDateAllowed = undefined;
                $scope.maxFromDateAllowed = undefined;
                $scope.minToDateAllowed = undefined;
                $scope.maxToDateAllowed = undefined;
                $scope.showMap = [];
                if ($scope.isPassenger)
                    $scope.activate($scope.passenger);
            };

            function getServiceDateByDivision() {
                $scope.loading = true;
                ScheduleService.getServiceDateByDivision(divisionId)
                .then(function (response) {
                    if (response.data.status == 1) {
                        var serviceDate = response.data.result;
                        $scope.serviceDate = serviceDate;
                        setCalendarDates(serviceDate);
                        $scope.loading = false;
                        var callback = $scope.opts.autoRefresh ? setAutoRefresh : null;
                        getTripsForPassenger(callback);
                    }
                }, function errorCallback(response) {
                    $scope.loading = false;
                    UtilityFactory.toastError("Error!", "Failed to get Service Date.");
                });
            };


            function setAutoRefresh() {
                autoRefreshActiveTrip = $interval(function () {
                    getActiveTrip();
                }, 30000);
                autoRefresh = $interval(function () {
                    getTripsForPassenger();
                }, 60000);
            }

            function getActiveTrip(callback) {
                var pass = JSON.parse($scope.passenger);
                $scope.passengerId = pass ? pass.Id : undefined;
                
                ScheduleService.getlastripdetails($scope.passengerId, divisionId).then(function (response) {
                    if (response.data.status == 1) {
                       
                        if (!angular.isUndefined($scope.passengerFutureTrips)) {
                            var activeTrip = $filter('filter')($scope.passengerFutureTrips,
                                { TripId: response.data.result.TripID });
                            if (activeTrip.length > 0)
                                $scope.activeTrip = activeTrip[0];
                        }
                    }
                    else
                        $scope.activeTrip = {
                            TripId: null
                        };
                    if (callback)
                        callback();
                }, function () {
                });
            };


            function setCalendarDates(serviceDate) {

                if ($scope.isPassenger) {
                    if (!$scope.opts.isAdvancedReservation) {
                        $scope.date.to = moment(serviceDate).format(dateFormat);
                    }
                    else
                        $scope.date.to = moment(serviceDate).add(batchDays, 'd').format(dateFormat);

                    $scope.date.from = moment(serviceDate).add(-minFromDays, 'd').format(dateFormat);
                }
                else {
                    var selectedMomentDate = moment(serviceDate).format(dateFormat);

                    $scope.date.from = selectedMomentDate;
                    $scope.date.to = selectedMomentDate;

                    var maxToDate = moment(selectedMomentDate, dateFormat).add(batchDays, 'd');
                    $scope.minToDateAllowed = selectedMomentDate;
                    $scope.maxToDateAllowed = new Date(maxToDate);

                    var minFromDate = moment(selectedMomentDate, dateFormat).add(-minFromDays, 'd');
                    $scope.minFromDateAllowed = new Date(minFromDate);
                    $scope.maxFromDateAllowed = selectedMomentDate;
                }
            };

            $scope.onTripCancel = function () {
                getTripsForPassenger(null, true);
            }
            $scope.dateChanged = function () {
                var fromDate = $scope.date.from;
                $scope.minToDateAllowed = fromDate;
                if (isBefore($scope.date.to, $scope.date.from))
                    $scope.date.to = angular.copy($scope.date.from);

                getTripsForPassenger();
            };

            function isBefore(from, to) {
                var diff = new Date(from).getTime() <= new Date(to).getTime();
                return diff;
            };


            function getTripsForPassenger(callback, isFromCancel) {

                $scope.loading = true;
                var fromDate = $filter('date')($scope.date.from, 'yyyy-MM-dd');
                var toDate = $filter('date')($scope.date.to, 'yyyy-MM-dd');

                var pass = JSON.parse($scope.passenger);
                $scope.passengerId = pass ? pass.Id : undefined;
                ScheduleService.getPassengerTrips(divisionId, $scope.passengerId, fromDate, toDate)
                    .then(function (response) {

                        if (response.data.status == 1) {
                            mapTrips(response.data.result);

                        }
                        $scope.loading = false;
                        if (callback) {
                            getActiveTrip(callback)


                        }
                        else if (isFromCancel)
                            getActiveTrip();
                    }, function (errormsg) {
                        $scope.loading = false;
                        UtilityFactory.toastError('Error', errormsg.data);
                    });
            };

            function mapTrips(trips) {
                addPromiseWindowAndEpochToTrip(trips);

                $scope.passengerPastTrips = getTrips(trips, filterPastTrips, sortPastTrips);
                $scope.passengerFutureTrips = getFutureTrips(trips);//, filterFutureTrips, sortFutureTrips);
                
            };

            function getFutureTrips(trips) {
                var futureTrips = angular.copy(trips);

                for (var i = 0; i < $scope.passengerPastTrips.length; i++) {
                    var tripId = $scope.passengerPastTrips[i].TripId;
                    futureTrips = $filter('filter')(futureTrips, { TripId: '!' + tripId });
                }
                return futureTrips;

            }


            function sortFutureTrips(a, b) {
                return a.schedEpoch - b.schedEpoch;
            };

            function filterPastTrips(trip) {
                var currentDivisionEpoch = moment.tz(DivisionService.getTimeZone()).format('x');

                return trip.Status === 'Cancel'
                    || trip.Status === 'No-show'
                    || trip.Status === 'End'
                    || //trip.Status === 'Reserved' && 
                       trip.serviceDate < $scope.serviceDate;
            };

            function sortPastTrips(a, b) {
                return b.schedEpoch - a.schedEpoch;
            };



            function getTrips(trips, filter, sort) {

                var filtered = trips.filter(filter);

                if (filtered) {
                    filtered.sort(sort);
                }
                return filtered;
            }

            function mapPromiseWindowAndEpoch(trip) {
                var promiseWindow = $scope.opts.promiseWindow;
                trip.schedEpoch = moment.tz(trip.schedPickupTime, DivisionService.getTimeZone()).format('x');
                trip.estEpoch = moment.tz(trip.estimatedPickupTime, DivisionService.getTimeZone()).format('x');

                if (trip.estimatedPickupTime) {
                    //var pickupTime = trip.schedPickupTime;
                    //var promiseWindowsEndTime = DateFactory.getPromiseWindowEndTime(pickupTime, promiseWindow);
                    //trip.promiseWindowStartTime = $filter('date')(pickupTime, 'h:mm a');
                    //trip.promiseWindowEndTime = $filter('date')(promiseWindowsEndTime, 'h:mm a');

                    var startPickupWindowTime = new moment(trip.startPickupWindowTime);
                    var endPickupWindowTime = new moment(trip.endPickupWindowTime);
                    trip.promiseWindowStartTime = startPickupWindowTime.format('h:mm A');
                    trip.promiseWindowEndTime = endPickupWindowTime.format('h:mm A');

                    if (trip.vehicleLicense == null)
                        trip.vehicleLicense = "N/A";
                }
            };

            function addPromiseWindowAndEpochToTrip(trips) {


                for (var i = 0; i < trips.length; i++)
                    mapPromiseWindowAndEpoch(trips[i]);
            }


            function getMapInfo(trip) {
                var mapInfo =
                    {
                        'activeTripRunId': trip.RunId,
                        'FromLat': trip.startLatitude,
                        'FromLong': trip.startLongitude,
                        'ToLat': trip.endLatitude,
                        'ToLong': trip.endLongitude,
                        'tripId': trip.TripId
                    };

                return mapInfo;
            };


            $scope.addNewTrip = function (trip) {
                var tripDate = moment(trip.ScheduledPickupTime).format(dateFormat);
                //if new trip falls between existing selected dates 
                if (isBefore($scope.date.from, tripDate) && isBefore(tripDate, $scope.date.to))
                    getTripsForPassenger();
            };

            $scope.$on('$destroy', function (event) {
                if (angular.isDefined(autoRefresh)) {
                    $interval.cancel(autoRefresh);
                    autoRefresh = undefined;
                }




                if (angular.isDefined(autoRefreshActiveTrip)) {
                    $interval.cancel(autoRefreshActiveTrip);
                    autoRefreshActiveTrip = undefined;
                }

            });

        }
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('WhatsNewController', WhatsNewController);

    WhatsNewController.$inject = ['$rootScope','$location', 'DynamicContentService', 'PageService'];

    function WhatsNewController($rootScope, $location, DynamicContentService, PageService) {
        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Whats New');
        vm.PageService.setHeadline('Latest Service Updates');

        function getData() {
            DynamicContentService.getWhatsNewData().then(function (response) {
                vm.data = response.data.result;                
            });
        }

        getData();

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/whats-new/whats-new.html';
        vm.ionicCustomClassName = 'ionic-whats-new card';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh';
        vm.ionicRefreshingText = 'Loading';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            getData();
            $rootScope.$broadcast('scroll.refreshComplete');

        }
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('VerificationController', VerificationController);

    VerificationController.$inject = ['$timeout', '$rootScope','authService', 'VerificationService', 'DivisionService', 'RedirectionService', 'PageService'];

    function VerificationController($timeout, $rootScope, authService, VerificationService,  DivisionService, RedirectionService, PageService) {

        var vm = this;

        vm.isClicked = false;
        vm.savedSuccessfully = false;
        vm.message = '';
        vm.code = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('Verification');

        var activate = function () {
            vm.registerData = {
                userName: authService.externalAuthData.userName,
                provider: authService.externalAuthData.provider,
                externalAccessToken: authService.externalAuthData.externalAccessToken,
                divisionId: DivisionService.getDivisionId(),
                divisionSupportsFeed: false
            };
            vm.PageService.setHeadline('Verify your ' + authService.externalAuthData.provider +' account');
        };

        activate();

        vm.cancel = function () {
            RedirectionService.redirectTo('dashboard/');
        }

        vm.registerExternal = function () {
            vm.message = '';
            vm.isClicked = true;
            if (vm.code.trim() !== '')
                validate();
            else {
                vm.message = 'Validation code missing.';
                vm.isClicked = false;
            }
        };



        var validate = function () {
            VerificationService
                .validate(vm.code.trim())
                .then(function (res) {
                    if (res.data.status == 1)
                        register();
                    else {
                        vm.message = "Invalid code.";
                        vm.isClicked = false;
                    }
                }, function (response) {
                    vm.message = response.data.Message;
                    vm.isClicked = false;
                });
        }

        function register() {           
            authService.registerExternal(vm.registerData).then(function (response) {
                vm.savedSuccessfully = true;
                startTimer();
            }, function (error) {
                vm.message = "An error occured. Please try again later."
                vm.isClicked = false;
            });
        }



        var startTimer = function () {
            var timer = $timeout(function () {
                $timeout.cancel(timer);
                $rootScope.$broadcast('loggedIn', null);
                RedirectionService.redirect();
            }, 2000);
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/verification/verification.html';
        vm.ionicCustomClassName = 'ionic-template-verification';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('VerificationService', VerificationService);

    VerificationService.$inject = ['$http','$q','env','DivisionService'];

    function VerificationService($http, $q, env, DivisionService) {
        var service = {
            validate: validate,
            passengerExists: passengerExists
        };

        return service;

        function validate(key) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl  + 'division/' + DivisionService.getDivisionId()
                                + '/Validate?key=' + key;
            $http.get(serviceUrl)
            .then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function passengerExists(clientPassengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'passenger/exists/' + DivisionService.getDivisionId() + '/' + clientPassengerId;
            $http.get(serviceUrl)
            .then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('AddVehicleController', AddVehicleController);

    AddVehicleController.$inject = ['authService', 'vehicleService', '$uibModalInstance', 'atleastOneVehicleExist','$timeout'];

    function AddVehicleController(authService, vehicleService, $uibModalInstance, atleastOneVehicleExist,$timeout) {
        var vm = this;
        vm.vehicleInfo = undefined;
        vm.atleastOneVehicleExist = atleastOneVehicleExist;
        vm.message = '';
        vm.isSaving = false;
        vm.errorMessage = 'Add failed';
        vm.showMessage = false;
        var passengerId = authService.authentication.passengerId;        
        var isAdded = false;
        vm.maxYear = new Date().getFullYear() + 1;
        vm.isYearValid = isYearValid;

        function getDefaultVehicleInfo() {
            return {
                year: '',
                make: '',
                model: '',
                color: '',
                licencePlate: '',                
                isDefault: !vm.atleastOneVehicleExist,
                isActive: true
            };
        }

        function isYearValid() {
            if (vm.vehicleInfo.year !== '') {
                return vm.vehicleInfo.year >= '1930' && vm.vehicleInfo.year <= vm.maxYear;
            }
            return true;
        };

        function showMessage(msg) {
            vm.message = msg;
            vm.showMessage = true;
            $timeout(function () {
                vm.showMessage = false;
            }, 5000);
        };

        vm.save = function () {
            vm.isSaving = true;
            isAdded = false;
            if (isValid()) {
                vehicleService.save(vm.vehicleInfo, passengerId)
                .then(function (response) {
                    if (response.data && response.data.status == 1 && response.data.result > -1) {
                        vm.vehicleInfo.id = response.data.result;
                        //reset
                        vm.vehicleInfo = getDefaultVehicleInfo();
                        isAdded = true;
                        $uibModalInstance.close({ 'isAdded': isAdded });
                    }
                    else
                        showMessage(response.data.result);
                    vm.isSaving = false;
                }, function (error) {
                    showMessage(response.data.message);
                    vm.isSaving = false;
                });
            }
            else {
                showMessage("Invalid Input!");
                vm.isSaving = false;
            }
        }        

        function isValid() {
            return !(vm.vehicleInfo.color === '' || vm.vehicleInfo.color.trim() == ''
            || vm.vehicleInfo.licencePlate === '' || vm.vehicleInfo.licencePlate.trim() == ''
                || vm.vehicleInfo.make === '' || vm.vehicleInfo.make.trim() == ''
                || vm.vehicleInfo.model === '' || vm.vehicleInfo.model.trim() == ''
                || vm.vehicleInfo.year === '');
        };

        
        vm.cancel = function() {
            $uibModalInstance.close({'isAdded' : isAdded});
        };


        activate();

        function activate() {
            vm.vehicleInfo = getDefaultVehicleInfo();
        }

        
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('CancelReservationController', CancelReservationController);

    CancelReservationController.$inject = ['$location', '$uibModalInstance', 'reservationInfo', 'ReservationService', 'StopDataService', 'MessageService'];

    function CancelReservationController($location, $uibModalInstance, reservationInfo, ReservationService, StopDataService, MessageService) {
        /* jshint validthis:true */
        var vm = this;
        vm.reservationInfo = reservationInfo;
        vm.routeName = vm.reservationInfo.routeName;
        vm.startTime = vm.reservationInfo.startTime;
        vm.reservationDate = moment(vm.reservationInfo.reservationDate).format('MM/DD/YYYY');
        vm.cancelError = false;
        vm.disable = false;
        vm.errorMessage = 'Sorry, we were unable to cancel this reservation.';    

        vm.cancelReservation = function () {
            vm.disable = true;
            if (vm.reservationInfo.reservationId) {
                ReservationService.cancelReservation(vm.reservationInfo.passengerId, vm.reservationInfo.reservationId)
                .then(function (response) {
                    if (response && response.data && response.data.status == 1) {
                        $uibModalInstance.close({ 'action': 'close', 'isCancel': true });
                    } else {
                        vm.cancelError = true;
                        if (response.data.result && response.data.message == 'Failure')
                            vm.errorMessage = response.data.result;
                    }
                    vm.disable = false;
                });
            } else {
                vm.cancelError = true;
            }
        };
        
        vm.cancel = function () {
            $uibModalInstance.dismiss('cancel');
        };

        this.MakeDisable = function () {
            if (vm.disable) {
                return true;
            }
            else {
                return false;
            }
        };
    }
})();



(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ModifyReservationPickup', ModifyReservationPickup);

    ModifyReservationPickup.$inject = ['$location', '$uibModalInstance', 'ReservationService',
        'vehicleService', 'DivisionService', 'authService', 'reservation'];

    function ModifyReservationPickup($location, $uibModalInstance, ReservationService,
        vehicleService, DivisionService,authService, reservation) {

        var vm = this;

        var passengerId = authService.authentication.passengerId;
        var newReservationInfo = undefined;
        var noVehicle = { id: null, licenceplate: '--' };

        vm.reservationInfo = reservation;
        vm.message = "";
        vm.isSaving = false;
        vm.currentTripId = vm.reservationInfo.tripId;
        vm.selectedTripId = vm.reservationInfo.tripId;
        vm.availableParking = 0;
        vm.selectedVehicleId = angular.copy(vm.reservationInfo.vehicleId);
        vm.divisionAllowsWaitlist = true;

        vm.manageVehicle = manageVehicle;
        vm.modifyTrip = modifyTrip;
        vm.cancel = cancel;

        function init() {

            DivisionService
               .isWaitlistAllowedByDivision()
           .then(function (response) {
               vm.divisionAllowsWaitlist = response;
           });

            getAlternateTrips();
            getPassengerVehicles();
        }

        function cancel() {
            $uibModalInstance.close({
                'action': 'close'
            });
        };

        function manageVehicle() {
            vm.message = "";

            ReservationService
                .manageParkingForReservation(passengerId, vm.reservationInfo.id, vm.selectedVehicleId)
            .then(function (response) {
                if (response.data.status == 0) {
                    var msg = response.data.result.message;
                    vm.message = msg;
                }
                else {
                    $uibModalInstance.close({
                        'action': 'close',
                        'refresh': true,
                        'reservationId': response.data.result.id
                    });
                }
            }, function (error) {

            });
        }

        function getAlternateTrips() {
            ReservationService
             .getAllTripsForCurrentReservation(vm.reservationInfo.id, passengerId)
                 .then(function (response) {
                     vm.trips = response.data.result.altTrips;
                     vm.availableParking = vm.trips[0].availableParking;
                 }, function (error) {

                 })
        }

        function getPassengerVehicles() {
            vehicleService.getVehiclesForPassenger(passengerId)
            .then(function (response) {
                if (response.data.status === 1 && response.data.result.passengerVehicles != null)
                    vm.passengerVehicles = response.data.result.passengerVehicles;

                if (vm.passengerVehicles.length > 0)
                    vm.passengerVehicles.splice(0, 0, noVehicle);
                else
                    vm.passengerVehicles.push(noVehicle);             

            }, function (error) {
            });
        }


        function modifyTrip() {
            vm.isSaving = true;
            vm.message = '';

            ReservationService
            .modifyReservation(vm.reservationInfo.id, vm.selectedTripId, passengerId)
            .then(function (response) {
                if (response.data.status == 0) {
                    vm.message = response.data.result.message;
                    vm.isSaving = false;
                }
                else {
                    vm.isSaving = false;
                    $uibModalInstance.close({
                        'action': 'close',
                        'refresh': true,
                        'reservationId': response.data.result.id
                    });
                }

            }, function (error) {
                vm.message = error;
                vm.isSaving = false;
            });
        }

        init();
    }
})();



(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.controller('CommuterFeedbackModalController', CommuterFeedbackModalController);

    CommuterFeedbackModalController.$inject = ['$uibModalInstance', 'UtilityFactory', 'ConfigFactory', 'FeedbackService', 'feedbackInfo'];

    function CommuterFeedbackModalController($uibModalInstance,UtilityFactory, ConfigFactory, FeedbackService, feedbackInfo) {
        var vm = this;
        vm.feedbackInfo = angular.copy(feedbackInfo);

        vm.cancel = cancel;
        vm.saveFeedback = saveFeedback;


        vm.disableSubmit = function () {
            return vm.feedbackInfo.rating <= 0 || vm.feedbackInfo.rating == null;
        };

        function cancel() {
            $uibModalInstance.close({isSaved:false});
        };

        function saveFeedback() {            

            FeedbackService
                .addCommuterFeedback(
                {
                    Comment: vm.feedbackInfo.comment.trim(),
                    Rating: vm.feedbackInfo.rating
                },
                                        vm.feedbackInfo.reservationId)
              .then(function (response) {
                if (response.data.status == 1) {
                    vm.isSaving = false;
                    UtilityFactory.toastSuccess("Success!", "Feedback saved successfully");
                    $uibModalInstance.close({isSaved :true});
                } else {
                    vm.isSaving = false;
                    UtilityFactory.toastError("Error!", "Could not save feedback");
                    console.log('Error: - ' + response.data.message);
                }
            }, function errorCallback(response) {
                vm.isSaving = false;
                UtilityFactory.toastError("Error!", "Could not save feedback");
                console.log('Error: - ' + response.data.message);
            });

        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('RemoveVehicleConfirmationController', RemoveVehicleConfirmationController);

    RemoveVehicleConfirmationController.$inject = ['$location','$uibModalInstance','vehicleService','id','authService'];

    function RemoveVehicleConfirmationController($location, $uibModalInstance, vehicleService, id, authService) {

        var vm = this;
        vm.isRemoving = false;

        vm.removeVehicle = function () {
            vm.isRemoving = true;
            vehicleService.removeVehicle(id, authService.authentication.passengerId)
                .then(function (response) {
                    if (response.data && response.data.status == 1)
                        $uibModalInstance.close({ removed: true });                    
                    else 
                        if (response.data.result && response.data.result !== '')
                            $uibModalInstance.close({ removed: false, errorMessage: response.data.result });
                }, function (err) {
                });
        };

        vm.cancel = function () {
            $uibModalInstance.dismiss({removed:false});
        };
    }
})();

(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .controller('ReservationMapController', ReservationMapController);

    ReservationMapController.$inject = ['$scope', '$location', '$timeout', '$http', '$uibModalInstance','$interval',
        'GeoLocationService',  'StopDataService', 'uiGmapIsReady', 'LocationService', 'reservation_stops'];

    function ReservationMapController($scope, $location, $timeout, $http, $uibModalInstance, $interval,
        GeoLocationService, StopDataService,uiGmapIsReady, LocationService, reservation_stops) {
        var vm = this;
        vm.title = 'Schedule Stops';
        vm.mapControl = {};
        vm.stopMarker = [];
        var autoRefreshMarker = undefined;
        vm.map = {
            // http://angular-google-maps.org/use
            center: {
                latitude: 43.75514221191406,
                longitude: -116.57597351074219
            },
            zoom: 10,
            lineStyle: {
                color: '#333',
                weight: 5,
                opacity: 0.7
            }
        };
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false

        };
        var myLocationPin = 'images/pin-my-location.png';
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };

        vm.reservationStops = reservation_stops;
        if (vm.reservationStops.id != null || vm.reservationStops.id != '')
        {
            if (vm.reservationStops.scheduleType == 'AM') {
                vm.icon = 'images/pin-busstop-green.svg'
                vm.hubIcon = 'images/pin-hub.svg'

                vm.stopMarker.push({
                    'stopId': vm.reservationStops.pickupStopId, 'stopName': vm.reservationStops.pickupStopName,
                    'latitude': vm.reservationStops.pickupLatitude, 'longitude': vm.reservationStops.pickupLongitude,
                    'icon': vm.icon, 'address': vm.reservationStops.pickupAddress
                });
                vm.stopMarker.push({
                    'stopId': vm.reservationStops.dropoffStopId, 'stopName': vm.reservationStops.dropoffStopName,
                    'latitude': vm.reservationStops.dropoffLatitude, 'longitude': vm.reservationStops.dropoffLongitude,
                    'icon': vm.hubIcon, 'address': vm.reservationStops.dropoffAddress
                });
            }
            else {
                vm.icon = 'images/pin-busstop-grey.svg'
                vm.hubIcon = 'images/pin-hub.svg'

                vm.stopMarker.push({
                    'stopId': vm.reservationStops.pickupStopId, 'stopName': vm.reservationStops.pickupStopName,
                    'latitude': vm.reservationStops.pickupLatitude, 'longitude': vm.reservationStops.pickupLongitude,
                    'icon': vm.hubIcon, 'address': vm.reservationStops.pickupAddress
                });
                vm.stopMarker.push({
                    'stopId': vm.reservationStops.dropoffStopId, 'stopName': vm.reservationStops.dropoffStopName,
                    'latitude': vm.reservationStops.dropoffLatitude, 'longitude': vm.reservationStops.dropoffLongitude,
                    'icon': vm.icon, 'address': vm.reservationStops.dropoffAddress
                });
            }            
        }
        else
        {
            return;
        }
        
        autoRefreshMarker = $interval(function () {
            getMyLocation();
        }, 10000);

        function getMyLocation()
        {            
          GeoLocationService.getCurrentPosition()            
            .then(function (position) {
                if (position == undefined || position == null)
                {
                    stopAutoRefreshMarker()
                    return;
                }
                vm.myLocation = {
                    "coords": {
                        "latitude": position.coords.latitude,
                        "longitude": position.coords.longitude
                    },
                    "icon": vm.myLocationIcon
                };
                
            }, function (err) {

            });
        }

        uiGmapIsReady.promise().then(function (maps) {
            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            
            var bounds = new google.maps.LatLngBounds();

            angular.forEach(vm.stopMarker, function (stop) {
                bounds.extend(new google.maps.LatLng(stop.latitude, stop.longitude));
            });

            vm.mapControl.getGMap().fitBounds(bounds);
        });

        //marker click function
        vm.markerEvent = {
            click: function (gMarker, eventName, model) {
                if (model.$id) {
                    //navigateToSelectedStop(model.coords);
                    if (vm.selectedLocation)
                        StopDataService.setGeoLocation(vm.selectedLocation);
                    StopDataService.setStop(model.coords);
                    vm.coords = model.coords;
                    vm.show = true;
                }
            }
        };

        vm.cancel = function () {
            stopAutoRefreshMarker();
           $uibModalInstance.dismiss('cancel');
           vm.isDone = true;
       };

       function stopAutoRefreshMarker() {
           if (angular.isDefined(autoRefreshMarker)) {
               $interval.cancel(autoRefreshMarker);
               autoRefreshMarker = undefined;
           }
       };

       $scope.$on('$locationChangeStart', function (event) {
           stopAutoRefreshMarker();
       });
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ReservationController', ReservationController);

    ReservationController.$inject = ['$location', '$uibModalInstance', 'reservationInfo', '$interval', '$rootScope',
        'isAdd', 'ReservationService', 'MessageService', 'vehicleService', 'StopDataService', 'DivisionService'];

    function ReservationController($location, $uibModalInstance, reservationInfo, $interval, $rootScope,
        isAdd, ReservationService, MessageService, vehicleService, StopDataService, DivisionService) {
        /* jshint validthis:true */
        var vm = this;
        vm.isAdd = isAdd;
        vm.disable = false;
        vm.isReserved = false;
        vm.hasVehicles = false;
        vm.needsParking = false;
        vm.vehicles = [];
        vm.selectedVehicle = undefined;
        vm.loadingVehicles = true;
        vm.isAMReservation = reservationInfo.scheduleType === "AM";
        vm.parkingNotAvailable = false;
        vm.noParkingMessage = "Parking not available.";
        vm.availableParkingSlots = 0;
        vm.isParkingAttachedToReservation = true;
        vm.reservationData = reservationInfo;
        vm.updateLabels = updateLabels;
        var availableSeats = 0;
        vm.divisionAllowsWaitlist = true;
        vm.numCompanions = [];
        vm.selectedCompanions = 0;


        var noVehicle = { 'licenceplate': '--', 'id': undefined };

        vm.reserve = reserve;

        var init = function () {

            DivisionService
               .isWaitlistAllowedByDivision()
           .then(function (response) {
               vm.divisionAllowsWaitlist = response;
               getAvailableSeats();
           }, function () {
               getAvailableSeats();
           });
        };


        function updateLabels() {

            if (!vm.divisionAllowsWaitlist)
                setReservationLabels();
            else {
                if (isParkingSelectedAndUnAvailable() || availableSeats < 1 + vm.selectedCompanions)
                    setWaitlistLabels();
                else
                    setReservationLabels();
            }
        }

        function isParkingSelectedAndUnAvailable() {
            if (!vm.isAMReservation) return false;

            return vm.selectedVehicle !== noVehicle
                    && vm.availableParkingSlots <= 0;
        }

        function getAvailableSeats() {
            ReservationService.getAvailableSeatsForTrip(reservationInfo.trip.tripId, Date.parse(reservationInfo.reservationDate))
                .then(function (response) {
                    getVehicles();
                    if (response.data.status === 1) {
                        availableSeats = response.data.result.availableCapacity;
                        if (response.data.result.allowedCompanions > 0){
                            for (var i = 0; i <= response.data.result.allowedCompanions; i++) {
                                vm.numCompanions.push(i);
                            }
                        }
                    }


                },
                    function error(response) {
                    });
        };

        function setReservationLabels() {
            vm.btnText = 'Reserve Seat';
            vm.modalText = 'Reserve a seat';
            vm.modalSuccessText = 'Reservation Created';
        }

        function setWaitlistLabels() {
            vm.btnText = 'Add To Waitlist';
            vm.modalText = 'Add to waitlist';
            vm.modalSuccessText = 'Added To Waitlist';
        }

        function getParkingInfo() {

            if (!vm.isAMReservation) {
                updateLabels();
                return;
            }

            StopDataService
                    .getAvailableParkingsForStop(reservationInfo.pickupStop.id, reservationTimespan())
                    .then(
                        function (response) {
                            if (response.data.status === 1) {
                                vm.availableParkingSlots = response.data.result;
                            }
                            if (vm.availableParkingSlots <= 0)
                                vm.parkingNotAvailable = true;

                            updateLabels();
                        },
                        function (error) {
                            MessageService.showInformation(error);
                        });
        };

        function getVehicles() {
            vehicleService.getVehiclesForPassenger(reservationInfo.passengerId)
            .then(function (response) {

                getParkingInfo();

                if (response.data.status === 1 && response.data.result.passengerVehicles != null) {
                    vm.vehicles = response.data.result.passengerVehicles;
                    vm.vehicles.splice(0, 0, noVehicle);
                    vm.selectedVehicle = findDefault(vm.vehicles);
                    vm.hasVehicles = true;

                    if (vm.isAMReservation)
                        vm.needsParking = true;
                }

                if (!vm.vehicles || vm.vehicles.length === 0)
                    vm.selectedVehicle = noVehicle;

                vm.loadingVehicles = false;
            }, function (error) {
                vm.hasVehicles = false;
                vm.loadingVehicles = false;
            });
        }





        function findDefault(vehicles) {
            for (var i = 0; i < vehicles.length; i++) {
                if (vehicles[i].isDefault) return vehicles[i];
            }
            return noVehicle;
        };

        function reservationTimespan() {
            return Date.parse(reservationInfo.reservationDate);
        }



        function reserve() {
            vm.disable = true;
            var reservation = {
                'pickupStopId': reservationInfo.pickupStop.id,
                'dropoffStopId': reservationInfo.dropoffStop.id,
                'tripId': reservationInfo.trip.tripId,
                'reservationDate': reservationInfo.reservationDate,
                'passengerId': reservationInfo.passengerId,
                'divisionId': reservationInfo.divisionId,
                'routeId': reservationInfo.trip.routeId,
                'schedule': reservationInfo.scheduleType,
                'companions' :vm.selectedCompanions

            };

            if (vm.needsParking && !angular.isUndefined(vm.selectedVehicle.id)) {
                reservation.vehicleId = vm.selectedVehicle.id;
            }

            ReservationService.addReservations(reservationInfo.passengerId, [reservation]).then(handleReservationSuccess);
        };

        function handleReservationSuccess(response) {
            if (response.data && response.data.status == 1) {

                if (response.data.result.errors && response.data.result.errors.length > 0)
                    MessageService.showInformation(response.data.result.errors[0]);
                else
                    getReservation(reservationInfo.passengerId, response.data.result.id[0]);
            } else
                MessageService.showInformation("Error processing reservation.");

            vm.disable = false;
        }


        function getReservation(passengerId, rId) {
            ReservationService.getReservationById(passengerId, rId)
            .then(function (response) {
                vm.isReserved = true;
                vm.confirmationNumber = response.data.result.confirmationNumber;
                //hide parking section if not selected.
                if (!vm.needsParking)
                    vm.isParkingAttachedToReservation = false;

                StopDataService.getAvailableParkingsForStop(reservationInfo.pickupStop.id, reservationTimespan())
               .then(function (response) {
                   if (response.data.status === 1 && response.data.result) {
                       vm.availableParkingSlots = response.data.result;
                   }
               });
            });
        }

        vm.cancel = function () {
            $uibModalInstance.close({
                'action': 'close', 'isReserved': vm.isReserved
            });
        };

        vm.navigateToReservationPage = function () {
            $uibModalInstance.close({
                'action': 'reservation'
            });
        };

        vm.navigateToAddVehicles = function () {
            $uibModalInstance.close({
                'action': 'vehicle'
            });
        };

        this.MakeDisable = function () {
            if (vm.disable) {
                return true;
            }
            else {
                return false;
            }
        };

        init();
    }
})();



(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .controller('StopsMapController', StopsMapController);

    StopsMapController.$inject = ['$location', 'GeoLocationService',
        'StopDataService', 'uiGmapIsReady', 'LocationService', '$http', '$timeout',
        'schedule_stops', 'routeData', '$uibModalInstance', '$window'];

    function StopsMapController($location, GeoLocationService,
        StopDataService, uiGmapIsReady, LocationService, $http, $timeout,
        schedule_stops, routeData, $uibModalInstance, $window) {

        var vm = this;
        vm.title = 'Schedule Stops'
        vm.mapControl = {};
        vm.stopMarker = [];
        vm.map = {
            // http://angular-google-maps.org/use
            center: {
                latitude: 43.75514221191406,
                longitude: -116.57597351074219
            },
            zoom: 10,
            lineStyle: {
                color: '#333',
                weight: 5,
                opacity: 0.7
            }
        };
        var myStyles = [
           {
               featureType: "poi",
               elementType: "labels",
               stylers: [
                     { visibility: "off" }
               ]
           },
           {
               "featureType": "transit",
               "elementType": "labels.icon",
               "stylers": [
                   {
                       "visibility": "off"
                   }
               ]
           }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: myStyles

        };

        var busStopGreen, busStopGrey, hubIcon, pickupIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            busStopGreen = 'images/pin-busstop-green.png';
            busStopGrey = 'images/pin-busstop-grey.png';
            hubIcon = 'images/pin-hub.png';
            pickupIcon = 'images/pin_pickup.png';
        }
        else {
            busStopGreen = 'images/pin-busstop-green.svg';
            busStopGrey = 'images/pin-busstop-grey.svg';
            hubIcon = 'images/pin-hub.svg';
            pickupIcon = 'images/pin_pickup.svg';
        }

        vm.scheduleStops = schedule_stops;

        if (vm.scheduleStops.IsAM) {// TBD add this field
            angular.forEach(vm.scheduleStops.stops, function (stop) {
                vm.icon = { url: busStopGreen };
                if (stop.isHub) {
                    vm.icon = { url: hubIcon }
                }
                vm.stopMarker.push({
                    'stopId': stop.stopId, 'stopName': stop.name,
                    'latitude': stop.latitude, 'longitude': stop.longitude,
                    'icon': vm.icon,
                    'address': stop.address
                });
            });
        }
        else {
            angular.forEach(vm.scheduleStops.stops, function (stop) {
                vm.icon = { url: busStopGrey };
                if (stop.isHub) {
                    vm.icon = { url: hubIcon }
                }
                vm.stopMarker.push({
                    'stopId': stop.stopId, 'stopName': stop.name,
                    'latitude': stop.latitude, 'longitude': stop.longitude,
                    'icon': vm.icon,
                    'address': stop.address
                });
            });
        }

        vm.icon = 'images/pin_pickup.svg';
        vm.icon = { url: pickupIcon };
        uiGmapIsReady.promise().then(function (maps) {

            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");

            if (routeData != null && routeData.length > 0) {

                var decodedPath = google.maps.geometry.encoding.decodePath(routeData[0].line);

                var line = new google.maps.Polyline({
                    path: decodedPath,
                    strokeOpacity: 0.5,
                    strokeWeight: 5,
                    icons: [{
                        icon: {
                            path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
                            strokeOpacity: 0,
                            fillOpacity: 1,
                            scale: 2.5
                        },
                        offset: '25px',
                        repeat: '200px',

                    }],
                    zIndex: 1
                });
                var lineStroke = new google.maps.Polyline({
                    path: decodedPath,
                    strokeColor: '#fff',
                    strokeOpacity: 1.0,
                    strokeWeight: 8,
                    zindex: 0
                });
                line.setMap(vm.mapControl.getGMap());
                lineStroke.setMap(vm.mapControl.getGMap());


            }
            var bounds = new google.maps.LatLngBounds();

            if (decodedPath && decodedPath.length > 0)
                angular.forEach(decodedPath, function (l) {
                    bounds.extend(new google.maps.LatLng(l.lat(), l.lng()));
                });
            else {
                angular.forEach(vm.stopMarker, function (m) {
                    bounds.extend(new google.maps.LatLng(m.latitude, m.longitude));
                });

            }
            vm.mapControl.getGMap().fitBounds(bounds);

        });

        vm.polylines = [{
            id: 1,
            path: vm.path,
            stroke: {
                color: '#6060FB',
                weight: 5
            },
            editable: false,
            draggable: false,
            geodesic: true,
            visible: true,
        }];

        //marker click function
        vm.markerEvent = {
            click: function (gMarker, eventName, model) {
                if (model.$id) {
                    //navigateToSelectedStop(model.coords);
                    if (vm.selectedLocation)
                        StopDataService.setGeoLocation(vm.selectedLocation);
                    StopDataService.setStop(model.coords);
                    vm.coords = model.coords;
                    vm.show = true;
                }
            }
        };

        vm.cancel = function () {
            $uibModalInstance.dismiss('cancel');
            vm.isDone = true;
        };
    }

})();

(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .directive('backControl', backControl);

    backControl.$inject = ['$window'];

    function backControl($window) {

        var directive = {
            restrict: 'E',
            controller: controller,
            replace:true,
            template: '<button class="go-back" ng-click="goBack()">Back</button>'
        };
        return directive;

        function controller($scope,$window) {
            $scope.goBack = function () {
                $window.history.back();
            }
        }
    }

})();
(function() {
    'use strict';

    angular
        .module('oneMVApp')
        .filter('routeStopsName', function () {
            return function (routeLongName) {
                if (routeLongName && routeLongName.length > 0) {
                    var startIndex = routeLongName.indexOf("-") + 1;
                    var endIndex = routeLongName.length;
                    return routeLongName.substring(startIndex, endIndex);
                }
            }
        });

    angular
        .module('oneMVApp')
        .filter('routeShortName', function () {
            return function (routeLongName) {
                if (routeLongName && routeLongName.length > 0) {
                    var startIndex = 0;
                    var endIndex = routeLongName.indexOf("-") - 1;
                    return routeLongName.substring(startIndex, endIndex);
                }
            }
        });

    angular
        .module('oneMVApp')
        .directive('routeCard', routeCard);

    routeCard.$inject = ['$window'];
    
    function routeCard($window) {
        // Usage:
        //     <route-card></route-card>
        // Creates:
        // 
        var directive = {
            link: link,
            restrict: 'EA',
            controller: controller,
            scope: { routeInfo: '=', onSelect: '&', pinnable: '='},
            templateUrl: 'app/modules/fixed-route/directives/route-card/route-card.html'
        };
        return directive;

        function link(scope, element, attrs) {
            scope.$watch("routeInfo", function (newValue, oldValue) {
                //This gets called when data changes.
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string")
                        scope.routeInfo = JSON.parse(newValue);
                    else if (typeof newValue == "object")
                        scope.routeInfo = newValue;
                    scope.activate();
                }

            });
        }

        

        function controller($scope, $location) {
            
           
            $scope.activateTrip = activateTrip;
            $scope.activateRoute = activateRoute;
            $scope.gotoRouteWithStops = gotoRouteWithStops;
            $scope.activate = activate;
            //$scope.isRouteSelected = false;
            $scope.activeTrip = null;

            activate();

            function activate() {
                var isAnyTripActive = false;
                for (var i = 0; i < $scope.routeInfo.trips.length; i++) {
                    if ($scope.routeInfo.trips[i].isActive) {
                        $scope.activeTrip = $scope.routeInfo.trips[i];
                        isAnyTripActive = true;
                        break;
                    } 
                };
                if (!isAnyTripActive) {
                    if ($scope.routeInfo && $scope.routeInfo.trips && !$scope.activeTrip) {
                        $scope.activeTrip = $scope.routeInfo.trips[0];
                        $scope.routeInfo.trips[0].isActive = true;
                    }
                }

            }

            function activateTrip(trip) {
                $scope.activeTrip = trip;
                for (var i = 0; i < $scope.routeInfo.trips.length; i++) {

                    if ($scope.routeInfo.trips[i] === trip) {
                        $scope.routeInfo.trips[i].isActive = true;
                    } else {
                        $scope.routeInfo.trips[i].isActive = false;
                    }
                };
            }

            function activateRoute() {
                $scope.routeInfo.isSelected = !$scope.routeInfo.isSelected
                //Send back the selected route to parent controller
                if ($scope.onSelect && typeof $scope.onSelect === "function")
                    $scope.onSelect({ schedule: $scope.routeInfo });
            };

            function gotoRouteWithStops() {
                $location.path("fixed-route/routes/" + $scope.routeInfo.route.id);
            }
        }
    }

})();
(function () {
    'use strict';  
    angular
        .module('oneMVApp')
        .directive('stopArrivalInfo', stopArrivalInfo);

    stopArrivalInfo.$inject = [];

    function stopArrivalInfo() {

        var directive = {
            link: link,
            restrict: 'E',
            controller: controller,            
            scope: { routeArrival: '=', selectedStopId:'=' },
            templateUrl: 'app/modules/fixed-route/directives/stop-arrival-info/stop-arrival-info.html'
        };
        return directive;

        function link(scope, element, attrs) {

        }

        function controller($scope) {

            $scope.selectedArrivalIndex = 0;

            $scope.showArrivals = function (index) {
                $scope.selectedArrivalIndex = index;
            }

            var x = $scope.selectedStopId;

        }
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MenuController', MenuController);

    MenuController.$inject = ['$scope'];

    function MenuController($scope) {
        //var vm = this;
        $scope.onHammer = function onHammer (event) {
            $scope.eventType = event.type;
            console.log(event.type);
          };

        $scope.carouselOptions = {
            navText: ["", ""],
            responsiveClass: false,
            nav: true,
            onDrag:noscroll,
            onDragged:goscroll, 

            responsive: {
                0: {
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                375:{
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                768: {
                    items: 2,
                    stagePadding: 16,
                    startPosition: 1,
                    center: true,
                },
                992: {
                    items: 3,
                    stagePadding: 0,
                    center: false,
                    mergeFit:true
                }

            }
        };

        function noscroll(event) {
            angular.element('html').addClass('no-scroll');

        }
        function goscroll(event) {
            angular.element('html').removeClass('no-scroll');
        }
    }
})();

(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('owlCarousel', MVOwlCarousel);

    MVOwlCarousel.$inject = [];

    function MVOwlCarousel() {
        return {
            restrict: 'E',
            transclude: false,
            link: function (scope) {
                scope.initCarousel = function (element) {
                    // provide any default options you want
                    var defaultOptions = {
                    };
                    var customOptions = scope.$eval($(element).attr('data-options'));
                    // combine the two options objects
                    for (var key in customOptions) {
                        defaultOptions[key] = customOptions[key];
                    }
                    // init carousel
                    $(element).owlCarousel(defaultOptions);
                };
            }
        };
    }
})();


(function () {
    'use strict';

    angular.module('oneMVApp')
    .controller('RatingModalController', RatingModalController);

    RatingModalController.$inject = ['$scope', '$http', 'UtilityFactory',
        'ConfigFactory', '$uibModalInstance', 'trip', 'selectedRating', 'FeedbackService', 'authService'];

    function RatingModalController($scope, $http, UtilityFactory, ConfigFactory,
        $uibModalInstance, trip, selectedRating, FeedbackService, authService) {
        var vm = this;
        vm.trip = trip;

        vm.cancel = cancel;
        vm.saveFeedback = saveFeedback;

        vm.feedback = {
            rating: selectedRating,
            comment: ''
        };

        vm.disableSubmit = function () {
            var result = true;
            if (vm.feedback.rating > 0) {
                result = false;
            }

            return result;
        };

        function cancel() {
            $uibModalInstance.close();
        };

        function saveFeedback() {
            var feedbackRequest = {
                PassengerRating: vm.feedback.rating,
                Comment: vm.feedback.comment,
                TripId: vm.trip.TripId,
                CreatedBy: authService.authentication.passengerId
            };

            FeedbackService.SaveFeedback(feedbackRequest).then(function (response) {
                if (response.data.status == 1) {
                    vm.isSaving = false;
                    UtilityFactory.toastSuccess("Success!", "Feedback saved successfully");
                    $uibModalInstance.close(feedbackRequest);
                } else {
                    vm.isSaving = false;
                    UtilityFactory.toastError("Error!", "Could not save feedback");
                    $log.error('Error: - ' + response.data.message);
                }
            }, function errorCallback(response) {
                vm.isSaving = false;
                UtilityFactory.toastError("Error!", "Could not save feedback");
                $log.error('Error: - ' + response.data.message);
            });

        }
    }
})();
(function () {
    'use strict';
    angular.module("oneMVApp").directive('starRatingDirective', starRatingDirective);

    function starRatingDirective() {

        return {
            restrict: 'E',
            scope: {
                tripInfo: '=',
                options: '@',
                allowTripRating: '@'
            },
            templateUrl: 'app/modules/on-demand/reservations/rating-component/starRating.html',
            controller : controllerFunction
        };

        function controllerFunction($scope, $uibModal) {
            $scope.jsTripInfo = $scope.tripInfo; //JSON.parse($scope.tripInfo);
            $scope.jsOptions = JSON.parse($scope.options);
            $scope.rating = $scope.jsTripInfo.rating;
            $scope.ratingComment = $scope.jsTripInfo.ratingComment;
            $scope.mvReadOnly = false;

            var setRating = function () {
                //let today = new Date($scope.serviceDate);
                var serviceDate = new Date($scope.jsTripInfo.serviceDate);
                var arrRestrictedValues = ["No-show", "Cancel"];

                if ($scope.allowTripRating == false && $scope.jsTripInfo.rating <= 0) {
                    $scope.mvReadOnly = false;
                }
                else {
                    if (arrRestrictedValues.indexOf($scope.jsTripInfo.Status) >= 0) {
                        $scope.mvReadOnly = false;
                    }
                    else {

                        if ($scope.jsTripInfo.rating > 0) {
                            $scope.mvReadOnly = true;
                        };
                    }
                }
            };




            $scope.showRatingModal = function () {
                if ($scope.mvReadOnly) {
                    return false;
                }

                var modalInstance = $uibModal.open({
                    templateUrl: 'app/modules/on-demand/reservations/rating-component/ratingModal.html',
                    controller: 'RatingModalController as vm',
                    resolve: {
                        trip: $scope.jsTripInfo,
                        selectedRating: $scope.rating
                    }
                });

                modalInstance.result.then(function (item) {
                    if (!angular.isUndefined(item)) {
                        $scope.rating = item.PassengerRating;
                        $scope.ratingComment = item.Comment;
                        $scope.jsTripInfo.ratingComment = item.Comment;
                        $scope.jsTripInfo.rating = item.PassengerRating;
                        $scope.mvReadOnly = true;
                    }
                    else {
                        $scope.rating = 0;
                    }

                }, function () {
                    // dismiss
                });
            }

            setRating();

        }
    }
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9uZW12LWNvbnRyb2xsZXIuanMiLCJjb3JlL2RpcmVjdGl2ZXMvaHRtbC1kaXJlY3RpdmUuanMiLCJjb3JlL2RpcmVjdGl2ZXMva2V5ZG93bi5qcyIsImNvcmUvZGlyZWN0aXZlcy9uZ0xvYWRTY3JpcHQuanMiLCJjb3JlL2RpcmVjdGl2ZXMvcGhvbmVudW1iZXJEaXJlY3RpdmUuanMiLCJjb3JlL3NlcnZpY2VzL0NvbmZpZ0ZhY3RvcnkuanMiLCJjb3JlL3NlcnZpY2VzL0RhdGFWYWxpZGF0aW9uRmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvRGF0ZUZhY3RvcnkuanMiLCJjb3JlL3NlcnZpY2VzL0xvY2F0aW9uRmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvU2VjdXJpdHlGYWN0b3J5LmpzIiwiY29yZS9zZXJ2aWNlcy9VdGlsaXR5RmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvYXV0aEludGVyY2VwdG9yU2VydmljZS5qcyIsImNvcmUvc2VydmljZXMvYXV0aFNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2NvbW1vblNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2NvbW11bmljYXRpb25zLXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2RhdGUtdXRpbGl0eS1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9kaXZpc2lvblNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2R5bmFtaWMtY29udGVudC1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9nZW8tbG9jYXRpb24tc2VydmljZS5qcyIsImNvcmUvc2VydmljZXMvbG9naW4tc2VydmljZS5qcyIsImNvcmUvc2VydmljZXMvbHV1bUxpbmtlZFNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL21hcC1pY29uLXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL21hcFNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL21lc3NhZ2UtYm94LmpzIiwiY29yZS9zZXJ2aWNlcy9vbmUtbXYtc2VydmljZXMtZmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvcGFnZVNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL3Bhc3N3b3JkLXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL3BvcnRhbC11dGlsaXR5LXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL3Byb2ZpbGVTZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9yZWRpcmVjdGlvbi1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9yZXNlcnZhdGlvbi1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9zZXJ2aWNlLWFyZWEtc2VydmljZS5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvYWxsLXN0b3BzL2FsbC1zdG9wcy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9kaXJlY3Rpb25zL2RpcmVjdGlvbnMtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvaG9tZS9ob21lLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS9hZHYtc2NoZWR1bGUtY29uZmlybWF0aW9uLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS9hZHYtc2NoZWR1bGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvYWR2LXNjaGVkdWxlL2Fkdi1zY2hlZHVsZS1zZXR1cC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9hZHYtc2NoZWR1bGUvcmVzZXJ2YXRpb24tbW9kYWwuanMiLCJtb2R1bGVzL2NvbW11dGVyL2xvY2F0aW9uL2xhc3QtbG9jYXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbG9jYXRpb24vbG9jYXRpb24tc2VydmljZS5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbWVzc2FnZS9tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL21lc3NhZ2UvbWVzc2FnZS1zZXJ2aWNlLmpzIiwibW9kdWxlcy9jb21tdXRlci9teS12ZWhpY2xlcy9teS12ZWhpY2xlcy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9teS12ZWhpY2xlcy92ZWhpY2xlLXNlcnZpY2UuanMiLCJtb2R1bGVzL2NvbW11dGVyL3B1Ymxpc2hlZC1zY2hlZHVsZS9wdWJsaXNoZWQtc2NoZWR1bGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvcHVibGlzaGVkLXNjaGVkdWxlL3B1Ymxpc2hlZC1zY2hlZHVsZS1zZXJ2aWNlLmpzIiwibW9kdWxlcy9jb21tdXRlci9zY2hlZHVsZS9zY2hlZHVsZS1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9zZWxlY3RlZC10cmlwL3NlbGVjdGVkLXRyaXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvc2VsZWN0ZWQtdHJpcC9zZWxlY3RlZC10cmlwLXNlcnZpY2UuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL0xhbmRpbmcvbGFuZGluZy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9zdG9wL3NlYXQtYXZhaWxhYmlsaXR5LmNvbXBvbmVudC5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvc3RvcC9zZWxlY3RlZC1zdG9wLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL3N0b3Avc2VsZWN0ZWRTdG9wLW5wdC5jb21wb25lbnQuanMiLCJtb2R1bGVzL2NvbW11dGVyL3N0b3Avc3RvcC1kYXRhLXNlcnZpY2UuanMiLCJtb2R1bGVzL2NvbW11dGVyL3N0b3AvdmVoaWNsZS1kYXRhLXNlcnZpY2UuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3JvdXRlcy9hbGwtcm91dGVzLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3NjaGVkdWxlL2ZyLXNjaGVkdWxlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3NlcnZpY2VzL2ZyLW5vdGlmaWNhdGlvbnMtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvc2VydmljZXMvZnItc2NoZWR1bGUtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvc2VydmljZXMvcm91dGUtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvc2VydmljZXMvc3RvcC1zZXJ2aWNlLmpzIiwibW9kdWxlcy9maXhlZC1yb3V0ZS9zZXJ2aWNlcy92ZWhpY2xlLXNlcnZpY2UuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3N0b3BzL2ZyLXN0b3BzLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3N0b3BzLWZvci1yb3V0ZS9zdG9wcy1mb3Itcm91dGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvYWN0aXZlLXRyaXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvcGFzc2VuZ2VyLW1vYmlsZS1tb2RhbC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvZmFyaW5nL2ZhcmluZy1tb2RhbC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvZGFzaGJvYXJkL2Rhc2hib2FyZC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL2Rpc3BsYXlUcmlwLW1vZGFsLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvZmFyaW5nLXNlcnZpY2UuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvZmVlZGJhY2stc2VydmljZS5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9maXhlZC1yb3V0ZXMtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9sb2NhdGlvblNlYXJjaERpcmVjdGl2ZS5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9sb2NhdGlvblNlcnZpY2UuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvbW9iaWxpdHktYWlkcy1zZXJ2aWNlLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL25lZ290aWF0aW9uLW1vZGFsLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb24tbW9kYWwtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9yZXNlcnZhdGlvbkZvcm1EaXJlY3RpdmUuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb25NYXBEaXJlY3RpdmUuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb25zLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvc2NoZWR1bGUtc2VydmljZS5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy90cmlwLW5lZ290aWF0aW9uLWxvZy1zZXJ2aWNlLmpzIiwibW9kdWxlcy9zaGFyZWQvbG9naW4vZm9yZ290LXBhc3N3b3JkLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL3NoYXJlZC9sb2dpbi9sb2dpbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbG9naW4vb25lbXYtbG9naW4tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL2xvZ2luL3ZlcmlmeS11cGRhdGUtcGFzc3dvcmQtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL2RpdmlzaW9uL2RpdmlzaW9ucy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbG9nb3V0L2xvZ291dC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbWluLWFwcC1zdXBwb3J0L21pbi1hcHAtc3VwcG9ydC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbmF2L25hdi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1pdGVtLmNvbXBvbmVudC5qcyIsIm1vZHVsZXMvc2hhcmVkL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24tc2VydmljZS5qcyIsIm1vZHVsZXMvc2hhcmVkL3Byb2ZpbGUvY2hhbmdlLXBhc3N3b3JkLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL3NoYXJlZC9wcm9maWxlL2hvbWVBZGRyZXNzRGlyZWN0aXZlLmpzIiwibW9kdWxlcy9zaGFyZWQvcHJvZmlsZS9wcm9maWxlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL3NoYXJlZC9wdXNoTm90aWZpY2F0aW9ucy9kaXNwbGF5LXB1c2gtbWVzc2FnZS1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvcmVnaXN0cmF0aW9uL2V4dGVybmFsLXJlZ2lzdHJhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvcmVnaXN0cmF0aW9uL29uZW12LXJlZ2lzdHJhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvc2V0dGluZ3Mvc2V0dGluZ3MtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3NldHRpbmdzL3NldHRpbmdzLXNlcnZpY2UuanMiLCJtb2R1bGVzL3NoYXJlZC9zdXBwb3J0L3N1cHBvcnQtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3RyaXBzL2NvbW11dGVyLXRyaXAtbW9kYWwuanMiLCJtb2R1bGVzL3NoYXJlZC90cmlwcy9jb21tdXRlci10cmlwcy5qcyIsIm1vZHVsZXMvc2hhcmVkL3RyaXBzL2RydC10cmlwLW1vZGFsLmpzIiwibW9kdWxlcy9zaGFyZWQvdHJpcHMvcGFzc2VuZ2VyLXRyaXBzLmpzIiwibW9kdWxlcy9zaGFyZWQvdHJpcHMvdHJpcENhcmREaXJlY3RpdmUuanMiLCJtb2R1bGVzL3NoYXJlZC90cmlwcy91c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlLmpzIiwibW9kdWxlcy9zaGFyZWQvd2hhdHMtbmV3L3doYXRzLW5ldy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvdmVyaWZpY2F0aW9uL3ZlcmlmaWNhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvdmVyaWZpY2F0aW9uL3ZlcmlmaWNhdGlvbi1zZXJ2aWNlLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvYWRkLXZlaGljbGUtbW9kYWwvYWRkLXZlaGljbGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL2NhbmNlbC1yZXNlcnZhdGlvbi1tb2RhbC9jYW5jZWwtcmVzZXJ2YXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL21vZGlmeS1yZXNlcnZhdGlvbi1tb2RhbC9tb2RpZnktcmVzZXJ2YXRpb24tcGlja3VwLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL21vZGFscy9mZWVkYmFjay1tb2RhbC9jb21tdXRlci1mZWVkYmFjay1tb2RhbC5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3JlbW92ZS12ZWhpY2xlLW1vZGFsL3JlbW92ZS12ZWhpY2xlLWNvbmZpcm1hdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbWFwLW1vZGFsL3Jlc2VydmF0aW9uLW1hcC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbW9kYWwvcmVzZXJ2YXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3N0b3BzLW1hcC1tb2RhbC9zdG9wcy1tYXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvZGlyZWN0aXZlcy9iYWNrL2JhY2suanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL2RpcmVjdGl2ZXMvcm91dGUtY2FyZC9yb3V0ZS1jYXJkLmpzIiwibW9kdWxlcy9maXhlZC1yb3V0ZS9kaXJlY3RpdmVzL3N0b3AtYXJyaXZhbC1pbmZvL3N0b3AtYXJyaXZhbC1pbmZvLmpzIiwibW9kdWxlcy9zaGFyZWQvZGFzaGJvYXJkL21lbnUvbWVudS1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3JhdGluZy1jb21wb25lbnQvUmF0aW5nTW9kYWxDb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3JhdGluZy1jb21wb25lbnQvc3RhclJhdGluZ0RpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNWZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOWlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcmtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4ZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFtQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDak9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcnBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5ZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9iQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3haQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1vZHVsZXMuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdPbmVNVkNvbnRyb2xsZXInLCBPbmVNVkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE9uZU1WQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHNjb3BlJywgJ0RpdmlzaW9uU2VydmljZScsICckcm9vdFNjb3BlJywgJyRpbnRlcnZhbCcsICdlbnYnLCAnUGFnZVNlcnZpY2UnLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywgJyRsb2cnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBPbmVNVkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc2NvcGUsIERpdmlzaW9uU2VydmljZSwgJHJvb3RTY29wZSwgJGludGVydmFsLCBlbnYsIFBhZ2VTZXJ2aWNlLCBSZWRpcmVjdGlvblNlcnZpY2UsICRsb2cpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5kaXZpc2lvbiA9IFwiZGVmYXVsdFwiO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uYnJhbmQgPSAnYmFzZSc7XHJcbiAgICAgICAgaWYgKGVudi5pb25pYykge1xyXG4gICAgICAgICAgICB2bS5pb25pYyA9IGVudi5pb25pYztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2bS5pb25pYyA9IHt9O1xyXG4gICAgICAgICAgICB2bS5pb25pYy5zaG93TWVudSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBpZiAoRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSlcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgICAuZ2V0RGl2aXNpb25JbmZvKClcclxuICAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVTdWNjZXNzLCBoYW5kbGVGYWlsdXJlKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgaGFuZGxlRmFpbHVyZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlU3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHNldERpdmlzaW9uVmFsdWVzKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRmFpbHVyZShlcnJvcikge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2RpdmlzaW9uJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYWpvckFwcFZlcnNpb24obWFqb3JObykge1xyXG4gICAgICAgICAgICB2YXIgX21ham9yQXBwTm8gPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAobWFqb3JObykge1xyXG4gICAgICAgICAgICAgICAgdmFyIF9hcnIgPSBtYWpvck5vLnNwbGl0KCd2Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2FyciAmJiBfYXJyLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbWFqb3JBcHBObyA9IF9hcnJbMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKFwiQXBwIFZlcnNpb24gbm90IHNldHVwIGNvcnJlY3RseSBpbiBEQi5cIik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIF9tYWpvckFwcE5vO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFqb3JTd1ZlcnNpb24obWFqb3JObykge1xyXG4gICAgICAgICAgICB2YXIgX21ham9yU3dObyA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChtYWpvck5vKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX2FyciA9IG1ham9yTm8uc3BsaXQoJ3N3Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2FyciAmJiBfYXJyLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbWFqb3JTd05vID0gX2FyclsxXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gX21ham9yU3dObztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0FOdW1iZXIobm8pIHtcclxuICAgICAgICAgICAgcmV0dXJuICFpc05hTihubyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc01pblZlcnNpb24oZGl2aXNpb24pIHtcclxuICAgICAgICAgICAgdmFyIGlzTWluVmVyc2lvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChkaXZpc2lvbi5NaW5BcHBWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGJBcHBWZXJzaW9ucyA9IGRpdmlzaW9uLk1pbkFwcFZlcnNpb24uc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VmVyc2lvbnMgPSBlbnYuYXBwVmVyc2lvbi5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgZGJObyA9IChnZXRNYWpvckFwcFZlcnNpb24oZGJBcHBWZXJzaW9uc1swXSkgKiAxMDAwMCkgKyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChldmFsKGRiQXBwVmVyc2lvbnNbMV0pICogMTAwKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGJBcHBWZXJzaW9uc1syXSA/IGV2YWwoZGJBcHBWZXJzaW9uc1syXSkgOiAwKVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50QXBwTm8gPSAoZ2V0TWFqb3JBcHBWZXJzaW9uKGN1cnJlbnRWZXJzaW9uc1swXSkgKiAxMDAwMCkgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXZhbChjdXJyZW50VmVyc2lvbnNbMV0pICogMTAwKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjdXJyZW50VmVyc2lvbnNbMl0gPyBldmFsKGN1cnJlbnRWZXJzaW9uc1syXSkgOiAwKVxyXG5cclxuICAgICAgICAgICAgICAgIGlzTWluVmVyc2lvbiA9IGN1cnJlbnRBcHBObyA+PSBkYk5vO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGlzTWluVmVyc2lvbjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXREaXZpc2lvblZhbHVlcyhkaXZpc2lvbikge1xyXG4gICAgICAgICAgICB2YXIgbXNnID0ge3R5cGU6XCJjaGVja01pbkFwcFZlcnNpb25cIiwgZGF0YTogZGl2aXNpb259O1xyXG4gICAgICAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5kaXIobXNnKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShtc2cpKTtcclxuICAgICAgICAgICAgIH1jYXRjaChlKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZW52LmlvbmljICYmICFpc01pblZlcnNpb24oZGl2aXNpb24pKSB7XHJcbiAgICAgICAgICAgICAgICBSZWRpcmVjdGlvblNlcnZpY2UucmVkaXJlY3RUbygnL21pbi1hcHAtc3VwcG9ydCcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChkaXZpc2lvbi5IYXNDdXN0b21TZXR1cCl7XHJcbiAgICAgICAgICAgICAgICB2bS5icmFuZCA9IGRpdmlzaW9uLkRpdmlzaW9uSUQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5icmFuZCA9ICdiYXNlJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdm0uZGl2aXNpb24gPSBkaXZpc2lvbi5EaXZpc2lvbklEO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vIGRvY3VtZW50LnRpdGxlID0gZGl2aXNpb24uTWV0YVRpdGxlO1xyXG4gICAgICAgICAgICAvLyB2bS50aXRsZSA9IGRpdmlzaW9uLk1ldGFUaXRsZTs7XHJcbiAgICAgICAgICAgIC8vIHZtLmRlc2NyaXB0aW9uID0gZGl2aXNpb24uTWV0YURlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLnN1cHBvcnRQaG9uZU51bWJlciA9IGRpdmlzaW9uLlN1cHBvcnRQaG9uZU51bWJlcjtcclxuICAgIH1cclxuXHJcblxyXG4gICAgICAgIGlmIChEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpKVxyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignZGl2aXNpb25DaGFuZ2VkJywgYWN0aXZhdGUpO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnZHluYW1pYycsIEh0bWxEaXJlY3RpdmUpO1xyXG5cclxuICAgIEh0bWxEaXJlY3RpdmUuJGluamVjdCA9IFsnJGNvbXBpbGUnXTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gSHRtbERpcmVjdGl2ZSgkY29tcGlsZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlLCBhdHRycykge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLmR5bmFtaWMsIGZ1bmN0aW9uIChodG1sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlLmh0bWwoaHRtbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGNvbXBpbGUoZWxlLmNvbnRlbnRzKCkpKHNjb3BlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiLy92YXIgbW9kID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbi8vbW9kLmRpcmVjdGl2ZSgnb25LZXlkb3duJywgZnVuY3Rpb24gKCkge1xyXG4vLyAgICByZXR1cm4ge1xyXG4vLyAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuLy8gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuLy8gICAgICAgICAgICAvLyB0aGlzIG5leHQgbGluZSB3aWxsIGNvbnZlcnQgdGhlIHN0cmluZ1xyXG4vLyAgICAgICAgICAgIC8vIGZ1bmN0aW9uIG5hbWUgaW50byBhbiBhY3R1YWwgZnVuY3Rpb25cclxuLy8gICAgICAgICAgICB2YXIgZnVuY3Rpb25Ub0NhbGwgPSBzY29wZS4kZXZhbChhdHRycy5vbktleWRvd24pO1xyXG4vLyAgICAgICAgICAgIGVsZW0ub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4vLyAgICAgICAgICAgICAgICAvLyBvbiB0aGUga2V5ZG93biBldmVudCwgY2FsbCBteSBmdW5jdGlvblxyXG4vLyAgICAgICAgICAgICAgICAvLyBhbmQgcGFzcyBpdCB0aGUga2V5Y29kZSBvZiB0aGUga2V5XHJcbi8vICAgICAgICAgICAgICAgIC8vIHRoYXQgd2FzIHByZXNzZWRcclxuLy8gICAgICAgICAgICAgICAgLy8gZXg6IGlmIEVOVEVSIHdhcyBwcmVzc2VkLCBlLndoaWNoID09IDEzXHJcbi8vICAgICAgICAgICAgICAgIGZ1bmN0aW9uVG9DYWxsKGUpO1xyXG4vLyAgICAgICAgICAgIH0pO1xyXG4vLyAgICAgICAgfVxyXG4vLyAgICB9O1xyXG4vL30pOyIsIi8qZ2xvYmFsIGFuZ3VsYXIgKi9cclxuKGZ1bmN0aW9uIChuZykge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgdmFyIGFwcCA9IG5nLm1vZHVsZSgnbmdMb2FkU2NyaXB0JywgW10pO1xyXG5cclxuICBhcHAuZGlyZWN0aXZlKCdzY3JpcHQnLCBmdW5jdGlvbiAoJHBhcnNlLCAkcm9vdFNjb3BlLCAkY29tcGlsZSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgIHRlcm1pbmFsOiB0cnVlLFxyXG4gICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRyKSB7XHJcbiAgICAgICAgICAgICAgaWYgKGF0dHIubmdTcmMpIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGRvbUVsZW0gPSAnPHNjcmlwdCBzcmM9XCInICsgYXR0ci5uZ1NyYyArICdcIiBhc3luYyBkZWZlcj48L3NjcmlwdD4nO1xyXG4gICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmFwcGVuZCgkY29tcGlsZShkb21FbGVtKShzY29wZSkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gIH0pO1xyXG5cclxufShhbmd1bGFyKSk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ3Bob25lbnVtYmVyRGlyZWN0aXZlJywgcGhvbmVudW1iZXJEaXJlY3RpdmUpXHJcbiAgICAgICAgLmZpbHRlcigncGhvbmVudW1iZXInLCBwaG9uZW51bWJlcik7XHJcbiAgICBwaG9uZW51bWJlckRpcmVjdGl2ZS4kaW5qZWN0ID0gWyckZmlsdGVyJywgJyRicm93c2VyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gcGhvbmVudW1iZXJEaXJlY3RpdmUoJGZpbHRlciwgJGJyb3dzZXIpIHtcclxuICAgICAgICAvKlxyXG5cdFx0SW50ZW5kZWQgdXNlOlxyXG5cdFx0XHQ8cGhvbmVudW1iZXItZGlyZWN0aXZlIHBsYWNlaG9sZGVyPSdwcm9tcHQnIG1vZGVsPSdzb21lTW9kZWwucGhvbmVudW1iZXInPjwvcGhvbmVudW1iZXItZGlyZWN0aXZlPlxyXG5cdFx0V2hlcmU6XHJcblx0XHRcdHNvbWVNb2RlbC5waG9uZW51bWJlcjoge1N0cmluZ30gdmFsdWUgd2hpY2ggdG8gYmluZCBvbmx5IHRoZSBudW1lcmljIGNoYXJhY3RlcnMgWzAtOV0gZW50ZXJlZFxyXG5cdFx0XHRcdGllLCBpZiB1c2VyIGVudGVycyA2MTctMjIyMzMzMywgdmFsdWUgb2YgNjE3MjIyMzMzMyB3aWxsIGJlIGJvdW5kIHRvIG1vZGVsXHJcblx0XHRcdHByb21wdDoge1N0cmluZ30gdGV4dCB0byBrZWVwIGluIHBsYWNlaG9sZGVyIHdoZW4gbm8gbnVtZXJpYyBpbnB1dCBlbnRlcmVkXHJcblx0XHQqL1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsIG5nTW9kZWxDdHJsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJGVsZW1lbnQudmFsKCkucmVwbGFjZSgvW14wLTldL2csICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAkZWxlbWVudC52YWwoJGZpbHRlcigncGhvbmVudW1iZXInKSh2YWx1ZSwgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBydW5zIHdoZW4gd2UgdXBkYXRlIHRoZSB0ZXh0IGZpZWxkXHJcbiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uICgkdmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR2aWV3VmFsdWUucmVwbGFjZSgvW14wLTldL2csICcnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRoaXMgcnVucyB3aGVuIHRoZSBtb2RlbCBnZXRzIHVwZGF0ZWQgb24gdGhlIHNjb3BlIGRpcmVjdGx5IGFuZCBrZWVwcyBvdXIgdmlldyBpbiBzeW5jXHJcbiAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50LnZhbCgkZmlsdGVyKCdwaG9uZW51bWJlcicpKG5nTW9kZWxDdHJsLiR2aWV3VmFsdWUsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICRlbGVtZW50LmJpbmQoJ2NoYW5nZScsIGxpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgICRlbGVtZW50LmJpbmQoJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gZXZlbnQua2V5Q29kZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUga2V5cyBpbmNsdWRlIHRoZSBDVFJMLCBTSElGVCwgQUxULCBvciBNRVRBIGtleXMsIG9yIHRoZSBhcnJvdyBrZXlzLCBkbyBub3RoaW5nLlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbGV0cyB1cyBzdXBwb3J0IGNvcHkgYW5kIHBhc3RlIHRvb1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT0gOTEgfHwgKDE1IDwga2V5ICYmIGtleSA8IDE5KSB8fCAoMzcgPD0ga2V5ICYmIGtleSA8PSA0MCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkYnJvd3Nlci5kZWZlcihsaXN0ZW5lcik7IC8vIEhhdmUgdG8gZG8gdGhpcyBvciBjaGFuZ2VzIGRvbid0IGdldCBwaWNrZWQgdXAgcHJvcGVybHlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRlbGVtZW50LmJpbmQoJ3Bhc3RlIGN1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkYnJvd3Nlci5kZWZlcihsaXN0ZW5lcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHBob25lbnVtYmVyKCkge1xyXG4gICAgICAgIC8qIFxyXG5cdCAgICBGb3JtYXQgcGhvbmVudW1iZXIgYXM6IGMgKHh4eCkgeHh4LXh4eHhcclxuXHQgICAgXHRvciBhcyBjbG9zZSBhcyBwb3NzaWJsZSBpZiBwaG9uZW51bWJlciBsZW5ndGggaXMgbm90IDEwXHJcblx0ICAgIFx0aWYgYyBpcyBub3QgJzEnIChjb3VudHJ5IGNvZGUgbm90IFVTQSksIGRvZXMgbm90IHVzZSBjb3VudHJ5IGNvZGVcclxuXHQgICAgKi9cclxuXHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChudW1iZXIpIHtcclxuICAgICAgICAgICAgLyogXHJcblx0XHQgICAgQHBhcmFtIHtOdW1iZXIgfCBTdHJpbmd9IG51bWJlciAtIE51bWJlciB0aGF0IHdpbGwgYmUgZm9ybWF0dGVkIGFzIHRlbGVwaG9uZSBudW1iZXJcclxuXHRcdCAgICBSZXR1cm5zIGZvcm1hdHRlZCBudW1iZXI6ICgjIyMpICMjIy0jIyMjXHJcblx0XHQgICAgXHRpZiBudW1iZXIubGVuZ3RoIDwgNDogIyMjXHJcblx0XHQgICAgXHRlbHNlIGlmIG51bWJlci5sZW5ndGggPCA3OiAoIyMjKSAjIyNcclxuIFxyXG5cdFx0ICAgIERvZXMgbm90IGhhbmRsZSBjb3VudHJ5IGNvZGVzIHRoYXQgYXJlIG5vdCAnMScgKFVTQSlcclxuXHRcdCAgICAqL1xyXG4gICAgICAgICAgICBpZiAoIW51bWJlcikgeyByZXR1cm4gJyc7IH1cclxuXHJcbiAgICAgICAgICAgIG51bWJlciA9IFN0cmluZyhudW1iZXIpO1xyXG5cclxuICAgICAgICAgICAgLy8gV2lsbCByZXR1cm4gZm9ybWF0dGVkTnVtYmVyLiBcclxuICAgICAgICAgICAgLy8gSWYgcGhvbmVudW1iZXIgaXNuJ3QgbG9uZ2VyIHRoYW4gYW4gYXJlYSBjb2RlLCBqdXN0IHNob3cgbnVtYmVyXHJcbiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWROdW1iZXIgPSBudW1iZXI7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiB0aGUgZmlyc3QgY2hhcmFjdGVyIGlzICcxJywgc3RyaXAgaXQgb3V0IGFuZCBhZGQgaXQgYmFja1xyXG4gICAgICAgICAgICB2YXIgYyA9IChudW1iZXJbMF0gPT0gJzEnKSA/ICcxICcgOiAnJztcclxuICAgICAgICAgICAgbnVtYmVyID0gbnVtYmVyWzBdID09ICcxJyA/IG51bWJlci5zbGljZSgxKSA6IG51bWJlcjtcclxuXHJcbiAgICAgICAgICAgIC8vICMgKCMjIykgIyMjLSMjIyMgYXMgYyAoYXJlYSkgZnJvbnQtZW5kXHJcbiAgICAgICAgICAgIHZhciBhcmVhID0gbnVtYmVyLnN1YnN0cmluZygwLCAzKTtcclxuICAgICAgICAgICAgdmFyIGZyb250ID0gbnVtYmVyLnN1YnN0cmluZygzLCA2KTtcclxuICAgICAgICAgICAgdmFyIGVuZCA9IG51bWJlci5zdWJzdHJpbmcoNiwgMTApO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZyb250KSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtYXR0ZWROdW1iZXIgPSAoYyArIFwiKFwiICsgYXJlYSArIFwiKSBcIiArIGZyb250KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZW5kKSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtYXR0ZWROdW1iZXIgKz0gKFwiLVwiICsgZW5kKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVkTnVtYmVyO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgLy9kZWJ1Z2dlcjtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdDb25maWdGYWN0b3J5JywgQ29uZmlnRmFjdG9yeSk7XHJcbiAgICBDb25maWdGYWN0b3J5LiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudiddO1xyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBDb25maWdGYWN0b3J5KCRodHRwLCAkcSwgZW52KSB7XHJcbiAgICB2YXIgRmFjdG9yeSA9IHtcclxuICAgICAgICBnZXRPbmVNVkFwaVVSTDogZ2V0T25lTVZBcGlVUkwsXHJcbiAgICAgICAgZ2V0T25lTVZBcGlVUkxQcm9taXNlOiBnZXRPbmVNVkFwaVVSTFByb21pc2UsXHJcbiAgICAgICAgcmVzZXRVc2VyQW5kRGl2aXNpb246IHJlc2V0VXNlckFuZERpdmlzaW9uLFxyXG4gICAgICAgIGdldEN1cnJlbnRVc2VyOiBnZXRDdXJyZW50VXNlcixcclxuICAgICAgICBnZXRDdXJyZW50RGl2aXNpb246IGdldEN1cnJlbnREaXZpc2lvbixcclxuICAgICAgICBnZXRDdXJyZW50RGl2aXNpb25UaW1lOiBnZXRDdXJyZW50RGl2aXNpb25UaW1lLFxyXG4gICAgICAgIGdldERpdmlzaW9uUGFyYW1ldGVyczogZ2V0RGl2aXNpb25QYXJhbWV0ZXJzXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjb25maWdEYXRhO1xyXG4gICAgdmFyIGN1cnJlbnRVc2VyO1xyXG4gICAgdmFyIGN1cnJlbnREaXZpc2lvbjtcclxuICAgIHZhciBjdXJyZW50RGl2aXNpb25EYXRlO1xyXG4gICAgdmFyIGN1cnJlbnREaXZpc2lvblN5c1BhcmFtcztcclxuICAgIHZhciB2YWx1ZTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXREaXZpc2lvblBhcmFtZXRlcnMoZGl2aXNpb25JZCkge1xyXG4gICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIGdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICB2YXIgX3VybCA9IG9uZU1WVVJMICsgJ2RpdmlzaW9uLycgKyBkaXZpc2lvbklkICsgJy9zeXN0ZW1QYXJhbWV0ZXJzP2FwcFR5cGU9ZGVza3RvcCZybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgfVxyXG4gICBcclxuICAgIC8vZnVuY3Rpb24gZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkge1xyXG4gICAgLy8gICAgdmFyIF91cmwgPSAnLi4vY2xpZW50YXBwc2V0dGluZ3MuanNvbic7XHJcbiAgICAvLyAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgLy8gICAgaWYgKCFjb25maWdEYXRhKSB7XHJcbiAgICAvLyAgICAgICAgJGh0dHAoe1xyXG4gICAgLy8gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgLy8gICAgICAgICAgICB1cmw6IF91cmxcclxuICAgIC8vICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgLy8gICAgICAgICAgICAvL1RCRFxyXG4gICAgLy8gICAgICAgICAgICBjb25maWdEYXRhID0gcmVzcG9uc2UuZGF0YVxyXG4gICAgLy8gICAgICAgICAgICBkZWZlci5yZXNvbHZlKGNvbmZpZ0RhdGEuQXBpVVJMcy5PbmVNVkFwaVVSTCk7XHJcbiAgICAvLyAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgLy8gICAgICAgICAgICAvL0Vycm9yIGhhbmRsaW5nIFRCRFxyXG4gICAgLy8gICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgLy8gICAgICAgIH0pO1xyXG4gICAgLy8gICAgfSBlbHNlIHtcclxuICAgIC8vICAgICAgICBkZWZlci5yZXNvbHZlKGNvbmZpZ0RhdGEuQXBpVVJMcy5PbmVNVkFwaVVSTCk7XHJcbiAgICAvLyAgICB9XHJcbiAgICAvLyAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgIC8vfVxyXG4gICAgZnVuY3Rpb24gZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkge1xyXG4gICAgICAgXHJcbiAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgIFxyXG4gICAgICAgIGRlZmVyLnJlc29sdmUoZW52Lm9uZU1WQXBpVXJsKTtcclxuICAgICAgIFxyXG4gICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZ2V0T25lTVZBcGlVUkwoKSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZ0RhdGEuQXBpVVJMcy5PbmVNVkFwaVVSTDtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHJlc2V0VXNlckFuZERpdmlzaW9uKCkge1xyXG4gICAgICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcclxuICAgICAgICBjdXJyZW50RGl2aXNpb24gPSBudWxsO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIoKSB7XHJcbiAgICAgICAgX3VybCA9ICcuLi9PcGVyYXRpb24vR2V0Q3VycmVudFVzZXJEZXRhaWxzP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudERpdmlzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnREaXZpc2lvbiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgY3VycmVudERpdmlzaW9uID0gY3VycmVudFVzZXIuRGl2aXNpb25zWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRVc2VyLkN1cnJlbnRMb2dpbiAmJiBjdXJyZW50VXNlci5DdXJyZW50TG9naW4uRGl2aXNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGl2aXNpb24gPSBjdXJyZW50VXNlci5DdXJyZW50TG9naW4uRGl2aXNpb247XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoY3VycmVudFVzZXIpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAvL0Vycm9yIGhhbmRsaW5nIFRCRFxyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShjdXJyZW50VXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG5cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGdldEN1cnJlbnREaXZpc2lvbigpIHtcclxuICAgICAgICB2YXIgX3VybCA9ICcuLi9PcGVyYXRpb24vR2V0Q3VycmVudFVzZXJEZXRhaWxzP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBpZiAoIWN1cnJlbnREaXZpc2lvbikge1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50VXNlciA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnREaXZpc2lvbilcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGl2aXNpb24gPSB7fTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnREaXZpc2lvbiA9IGN1cnJlbnRVc2VyLkRpdmlzaW9uc1swXTtcclxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VXNlci5DdXJyZW50TG9naW4gJiYgY3VycmVudFVzZXIuQ3VycmVudExvZ2luLkRpdmlzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudERpdmlzaW9uID0gY3VycmVudFVzZXIuQ3VycmVudExvZ2luLkRpdmlzaW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShjdXJyZW50RGl2aXNpb24pO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAvL0Vycm9yIGhhbmRsaW5nIFRCRFxyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShjdXJyZW50RGl2aXNpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGdldEN1cnJlbnREaXZpc2lvblRpbWUoKSB7XHJcbiAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICB2YXIgX3VybCA9ICcuLi9PcGVyYXRpb24vR2V0Q3VycmVudERpdmlzaW9uVGltZT9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgY3VycmVudERpdmlzaW9uRGF0ZSA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoY3VycmVudERpdmlzaW9uRGF0ZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlci5yZWplY3QoY3VycmVudERpdmlzaW9uRGF0ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdldE9uZU1WQXBpVVJMUHJvbWlzZSgpOyAvL09uZSBtYW51YWwgY2FsbCB0byBzZXQgdGhlIFVSTC4gVG8gZ2V0IHRoZSBndWFyYW50ZWVkIHVybCB3ZSBuZWVkIHRvIHVzZSB0aGUgcHJvbWlzZSBtZXRob2QuXHJcbiAgICByZXR1cm4gRmFjdG9yeTtcclxufVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIC8vZGVidWdnZXI7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuZmFjdG9yeSgnRGF0YVZhbGlkYXRpb25GYWN0b3J5JywgRGF0YVZhbGlkYXRpb25GYWN0b3J5KTtcclxuICAgIERhdGFWYWxpZGF0aW9uRmFjdG9yeS4kaW5qZWN0ID0gWyckbG9nJywgJyR3aW5kb3cnLCAnJGh0dHAnXTtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gRGF0YVZhbGlkYXRpb25GYWN0b3J5KCRsb2csICR3aW5kb3csICRodHRwKSB7XHJcbiAgICAgICAgdmFyIGZhY3RvcnkgPSB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRlWmlwQ29kZTogdmFsaWRhdGVaaXBDb2RlLFxyXG4gICAgICAgICAgICB2YWxpZGF0ZVppcENvZGVOZXc6IHZhbGlkYXRlWmlwQ29kZU5ld1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gZmFjdG9yeTtcclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkb1Bvc3RIdHRwUmVxdWVzdCh1cmwpIHtcclxuICAgICAgICAgICAgdmFyIGdvb2dsZVVybCA9IHVybDtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgIHVybDogZ29vZ2xlVXJsLFxyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogZmFsc2VcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlWmlwQ29kZU5ldyh6aXApIHtcclxuICAgICAgICAgICAgdmFyIGdvb2dsZVVybCA9IFwiLy9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9hZGRyZXNzPVwiICsgemlwICsgXCImc2Vuc29yPXRydWVcIjtcclxuICAgICAgICAgICAgcmV0dXJuIGRvUG9zdEh0dHBSZXF1ZXN0KGdvb2dsZVVybCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZVppcENvZGUoemlwLCB2bSkge1xyXG4gICAgICAgICAgICB2YXIgc3RhdGVDb2RlO1xyXG4gICAgICAgICAgICB2YXIgc3RhdGU7XHJcbiAgICAgICAgICAgIHZhciBnb29nbGVVcmwgPSBcIi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/YWRkcmVzcz1cIiArIHppcCArIFwiJnNlbnNvcj10cnVlXCI7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBnb29nbGVVcmwsXHJcbiAgICAgICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGNhbGxiYWNrIHdpbGwgYmUgY2FsbGVkIGFzeW5jaHJvbm91c2x5XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhZGRyZXNzQ29tcG9uZW50cyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0c1swXS5hZGRyZXNzX2NvbXBvbmVudHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlQ29kZSA9IGFkZHJlc3NDb21wb25lbnRzW2FkZHJlc3NDb21wb25lbnRzLmxlbmd0aCAtIDJdLnNob3J0X25hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBhZGRyZXNzQ29tcG9uZW50c1thZGRyZXNzQ29tcG9uZW50cy5sZW5ndGggLSAyXS5sb25nX25hbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGVDb2RlICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdGVhYmJyID0gc3RhdGVDb2RlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGVDb2RlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnO1xyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiTi9BXCI7XHJcbiAgICAgICAgICAgICAgICAvLyAkc2NvcGUuZXJyID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICAvLyBjYWxsZWQgYXN5bmNocm9ub3VzbHkgaWYgYW4gZXJyb3Igb2NjdXJzXHJcbiAgICAgICAgICAgICAgICAvLyBvciBzZXJ2ZXIgcmV0dXJucyByZXNwb25zZSB3aXRoIGFuIGVycm9yIHN0YXR1cy5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuXHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICAvL2RlYnVnZ2VyXHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnRGF0ZUZhY3RvcnknLCBEYXRlRmFjdG9yeSk7XHJcblxyXG4gICAgRGF0ZUZhY3RvcnkuJGluamVjdCA9IFsnJGxvZycsICdVdGlsaXR5RmFjdG9yeScsICckcm9vdFNjb3BlJ107XHJcblxyXG5mdW5jdGlvbiBEYXRlRmFjdG9yeSgkbG9nLCBVdGlsaXR5RmFjdG9yeSwgJHJvb3RTY29wZSkge1xyXG4gICAgdmFyIGZhY3RvcnkgPSB7XHJcbiAgICAgICAgZ2V0Q3VzdG9tVGltZTogZ2V0Q3VzdG9tVGltZSxcclxuICAgICAgICBnZXREYXRlRnJvbUN1c3RvbVRpbWU6IGdldERhdGVGcm9tQ3VzdG9tVGltZSxcclxuICAgICAgICBnZXRQcmV2aW91c0RhdGU6IGdldFByZXZpb3VzRGF0ZSxcclxuICAgICAgICBnZXRUaW1lRGlmZmVyZW5jZTogZ2V0VGltZURpZmZlcmVuY2UsXHJcbiAgICAgICAgaXNEYXlMaWdodHNhdmluZ09uOiBpc0RheUxpZ2h0c2F2aW5nT24sXHJcbiAgICAgICAgZ2V0TWludXRlc0Zyb21UaW1lU3RyaW5nOiBnZXRNaW51dGVzRnJvbVRpbWVTdHJpbmcsXHJcbiAgICAgICAgZ2V0UHJvbWlzZVdpbmRvd1RpbWVEaXNwbGF5OiBnZXRQcm9taXNlV2luZG93VGltZURpc3BsYXksXHJcbiAgICAgICAgZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWU6IGdldFByb21pc2VXaW5kb3dFbmRUaW1lXHJcbiAgICAgICAgXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBmYWN0b3J5O1xyXG5cclxuICAgIC8vZ2V0IGRpZmZlcmVuY2UgaW4gbWludXRlcyBmcm9tIGdpdmVuIGRhdGVUaW1lIGFuZCBjdXJyZW50IGJyb3dzZXIgZGF0ZXRpbWVcclxuICAgIGZ1bmN0aW9uIGdldFRpbWVEaWZmZXJlbmNlKGRpdmlzaW9uRGF0ZSkge1xyXG4gICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdmFyIHNlcnZlckRhdGUgPSBuZXcgRGF0ZShEYXRlLnBhcnNlKGRpdmlzaW9uRGF0ZSkpOyAgLy9nZXQgdGhlIGRhdGUgaW4gY29ycmVjdCBmb3JtYXQgZm9yIERhdGUgZnVuY3Rpb25cclxuXHJcbiAgICAgICAgdmFyIGRpZmZlcmVuY2UgPSB0b2RheSAtIHNlcnZlckRhdGU7XHJcblxyXG4gICAgICAgIC8vY29udmVydCBkaWZmZXJlbmNlIGZyb20gbWlsbGlzZWNvbmRzIHRvIG1pbnV0ZXNcclxuICAgICAgICBpZiAoTWF0aC5hYnMoZGlmZmVyZW5jZSAvIDEwMDAgLyA2MCkgPCAxKVxyXG4gICAgICAgICAgICBkaWZmZXJlbmNlID0gMFxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoZGlmZmVyZW5jZSA8IDApXHJcbiAgICAgICAgICAgICAgICBkaWZmZXJlbmNlID0gTWF0aC5mbG9vcihkaWZmZXJlbmNlIC8gMTAwMCAvIDYwKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgZGlmZmVyZW5jZSA9IE1hdGguY2VpbCgoZGlmZmVyZW5jZSAvIDEwMDApIC8gNjApXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vd2Ugb25seSBjYXJlIGlmIHRoZSB0aW1lIGlzIDEgbWludXRlIGxlc3Mgb3IgMSBtaW51dGUgbW9yZSB0aGFuIHNob3VsZCBiZSBiZWNhdXNlIG9mIHJvdW5kaW5nXHJcbiAgICAgICAgaWYgKE1hdGguYWJzKGRpZmZlcmVuY2UpICUgMTAgPiAwKSB7XHJcbiAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmZlcmVuY2UpICUgMTAgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICBkaWZmZXJlbmNlID0gZGlmZmVyZW5jZSArIDE7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGlmZmVyZW5jZSkgJSAxMCA9PSA5KVxyXG4gICAgICAgICAgICAgICAgICAgIGRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlIC0gMTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGlmZmVyZW5jZSkgJSAxMCA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIGRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlIC0gMTtcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmZXJlbmNlKSAlIDEwID09IDkpXHJcbiAgICAgICAgICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2UgKyAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkaWZmZXJlbmNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIDMzIGhyIGRpc3BsYXkgbG9naWNcclxuICAgIGZ1bmN0aW9uIGdldEN1c3RvbVRpbWUoZGF0ZVRvUmVuZGVyLCBzZXJ2aWNlRGF0ZSkge1xyXG4gICAgICAgIHZhciBfY3VzdG9tVGltZSA9IFwiXCI7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRlVG9SZW5kZXIgJiYgc2VydmljZURhdGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBfaHJzVG9BZGQgPSBtb21lbnQoZGF0ZVRvUmVuZGVyKS5ob3VycygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vbWVudChkYXRlVG9SZW5kZXIpLmRhdGUoKSAhPSBtb21lbnQoc2VydmljZURhdGUpLmRhdGUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQWRkIHRoZSBkaWZmZXJlbmNlIGRheXMgKiAyNC4gR2VuZXJpYyBzb2x1dGlvbiB0byBoYW5kbGUgbW9yZSB0aGFuIDMzIGhycy5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgX2RpZmYgPSBtb21lbnQoZGF0ZVRvUmVuZGVyKS5kaWZmKG1vbWVudChzZXJ2aWNlRGF0ZSksICdkYXlzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgX2hyc1RvQWRkID0gX2hyc1RvQWRkICsgKF9kaWZmICogMjQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKF9ocnNUb0FkZCA8IDAgJiYgX2hyc1RvQWRkID4gLTEwKVxyXG4gICAgICAgICAgICAgICAgICAgIF9ocnNUb0FkZCA9IFwiLTBcIiArIChfaHJzVG9BZGQgKiAtMSkvL1doZW4gc2VydmljZSBkYXRlIGlzIGxlc3MgdGhhbiBkYXRldG9SZW5kZXJcclxuICAgICAgICAgICAgICAgIGlmIChfaHJzVG9BZGQgPCAxMClcclxuICAgICAgICAgICAgICAgICAgICBfaHJzVG9BZGQgPSBcIjBcIiArIF9ocnNUb0FkZDtcclxuXHJcbiAgICAgICAgICAgICAgICBfY3VzdG9tVGltZSA9IF9ocnNUb0FkZCArIFwiOlwiICsgbW9tZW50KGRhdGVUb1JlbmRlcikuZm9ybWF0KCdtbScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIF9jdXN0b21UaW1lXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFJldmVyc2Ugb2YgZ2V0Q3VzdG9tVGltZSBmdW5jdGlvblxyXG4gICAgLy8gVXNpbmcgY3VzdG9tIHRpbWUgYW5kIHNlcnZpY2UgZGF0ZSBjYWxjdWxhdGUgdGhlIGFjdHVhbCBkYXRlXHJcbiAgICAvLyBXZSBuZWVkIHRvIGZpZ3VyZSBvdXQgYmFzZWQgb24gZGl2aXNpb24gc28gZ2V0IGRpZmZlcmVuY2UgZnJvbSBkaXZpc2lvbiB0aW1lIGFuZCBhZGp1c3QgdGltZSBhY2NvcmRpbmdseVxyXG4gICAgZnVuY3Rpb24gZ2V0RGF0ZUZyb21DdXN0b21UaW1lKGN1c3RvbVRpbWUsIHNlcnZpY2VEYXRlKSB7XHJcbiAgICAgICAgdmFyIGRhdGU7XHJcbiAgICAgICAgdmFyIGRpZmZfTWludXRlcztcclxuICAgICAgICB2YXIgX3NlcnZpY2VEYXRlO1xyXG4gICAgICAgIHZhciBkaWZmZXJlbmNlID0gJHJvb3RTY29wZS50aW1lRGlmZmVyZW5jZTtcclxuXHJcblxyXG4gICAgICAgIC8vSGFuZGxpbmcgYm90aCBtb21lbnQgZGF0ZSBhbmQgbmF0aXZlIEpTIGRhdGUgZm9ybWF0XHJcbiAgICAgICAgaWYgKHNlcnZpY2VEYXRlLl9pc0FNb21lbnRPYmplY3QpXHJcbiAgICAgICAgICAgIF9zZXJ2aWNlRGF0ZSA9IHNlcnZpY2VEYXRlLnN0YXJ0T2YoJ2RheScpXHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBfc2VydmljZURhdGUgPSBzZXJ2aWNlRGF0ZS5zZXRIb3VycygwLCAwLCAwKTtcclxuICAgICAgICBpZiAodHlwZW9mIGN1c3RvbVRpbWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAoY3VzdG9tVGltZS5pbmRleE9mKCc6JykgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGRpZmZfTWludXRlcyA9IChwYXJzZUludChjdXN0b21UaW1lWzBdICsgY3VzdG9tVGltZVsxXSkpICogNjAgKyBwYXJzZUludChjdXN0b21UaW1lWzJdICsgY3VzdG9tVGltZVszXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlmZmVyZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpZmZfTWludXRlcyA9IGRpZmZfTWludXRlcyArIGRpZmZlcmVuY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoY3VzdG9tVGltZS5pbmRleE9mKCc6JykgPT0gMikge1xyXG4gICAgICAgICAgICAgICAgZGlmZl9NaW51dGVzID0gKHBhcnNlSW50KGN1c3RvbVRpbWVbMF0gKyBjdXN0b21UaW1lWzFdKSkgKiA2MCArIHBhcnNlSW50KGN1c3RvbVRpbWVbM10gKyBjdXN0b21UaW1lWzRdKTtcclxuICAgICAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlmZl9NaW51dGVzID0gZGlmZl9NaW51dGVzICsgZGlmZmVyZW5jZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGN1c3RvbVRpbWUgPT0gXCJkYXRlXCIpIHtcclxuICAgICAgICAgICAgLy9oYW5kbGUgZGF0ZSB0aW1lXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKGRpZmZfTWludXRlcykge1xyXG4gICAgICAgICAgICBkYXRlID0gbW9tZW50KF9zZXJ2aWNlRGF0ZSkuYWRkKGRpZmZfTWludXRlcywgJ20nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICRsb2cuZXJyb3IoXCJnZXREYXRlRnJvbUN1c3RvbVRpbWU6IFRpbWUgaXMgaW52YWxpZCEsIENhbm5vdCBjYWx1bGF0ZSBhY3R1YWwgdGltZVwiKTtcclxuICAgICAgICAgICAgJGxvZy5sb2coXCJlcnJvciBkZXRhaWxzXCIsIFwiZ2V0RGF0ZUZyb21DdXN0b21UaW1lIGN1c3RvbVRpbWU6IFwiICsgY3VzdG9tVGltZSk7XHJcbiAgICAgICAgICAgICRsb2cubG9nKFwiZXJyb3IgZGV0YWlsc1wiLCBcImdldERhdGVGcm9tQ3VzdG9tVGltZSBzZXJ2aWNlRGF0ZTogXCIgKyBfc2VydmljZURhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGF0ZTtcclxuXHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBnZXRQcmV2aW91c0RhdGUoZGF0ZSkge1xyXG4gICAgICAgIGlmIChkYXRlID09IG51bGwpIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSAtIDEpO1xyXG4gICAgICAgIHJldHVybiBkYXRlO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gaXNEYXlMaWdodHNhdmluZ09uKCkge1xyXG4gICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdmFyIGphbnVhcnkgPSBuZXcgRGF0ZSh0b2RheS5nZXRGdWxsWWVhcigpLCAwLCAxKTtcclxuICAgICAgICB2YXIganVseSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIDYsIDEpO1xyXG4gICAgICAgIHZhciB0aW1lem9uZURpZmYgPSBNYXRoLm1heChqYW51YXJ5LmdldFRpbWV6b25lT2Zmc2V0KCksIGp1bHkuZ2V0VGltZXpvbmVPZmZzZXQoKSk7XHJcbiAgICAgICAgcmV0dXJuIHRvZGF5LmdldFRpbWV6b25lT2Zmc2V0KCkgPCB0aW1lem9uZURpZmY7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0TWludXRlc0Zyb21UaW1lU3RyaW5nKHRpbWVTdHJpbmcpIHtcclxuICAgICAgICB2YXIgZGlmZl9NaW51dGVzID0gMDtcclxuICAgICAgICBpZiAodHlwZW9mIHRpbWVTdHJpbmcgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBpZiAodGltZVN0cmluZy5pbmRleE9mKCc6JykgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGRpZmZfTWludXRlcyA9IChwYXJzZUludCh0aW1lU3RyaW5nWzBdICsgdGltZVN0cmluZ1sxXSkpICogNjAgKyBwYXJzZUludCh0aW1lU3RyaW5nWzJdICsgdGltZVN0cmluZ1szXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGltZVN0cmluZy5pbmRleE9mKCc6JykgPT0gMikge1xyXG4gICAgICAgICAgICAgICAgZGlmZl9NaW51dGVzID0gKHBhcnNlSW50KHRpbWVTdHJpbmdbMF0gKyB0aW1lU3RyaW5nWzFdKSkgKiA2MCArIHBhcnNlSW50KHRpbWVTdHJpbmdbM10gKyB0aW1lU3RyaW5nWzRdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGlmZl9NaW51dGVzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICBcclxuICAgIGZ1bmN0aW9uIGdldFByb21pc2VXaW5kb3dUaW1lRGlzcGxheShzY2hlZHVsZVRpbWUsIHByb21pc2VXaW5kb3csIHNlcnZpY2VEYXRlKSB7XHJcbiAgICAgICAgdmFyIHNjaGVkdWxlVGltZVZpZXcgPSBnZXRDdXN0b21UaW1lKHNjaGVkdWxlVGltZSwgc2VydmljZURhdGUpO1xyXG4gICAgICAgIHZhciBmb3JtYXREYXRlID0gbW9tZW50KHNjaGVkdWxlVGltZSkuYWRkKHByb21pc2VXaW5kb3csICdtaW51dGVzJyk7XHJcbiAgICAgICAgdmFyIHByb21pc2VXaW5kb3dUaW1lID0gc2NoZWR1bGVUaW1lVmlldyArIFwiLVwiICsgZ2V0Q3VzdG9tVGltZShmb3JtYXREYXRlLCBzZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2VXaW5kb3dUaW1lO1xyXG4gICAgfVxyXG5cclxuICAgIC8vd2luZG93U3RhcnRUaW1lIGlzIGV4cGVjdGVkIHRvIGJlIGluIElTTyBzdHJpbmcgZm9ybWF0XHJcbiAgICAvL3Byb21pc2VXaW5kb3cgaW4gbWludXRlc1xyXG4gICAgZnVuY3Rpb24gZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWUod2luZG93U3RhcnRUaW1lLCBwcm9taXNlV2luZG93KSB7XHJcbiAgICAgICAgdmFyIG9sZERhdGVPYmogPSBtb21lbnQod2luZG93U3RhcnRUaW1lKTtcclxuICAgICAgICB2YXIgbmV3RGF0ZU9iaiA9IG9sZERhdGVPYmouYWRkKCdtJywgcHJvbWlzZVdpbmRvdyk7XHJcbiAgICAgICAgcmV0dXJuIG5ld0RhdGVPYmouZm9ybWF0KCk7XHJcbiAgICB9XHJcbn07XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuZmFjdG9yeSgnTG9jYXRpb25GYWN0b3J5JywgTG9jYXRpb25GYWN0b3J5KTtcclxuXHJcbiAgICBMb2NhdGlvbkZhY3RvcnkuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnQ29uZmlnRmFjdG9yeScsICdhdXRoU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIExvY2F0aW9uRmFjdG9yeSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnksIGF1dGhTZXJ2aWNlKSB7XHJcblxyXG4gICAgdmFyIGxvY2F0aW9uRnJvbSA9IFtdO1xyXG4gICAgdmFyIGxvY2F0aW9uVG8gPSBbXTtcclxuICAgIHZhciBBZExvY2F0aW9uRnJvbSA9IFtdO1xyXG4gICAgdmFyIEFkTG9jYXRpb25UbyA9IFtdO1xyXG4gICAgdmFyIEdvb2dsZUxvY2F0aW9uRnJvbSA9IFtdO1xyXG4gICAgdmFyIEdvb2dsZUxvY2F0aW9uVG8gPSBbXTtcclxuICAgIHZhciBhZGRyZXNzUmVzdCA9ICcnO1xyXG4gICAgdmFyIGxvY2F0aW9uRmlsdGVyID0gJyc7XHJcbiAgICB2YXIgZmFjdG9yeSA9IHtcclxuICAgICAgICBzZXRhZGQ6IHN0dCxcclxuICAgICAgICBnZXRMb2NhdGlvbnM6IGdldExvY2F0aW9ucyxcclxuICAgICAgICBmaW5kQ2xvc2VzdExvY2F0aW9uOiBmaW5kQ2xvc2VzdExvY2F0aW9uXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBmYWN0b3J5O1xyXG5cclxuICAgIGZ1bmN0aW9uIHN0dChuZXdOYW1lKSB7XHJcbiAgICAgICAgYWRkcmVzc1Jlc3QgPSBuZXdOYW1lO1xyXG5cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHNldExvY2F0aW9uRmlsdGVyKGZpbHRlclN0YXR1cykge1xyXG4gICAgICAgIGxvY2F0aW9uRmlsdGVyID0gZmlsdGVyU3RhdHVzO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldEFkZHJlc3MoQWRMb2NhdGlvbkZyb20sIGxvYykge1xyXG4gICAgICAgIHZhciBhZGRyZXNzRGV0YWlscyA9IFwiXCI7XHJcbiAgICAgICAgaWYgKGxvYykge1xyXG4gICAgICAgIFx0Ly92YXIgYWRkcmVzc0RldGFpbHMgPSBBZExvY2F0aW9uRnJvbVtsb2NdLklzTWFudWFsbHlBZGRlZCA/IChBZExvY2F0aW9uRnJvbVtsb2NdLk5hbWUpLnRvVXBwZXJDYXNlKCkgOiAnJztcclxuICAgICAgICBcdGlmIChBZExvY2F0aW9uRnJvbVtsb2NdLk5hbWUpXHJcbiAgICAgICAgXHRcdGFkZHJlc3NEZXRhaWxzID0gQWRMb2NhdGlvbkZyb21bbG9jXS5OYW1lLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgXHRpZiAoQWRMb2NhdGlvbkZyb21bbG9jXS5BbGlhc05hbWVzKVxyXG4gICAgICAgIFx0XHRhZGRyZXNzRGV0YWlscyA9IGFkZHJlc3NEZXRhaWxzICsgXCIgKFwiICsgQWRMb2NhdGlvbkZyb21bbG9jXS5BbGlhc05hbWVzICsgXCIpXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhZGRyZXNzRGV0YWlscztcclxuICAgIH1cclxuXHJcbiAgICAvL21vdmUgdG8gVXRpbGl0eUZhY3RvcnkgKG1heSBiZSlcclxuICAgIGZ1bmN0aW9uIGlzTnVsbE9yRW1wdHkoaW5wdXQpIHtcclxuICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChpbnB1dCkgfHwgaW5wdXQgPT09IG51bGwgfHwgaW5wdXQgPT0gJycpICAgLy9hbmd1bGFyLmVxdWFscyhpbnB1dCwge30pOy8vZW1wdHkgb2JqZWN0IGNvbXBhcmlzb25cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZmluZENsb3Nlc3RMb2NhdGlvbihteXBvc2l0aW9uLCBsb2NhdGlvbnMpIHtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsb2NhdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbG9jYXRpb25zW2ldLmRpc3RhbmNlID0gcmVjdGlsaW5lYXJIYXZlcnNpbmUobXlwb3NpdGlvbiwgbG9jYXRpb25zW2ldLmxvYyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvY2F0aW9ucy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLmRpc3RhbmNlIC0gYi5kaXN0YW5jZTtcclxuXHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gbG9jYXRpb25zWzBdO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gaGF2ZXJzaW5lRm9ybXVsYShncHNMb2MsIGJsZGcpIHtcclxuICAgICAgICAvL3Bvc2l0aW9uMSA9ICB2bS5wb3NpdGlvblxyXG4gICAgICAgIC8vcG9zaXRpb24yID0gc3RvcFxyXG4gICAgICAgIHZhciBsYXQxID0gZ3BzTG9jLkxhdGl0dWRlO1xyXG4gICAgICAgIHZhciBsb24xID0gZ3BzTG9jLkxvbmdpdHVkZTtcclxuICAgICAgICB2YXIgbGF0MiA9IGJsZGcuTGF0aXR1ZGU7XHJcbiAgICAgICAgdmFyIGxvbjIgPSBibGRnLkxvbmdpdHVkZVxyXG5cclxuICAgICAgICB2YXIgUiA9IDYzNzE7IC8vIGttIFxyXG4gICAgICAgIHZhciB4MSA9IGxhdDIgLSBsYXQxO1xyXG4gICAgICAgIHZhciBkTGF0ID0geDEgKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgICAgIHZhciB4MiA9IGxvbjIgLSBsb24xO1xyXG4gICAgICAgIHZhciBkTG9uID0geDIgKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgICAgIHZhciBhID0gTWF0aC5zaW4oZExhdCAvIDIpICogTWF0aC5zaW4oZExhdCAvIDIpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5jb3MobGF0MSAqIE1hdGguUEkgLyAxODApICogTWF0aC5jb3MobGF0MiAqIE1hdGguUEkgLyAxODApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4oZExvbiAvIDIpICogTWF0aC5zaW4oZExvbiAvIDIpO1xyXG4gICAgICAgIHZhciBjID0gMiAqIE1hdGguYXRhbjIoTWF0aC5zcXJ0KGEpLCBNYXRoLnNxcnQoMSAtIGEpKTtcclxuICAgICAgICB2YXIgZCA9IFIgKiBjICogMC42MjEzNzsgLy9jb252ZXJ0IHRvIG1pbGVzXHJcbiAgICAgICAgcmV0dXJuIGQudG9GaXhlZCgyKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZWN0aWxpbmVhckhhdmVyc2luZShsb2MxLCBsb2MyKSB7XHJcbiAgICAgICAgdmFyIHRlbXBQb2ludCA9IHtcclxuICAgICAgICAgICAgXCJMYXRpdHVkZVwiOiBsb2MxLkxhdGl0dWRlLFxyXG4gICAgICAgICAgICBcIkxvbmdpdHVkZVwiOiBsb2MyLkxvbmdpdHVkZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGQxID0gcGFyc2VGbG9hdChoYXZlcnNpbmVGb3JtdWxhKGxvYzEsIHRlbXBQb2ludCkpO1xyXG4gICAgICAgIHZhciBkMiA9IHBhcnNlRmxvYXQoaGF2ZXJzaW5lRm9ybXVsYSh0ZW1wUG9pbnQsIGxvYzIpKTtcclxuICAgICAgICByZXR1cm4gKGQxICsgZDIpLnRvRml4ZWQoMik7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrSWZWYWxpZChhZGRyZXNzKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSBpbiBhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50cykge1xyXG4gICAgICAgICAgICBpZiAoYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0udHlwZXNbMF0gPT0gXCJzdHJlZXRfbnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIC8vIHRoaXMgaXMgdGhlIG9ubHkgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGluIHVzZSBmb3IgYm90aCBmcm9tIGFuZCB0byBsb2NhdGlvbnMsIHdoZW4gdGhlIGRpcmVjdGl2ZSBpcyBpbiBwbGFjZS5cclxuICAgIC8vVGhlIGFib3ZlIDIgZnVuY3Rpb25zIGFyZSBvbmx5IGZvciB0aGUgZXhpc3RpbmcgZnVuY3Rpb25hbGl0eSwgdGhleSBjYW4gYmUgY2xlYW5lZCB1cCBvbmNlIHRoZSBuZXcgYWR2YW5jZWQgcmVzZXJ2YXRpb24gaXMgcmVhZHlcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRMb2NhdGlvbnMoU2VhcmNoVGVybSwgbG9jYXRpb25maWx0ZXIsIGRpdmlzaW9uSWQsIHBhc3NlbmdlcklkLCBnb29nbGVPbmx5KSB7XHJcbiAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICB2YXIgbG9jYXRpb25EYXRhID0gW107XHJcbiAgICAgICAgaWYgKGdvb2dsZU9ubHkgPT0gdHJ1ZSB8fCBnb29nbGVPbmx5ID09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgXHQkaHR0cC5nZXQoJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24nLCB7XHJcbiAgICAgICAgXHRcdHBhcmFtczoge1xyXG4gICAgICAgIFx0XHRcdGFkZHJlc3M6IFNlYXJjaFRlcm0gKyAnICcgKyBhZGRyZXNzUmVzdCxcclxuICAgICAgICBcdFx0XHRzZW5zb3I6IHRydWUsXHJcbiAgICAgICAgXHRcdFx0a2V5OiAnQUl6YVN5Q3p0cVJUYVF6Z0J4dTBETVY5Y0RLcTBJY2lxTWFRSTVFJ1xyXG4gICAgICAgIFx0XHR9LFxyXG4gICAgICAgIFx0XHR3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLFxyXG4gICAgICAgIFx0XHRza2lwQXV0aG9yaXphdGlvbjogdHJ1ZVxyXG4gICAgICAgIFx0fSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICBcdFx0R29vZ2xlTG9jYXRpb25Gcm9tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzO1xyXG4gICAgICAgIFx0XHRmb3IgKHZhciBsb2MgaW4gR29vZ2xlTG9jYXRpb25Gcm9tKSB7XHJcbiAgICAgICAgXHRcdCAgICBpZiAoY2hlY2tJZlZhbGlkKEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdKSkge1xyXG4gICAgICAgIFx0XHQgICAgICAgIGxvY2F0aW9uRGF0YS5wdXNoKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBHb29nbGVMb2NhdGlvbkZyb21bbG9jXS5mb3JtYXR0ZWRfYWRkcmVzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzR29vZ2xlTG9jYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2M6IEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdLk5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10uZm9ybWF0dGVkX2FkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHRcdCAgICB9XHJcbiAgICAgICAgXHRcdH1cclxuICAgICAgICBcdFx0ZGVmZXIucmVzb2x2ZSh7IFwiZGF0YVwiOiBsb2NhdGlvbkRhdGEgfSk7XHJcbiAgICAgICAgXHR9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgIFx0Q29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgIFx0XHRpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgIFx0XHRcdHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyBcImxvY2F0aW9uL1wiICsgZGl2aXNpb25JZCArIFwiLz9TZWFyY2hUZXJtPVwiICsgU2VhcmNoVGVybTtcclxuXHJcbiAgICAgICAgXHRcdFx0JGh0dHAuZ2V0KHNlcnZpY2VVcmwpXHJcblx0XHRcdCAgIC50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG5cdFx0XHQgICBcdEFkTG9jYXRpb25Gcm9tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblx0XHRcdCAgIFx0Zm9yICh2YXIgbG9jIGluIEFkTG9jYXRpb25Gcm9tKSB7XHJcblx0XHRcdCAgIFx0XHRsb2NhdGlvbkRhdGEucHVzaChcclxuXHRcdFx0XHRcdFx0IHtcclxuXHRcdFx0XHRcdFx0IFx0bmFtZTogQWRMb2NhdGlvbkZyb21bbG9jXS5OYW1lLFxyXG5cdFx0XHRcdFx0XHQgXHRhZGRyZXNzOiBBZExvY2F0aW9uRnJvbVtsb2NdLkFkZHJlc3MgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIWlzTnVsbE9yRW1wdHkoQWRMb2NhdGlvbkZyb21bbG9jXS5DaXR5KSA/IFwiLCBcIiArIEFkTG9jYXRpb25Gcm9tW2xvY10uQ2l0eSA6IFwiIFwiKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICghaXNOdWxsT3JFbXB0eShBZExvY2F0aW9uRnJvbVtsb2NdLlppcCkgPyBcIiwgXCIgKyBBZExvY2F0aW9uRnJvbVtsb2NdLlppcCA6IFwiXCIpLFxyXG5cdFx0XHRcdFx0XHQgXHRpc0dvb2dsZUxvY2F0aW9uOiBmYWxzZSxcclxuXHRcdFx0XHRcdFx0IFx0bG9jOiBBZExvY2F0aW9uRnJvbVtsb2NdLFxyXG5cdFx0XHRcdFx0XHQgXHR0aXRsZTogZ2V0QWRkcmVzcyhBZExvY2F0aW9uRnJvbSwgbG9jKSxcclxuXHRcdFx0XHRcdFx0IFx0ZGVzY3JpcHRpb246IEFkTG9jYXRpb25Gcm9tW2xvY10uQWRkcmVzcyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICghaXNOdWxsT3JFbXB0eShBZExvY2F0aW9uRnJvbVtsb2NdLkNpdHkpID8gXCIsIFwiICsgQWRMb2NhdGlvbkZyb21bbG9jXS5DaXR5IDogXCIgXCIpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCFpc051bGxPckVtcHR5KEFkTG9jYXRpb25Gcm9tW2xvY10uWmlwKSA/IFwiLCBcIiArIEFkTG9jYXRpb25Gcm9tW2xvY10uWmlwIDogXCJcIilcclxuXHRcdFx0XHRcdFx0IH0pO1xyXG5cdFx0XHQgICBcdH1cclxuXHRcdFx0ICAgXHRpZiAobG9jYXRpb25GaWx0ZXIgPT0gZmFsc2UgfHwgbG9jYXRpb25GaWx0ZXIgPT0gXCJmYWxzZVwiKSB7XHJcblx0XHRcdCAgIFx0XHRkZWZlci5yZXNvbHZlKHsgXCJkYXRhXCI6IGxvY2F0aW9uRGF0YSB9KTtcclxuXHRcdFx0ICAgXHRcdHJldHVybiBkZWZlci5wcm9taXNlO1xyXG5cdFx0XHQgICBcdH1cclxuXHRcdFx0ICAgXHRlbHNlIGlmIChsb2NhdGlvbkZpbHRlciA9PSB0cnVlIHx8IGxvY2F0aW9uRmlsdGVyID09IFwidHJ1ZVwiKSB7XHJcblxyXG5cdFx0XHQgICBcdFx0JGh0dHAuZ2V0KCdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uJywge1xyXG5cdFx0XHQgICBcdFx0XHRwYXJhbXM6IHtcclxuXHRcdFx0ICAgXHRcdFx0XHRhZGRyZXNzOiBTZWFyY2hUZXJtICsgJyAnICsgYWRkcmVzc1Jlc3QsXHJcblx0XHRcdCAgIFx0XHRcdFx0c2Vuc29yOiB0cnVlLFxyXG5cdFx0XHQgICBcdFx0XHRcdGtleTogJ0FJemFTeUN6dHFSVGFRemdCeHUwRE1WOWNES3EwSWNpcU1hUUk1RSdcclxuXHRcdFx0ICAgXHRcdFx0fSxcclxuXHRcdFx0ICAgXHRcdFx0d2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcclxuXHRcdFx0ICAgXHRcdFx0c2tpcEF1dGhvcml6YXRpb246IHRydWVcclxuXHRcdFx0ICAgXHRcdH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcblx0XHRcdCAgIFx0XHRcdEdvb2dsZUxvY2F0aW9uRnJvbSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0cztcclxuXHRcdFx0ICAgXHRcdFx0Zm9yICh2YXIgbG9jIGluIEdvb2dsZUxvY2F0aW9uRnJvbSkge1xyXG5cdFx0XHQgICBcdFx0XHQgICAgaWYgKGNoZWNrSWZWYWxpZChHb29nbGVMb2NhdGlvbkZyb21bbG9jXSkpIHtcclxuXHRcdFx0ICAgXHRcdFx0ICAgICAgICBsb2NhdGlvbkRhdGEucHVzaChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBHb29nbGVMb2NhdGlvbkZyb21bbG9jXS5mb3JtYXR0ZWRfYWRkcmVzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0dvb2dsZUxvY2F0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdLk5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdLmZvcm1hdHRlZF9hZGRyZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHRcdFx0ICAgXHRcdFx0ICAgIH1cclxuXHRcdFx0ICAgXHRcdFx0fVxyXG5cdFx0XHQgICBcdFx0XHRkZWZlci5yZXNvbHZlKHsgXCJkYXRhXCI6IGxvY2F0aW9uRGF0YSB9KTtcclxuXHRcdFx0ICAgXHRcdH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soZXJyKSB7XHJcblx0XHRcdCAgIFx0XHRcdGRlZmVyLnJlamVjdChlcnIpO1xyXG5cdFx0XHQgICBcdFx0fSk7XHJcblx0XHRcdCAgIFx0fVxyXG5cdFx0XHQgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKGVycikge1xyXG5cdFx0XHQgICBcdGRlZmVyLnJlamVjdChlcnIpO1xyXG5cdFx0XHQgICB9KTtcclxuXHJcblxyXG4gICAgICAgIFx0XHR9XHJcbiAgICAgICAgXHR9LCBmdW5jdGlvbiBlcnJvcmhhbmRsZXIoZXJyKSB7XHJcbiAgICAgICAgXHR9KTtcclxuICAgICAgICBcdHNldExvY2F0aW9uRmlsdGVyKGxvY2F0aW9uZmlsdGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICB9O1xyXG59XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuZmFjdG9yeSgnU2VjdXJpdHlGYWN0b3J5JywgU2VjdXJpdHlGYWN0b3J5KTtcclxuICAgIFNlY3VyaXR5RmFjdG9yeS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICckY2FjaGVGYWN0b3J5JywgJ3NlY3VyaXR5U2VydmljZSddO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBTZWN1cml0eUZhY3RvcnkoJGh0dHAsICRxLCAkY2FjaGVGYWN0b3J5LCBzZWN1cml0eVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgX3Blcm1pc3Npb25zID0ge307XHJcbiAgICAgICAgdmFyIGNhY2hlID0gJGNhY2hlRmFjdG9yeShcIlBlcm1pc3Npb25zQ2FjaGVcIik7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldFBlcm1pc3Npb25zOiBnZXRQZXJtaXNzaW9ucyxcclxuICAgICAgICAgICAgZ2V0TG9hZGVkUGVybWlzc2lvbnM6IGdldExvYWRlZFBlcm1pc3Npb25zLFxyXG4gICAgICAgICAgICBzZXR1cFNlc3Npb246IHNldHVwU2Vzc2lvblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBlcm1pc3Npb25zKHVzZXJJZCwgZGl2aXNpb25pZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICBfcGVybWlzc2lvbnMgPSBjYWNoZS5nZXQoXCJwZXJtaXNzaW9uc1wiKTtcclxuICAgICAgICAgICAgaWYgKF9wZXJtaXNzaW9ucykge1xyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShfcGVybWlzc2lvbnMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VjdXJpdHlTZXJ2aWNlLmdldFBlcm1pc3Npb25zKHVzZXJJZCwgZGl2aXNpb25pZCkudGhlbihmdW5jdGlvbiAocGVybWlzc2lvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWNoZS5wdXQoXCJwZXJtaXNzaW9uc1wiLCBwZXJtaXNzaW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShwZXJtaXNzaW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXR1cFNlc3Npb24odXNlcklkLCBkaXZpc2lvbmlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZWN1cml0eVNlcnZpY2Uuc2V0dXBTZXNzaW9uKHVzZXJJZCwgZGl2aXNpb25pZCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TG9hZGVkUGVybWlzc2lvbnMoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjYWNoZS5nZXQoXCJwZXJtaXNzaW9uc1wiKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7XHJcblxyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuZmFjdG9yeSgnVXRpbGl0eUZhY3RvcnknLCBVdGlsaXR5RmFjdG9yeSk7XHJcbiAgICBVdGlsaXR5RmFjdG9yeS4kaW5qZWN0ID0gWyckbG9nJywgJyR3aW5kb3cnXTtcclxuICAgIGZ1bmN0aW9uIFV0aWxpdHlGYWN0b3J5KCRsb2csICR3aW5kb3cpIHtcclxuXHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG5cclxuICAgICAgICAgICAgZ2V0RGF0YTogZ2V0RGF0YSxcclxuICAgICAgICAgICAgc2V0RGF0YTogc2V0RGF0YSxcclxuICAgICAgICAgICAgZ2V0QVBJQmFzZVVybDogZ2V0QVBJQmFzZVVybCxcclxuXHJcbiAgICAgICAgICAgIHRvYXN0RXJyb3I6IHRvYXN0RXJyb3IsXHJcbiAgICAgICAgICAgIHRvYXN0SW5mbzogdG9hc3RJbmZvLFxyXG4gICAgICAgICAgICB0b2FzdFN1Y2Nlc3M6IHRvYXN0U3VjY2VzcyxcclxuICAgICAgICAgICAgdG9hc3RXYXJuaW5nOiB0b2FzdFdhcm5pbmcsXHJcblxyXG4gICAgICAgICAgICBsb2dFcnJvcjogbG9nRXJyb3IsXHJcbiAgICAgICAgICAgIGxvZ0luZm86IGxvZ0luZm8sXHJcbiAgICAgICAgICAgIGxvZ1N1Y2Nlc3M6IGxvZ1N1Y2Nlc3MsXHJcbiAgICAgICAgICAgIGxvZ1dhcm5pbmc6IGxvZ1dhcm5pbmcsXHJcblxyXG4gICAgICAgICAgICBsb2c6ICRsb2cubG9nLFxyXG5cclxuICAgICAgICAgICAgZ2V0VXNTdGF0ZXM6IGdldFVzU3RhdGVzLFxyXG4gICAgICAgICAgICBnZXRCcm93c2VySW5mbzogZ2V0QnJvd3NlckluZm8sXHJcblxyXG4gICAgICAgICAgICBpc0Nocm9tZTogaXNDaHJvbWUsXHJcbiAgICAgICAgICAgIGlzSUU6IGlzSUUsXHJcbiAgICAgICAgICAgIGlzRmlyZWZveDogaXNGaXJlZm94LFxyXG4gICAgICAgICAgICBpc1NhZmFyaTogaXNTYWZhcmksXHJcblxyXG4gICAgICAgICAgICB1c1N0YXRlczogW1xyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQWxhYmFtYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkFMXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQWxhc2thXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiQUtcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJBbWVyaWNhbiBTYW1vYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkFTXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQXJpem9uYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkFaXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQXJrYW5zYXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJBUlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkNhbGlmb3JuaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJDQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkNvbG9yYWRvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiQ09cIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJDb25uZWN0aWN1dFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkNUXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiRGVsYXdhcmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJERVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkRpc3RyaWN0IE9mIENvbHVtYmlhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiRENcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJGZWRlcmF0ZWQgU3RhdGVzIE9mIE1pY3JvbmVzaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJGTVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkZsb3JpZGFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJGTFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkdlb3JnaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJHQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkd1YW1cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJHVVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkhhd2FpaVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkhJXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiSWRhaG9cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJJRFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIklsbGlub2lzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiSUxcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJJbmRpYW5hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiSU5cIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJJb3dhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiSUFcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJLYW5zYXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJLU1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIktlbnR1Y2t5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiS1lcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJMb3Vpc2lhbmFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJMQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1haW5lXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTUVcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNYXJzaGFsbCBJc2xhbmRzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTUhcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNYXJ5bGFuZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk1EXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTWFzc2FjaHVzZXR0c1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk1BXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTWljaGlnYW5cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNSVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1pbm5lc290YVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk1OXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTWlzc2lzc2lwcGlcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNU1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1pc3NvdXJpXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTU9cIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNb250YW5hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTVRcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOZWJyYXNrYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk5FXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTmV2YWRhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTlZcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOZXcgSGFtcHNoaXJlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTkhcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOZXcgSmVyc2V5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTkpcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOZXcgTWV4aWNvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTk1cIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOZXcgWW9ya1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk5ZXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTm9ydGggQ2Fyb2xpbmFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJOQ1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5vcnRoIERha290YVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk5EXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTm9ydGhlcm4gTWFyaWFuYSBJc2xhbmRzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTVBcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJPaGlvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiT0hcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJPa2xhaG9tYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk9LXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiT3JlZ29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiT1JcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJQYWxhdVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIlBXXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiUGVubnN5bHZhbmlhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiUEFcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJQdWVydG8gUmljb1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIlBSXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiUmhvZGUgSXNsYW5kXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiUklcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTb3V0aCBDYXJvbGluYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIlNDXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiU291dGggRGFrb3RhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiU0RcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJUZW5uZXNzZWVcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJUTlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlRleGFzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiVFhcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJVdGFoXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiVVRcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJWZXJtb250XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiVlRcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJWaXJnaW4gSXNsYW5kc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIlZJXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiVmlyZ2luaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJWQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIldhc2hpbmd0b25cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJXQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIldlc3QgVmlyZ2luaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJXVlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIldpc2NvbnNpblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIldJXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiV3lvbWluZ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIldZXCJcclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG5cclxuICAgICAgICAvLyAgKioqKioqKioqKioqKiAgYmFzZSBhcGkgVVJMICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAgICAgLy8gVGhpcyB3aWxsIGJlIHJlbW92ZWQgYW5kIG1vdmVkIHRvIGEgQ29uZmlnRmFjdG9yeSBhbmQgdG8gVVNFIGEgSlNPTiBkYXRhIFxyXG4gICAgICAgIHZhciBhcGlCYXNlVXJsID0gJ2h0dHBzOi8vb25lbXZhcGktZGV2Lm12dHJhbnNpdC5jb20vYXBpLyc7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFQSUJhc2VVcmwoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcGlCYXNlVXJsO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vICoqKioqKioqKiAgIHNlc3Npb24gICAgKioqKioqKioqKioqKioqKioqKlxyXG5cclxuICAgICAgICAvL3NldCBkZWZhdWx0IHZhbHVlcyAxc3QgIC0tLSBub3QgdXNpbmcgdG8gcmVtb3ZlIFxyXG4gICAgICAgIC8vZGF0YVsnaXNEaXNwYXRjaCddID0gZmFsc2U7XHJcbiAgICAgICAgLy9kYXRhWydpc1JlcG9ydGluZyddID0gZmFsc2U7XHJcbiAgICAgICAgLy9kYXRhWydpc1VzZXJNYW5hZ2VtZW50J10gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdmFyIGRhdGEgPSB7fTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YShrZXkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGFba2V5XTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXREYXRhKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgZGF0YVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG5cclxuICAgICAgICAvLyAqKioqKioqKioqKioqICAgLS0tICAgIGdldCBicm93c2VyIGluZm9ybWF0aW9uIFxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRCcm93c2VySW5mbygpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB1c2VyQWdlbnQgPSAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7XHJcblxyXG4gICAgICAgICAgICB2YXIgYnJvd3NlcnMgPSB7IGNocm9tZTogL2Nocm9tZS9pLCBzYWZhcmk6IC9zYWZhcmkvaSwgZmlyZWZveDogL2ZpcmVmb3gvaSwgaWU6IC9pbnRlcm5ldCBleHBsb3Jlci9pIH07XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYnJvd3NlcnMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChicm93c2Vyc1trZXldLnRlc3QodXNlckFnZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJ3Vua25vd24nO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vICoqKioqKioqKioqKiogICAtLS0gICAgZGV0ZWN0IGJyb3dzZXJzIGluZm9ybWF0aW9uIFxyXG4gICAgICAgIGZ1bmN0aW9uIGlzQ2hyb21lKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gISF3aW5kb3cuY2hyb21lICYmICEhd2luZG93LmNocm9tZS53ZWJzdG9yZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gaXNJRSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIHx8ICEhZG9jdW1lbnQuZG9jdW1lbnRNb2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBpc0ZpcmVmb3goKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgSW5zdGFsbFRyaWdnZXIgIT09ICd1bmRlZmluZWQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBpc1NhZmFyaSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh3aW5kb3cuSFRNTEVsZW1lbnQpLmluZGV4T2YoJ0NvbnN0cnVjdG9yJykgPiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gICoqKioqKioqKiAgIFRvYXN0ZXIgICAgKioqKioqKioqKioqKioqKioqKlxyXG5cclxuICAgICAgICBmdW5jdGlvbiB0b2FzdEVycm9yKHRpdGxlLCBtZXNzYWdlLCB0aW1lb3V0KSB7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGltZW91dCA9IHRpbWVvdXQgfHwgMTAwMDtcclxuICAgICAgICAgICAgdG9hc3RyLmVycm9yKG1lc3NhZ2UsIHRpdGxlLCB7IHRpbWVPdXQ6IHRpbWVvdXQgfSk7XHJcblxyXG4gICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSAnICsgdGl0bGUgKyAnICAtICcgKyBtZXNzYWdlLCAnJylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvYXN0SW5mbyh0aXRsZSwgbWVzc2FnZSwgdGltZW91dCkge1xyXG5cclxuICAgICAgICAgICAgdGltZW91dCA9IHRpbWVvdXQgfHwgMTAwMDtcclxuXHJcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKG1lc3NhZ2UsIHRpdGxlLCB7XHJcbiAgICAgICAgICAgICAgICB0aW1lT3V0OiB0aW1lb3V0XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9hc3RTdWNjZXNzKHRpdGxlLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy5kZWJ1ZygnU3VjY2VzczogLSAnICsgdGl0bGUgKyAnICAtICcgKyBtZXNzYWdlLCAnJylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvYXN0V2FybmluZyh0aXRsZSwgbWVzc2FnZSkge1xyXG4gICAgICAgICAgICB0b2FzdHIud2FybmluZyhtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cud2FybignV2FybmluZzogLSAnICsgdGl0bGUgKyAnICAtICcgKyBtZXNzYWdlLCAnJylcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyAgKioqKioqKioqICAgTG9nZ2luZyAgICAqKioqKioqKioqKioqKioqKioqXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ0Vycm9yKG1lc3NhZ2UsIGRhdGEpIHtcclxuICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6JyArIG1lc3NhZ2UsIGRhdGEpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2dJbmZvKG1lc3NhZ2UsIGRhdGEpIHtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKCdJbmZvOicgKyBtZXNzYWdlLCBkYXRhKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9nU3VjY2VzcyhtZXNzYWdlLCBkYXRhKSB7XHJcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ1N1Y2Nlc3M6JyArIG1lc3NhZ2UsIGRhdGEpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2dXYXJuaW5nKG1lc3NhZ2UsIGRhdGEpIHtcclxuICAgICAgICAgICAgJGxvZy53YXJuKCdXYXJuaW5nOicgKyBtZXNzYWdlLCBkYXRhKVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vICAqKioqKioqKiogICBVUyBTdGF0ZSAgICAqKioqKioqKioqKioqKioqKioqXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVc1N0YXRlcygpIHtcclxuICAgICAgICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2UudXNTdGF0ZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvclNlcnZpY2UnLCBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlKTtcclxuXHJcbiAgICBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlLiRpbmplY3QgPSBbJyRxJywgJyRpbmplY3RvcicsICckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gYXV0aEludGVyY2VwdG9yU2VydmljZSgkcSwgJGluamVjdG9yLCRsb2NhdGlvbiwkcm9vdFNjb3BlLCBsb2NhbFN0b3JhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIGF1dGhJbnRlcmNlcHRvclNlcnZpY2VGYWN0b3J5ID0ge307XHJcblxyXG4gICAgICAgIHZhciBfcmVxdWVzdCA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuXHJcbiAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKCFjb25maWcudXJsLmluY2x1ZGVzKCdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20nKSkge1xyXG4gICAgICAgICAgICBcdHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICBcdGlmIChhdXRoRGF0YSkge1xyXG4gICAgICAgICAgICBcdFx0Y29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhEYXRhLnRva2VuO1xyXG4gICAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBfcmVzcG9uc2VFcnJvciA9IGZ1bmN0aW9uIChyZWplY3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKHJlamVjdGlvbi5zdGF0dXMgPT09IDQwMSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGF1dGhTZXJ2aWNlID0gJGluamVjdG9yLmdldCgnYXV0aFNlcnZpY2UnKTtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG5cclxuICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ091dCgpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2Vkb3V0JywgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlRmFjdG9yeS5yZXF1ZXN0ID0gX3JlcXVlc3Q7XHJcbiAgICAgICAgYXV0aEludGVyY2VwdG9yU2VydmljZUZhY3RvcnkucmVzcG9uc2VFcnJvciA9IF9yZXNwb25zZUVycm9yO1xyXG5cclxuICAgICAgICByZXR1cm4gYXV0aEludGVyY2VwdG9yU2VydmljZUZhY3Rvcnk7XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAvL3ZhciBhdXRoQXBwID0gYW5ndWxhci5tb2R1bGUoJ2F1dGhBcHAnLCBbXSk7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2F1dGhTZXJ2aWNlJywgYXV0aFNlcnZpY2UpO1xyXG5cclxuICAgIGF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCckaHR0cCcsICckcScgLCdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGF1dGhTZXJ2aWNlKCRyb290U2NvcGUsICRodHRwLCAkcSwgbG9jYWxTdG9yYWdlU2VydmljZSwgZW52KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2VCYXNlID0gZW52LmF1dGhTZXJ2ZXJVcmw7XHJcbiAgICAgICAgdmFyIGF1dGhTZXJ2aWNlRmFjdG9yeSA9IHt9O1xyXG5cclxuICAgICAgICB2YXIgX2F1dGhlbnRpY2F0aW9uID0ge1xyXG4gICAgICAgICAgICBpc0F1dGg6IGZhbHNlLFxyXG4gICAgICAgICAgICBwYXNzZW5nZXJJZDogXCJcIixcclxuICAgICAgICAgICAgdXNlcklkOiBcIlwiLFxyXG4gICAgICAgICAgICB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBfZXh0ZXJuYWxBdXRoRGF0YSA9IHtcclxuICAgICAgICAgICAgcHJvdmlkZXI6IFwiXCIsXHJcbiAgICAgICAgICAgIHVzZXJOYW1lOiBcIlwiLFxyXG4gICAgICAgICAgICBleHRlcm5hbEFjY2Vzc1Rva2VuOiBcIlwiLFxyXG4gICAgICAgICAgICBmaXJzdE5hbWU6IFwiXCIsXHJcbiAgICAgICAgICAgIGxhc3ROYW1lOiBcIlwiXHJcbiAgICAgICAgfTtcclxuICAgICAgIFxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdsb2dnZWRJbicsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbG9nZ2VkSW4nLCBkYXRhKTtcclxuICAgICAgICAgICAgdmFyIG1zZyA9IHt9O1xyXG4gICAgICAgICAgICBtc2cudHlwZSA9IFwicmVnaXN0ZXJfcHVzaFwiO1xyXG4gICAgICAgICAgICBtc2cuYWxpYXMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImxzLmFsaWFzXCIpO1xyXG4gICAgICAgICAgICBtc2cuZGl2aXNpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImxzLmRpdmlzaW9uXCIpO1xyXG4gICAgICAgICAgICB2YXIgYXV0aERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImxzLmF1dGhvcml6YXRpb25EYXRhXCIpO1xyXG4gICAgICAgICAgICB0cnl7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXV0aERhdGFPYmogPSBKU09OLnBhcnNlKGF1dGhEYXRhKTtcclxuICAgICAgICAgICAgICAgIG1zZy5wYXNzZW5nZXJJZCA9IGF1dGhEYXRhT2JqLnBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KG1zZykpO1xyXG4gICAgICAgICAgICB9Y2F0Y2goZSl7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGNhbGxpbmcgcHVzaCByZWdpc3RyYXRpb25cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgIFxyXG4gICAgICAgIHZhciBfc2F2ZVJlZ2lzdHJhdGlvbiA9IGZ1bmN0aW9uIChyZWdpc3RyYXRpb24pIHtcclxuXHJcbiAgICAgICAgICAgIF9sb2dPdXQoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ2FjY291bnQvcmVnaXN0ZXInLCByZWdpc3RyYXRpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgX2xvZ2luID0gZnVuY3Rpb24gKGxvZ2luRGF0YSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBcImdyYW50X3R5cGU9cGFzc3dvcmQmdXNlcm5hbWU9XCIgKyBsb2dpbkRhdGEudXNlck5hbWUgKyBcIiZwYXNzd29yZD1cIiArIGxvZ2luRGF0YS5wYXNzd29yZDtcclxuXHJcbiAgICAgICAgICAgIGlmIChsb2dpbkRhdGEudXNlUmVmcmVzaFRva2Vucykge1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgKyBcIiZjbGllbnRfaWQ9XCIgKyBcIm1vYmlXZWJcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICRodHRwLnBvc3Qoc2VydmljZUJhc2UgKyAndG9rZW4nLCBkYXRhLCB7IGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIH0gfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobG9naW5EYXRhLnVzZVJlZnJlc2hUb2tlbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IGxvZ2luRGF0YS51c2VyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogcmVzcG9uc2UucmVmcmVzaF90b2tlbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZVJlZnJlc2hUb2tlbnM6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IGxvZ2luRGF0YS51c2VyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZVJlZnJlc2hUb2tlbnM6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlck5hbWUgPSBsb2dpbkRhdGEudXNlck5hbWU7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGxvZ2luRGF0YS51c2VSZWZyZXNoVG9rZW5zO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVyciwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHZhciBfY2xlYXJVcFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnJlbW92ZSgnYXV0aG9yaXphdGlvbkRhdGEnKTtcclxuXHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5pc0F1dGggPSBmYWxzZTtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkID0gXCJcIjtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCA9IFwiXCI7XHJcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5sb2dpblByb3ZpZGVyID0gXCJcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBfbG9nT3V0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoZW52LmF1dGhTZXJ2ZXJVcmwgKyAnYWNjb3VudC9zaWdub3V0Jywge30pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgX2NsZWFyVXBTZXNzaW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdVbmFibGUgdG8gbG9nb3V0IHVzZXIuJyk7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHZhciBfZmlsbEF1dGhEYXRhID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgIGlmIChhdXRoRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGF1dGhEYXRhLnVzZVJlZnJlc2hUb2tlbnM7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlcklkID0gYXV0aERhdGEudXNlcklkO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkID0gYXV0aERhdGEucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ubG9naW5Qcm92aWRlciA9IGF1dGhEYXRhLmxvZ2luUHJvdmlkZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgX2lzTG9nZ2VkSW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG4gICAgICAgICAgICBpZiAoYXV0aERhdGEgJiYgYXV0aERhdGEudXNlcklkICE9PSBcIlwiKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZhciBfcmVmcmVzaFRva2VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYXV0aERhdGEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYXV0aERhdGEudXNlUmVmcmVzaFRva2Vucykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFwiZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJnJlZnJlc2hfdG9rZW49XCIgK2F1dGhEYXRhLnJlZnJlc2hUb2tlbiArIFwiJmNsaWVudF9pZD1cIiArbmdBdXRoU2V0dGluZ3MuY2xpZW50SWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2UucmVtb3ZlKCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ3Rva2VuJywgZGF0YSwgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyB9IH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5yZWZyZXNoX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUHJvdmlkZXI6IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2xvZ091dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgX2NoZWNrVXNlckhhc1JlZ2lzdGVyZWQgPSBmdW5jdGlvbiAoZXh0ZXJuYWxEYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLmdldChzZXJ2aWNlQmFzZSArICdhY2NvdW50L0NoZWNrVXNlckhhc1JlZ2lzdGVyZWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXI6IGV4dGVybmFsRGF0YS5wcm92aWRlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyS2V5OiBleHRlcm5hbERhdGEucHJvdmlkZXJLZXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbklkOiBleHRlcm5hbERhdGEuZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBleHRlcm5hbERhdGEudXNlck5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvblN1cHBvcnRzRmVlZDogZXh0ZXJuYWxEYXRhLmRpdmlzaW9uU3VwcG9ydHNGZWVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHN1Y2Nlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVyciwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBfb2J0YWluQWNjZXNzVG9rZW4gPSBmdW5jdGlvbiAoZXh0ZXJuYWxEYXRhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgJGh0dHAuZ2V0KHNlcnZpY2VCYXNlICsgJ2FjY291bnQvT2J0YWluTG9jYWxBY2Nlc3NUb2tlbicsXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlcjogZXh0ZXJuYWxEYXRhLnByb3ZpZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWxBY2Nlc3NUb2tlbjogZXh0ZXJuYWxEYXRhLmV4dGVybmFsQWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbklkOiBleHRlcm5hbERhdGEuZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOmV4dGVybmFsRGF0YS51c2VyTmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHJlc3BvbnNlLnVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiByZXNwb25zZS5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUHJvdmlkZXI6IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCA9IHJlc3BvbnNlLnVzZXJJZDtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCA9IHJlc3BvbnNlLnBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmxvZ2luUHJvdmlkZXIgPSByZXNwb25zZS5sb2dpblByb3ZpZGVyO1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBfcmVnaXN0ZXJFeHRlcm5hbCA9IGZ1bmN0aW9uIChyZWdpc3RlckV4dGVybmFsRGF0YSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICRodHRwLnBvc3Qoc2VydmljZUJhc2UgKyAnYWNjb3VudC9yZWdpc3RlcmV4dGVybmFsJywgcmVnaXN0ZXJFeHRlcm5hbERhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogcmVzcG9uc2UudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJJZDogcmVzcG9uc2UucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUHJvdmlkZXI6IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VySWQgPSByZXNwb25zZS51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkID0gcmVzcG9uc2UucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ubG9naW5Qcm92aWRlciA9IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3JlZ2lzdGVyT25lTXYocmVnaXN0cmF0aW9uT2JqZWN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICdhY2NvdW50L1JlZ2lzdGVyJywgcmVnaXN0cmF0aW9uT2JqZWN0KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW46IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZVJlZnJlc2hUb2tlbnM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHJlc3BvbnNlLnVzZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc2VuZ2VySWQ6IHJlc3BvbnNlLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dpblByb3ZpZGVyOiByZXNwb25zZS5sb2dpblByb3ZpZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlcklkID0gcmVzcG9uc2UudXNlcklkO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZVJlZnJlc2hUb2tlbnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCA9IHJlc3BvbnNlLnBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmxvZ2luUHJvdmlkZXIgPSByZXNwb25zZS5sb2dpblByb3ZpZGVyO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVyciwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gX2xvZ2luT25lTXYobG9naW5EYXRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICdhY2NvdW50L0xvZ2luT25lTXYnLCBsb2dpbkRhdGEpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogcmVzcG9uc2UudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJJZDogcmVzcG9uc2UucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUHJvdmlkZXI6IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VySWQgPSByZXNwb25zZS51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkID0gcmVzcG9uc2UucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ubG9naW5Qcm92aWRlciA9IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3ZlcmlmeUNhcHRjaGEoY2FwdGNoYSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ2FjY291bnQvVmVyaWZ5Q2FwdGNoYScsICdcIicgKyBjYXB0Y2hhICsgJ1wiJykuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LnNhdmVSZWdpc3RyYXRpb24gPSBfc2F2ZVJlZ2lzdHJhdGlvbjtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkubG9naW4gPSBfbG9naW47XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmxvZ091dCA9IF9sb2dPdXQ7XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmZpbGxBdXRoRGF0YSA9IF9maWxsQXV0aERhdGE7XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmF1dGhlbnRpY2F0aW9uID0gX2F1dGhlbnRpY2F0aW9uO1xyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5yZWZyZXNoVG9rZW4gPSBfcmVmcmVzaFRva2VuO1xyXG5cclxuICAgICAgICBhdXRoU2VydmljZUZhY3Rvcnkub2J0YWluQWNjZXNzVG9rZW4gPSBfb2J0YWluQWNjZXNzVG9rZW47XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmV4dGVybmFsQXV0aERhdGEgPSBfZXh0ZXJuYWxBdXRoRGF0YTtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkucmVnaXN0ZXJFeHRlcm5hbCA9IF9yZWdpc3RlckV4dGVybmFsO1xyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5pc0xvZ2dlZEluID0gX2lzTG9nZ2VkSW47XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmxvZ2luT25lTVYgPSBfbG9naW5PbmVNdjtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkucmVnaXN0ZXJPbmVNViA9IF9yZWdpc3Rlck9uZU12O1xyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS52ZXJpZnlDYXB0Y2hhID0gX3ZlcmlmeUNhcHRjaGE7XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmNoZWNrVXNlckhhc1JlZ2lzdGVyZWQgPSBfY2hlY2tVc2VySGFzUmVnaXN0ZXJlZDtcclxuXHJcbiAgICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlRmFjdG9yeTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHJcblx0YW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnQ29tbW9uU2VydmljZScsIENvbW1vblNlcnZpY2UpO1xyXG5cclxuXHRDb21tb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudiddO1xyXG5cclxuXHRmdW5jdGlvbiBDb21tb25TZXJ2aWNlKCRodHRwLCAkcSwgZW52KSB7XHJcblx0XHR2YXIgc2VydmljZUJhc2UgPSBlbnYub25lTVZBcGlVcmw7XHJcblxyXG5cdFx0dmFyIHNlcnZpY2UgPSB7XHJcblx0XHQgICAgR2V0QWxsU3RhdGVzOiBHZXRBbGxTdGF0ZXMsXHJcblx0XHQgICAgR2V0U3RhdGVzV2l0aERpdmlzaW9uczogR2V0U3RhdGVzV2l0aERpdmlzaW9ucyxcclxuXHRcdCAgICBTY2hlZHVsZVR5cGU6IEdldFNjaGVkdWxlVHlwZXMoKVxyXG5cdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gc2VydmljZTtcclxuXHJcblx0XHRmdW5jdGlvbiBHZXRBbGxTdGF0ZXMoKSB7XHJcblx0XHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblx0XHRcdHZhciB1cmwgPSBzZXJ2aWNlQmFzZSArICdjb21tb24vR2V0QWxsU3RhdGVzJztcclxuXHJcblx0XHRcdCRodHRwKHtcclxuXHRcdFx0XHRtZXRob2Q6ICdHRVQnLFxyXG5cdFx0XHRcdHVybDogdXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIEdldFN0YXRlc1dpdGhEaXZpc2lvbnMoKVxyXG5cdFx0e1xyXG5cdFx0ICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblx0XHQgICAgdmFyIHVybCA9IHNlcnZpY2VCYXNlICsgJ2NvbW1vbi9HZXRTdGF0ZXNXaXRoRGl2aXNpb25zJztcclxuXHJcblx0XHQgICAgJGh0dHAoe1xyXG5cdFx0ICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG5cdFx0ICAgICAgICB1cmw6IHVybCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuXHRcdCAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0ICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG5cdFx0ICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcblx0XHQgICAgICAgIH0gZWxzZSB7XHJcblx0XHQgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xyXG5cdFx0ICAgICAgICB9XHJcblx0XHQgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG5cdFx0ICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuXHRcdCAgICB9KTtcclxuXHJcblx0XHQgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gR2V0U2NoZWR1bGVUeXBlcygpIHtcclxuXHRcdCAgICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7ICdNb3JuaW5nJzogJ0FNJywgJ0V2ZW5pbmcnOiAnUE0nIH0pO1xyXG5cdFx0fVxyXG5cclxuXHR9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmZhY3RvcnkoJ0NvbW11bmljYXRpb25zU2VydmljZScsIENvbW11bmljYXRpb25zU2VydmljZSk7XHJcbiAgICBDb21tdW5pY2F0aW9uc1NlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnQ29uZmlnRmFjdG9yeSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbW11bmljYXRpb25zU2VydmljZSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnkpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY29udGFjdERyaXZlcjogY29udGFjdERyaXZlclxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRhY3REcml2ZXIodHJpcElkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcImNvbW11bmljYXRpb25zL2NvbnRhY3Rkcml2ZXIvXCIgKyB0cmlwSWQgKyBcIj9ybmQ9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzICYmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxIHx8IHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiLy8oZnVuY3Rpb24gKCkge1xyXG4vLyAgICAndXNlIHN0cmljdCc7XHJcblxyXG4vLyAgICBhbmd1bGFyXHJcbi8vICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbi8vICAgICAgICAuZmFjdG9yeSgnRGF0ZVV0aWxpdHlTZXJ2aWNlJywgRGF0ZVV0aWxpdHlTZXJ2aWNlKTtcclxuXHJcbi8vICAgIERhdGVVdGlsaXR5U2VydmljZS4kaW5qZWN0ID0gW107XHJcblxyXG4vLyAgICBmdW5jdGlvbiBEYXRlVXRpbGl0eVNlcnZpY2UoKSB7XHJcbi8vICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuLy8gICAgICAgICAgICBhZGREYXlzOiBhZGREYXlzLFxyXG4vLyAgICAgICAgICAgIGdldFdlZWs6IGdldFdlZWssXHJcbi8vICAgICAgICAgICAgZ2V0RGF5T2ZZZWFyOiBnZXREYXlPZlllYXJcclxuLy8gICAgICAgIH07XHJcblxyXG4vLyAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4vLyAgICAgICAgZnVuY3Rpb24gYWRkRGF5cyhpbnB1dCwgbnVtT2ZEYXlzKSB7XHJcbi8vICAgICAgICAgICAgdmFyIGRhdCA9IG5ldyBEYXRlKGlucHV0KTtcclxuLy8gICAgICAgICAgICBkYXQuc2V0RGF0ZShkYXQuZ2V0RGF0ZSgpICsgbnVtT2ZEYXlzKTtcclxuLy8gICAgICAgICAgICByZXR1cm4gZGF0O1xyXG4vLyAgICAgICAgfVxyXG5cclxuLy8gICAgICAgIGZ1bmN0aW9uIGdldFdlZWsoaW5wdXQpIHtcclxuLy8gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGlucHV0LmdldFRpbWUoKSk7XHJcbi8vICAgICAgICAgICAgZGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcclxuLy8gICAgICAgICAgICAvLyBUaHVyc2RheSBpbiBjdXJyZW50IHdlZWsgZGVjaWRlcyB0aGUgeWVhci5cclxuLy8gICAgICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyAzIC0gKGRhdGUuZ2V0RGF5KCkgKyA2KSAlIDcpO1xyXG4vLyAgICAgICAgICAgIC8vIEphbnVhcnkgNCBpcyBhbHdheXMgaW4gd2VlayAxLlxyXG4vLyAgICAgICAgICAgIHZhciB3ZWVrMSA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgNCk7XHJcbi8vICAgICAgICAgICAgLy8gQWRqdXN0IHRvIFRodXJzZGF5IGluIHdlZWsgMSBhbmQgY291bnQgbnVtYmVyIG9mIHdlZWtzIGZyb20gZGF0ZSB0byB3ZWVrMS5cclxuLy8gICAgICAgICAgICByZXR1cm4gMSArIE1hdGgucm91bmQoKChkYXRlLmdldFRpbWUoKSAtIHdlZWsxLmdldFRpbWUoKSkgLyA4NjQwMDAwMFxyXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIDMgKyAod2VlazEuZ2V0RGF5KCkgKyA2KSAlIDcpIC8gNyk7XHJcbi8vICAgICAgICB9XHJcblxyXG4vLyAgICAgICAgZnVuY3Rpb24gZ2V0RGF5T2ZZZWFyKGlucHV0KSB7XHJcbi8vICAgICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKGlucHV0KTtcclxuLy8gICAgICAgICAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZShub3cuZ2V0RnVsbFllYXIoKSwgMCwgMCk7XHJcbi8vICAgICAgICAgICAgdmFyIGRpZmYgPSAobm93IC0gc3RhcnQpICsgKChzdGFydC5nZXRUaW1lem9uZU9mZnNldCgpIC0gbm93LmdldFRpbWV6b25lT2Zmc2V0KCkpICogNjAgKiAxMDAwKTtcclxuLy8gICAgICAgICAgICB2YXIgb25lRGF5ID0gMTAwMCAqIDYwICogNjAgKiAyNDtcclxuLy8gICAgICAgICAgICB2YXIgZGF5ID0gTWF0aC5mbG9vcihkaWZmIC8gb25lRGF5KTtcclxuLy8gICAgICAgICAgICByZXR1cm4gZGF5O1xyXG4vLyAgICAgICAgfVxyXG4vLyAgICB9XHJcbi8vfSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0RpdmlzaW9uU2VydmljZScsIERpdmlzaW9uU2VydmljZSk7XHJcblxyXG4gICAgRGl2aXNpb25TZXJ2aWNlLiRpbmplY3QgPSBbICckaHR0cCcsICckcScsICckcm9vdFNjb3BlJywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnZW52JywgJ2F1dGhTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRGl2aXNpb25TZXJ2aWNlKCRodHRwLCAkcSwgJHJvb3RTY29wZSwgIGxvY2FsU3RvcmFnZVNlcnZpY2UsIGVudiwgYXV0aFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgc2V0RGl2aXNpb246IF9zZXREaXZpc2lvbixcclxuICAgICAgICAgICAgZ2V0RGl2aXNpb25JbmZvOiBfZ2V0RGl2aXNpb25JbmZvLCAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBnZXREaXZpc2lvbnM6IF9nZXRBbGxEaXZpc2lvbnMsXHJcbiAgICAgICAgICAgIGdldERpdmlzaW9uSWQ6IF9nZXREaXZpc2lvbklkRnJvbUxvY2FsU3RvcmFnZSxcclxuICAgICAgICAgICAgZ2V0VGltZVpvbmU6IF9nZXRUaW1lWm9uZUZyb21Mb2NhbFN0b3JhZ2UsICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGdldEFsbG93ZWRTZXJ2aWNlczogX2dldEFsbG93ZWRTZXJ2aWNlc0Zyb21Mb2NhbFN0b3JhZ2UsXHJcbiAgICAgICAgICAgIGdldERpdmlzaW9uQWxpYXM6IF9nZXREaXZpc2lvbkFsaWFzRnJvbUxvY2FsU3RvcmFnZSxcclxuICAgICAgICAgICAgZ2V0U3VwcG9ydFBob25lTnVtYmVyOiBfZ2V0U3VwcG9ydFBob25lTnVtYmVyRnJvbUxvY2FsU3RvcmFnZSxcclxuICAgICAgICAgICAgZ2V0U3lzdGVtUGFyYW1ldGVyczogX2dldFN5c3RlbVBhcmFtZXRlcnNGcm9tTG9jYWxTdG9yYWdlLFxyXG4gICAgICAgICAgICBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb25UaW1lOiBfZ2V0U2VydmljZURhdGVCeURpdmlzaW9uVGltZSxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudERpdmlzaW9uVGltZTogX2dldEN1cnJlbnREaXZpc2lvblRpbWUsXHJcbiAgICAgICAgICAgIGdldERpdmlzaW9uQnlTdGF0ZTogX2dldERpdmlzaW9uQnlTdGF0ZSxcclxuICAgICAgICAgICAgZ2V0RGl2aXNpb25zQnlMb2NhdGlvbjogX2dldERpdmlzaW9uc0J5TG9jYXRpb24sXHJcbiAgICAgICAgICAgIGlzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvbjogX2lzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0Q3VycmVudERpdmlzaW9uVGltZSgpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZBcGlPcmdVcmwgKyAnZGl2aXNpb24vJyArIF9nZXREaXZpc2lvbklkRnJvbUxvY2FsU3RvcmFnZSgpICsgJy9jdXJyZW50VGltZT9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkgeyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc2V0RGl2aXNpb24oaW5wdXRBbGlhcykge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuXHRcdFx0Ly8gZ2V0IGRpdmlzaW9uIGluZm9cclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZBcGlVcmwgKyAnZGl2aXNpb24vdjE/YWxpYXM9JyArIGlucHV0QWxpYXNcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc0RpdmlzaW9uQ2hhbmdlZCA9IF9oYXNEaXZpc2lvbkNoYW5nZWQoaW5wdXRBbGlhcyk7XHJcbiAgICAgICAgICAgICAgICBcdHZhciBkaXZpc2lvbiA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgIFx0Ly8gZ2V0IGRpdmlzaW9uIHN5c3RlbSBwYXJhbWV0ZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIFx0bWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICBcdCd1cmwnOiBlbnYub25lTVZBcGlVcmwgKyAnL2RpdmlzaW9uLycgKyBkaXZpc2lvbi5EaXZpc2lvbklEICsnL3N5c3RlbVBhcmFtZXRlcnM/YXBwVHlwZT1EZXNrdG9wJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHBhcmFtUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdGlmIChwYXJhbVJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0ZGl2aXNpb24uU3lzdGVtUGFyYW1ldGVycyA9IHBhcmFtUmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblx0XHRcdFx0XHRcdFx0Ly8gY29udmVydCBib29sZWFuIHRleHQgdG8gYm9vbGVhblxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRmb3IgKHZhciBwYXJhbSBpbiBkaXZpc2lvbi5TeXN0ZW1QYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0dmFyIHZhbHVlID0gZGl2aXNpb24uU3lzdGVtUGFyYW1ldGVyc1twYXJhbV07XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0aWYgKHZhbHVlICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdGlmICh2YWx1ZSA9PSBcInRydWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0XHRkaXZpc2lvbi5TeXN0ZW1QYXJhbWV0ZXJzW3BhcmFtXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHR9IGVsc2UgaWYgKHZhbHVlID09IFwiZmFsc2VcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0XHRkaXZpc2lvbi5TeXN0ZW1QYXJhbWV0ZXJzW3BhcmFtXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICBcdFx0fVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBcdCAgICAvLyByZW1lbWJlciBkaXZpc2lvbiBwcm9wZXJ0aWVzIGZvciBmdXR1cmUgYWNjZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdF9zZXREaXZpc2lvblByb3BlcnRpZXMoZGl2aXNpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRfc2V0U2VydmljZXMocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBcdFx0X2Jyb2FkY2FzdERpdmlzaW9uQ2hhbmdlZChoYXNEaXZpc2lvbkNoYW5nZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgICAgICAgICBcdGVsc2UgZGVmZXJyZWQucmVqZWN0KCdkaXZpc2lvbiBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRkZWZlcnJlZC5yZWplY3QoJ2RpdmlzaW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBkZWZlcnJlZC5yZWplY3QoJ2RpdmlzaW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoJ2RpdmlzaW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBfaGFzRGl2aXNpb25DaGFuZ2VkKGlucHV0QWxpYXMpIHtcclxuICAgICAgICAgICAgdmFyIGxvY2FsU3RvcmFnZUFsaWFzID0gX2dldERpdmlzaW9uQWxpYXNGcm9tTG9jYWxTdG9yYWdlKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKGxvY2FsU3RvcmFnZUFsaWFzKSBcclxuICAgICAgICAgICAgICAgIHx8ICBsb2NhbFN0b3JhZ2VBbGlhcyA9PT0gbnVsbCBcclxuICAgICAgICAgICAgICAgIHx8IGxvY2FsU3RvcmFnZUFsaWFzLnRyaW0oKSA9PT0gJycpIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gaW5wdXRBbGlhcy50b0xvd2VyQ2FzZSgpICE9PSBsb2NhbFN0b3JhZ2VBbGlhcy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldERpdmlzaW9uSW5mbygpIHsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2RpdmlzaW9uLycgKyBfZ2V0RGl2aXNpb25JZEZyb21Mb2NhbFN0b3JhZ2UoKVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBfc2V0U2VydmljZXMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRBbGxEaXZpc2lvbnMoKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2RpdmlzaW9uL2FsbC92MSdcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7ICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTsgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb25UaW1lKGRpdmlzaW9uSWQsIGRpdmlzaW9uVGltZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkFwaVVybCArICdkaXZpc2lvbi8nICsgZGl2aXNpb25JZCArICcvJyArIGRpdmlzaW9uVGltZSArICcvc2VydmljZURhdGVCeURpdmlzaW9uVGltZT9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gX2dldERpdmlzaW9uQnlTdGF0ZShzdGF0ZUNvZGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkFwaVVybCArICdkaXZpc2lvbi9HZXREaXZpc2lvbnNCeVN0YXRlLycgKyBzdGF0ZUNvZGUgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldERpdmlzaW9uc0J5TG9jYXRpb24obGF0aXR1ZGUsIGxvbmdpdHVkZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2RpdmlzaW9uLycgKyBsYXRpdHVkZSArICcvJyArIGxvbmdpdHVkZSArICcvR2V0Q2xvc2VzdERpdmlzaW9ucz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gX3NldERpdmlzaW9uUHJvcGVydGllcyhkaXZpc2lvbikge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnZGl2aXNpb24nLCBkaXZpc2lvbi5EaXZpc2lvbklEKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3RpbWVab25lJywgZGl2aXNpb24uVGltZVpvbmUpO1xyXG4gICAgICAgICAgICAvL2xvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhbGxvd2VkU2VydmljZXMnLCBkaXZpc2lvbi5BbGxvd2VkU2VydmljZXMudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIC8vIFRlc3Qgc3R1ZiBiZWNhdXNlIGl0IGlzIGJyb2tlbi4gXHJcbiAgICAgICAgICAgIC8vIERvIG5vdCBwdWJsaXNoIHRoaXMuXHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIGlmIChkaXZpc2lvbi5Db21tdXRlckRpdmlzaW9uSWQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcENvbW11dGVyRGl2aXNpb25JZCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpdmlzaW9uSUQgPSBkaXZpc2lvbi5EaXZpc2lvbklEO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChkaXZpc2lvbklEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMjA2JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwQ29tbXV0ZXJEaXZpc2lvbklkID0gJzIwNidcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMTAwMSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcENvbW11dGVyRGl2aXNpb25JZCA9ICcxMDAxLjEnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzEwMDInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBDb21tdXRlckRpdmlzaW9uSWQgPSAnMTAwMi4xJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICcxMDAzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwQ29tbXV0ZXJEaXZpc2lvbklkID0gJzEwMDMuMSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMTAwNCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcENvbW11dGVyRGl2aXNpb25JZCA9ICcxMDA0LjEnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzEwMDUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBDb21tdXRlckRpdmlzaW9uSWQgPSAnMTAwNS4xJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBDb21tdXRlckRpdmlzaW9uSWQgPSAnLTk5OSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9OyBkaXZpc2lvbi5Db21tdXRlckRpdmlzaW9uSWQgPSBtYXBDb21tdXRlckRpdmlzaW9uSWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2NpZCcsIGRpdmlzaW9uLkNvbW11dGVyRGl2aXNpb25JZCk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdzdXBwb3J0UGhvbmVOdW1iZXInLCBkaXZpc2lvbi5TdXBwb3J0UGhvbmVOdW1iZXIpO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYWxpYXMnLCBkaXZpc2lvbi5BbGlhcyk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdzeXN0ZW1QYXJhbWV0ZXJzJywgZGl2aXNpb24uU3lzdGVtUGFyYW1ldGVycyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc2V0U2VydmljZXMocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VJbmZvID0gW107ICAgIFxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uU2VydmljZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdmNJbmZvID0gICByZXNwb25zZS5kYXRhLnJlc3VsdC5EaXZpc2lvblNlcnZpY2VzW2ldLlNlcnZpY2U7ICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VJbmZvLnB1c2goXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogc3ZjSW5mby5JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTpzdmNJbmZvLk5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsaWFzOiByZXNwb25zZS5kYXRhLnJlc3VsdC5EaXZpc2lvblNlcnZpY2VzW2ldLkFsaWFzIHx8IHN2Y0luZm8uTmFtZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldChcInNlcnZpY2VJbmZvXCIsc2VydmljZUluZm8pOyAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2Jyb2FkY2FzdERpdmlzaW9uQ2hhbmdlZChoYXNEaXZpc2lvbkNoYW5nZWQpIHtcclxuICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSAmJiBoYXNEaXZpc2lvbkNoYW5nZWQpIHtcclxuICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgLmxvZ091dCgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2RpdmlzaW9uQ2hhbmdlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGhhc0RpdmlzaW9uQ2hhbmdlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8gb25seSBicm9hZGNhc3QgaWYgdGhlIGRpdmlzaW9uIGhhcyBhY3R1YWxseSBjaGFuZ2VkLlxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdkaXZpc2lvbkNoYW5nZWQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFRpbWVab25lRnJvbUxvY2FsU3RvcmFnZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCd0aW1lWm9uZScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldERpdmlzaW9uSWRGcm9tTG9jYWxTdG9yYWdlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2RpdmlzaW9uJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0QWxsb3dlZFNlcnZpY2VzRnJvbUxvY2FsU3RvcmFnZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdzZXJ2aWNlSW5mbycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldERpdmlzaW9uQWxpYXNGcm9tTG9jYWxTdG9yYWdlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2FsaWFzJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0U3VwcG9ydFBob25lTnVtYmVyRnJvbUxvY2FsU3RvcmFnZSgpIHtcclxuICAgICAgICBcdHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnc3VwcG9ydFBob25lTnVtYmVyJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0U3lzdGVtUGFyYW1ldGVyc0Zyb21Mb2NhbFN0b3JhZ2UoKSB7XHJcbiAgICAgICAgXHRyZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3N5c3RlbVBhcmFtZXRlcnMnKTtcclxuICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gX2lzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WQXBpT3JnVXJsICsgJ2RpdmlzaW9uLycgKyBfZ2V0RGl2aXNpb25JZEZyb21Mb2NhbFN0b3JhZ2UoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICArICcvc3lzdGVtUGFyYW1ldGVycy9hbGxvd2NvbW11dGVyd2FpdGxpc3QnICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YS5yZXN1bHQgPT0gJ3RydWUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgZGVmZXJyZWQucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGZhbHNlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdEeW5hbWljQ29udGVudFNlcnZpY2UnLCBEeW5hbWljQ29udGVudFNlcnZpY2UpO1xyXG5cclxuICAgIER5bmFtaWNDb250ZW50U2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnLCAnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRHluYW1pY0NvbnRlbnRTZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0V2hhdHNOZXdEYXRhOiBnZXRXaGF0c05ld0RhdGEsXHJcbiAgICAgICAgICAgIGdldERhdGE6IGdldERhdGEsXHJcbiAgICAgICAgICAgIGdldFN1cHBvcnRGQVE6IGdldFN1cHBvcnRGQVFcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U3VwcG9ydEZBUSgpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbW9uLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zdXBwb3J0RkFRJztcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFdoYXRzTmV3RGF0YSgpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlPcmdVcmwgKyAnd2hhdHNOZXcvR2V0Q3VycmVudFdoYXRzTmV3TGlzdC8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERhdGEocGFnZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdjb21tb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2R5bmFtaWMvJyArIHBhZ2U7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnR2VvTG9jYXRpb25TZXJ2aWNlJywgR2VvTG9jYXRpb25TZXJ2aWNlKTtcclxuXHJcbiAgICBHZW9Mb2NhdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJHJvb3RTY29wZScsJyRxJywgJyR3aW5kb3cnLCAnJHRpbWVvdXQnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBHZW9Mb2NhdGlvblNlcnZpY2UoJHJvb3RTY29wZSwgJHEsICR3aW5kb3csICR0aW1lb3V0KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldEN1cnJlbnRQb3NpdGlvbjogZ2V0Q3VycmVudFBvc2l0aW9uXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRQb3NpdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy8gV2UgaGF2ZSBtdWx0aXBsZSBwZW9wbGUgY2FsbGluZyB0aGlzIGZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiBHUFMgaXMgdHVybmVkIG9uLlxyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGFuIGlzc3VlIGluIEFuZHJvaWQgZW52aXJvbm1lbnQuICBJIGFkZGVkIGEgQnJvYWRjYXN0IHNvIHRoYXQgYW55b25lIGNhblxyXG4gICAgICAgICAgICAvLyBsaXN0ZW4gdG8gZmluZCBvdXQgaWYgR1BTIGlzIHR1cm5lZCBvbiwgb3Igb2ZmLlxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICBpZiAoISR3aW5kb3cubmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ0dlb0xvY2F0aW9uU2VydmljZS5ncHNJc0F2YWlsYWJsZScsIHsgZ3BzSXNFbmFibGVkOiBmYWxzZSwgbGFzdFBvc2l0aW9uOiB7fSwgdGltZXN0YW1wOiBuZXcgRGF0ZSgpIH0pO1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCdHZW9sb2NhdGlvbiBub3Qgc3VwcG9ydGVkJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgIHZhciB0aW1lb3V0UHJvbWlzZSA9ICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoJ1VzZXIgY2FuY2VsbGVkJyk7ICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSwgMTAwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICR3aW5kb3cubmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdHZW9Mb2NhdGlvblNlcnZpY2UuZ3BzSXNBdmFpbGFibGUnLCB7IGdwc0lzRW5hYmxlZDogdHJ1ZSwgbGFzdFBvc2l0aW9uOiBwb3NpdGlvbiwgdGltZXN0YW1wOiBuZXcgRGF0ZSgpIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZW91dFByb21pc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnR2VvTG9jYXRpb25TZXJ2aWNlLmdwc0lzQXZhaWxhYmxlJywgeyBncHNJc0VuYWJsZWQ6IGZhbHNlLCBsYXN0UG9zaXRpb246IHt9LCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lb3V0UHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0se21heGltdW1BZ2U6IDAsIGVuYWJsZUhpZ2hBY2N1cmFjeTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0xvZ2luU2VydmljZScsIExvZ2luU2VydmljZSk7XHJcblxyXG4gICAgTG9naW5TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywnJHEnLCdlbnYnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBMb2dpblNlcnZpY2UoJGh0dHAsICRxLGVudikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBhdXRoZW50aWNhdGU6IGF1dGhlbnRpY2F0ZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhdXRoZW50aWNhdGUocHJvdmlkZXIsIHJldHVyblVybCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdhY2NvdW50L0V4dGVybmFsTG9naW4/cHJvdmlkZXI9JyArIHByb3ZpZGVyICsgJyZyZXR1cm5Vcmw9JyArIHJldHVyblVybDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ3RleHQvcGxhaW4nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZGF0YToge31cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdMdXVtTGlua2VkU2VydmljZScsIEx1dW1MaW5rZWRTZXJ2aWNlKTtcclxuXHJcbiAgICBMdXVtTGlua2VkU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnLCckcm9vdFNjb3BlJywnJHVpYk1vZGFsJywnJGxvY2F0aW9uJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTHV1bUxpbmtlZFNlcnZpY2UoJGh0dHAsICRxLCBlbnYsICRyb290U2NvcGUsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICB2ZXJpZnk6IHZlcmlmeSxcclxuICAgICAgICAgICAgZ2V0TmV3UGFzc2VuZ2VyTHV1bUxpbmthZ2VJbmZvOiBnZXROZXdQYXNzZW5nZXJMdXVtTGlua2FnZUluZm8sXHJcbiAgICAgICAgICAgIGRpc3BsYXlOZXdQYXNzZW5nZXJNZXNzYWdlIDogZGlzcGxheU5ld1Bhc3Nlbmdlck1lc3NhZ2VcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlOZXdQYXNzZW5nZXJNZXNzYWdlKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCIgPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxoMyBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+T25lTVYtTFVVTSBJbnRlZ3JhdGlvbiBJbmZvPC9oMz4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxwPicgK21lc3NhZ2UgKyAnPC9wPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi13YXJuaW5nXCIgdHlwZT1cImJ1dHRvblwiIG5nLWNsaWNrPVwiY2xvc2UoKVwiPk9LPC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2UgOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnJlcGxhY2UoKS5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TmV3UGFzc2VuZ2VyTHV1bUxpbmthZ2VJbmZvKGRpdmlzaW9uSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlPcmdVcmwgKyAnZGl2aXNpb24vJyArIGRpdmlzaW9uSWQgKyAnL25ld1Bhc3Nlbmdlck1lc3NhZ2UnO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZlcmlmeShwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gZW52Lm9uZU1WQXBpT3JnVXJsICsgJ3Bhc3Nlbmdlci9sdXVtTGlua2FnZS8nICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZXhlY3V0ZSBpZmYsIGRpdmlzaW9uIG5lZWQgb3IgY3VycmVudCBkYXRlIGhhcyBwYXNzZWQgc3RhcnQgZGF0ZSBmb3IgYXBwbGljYWJsZSBkaXZpc2lvbi5cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQudmVyaWZ5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuZGF0YS5yZXN1bHQuaXNMaW5rZWRUb0x1dW0pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0Lm1lc3NhZ2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiID4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGgzIGNsYXNzPVwibW9kYWwtdGl0bGVcIj5PbmVNVi1MVVVNIEludGVncmF0aW9uIEluZm88L2gzPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+JyArIG1lc3NhZ2UgKyAnPC9wPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi13YXJuaW5nXCIgdHlwZT1cImJ1dHRvblwiIG5nLWNsaWNrPVwiY2xvc2UoKVwiPk9LPC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdC5kaXNhYmxlQ29tbXV0ZXJOYXZpZ2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhdGggPSAkbG9jYXRpb24ucGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXRoLmluZGV4T2YoJy9jb21tdXRlci9zZWxlY3RlZC1zdG9wJykgPiAtMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBwYXRoLmluZGV4T2YoJy9wYXNzZW5nZXItdHJpcHMnKSA+IC0xXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IHBhdGguaW5kZXhPZignL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS1zZXR1cCcpID4gLTFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgcGF0aC5pbmRleE9mKCcvY29tbXV0ZXIvbXktdmVoaWNsZXMnKSA+IC0xKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnBhc3Nlbmdlck5vdGlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnJlcGxhY2UoKS5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgLmZhY3RvcnkoJ01hcEljb25TZXJ2aWNlJywgTWFwSWNvblNlcnZpY2UpO1xyXG5cclxuICAgIE1hcEljb25TZXJ2aWNlLiRpbmplY3QgPSBbJ1BvcnRhbFV0aWxpdHlTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTWFwSWNvblNlcnZpY2UoUG9ydGFsVXRpbGl0eVNlcnZpY2UpIHsgICAgICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldENvbW11dGVyU3RvcEljb24gOiBfZ2V0Q29tbXV0ZXJTdG9wSWNvbixcclxuICAgICAgICAgICAgZ2V0Q29tbXV0ZXJIdWJJY29uOiBfZ2V0Q29tbXV0ZXJIdWJJY29uLFxyXG4gICAgICAgICAgICBnZXREcnRQaWNrdXBJY29uOiBfZ2V0RHJ0UGlja3VwSWNvbixcclxuICAgICAgICAgICAgZ2V0RHJ0RHJvcG9mZkljb246IF9nZXREcnREcm9wb2ZmSWNvblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRDb21tdXRlckh1Ykljb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQb3J0YWxVdGlsaXR5U2VydmljZS5pc0lFKCkgPyAnaW1hZ2VzL3Bpbi1odWIucG5nJyA6ICdpbWFnZXMvcGluLWh1Yi5zdmcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldENvbW11dGVyU3RvcEljb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQb3J0YWxVdGlsaXR5U2VydmljZS5pc0lFKCkgPyAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZWVuLnBuZycgOiAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZWVuLnN2Zyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RHJ0UGlja3VwSWNvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdpbWFnZXMvZGVmYXVsdC9pLWRydC1waW4tYi5wbmcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldERydERyb3BvZmZJY29uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2ltYWdlcy9kZWZhdWx0L2ktZHJ0LXBpbi1nLnBuZyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdNYXBTZXJ2aWNlJywgTWFwU2VydmljZSk7XHJcblxyXG4gICAgTWFwU2VydmljZS4kaW5qZWN0ID0gWyckdGltZW91dCcsICd1aUdtYXBJc1JlYWR5JywgJ2dvb2dsZU1hcHNDb25maWcnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNYXBTZXJ2aWNlKCR0aW1lb3V0LCB1aUdtYXBJc1JlYWR5LCBnb29nbGVNYXBzQ29uZmlnKSB7XHJcblxyXG5cclxuICAgICAgICB2YXIgX21hcCA9IHVuZGVmaW5lZDtcclxuXHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzZXRNYXBCb3VuZHM6IHNldE1hcEJvdW5kcyxcclxuICAgICAgICAgICAgaW5pdGlhbGl6ZU1hcDogX3NldE1hcCxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0TWFwQm91bmRzKG1hcmtlcnMsIGV2ZW50cykge1xyXG5cclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoX21hcCkgfHwgYW5ndWxhci5pc1VuZGVmaW5lZChtYXJrZXJzKSB8fCBtYXJrZXJzLmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG1hcmtlcnMsIGZ1bmN0aW9uIChtYXJrZXIpIHtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgICdsYXQnOiBtYXJrZXIubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2xuZyc6IG1hcmtlci5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnRzKSBcclxuICAgICAgICAgICAgICAgIF9tYXAubWFya2VyRXZlbnQgPSBzZXRNYXJrZXJFdmVudHMoZXZlbnRzKTtcclxuXHJcbiAgICAgICAgICAgIF9tYXAuY29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICAgIF9tYXAuY29udHJvbC5nZXRHTWFwKCkuc2V0Wm9vbShfbWFwLmNvbnRyb2wuZ2V0R01hcCgpLmdldFpvb20oKSAtIDEpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zZXRNYXAoKSB7XHJcblxyXG4gICAgICAgICAgICBfbWFwID0ge1xyXG4gICAgICAgICAgICAgICAgY2VudGVyOlxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IDQ3LjYyMTYwMjYsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogLTEyMi4zNDI4NjJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgem9vbTogMTUsXHJcbiAgICAgICAgICAgICAgICBtYXBPcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBnb29nbGVNYXBzQ29uZmlnLm1hcFN0eWxlc1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2w6IHt9LFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBfbWFwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VyRXZlbnRzKGV2ZW50cykge1xyXG4gICAgICAgICAgICB2YXIgZXZudE9iaiA9IHt9O1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGV2ZW50cywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLmV2ZW50ICYmIHR5cGVvZiBlLmNhbGxiYWNrID09PSAnZnVuY3Rpb24nKVxyXG4gICAgICAgICAgICAgICAgICAgIGV2bnRPYmpbZS5ldmVudF0gPSBmdW5jdGlvbiAoZ01hcmtlciwgZXZlbnROYW1lLCBtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwuJGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmNhbGxiYWNrKG1vZGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGV2bnRPYmo7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cdGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ01lc3NhZ2VCb3gnLCBNZXNzYWdlQm94KTtcclxuXHJcblx0TWVzc2FnZUJveC4kaW5qZWN0ID0gWyckcScsICckdWliTW9kYWwnLCAnJHVpYk1vZGFsU3RhY2snXTtcclxuXHJcblx0ZnVuY3Rpb24gTWVzc2FnZUJveCgkcSwgJHVpYk1vZGFsLCAkdWliTW9kYWxTdGFjaykge1xyXG5cdFx0dmFyIHNlcnZpY2UgPSB7XHJcblx0XHRcdGluZm86IGluZm9cclxuXHRcdH07XHJcblxyXG5cdFx0cmV0dXJuIHNlcnZpY2U7XHJcblxyXG5cdFx0ZnVuY3Rpb24gaW5mbyh0aXRsZSwgbWVzc2FnZSkge1xyXG5cdFx0XHR2YXIgdGVtcGxhdGUgPVxyXG5cdFx0XHQnPGRpdiBjbGFzcz1cIm1vZGFsX19jb250ZW50XCI+XFxcclxuXHRcdFx0XHQ8ZGl2IGNsYXNzPVwibW9kYWxfX2hlYWRlclwiPlxcXHJcblx0XHRcdFx0XHQ8aDQgY2xhc3M9XCJtb2RhbC10aXRsZVwiPicgKyB0aXRsZSArICc8L2g0PlxcXHJcblx0XHRcdFx0PC9kaXY+XFxcclxuXHRcdFx0XHQ8ZGl2IGNsYXNzPVwibW9kYWxfX2JvZHlcIj5cXFxyXG5cdFx0XHRcdFx0PHA+JyArIG1lc3NhZ2UgKyAnPC9wPlxcXHJcblx0XHRcdFx0XHQ8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBuZy1jbGljaz1cIm9rKClcIiBjbGFzcz1cImJ0biBidG4tLXByaW1hcnlcIj5PazwvYnV0dG9uPlxcXHJcblx0XHRcdFx0PC9kaXY+XFxcclxuXHRcdFx0PC9kaXY+JztcclxuXHJcblx0XHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG5cdFx0XHR2YXIgbWVzc2FnZUJveCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuXHRcdFx0XHRiYWNrZHJvcDogZmFsc2UsIC8vIHByZXZlbnQgdXNlciBmcm9tIGRpc21pc3NpbmcgbWVzc2FnZWJveCBieSBjbGlja2luZyBiYWNrZ3JvdW5kXHJcblx0XHRcdFx0dGVtcGxhdGU6IHRlbXBsYXRlLFxyXG5cdFx0XHRcdHNpemU6Jy1mcycsXHJcblx0XHRcdFx0Y29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSkge1xyXG5cdFx0XHRcdFx0JHNjb3BlLm9rID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHQkdWliTW9kYWxTdGFjay5kaXNtaXNzQWxsKCk7XHJcblx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSkuY2xvc2VkLnRoZW4oZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHRcdH1cclxuXHR9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpe1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ09uZU12U2VydmljZXMnLE9uZU12U2VydmljZXMpO1xyXG5cclxuICAgIE9uZU12U2VydmljZXMuJGluamVjdCA9IFsnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gT25lTXZTZXJ2aWNlcyhEaXZpc2lvblNlcnZpY2Upe1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXRDb21tdXRlckluZm8gOl9nZXRDb21tdXRlclNlcnZpY2VJbmZvLFxyXG4gICAgICAgICAgICBnZXRGaXhlZFJvdXRlSW5mbyA6X2dldEZpeGVkUm91dGVTZXJ2aWNlSW5mbyxcclxuICAgICAgICAgICAgZ2V0RHJ0SW5mbyA6X2dldERydFNlcnZpY2VJbmZvICAgICAgIFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0Q29tbXV0ZXJTZXJ2aWNlSW5mbygpeyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gZmluZCgnY29tbXV0ZXInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRGaXhlZFJvdXRlU2VydmljZUluZm8oKXsgICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIGZpbmQoJ2ZpeGVkJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RHJ0U2VydmljZUluZm8oKXtcclxuICAgICAgICAgICAgcmV0dXJuIGZpbmQoJ2RydCcpOyAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbmQoc2VydmljZU5hbWUpe1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZXMgPSBEaXZpc2lvblNlcnZpY2UuZ2V0QWxsb3dlZFNlcnZpY2VzKCkgfHwgW10gO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaTxzZXJ2aWNlcy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKHNlcnZpY2VzW2ldLm5hbWUudG9Mb3dlckNhc2UoKSA9PSBzZXJ2aWNlTmFtZS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlc1tpXTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdQYWdlU2VydmljZScsIFBhZ2VTZXJ2aWNlKTtcclxuXHJcbiAgICBQYWdlU2VydmljZS4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gUGFnZVNlcnZpY2UoKSB7XHJcbiAgICAgICAgdmFyIHRpdGxlID0gJyc7XHJcbiAgICAgICAgdmFyIGhlYWRsaW5lID0gJyc7XHJcbiAgICAgICAgdmFyIHByb2R1Y3QgPSAnJztcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0aXRsZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGl0bGU7IH0sXHJcbiAgICAgICAgICAgIHNldFRpdGxlOiBmdW5jdGlvbiAobmV3VGl0bGUpIHsgdGl0bGUgPSBuZXdUaXRsZTsgfSxcclxuXHJcbiAgICAgICAgICAgIGhlYWRsaW5lOiBmdW5jdGlvbiAoKSB7IHJldHVybiBoZWFkbGluZTsgfSxcclxuICAgICAgICAgICAgc2V0SGVhZGxpbmU6IGZ1bmN0aW9uIChuZXdIZWFkbGluZSkgeyBoZWFkbGluZSA9IG5ld0hlYWRsaW5lOyB9LFxyXG5cclxuICAgICAgICAgICAgcHJvZHVjdDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcHJvZHVjdDsgfSxcclxuICAgICAgICAgICAgc2V0UHJvZHVjdDogZnVuY3Rpb24gKG5ld1Byb2R1Y3QpIHsgcHJvZHVjdCA9IG5ld1Byb2R1Y3Q7IH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1Bhc3N3b3JkU2VydmljZScsIFBhc3N3b3JkU2VydmljZSk7XHJcblxyXG4gICAgUGFzc3dvcmRTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudicsICdEaXZpc2lvblNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBQYXNzd29yZFNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSwgYXV0aFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgQ2hhbmdlUGFzc3dvcmQ6IGNoYW5nZVBhc3N3b3JkLFxyXG4gICAgICAgICAgICBWZXJpZnlBbmRVcGRhdGVQYXNzd29yZDogdXBkYXRlQW5kVmVyaWZ5UGFzc3dvcmQsXHJcbiAgICAgICAgICAgIFNlbmRQYXNzY29kZTogc2VuZFBhc3Njb2RlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUFuZFZlcmlmeVBhc3N3b3JkKHZlcmlmeUFuZFVwZGF0ZVZNKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgdmFyIHVybCA9IGVudi5vbmVNVkFwaVVybCArICdwYXNzd29yZC8nICsgZGl2aXNpb25JZCArICcvdXBkYXRlUGFzc3dvcmRXaXRoVGVtcENvZGUnO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIHVybDogdXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkodmVyaWZ5QW5kVXBkYXRlVk0pXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTsgIC8vcHV0IGFsbCBodGUgaWYgc3RhdG1lbnRzIGhlcmUgYWxzbyB3aGF0IHRvIHJlc29sdmUuXHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkKGNoYW5nZVB3ZFZNKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgXCIvcGFzc2VuZ2VyL1wiICsgYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgKyBcIi9jaGFuZ2VQYXNzd29yZFwiO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9qc29uJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGNoYW5nZVB3ZFZNKVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNlbmRQYXNzY29kZShlbWFpbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyBcInBhc3N3b3JkL1wiICArIGRpdmlzaW9uSWQgKyBcIi9zZW5kVGVtcG9yYXJ5Q29kZVwiO1xyXG4gICAgICAgICAgICAvLyRodHRwKHtcclxuICAgICAgICAgICAgLy8gICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIC8vICAgICd1cmwnOiBzZXJ2aWNlVXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG4gICAgICAgICAgICAvLyAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7IGVtYWlsIH0pXHJcbiAgICAgICAgICAgIC8vfSlcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRodHRwLnBvc3Qoc2VydmljZVVybCwgJ1wiJyArIGVtYWlsICsgJ1wiJykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdQb3J0YWxVdGlsaXR5U2VydmljZScsIFBvcnRhbFV0aWxpdHlTZXJ2aWNlKTtcclxuXHJcbiAgICBQb3J0YWxVdGlsaXR5U2VydmljZS4kaW5qZWN0ID0gWyckd2luZG93J107XHJcblxyXG4gICAgZnVuY3Rpb24gUG9ydGFsVXRpbGl0eVNlcnZpY2UoJHdpbmRvdykge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBoYXNWYWx1ZTogaGFzVmFsdWUsXHJcbiAgICAgICAgICAgIGlzSUUgOmlzSUVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFzVmFsdWUoaW5wdXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlucHV0ICE9IG51bGwgJiYgaW5wdXQgIT0gdW5kZWZpbmVkICYmIGlucHV0ICE9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzSUUoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwXHJcbiAgICAgICAgICAgICAgICAgICAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cdGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1Byb2ZpbGVTZXJ2aWNlJywgUHJvZmlsZVNlcnZpY2UpO1xyXG5cclxuXHRQcm9maWxlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0NvbmZpZ0ZhY3RvcnknLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcblx0ZnVuY3Rpb24gUHJvZmlsZVNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSwgQ29uZmlnRmFjdG9yeSwgYXV0aFNlcnZpY2UpIHtcclxuXHRcdHZhciBzZXJ2aWNlQmFzZSA9IGVudi5vbmVNVkFwaVVybDtcclxuXHJcblx0XHR2YXIgc2VydmljZSA9IHtcclxuXHRcdFx0Ly8gcGFzc2VuZ2VyIHByb2ZpbGUsIGluY2x1ZGluZyBob21lIGFkZHJlc3NcclxuXHRcdFx0R2V0UHJvZmlsZTogR2V0UHJvZmlsZSxcclxuXHRcdFx0VXBkYXRlUHJvZmlsZTogVXBkYXRlUHJvZmlsZSxcclxuICAgICAgICAgICAgR2V0UGFzc2VuZ2VyQWdlOiBnZXRQYXNzZW5nZXJBZ2UsXHJcblxyXG5cdFx0XHQvLyBob21lIGFkZHJlc3Mgb25seVxyXG5cdFx0XHRHZXRIb21lQWRkcmVzczogR2V0SG9tZUFkZHJlc3MsXHJcblx0XHRcdFVwZGF0ZUhvbWVBZGRyZXNzOiBVcGRhdGVIb21lQWRkcmVzcyxcclxuXHJcblx0XHRcdEFsbG93RWRpdEhvbWVBZGRyZXNzOiBBbGxvd0VkaXRIb21lQWRkcmVzcyxcclxuXHRcdFx0U2hvd0hvbWVBZGRyZXNzOiBTaG93SG9tZUFkZHJlc3MsXHJcblx0XHRcdEdldERlZmF1bHRNb2JpbGl0eUFpZHM6IEdldERlZmF1bHRNb2JpbGl0eUFpZHNcclxuXHRcdH07XHJcblxyXG5cdFx0cmV0dXJuIHNlcnZpY2U7XHJcblxyXG5cdFx0Ly8gZGV0ZXJtaW5lIGlmIGhvbWUgbG9jYXRpb24gc2hvdWxkIGJlIGRpc3BsYXllZFxyXG5cdFx0ZnVuY3Rpb24gU2hvd0hvbWVBZGRyZXNzKCkge1xyXG5cdFx0XHR2YXIgZGl2aXNpb25QYXJhbWV0ZXJzID0gRGl2aXNpb25TZXJ2aWNlLmdldFN5c3RlbVBhcmFtZXRlcnMoKTtcclxuXHRcdFx0cmV0dXJuIGRpdmlzaW9uUGFyYW1ldGVycy5Ecm9wb2ZmSG9tZUxvY2F0aW9uT25seTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBkZXRlcm1pbmUgaWYgdGhlIGdpdmVuIHBhc3NlbmdlciBtYXkgY2hhbmdlIGhpcyBob21lIGxvY2F0aW9uXHJcblx0XHRmdW5jdGlvbiBBbGxvd0VkaXRIb21lQWRkcmVzcygpIHtcclxuXHRcdFx0dmFyIGRpdmlzaW9uUGFyYW1ldGVycyA9IERpdmlzaW9uU2VydmljZS5nZXRTeXN0ZW1QYXJhbWV0ZXJzKCk7XHJcblx0XHRcdHZhciBhbGxvd0VkaXRQcm9maWxlID0gZGl2aXNpb25QYXJhbWV0ZXJzLkRyb3BvZmZIb21lTG9jYXRpb25Pbmx5XHJcblx0XHRcdFx0JiYgZGl2aXNpb25QYXJhbWV0ZXJzLkRyb3BvZmZIb21lTG9jYXRpb25FZGl0O1xyXG5cdFx0XHRyZXR1cm4gYWxsb3dFZGl0UHJvZmlsZTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBnZXRQYXNzZW5nZXJBZ2UocGFzc2VuZ2VySWQpXHJcblx0XHR7XHJcblx0XHQgICAgdmFyIHVybCA9IHNlcnZpY2VCYXNlICsgJ3Bhc3Nlbmdlci8nICsgcGFzc2VuZ2VySWQgKyAnL2FnZSc7XHJcblxyXG5cdFx0ICAgIHJldHVybiAkaHR0cCh7XHJcblx0XHQgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcblx0XHQgICAgICAgIHVybDogdXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcblx0XHQgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdCAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuXHRcdCAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuXHRcdCAgICAgICAgfVxyXG5cdFx0ICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdCAgICAgICAgdGhyb3cgZXJyO1xyXG5cdFx0ICAgIH0pO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gR2V0SG9tZUFkZHJlc3MocGFzc2VuZ2VySWQpIHtcclxuXHRcdFx0dmFyIHVybCA9IHNlcnZpY2VCYXNlICsgJ3Bhc3Nlbmdlci9HZXRIb21lQWRkcmVzcy8nICsgcGFzc2VuZ2VySWQ7XHJcblxyXG5cdFx0XHRyZXR1cm4gJGh0dHAoe1xyXG5cdFx0XHRcdG1ldGhvZDogJ0dFVCcsXHJcblx0XHRcdFx0dXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuXHRcdFx0fSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0dGhyb3cgZXJyO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBHZXRQcm9maWxlKHBhc3NlbmdlcklkKSB7XHJcblx0XHRcdHZhciB1cmwgPSBzZXJ2aWNlQmFzZSArICdwYXNzZW5nZXIvR2V0UHJvZmlsZS8nICsgcGFzc2VuZ2VySWQ7XHJcblxyXG5cdFx0XHRyZXR1cm4gJGh0dHAoe1xyXG5cdFx0XHRcdG1ldGhvZDogJ0dFVCcsXHJcblx0XHRcdFx0dXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuXHRcdFx0fSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIFVwZGF0ZUhvbWVBZGRyZXNzKHBhc3NlbmdlcklkLCBob21lQWRkcmVzcykge1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICdwYXNzZW5nZXIvVXBkYXRlSG9tZUFkZHJlc3MvJyArIHBhc3NlbmdlcklkLCBob21lQWRkcmVzcylcclxuXHRcdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiByZXNwb25zZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBVcGRhdGVQcm9maWxlKHByb2ZpbGUpIHtcclxuXHRcdFx0cmV0dXJuICRodHRwLnBvc3Qoc2VydmljZUJhc2UgKyAncGFzc2VuZ2VyL1VwZGF0ZVByb2ZpbGUnLCBwcm9maWxlKVxyXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIEdldERlZmF1bHRNb2JpbGl0eUFpZHMoZGl2aXNpb25JZCwgcGFzc2VuZ2VySWQpIHtcclxuXHRcdFx0dmFyIHVybCA9IHNlcnZpY2VCYXNlICsgJ3Bhc3Nlbmdlci9HZXREZWZhdWx0TW9iaWxpdHlBaWRzLycgKyBkaXZpc2lvbklkICsgJy8nICsgcGFzc2VuZ2VySWQ7XHJcblx0XHRcdHJldHVybiAkaHR0cCh7XHJcblx0XHRcdFx0bWV0aG9kOiAnR0VUJyxcclxuXHRcdFx0XHR1cmw6IHVybCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiByZXNwb25zZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1JlZGlyZWN0aW9uU2VydmljZScsIFJlZGlyZWN0aW9uU2VydmljZSk7XHJcblxyXG4gICAgUmVkaXJlY3Rpb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsJ2xvY2FsU3RvcmFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBSZWRpcmVjdGlvblNlcnZpY2UoJGxvY2F0aW9uLGxvY2FsU3RvcmFnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgc2F2ZTogc2F2ZSxcclxuICAgICAgICAgICAgcmVkaXJlY3Q6IHJlZGlyZWN0LFxyXG4gICAgICAgICAgICByZWRpcmVjdFRvOiByZWRpcmVjdFRvXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmUocGF0aCkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnY29taW5nLWZyb20nLCBwYXRoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZGlyZWN0KCkge1xyXG4gICAgICAgICAgICB2YXIgY29taW5nRnJvbSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdjb21pbmctZnJvbScpO1xyXG4gICAgICAgICAgICBpZiAoY29taW5nRnJvbSlcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2UucmVtb3ZlKCdjb21pbmctZnJvbScpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBjb21pbmdGcm9tID0gJ2Rhc2hib2FyZC8nO1xyXG5cclxuICAgICAgICAgICAgcmVkaXJlY3RUbyhjb21pbmdGcm9tKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZGlyZWN0VG8odXJsKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKHVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnUmVzZXJ2YXRpb25TZXJ2aWNlJywgUmVzZXJ2YXRpb25TZXJ2aWNlKTtcclxuXHJcbiAgICBSZXNlcnZhdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52JywnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUmVzZXJ2YXRpb25TZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY2FuY2VsUmVzZXJ2YXRpb246IGNhbmNlbFJlc2VydmF0aW9uLFxyXG4gICAgICAgICAgICBnZXRBbGxSZXNlcnZhdGlvbnNGb3JQYXNzZW5nZXI6IGdldEFsbFJlc2VydmF0aW9uc0ZvclBhc3NlbmdlcixcclxuICAgICAgICAgICAgZ2V0U3RvcEluZm9mb3JSZXNlcnZhdGlvbnM6IGdldFN0b3BJbmZvZm9yUmVzZXJ2YXRpb25zLFxyXG4gICAgICAgICAgICBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnNGb3JUb2RheTogZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zRm9yVG9kYXksXHJcbiAgICAgICAgICAgIGdldFVzZXJSZXNlcnZhdGlvbkZvcjogZ2V0VXNlclJlc2VydmF0aW9uRm9yLFxyXG4gICAgICAgICAgICBnZXRVc2VyUmVzZXJ2YXRpb25zQnlEdXJhdGlvbjogZ2V0VXNlclJlc2VydmF0aW9uc0J5RHVyYXRpb24sXHJcbiAgICAgICAgICAgIGdldFRyaXBUaW1pbmdzQnlEdXJhdGlvbjogZ2V0VHJpcFRpbWluZ3NCeUR1cmF0aW9uLFxyXG4gICAgICAgICAgICBhZGRSZXNlcnZhdGlvbnM6IGFkZFJlc2VydmF0aW9ucyxcclxuICAgICAgICAgICAgbWFuYWdlUGFya2luZ0ZvclJlc2VydmF0aW9uOiBtYW5hZ2VQYXJraW5nRm9yUmVzZXJ2YXRpb24sICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGdldEFsbFRyaXBzRm9yQ3VycmVudFJlc2VydmF0aW9uOiBnZXRBbGxUcmlwc0ZvckN1cnJlbnRSZXNlcnZhdGlvbixcclxuICAgICAgICAgICAgbW9kaWZ5UmVzZXJ2YXRpb246IG1vZGlmeVJlc2VydmF0aW9uLFxyXG4gICAgICAgICAgICBnZXRBZHZSZXNlcnZhdGlvbkFsbG93ZWRXZWVrczogZ2V0QWR2UmVzZXJ2YXRpb25BbGxvd2VkV2Vla3MsXHJcbiAgICAgICAgICAgIGdldFJlc2VydmF0aW9uQnlJZDogZ2V0UmVzZXJ2YXRpb25CeUlkLFxyXG4gICAgICAgICAgICBhZGRXYWl0bGlzdGVkUmVzZXJ2YXRpb25zOiBhZGRXYWl0bGlzdGVkUmVzZXJ2YXRpb25zLFxyXG4gICAgICAgICAgICBnZXRBdmFpbGFibGVTZWF0c0ZvclRyaXA6IGdldEF2YWlsYWJsZVNlYXRzRm9yVHJpcCxcclxuICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyVGVtcGxhdGVzOiBnZXRQYXNzZW5nZXJUZW1wbGF0ZXMsXHJcbiAgICAgICAgICAgIGFkZFBhc3NlbmdlclRlbXBsYXRlOmFkZFBhc3NlbmdlclRlbXBsYXRlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBZHZSZXNlcnZhdGlvbkFsbG93ZWRXZWVrcygpIHtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9ucy9hZHZSZXNlcnZhdGlvbldpbmRvdz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbW9kaWZ5UmVzZXJ2YXRpb24ocmVzZXJ2YXRpb25JZCxuZXdUcmlwSWQsIHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnL3Jlc2VydmF0aW9ucy8nICsgcmVzZXJ2YXRpb25JZCArICcvY2hhbmdlUGlja3VwLycgKyBuZXdUcmlwSWQgKyAnLycgK3Bhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxUcmlwc0ZvckN1cnJlbnRSZXNlcnZhdGlvbihyZXNlcnZhdGlvbklkLCBwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25zLycgKyByZXNlcnZhdGlvbklkICsgJy9hbHRUcmlwcy8nICsgcGFzc2VuZ2VySWQgK1xyXG4gICAgICAgICAgICAgICAgJz9ybmQnICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJSZXNlcnZhdGlvbkZvcihwYXNzZW5nZXJJZCwgc2NoZWR1bGVUeXBlLCByZXNlcnZhdGlvbkRhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9ucy9mb3IvJyArIHBhc3NlbmdlcklkICsgJy8nICsgc2NoZWR1bGVUeXBlICtcclxuICAgICAgICAgICAgICAgICcvJyArIHJlc2VydmF0aW9uRGF0ZSArICcvJyArICc/cm5kJyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFJlc2VydmF0aW9ucyhwYXNzZW5nZXJJZCwgcmVzZXJ2YXRpb25zKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9yZXNlcnZhdGlvbnMvYWRkLycgKyBwYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkocmVzZXJ2YXRpb25zKSxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRXYWl0bGlzdGVkUmVzZXJ2YXRpb25zKHBhc3NlbmdlcklkLCByZXNlcnZhdGlvbnMpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9ucy93YWl0bGlzdC9hZGQvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXNlcnZhdGlvbnMpLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbFJlc2VydmF0aW9uKHBhc3NlbmdlcklkLHJlc2VydmF0aW9uSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgICsgJy8nICsgcGFzc2VuZ2VySWQgKyAnL3Jlc2VydmF0aW9ucy8nICsgcmVzZXJ2YXRpb25JZCArICcvY2FuY2VsJztcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxSZXNlcnZhdGlvbnNGb3JQYXNzZW5nZXIocGFzc2VuZ2VySWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9ucy9hbGwvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTdG9wSW5mb2ZvclJlc2VydmF0aW9ucyhpbmNpZGVudElkLHN0b3BJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdyZXNlcnZhdGlvbi8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvc3RvcEluZm8vJyArIGluY2lkZW50SWQgKyAnLycgKyBzdG9wSWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zRm9yVG9kYXkoIHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9yZXNlcnZhdGlvbnMvdG9kYXkvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VyUmVzZXJ2YXRpb25zQnlEdXJhdGlvbih1c2VySWQsIHNjaGVkdWxlVHlwZSwgZHVyYXRpb24pIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAncmVzZXJ2YXRpb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3VzZXIvJyArIHVzZXJJZCArICcvJyArIHNjaGVkdWxlVHlwZSArICc/ZHVyYXRpb249JyArIGR1cmF0aW9uO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUcmlwVGltaW5nc0J5RHVyYXRpb24oZnJvbVN0b3BJZCwgdG9TdG9wSWQsIHNjaGVkdWxlVHlwZSwgZHVyYXRpb24pIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAncmVzZXJ2YXRpb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3RyaXBUaW1pbmdzLycgKyBmcm9tU3RvcElkICsgJy8nICsgdG9TdG9wSWQgKyAnLycgKyBzY2hlZHVsZVR5cGUgKyAnP2R1cmF0aW9uPScgKyBkdXJhdGlvbjtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYW5hZ2VQYXJraW5nRm9yUmVzZXJ2YXRpb24ocGFzc2VuZ2VySWQsIHJlc2VydmF0aW9uSWQsIHZlaGljbGVJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvJyArIHBhc3NlbmdlcklkICsgJy8nICsgcmVzZXJ2YXRpb25JZCArICcvbWFuYWdlUGFya2luZ1Jlc2VydmF0aW9uLycgKyB2ZWhpY2xlSWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXRSZXNlcnZhdGlvbkJ5SWQocGFzc2VuZ2VySWQsIGlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy8nICsgcGFzc2VuZ2VySWQgKyAnL3Jlc2VydmF0aW9ucy8nICsgaWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVNlYXRzRm9yVHJpcCh0cmlwSWQsIHJlc2VydmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvYXZhaWxhYmxlU2VhdHMvJyArIHRyaXBJZCArICcvJyArIHJlc2VydmF0aW9uRGF0ZTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBhc3NlbmdlclRlbXBsYXRlcyhwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25UZW1wbGF0ZXMvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRQYXNzZW5nZXJUZW1wbGF0ZShwYXNzZW5nZXJJZCwgdGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9uVGVtcGxhdGVzLycgKyBwYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgZGF0YTogdGVtcGxhdGUsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTsgICAgICAgIFxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnU2VydmljZUFyZWFTZXJ2aWNlJywgU2VydmljZUFyZWFTZXJ2aWNlKTtcclxuXHJcbiAgICBTZXJ2aWNlQXJlYVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCckcScsJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlcnZpY2VBcmVhU2VydmljZSgkaHR0cCwkcSxlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgaXNJblNlcnZpY2VBcmVhOiBpc0luU2VydmljZUFyZWFcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNJblNlcnZpY2VBcmVhKGRpdmlzaW9uSWQsIGxhdCwgbG9uKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpT3JnVXJsICsgJ3NlcnZpY2VhcmVhL2NhblJlZ2lzdGVyT3JMb2dpbi8nICsgZGl2aXNpb25JZCArICcvJyArIGxhdCArICcvJyArIGxvbjtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FsbFN0b3BzQ29udHJvbGxlcicsIEFsbFN0b3BzQ29udHJvbGxlcilcclxuICAgICAgICAuY29udHJvbGxlcignaW5mb1dpbmRvd0NvbnRyb2xsZXInLCBpbmZvV2luZG93Q29udHJvbGxlcik7XHJcblxyXG4gICAgaW5mb1dpbmRvd0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyRzY29wZScsICdTdG9wRGF0YVNlcnZpY2UnXTtcclxuICAgIGZ1bmN0aW9uIGluZm9XaW5kb3dDb250cm9sbGVyKCRsb2NhdGlvbiwgJHNjb3BlLCBTdG9wRGF0YVNlcnZpY2UpIHtcclxuICAgICAgIFxyXG4gICAgICAgICRzY29wZS5uYXZpZ2F0ZVRvU2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFN0b3Aoc3RvcCk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY29tbXV0ZXIvc2VsZWN0ZWQtc3RvcCcpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLmdldERpcmVjdGlvbnNUb1NlbGVjdGVkU3RvcCA9IGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKHN0b3ApO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NvbW11dGVyL2RpcmVjdGlvbnMnKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5vcGVuTWFwQXBwID0gZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmICgobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUGhvbmVcIikgIT0gLTEpXHJcbiAgICAgICAgICAgICAgICB8fCAobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUG9kXCIpICE9IC0xKVxyXG4gICAgICAgICAgICAgICAgfHwgKG5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKFwiaVBhZFwiKSAhPSAtMSkpIHtcclxuICAgICAgICAgICAgICAgIHVybCA9IFwiaHR0cDovL21hcHMuYXBwbGUuY29tLz9xPVwiICsgc3RvcC5sYXRpdHVkZSArIFwiLFwiICsgc3RvcC5sb25naXR1ZGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcImh0dHA6Ly9tYXBzLmdvb2dsZS5jb20vP3E9XCIgKyBzdG9wLmxhdGl0dWRlICsgXCIsXCIgKyBzdG9wLmxvbmdpdHVkZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh1cmwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gRm9yIElvbmljXHJcbiAgICAgICAgICAgICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1jb3Jkb3ZhJykpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfc3lzdGVtJywgJycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTsgICAgXHJcbiAgICB9XHJcbiAgICAvL2FkZHJlc3Mgbm90IGluIHNlcnZpY2UgYXJlYVxyXG4gICAgQWxsU3RvcHNDb250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnU3RvcERhdGFTZXJ2aWNlJyxcclxuICAgICAgICAndWlHbWFwSXNSZWFkeScsICdMb2NhdGlvblNlcnZpY2UnLCAnJGh0dHAnLCAnJHRpbWVvdXQnLCAnJHdpbmRvdycsICdNZXNzYWdlU2VydmljZScsICckZmlsdGVyJywgJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEFsbFN0b3BzQ29udHJvbGxlcigkbG9jYXRpb24sIEdlb0xvY2F0aW9uU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlLFxyXG4gICAgICAgIHVpR21hcElzUmVhZHksIExvY2F0aW9uU2VydmljZSwgJGh0dHAsICR0aW1lb3V0LCAkd2luZG93LCBNZXNzYWdlU2VydmljZSwgJGZpbHRlciwgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnRmluZCBhIGJ1cyBzdG9wJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXRDb21tdXRlckluZm8oKS5hbGlhcyk7XHJcbiAgICAgICAgdm0uc3RvcHMgPSBbXTtcclxuICAgICAgICB2bS5jbG9zZXN0QnVzU3RvcCA9IFtdO1xyXG4gICAgICAgLy8gdm0ub3RoZXJCdXNTdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLmFsbE90aGVyU3RvcHMgPSBbXTtcclxuICAgICAgICB2bS5zZWFyY2ggPSAnJztcclxuICAgICAgICB2bS5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgbGF0aXR1ZGU6IDQ3LjYwNDM1NixcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTIyLjMzNjA4MTdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLnBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgICB2bS5sb2NhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRMb2NhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgdm0uc2hvd0xpc3QgPSB0cnVlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBjbG9zZXN0UGluLCBvdGhlclBpbiwgbG9jYXRpb25QaW4sIG15TG9jYXRpb25QaW4sIGh1Ykljb247XHJcbiAgICAgICAgaWYgKCR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNsb3Nlc3RQaW4gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZWVuLnBuZyc7XHJcbiAgICAgICAgICAgIG90aGVyUGluID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmV5LnBuZyc7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbG9jYXRpb24ucG5nJztcclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnBuZyc7XHJcbiAgICAgICAgICAgIGh1Ykljb24gPSAnaW1hZ2VzL3Bpbi1odWIucG5nJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY2xvc2VzdFBpbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JlZW4uc3ZnJztcclxuICAgICAgICAgICAgb3RoZXJQaW4gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZXkuc3ZnJztcclxuICAgICAgICAgICAgbG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1sb2NhdGlvbi5zdmcnO1xyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24uc3ZnJztcclxuICAgICAgICAgICAgaHViSWNvbiA9ICdpbWFnZXMvcGluLWh1Yi5zdmcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2lmIGNsb3NlIHRvIGFtYXpvbiBjdXJyZW50IGxvY2F0aW9uIGRvZXMgbm90IGFwcGx5XHJcbiAgICAgICAgLy8gaWYgeW91IGFyZSB3YXkgb3V0IGN1cnJlbnQgTG9jYXRpb24gZG9lcyBub3QgYXBwbHlcclxuICAgICAgICAvL2hhdmVyc2hpbmUgZm9ybXVsYSB0byBnZXQgZGlzdGFuY2VcclxuICAgICAgICB2bS56b29tID0gMTU7XHJcbiAgICAgICAgdm0ubXlTdHlsZXMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJwb2lcIixcclxuICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwibGFiZWxzXCIsXHJcbiAgICAgICAgICAgIHN0eWxlcnM6IFtcclxuICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIm9mZlwiIH1cclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImZlYXR1cmVUeXBlXCI6IFwidHJhbnNpdFwiLFxyXG4gICAgICAgICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLmljb25cIixcclxuICAgICAgICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcInZpc2liaWxpdHlcIjogXCJvZmZcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IHRydWUsXHJcbiAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3R5bGVzOiB2bS5teVN0eWxlc1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTsgLy90aGlzIG9iamVjdCBnZXRzIHRoZSBtYXAgY29udHJvbCBpbnN0YW5jZSBzbyB0aGF0IHdlIGNhbiBtYW5pcHVsYXRlIGl0XHJcbiAgICAgICAgdm0ubXlMb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgIHVybDogbXlMb2NhdGlvblBpbixcclxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoNDIsIDQyKSxcclxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIwLCAyMClcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1hcCgpIHtcclxuICAgICAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdNYXAgY2Fubm90IGJlIGxvYWRlZC4nKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbiA9PSB1bmRlZmluZWQgfHwgcG9zaXRpb24gPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RvcERhdGFTZXJ2aWNlLmdldEFsbEJ1c1N0b3BzKCk7XHJcbiAgICAgICAgICAgICAgICB2bS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb29yZHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYXRpdHVkZVwiOiBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxvbmdpdHVkZVwiOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWNvblwiOiB2bS5teUxvY2F0aW9uSWNvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFBvcyA9IFN0b3BEYXRhU2VydmljZS5nZXRHZW9Mb2NhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFBvcyA9PSB1bmRlZmluZWQgfHwgc2VsZWN0ZWRQb3MgPT0gbnVsbCB8fCBzZWxlY3RlZFBvcy5pc0FkZHJlc3MgPT0gdW5kZWZpbmVkIHx8IHNlbGVjdGVkUG9zLmlzQWRkcmVzcyA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSB2bS5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvY2F0aW9uID0gc2VsZWN0ZWRQb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSB2bS5sb2NhdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoID0gc2VsZWN0ZWRQb3MuZm9ybWF0dGVkX2FkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIC8vIHZtLmNlbnRlciA9IHZtLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTdG9wRGF0YVNlcnZpY2UuZ2V0QWxsQnVzU3RvcHMoKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZExvY2F0aW9uID0gU3RvcERhdGFTZXJ2aWNlLmdldEdlb0xvY2F0aW9uKCkgfHwgbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZExvY2F0aW9uICE9IG51bGwgJiYgdm0uc2VsZWN0ZWRMb2NhdGlvbi5pc0FkZHJlc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoID0gdm0uc2VsZWN0ZWRMb2NhdGlvbi5mb3JtYXR0ZWRfYWRkcmVzcztcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5jbGVhckl0ZW0oJ2N1cnJMb2NhdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAuZ2V0QWxsQnVzU3RvcHMoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsU3RvcHMocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoJ0Vycm9yIGxvYWRpbmcgc3RvcHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGVydChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlKVxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxTdG9wcyhyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignRXJyb3IgbG9hZGluZyBzdG9wcy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nKTtcclxuICAgICAgICAgICAgICAgIC8vYWxlcnQoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vbWFya2VyIGNsaWNrIGZ1bmN0aW9uXHJcbiAgICAgICAgdm0ubWFya2VyRXZlbnQgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGdNYXJrZXIsIGV2ZW50TmFtZSwgbW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChtb2RlbC4kaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL25hdmlnYXRlVG9TZWxlY3RlZFN0b3AobW9kZWwuY29vcmRzKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZih2bS5zZWxlY3RlZExvY2F0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0R2VvTG9jYXRpb24odm0uc2VsZWN0ZWRMb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFN0b3AobW9kZWwuY29vcmRzKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb29yZHMgPSBtb2RlbC5jb29yZHM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5uYXZpZ2F0ZVRvQ2xvc2VzdFN0b3AgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgdm0ubmF2aWdhdGVUb1NlbGVjdGVkU3RvcCh2bS5jbG9zZXN0QnVzU3RvcFtpbmRleF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5nZXREaXJlY3Rpb25zVG9DbG9zZXN0U3RvcCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB2bS5nZXREaXJlY3Rpb25zVG9TZWxlY3RlZFN0b3Aodm0uY2xvc2VzdEJ1c1N0b3BbaW5kZXhdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uZ2V0RGlyZWN0aW9uc1RvT3RoZXJTdG9wID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZtLmdldERpcmVjdGlvbnNUb1NlbGVjdGVkU3RvcCh2bS5hbGxPdGhlclN0b3BzW2luZGV4XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vdm0uZ2V0RGlyZWN0aW9uc1RvU2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAvLyAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0U3RvcChzdG9wKTtcclxuICAgICAgICAvLyAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0R2VvTG9jYXRpb24odm0uc2VsZWN0ZWRMb2NhdGlvbik7XHJcbiAgICAgICAgLy8gICAgJGxvY2F0aW9uLnBhdGgoJy9jb21tdXRlci9kaXJlY3Rpb25zJyk7XHJcbiAgICAgICAgLy99O1xyXG4gICAgICAgIHZtLmRpc3BsYXlNYXAgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICB2bS5zaG93TGlzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCAncmVzaXplJyk7XHJcbiAgICAgICAgICAgICAgICByZXNldE1hcCgpO1xyXG4gICAgICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9O1xyXG4gICAgICBcclxuICAgICAgICB2bS5uYXZpZ2F0ZVRvT3RoZXJTdG9wID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZtLm5hdmlnYXRlVG9TZWxlY3RlZFN0b3Aodm0uYWxsT3RoZXJTdG9wc1tpbmRleF0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0ubG9jYXRpb25TZWFyY2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWFyY2gudHJpbSgpID09ICcnKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2UuY2xlYXJJdGVtKCdjdXJyTG9jYXRpb24nKVxyXG4gICAgICAgICAgICAgICAgaWYodm0ucG9zaXRpb24gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZExvY2F0aW9uID0gdm0ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZExvY2F0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmxvY2F0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlU3RvcHMoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBMb2NhdGlvblNlcnZpY2UuZ2V0TG9jYXRpb24odm0uc2VhcmNoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2UubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2ggPSByZXNwb25zZVswXS5mb3JtYXR0ZWRfYWRkcmVzcztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb25JY29uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGxvY2F0aW9uUGluXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9jYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29vcmRzXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGF0aXR1ZGVcIjogcmVzcG9uc2VbMF0uZ2VvbWV0cnkubG9jYXRpb24ubGF0KCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxvbmdpdHVkZVwiOiByZXNwb25zZVswXS5nZW9tZXRyeS5sb2NhdGlvbi5sbmcoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImlzQWRkcmVzc1wiOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImZvcm1hdHRlZF9hZGRyZXNzXCI6IHJlc3BvbnNlWzBdLmZvcm1hdHRlZF9hZGRyZXNzLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpY29uXCI6IGxvY2F0aW9uSWNvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRMb2NhdGlvbiA9IHZtLmxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5zZWxlY3RlZExvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlU3RvcHMoKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignQ2Fubm90IGZpbmQgdGhlIGxvY2F0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYWxlcnQoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgdm0ubmF2aWdhdGVUb1NlbGVjdGVkU3RvcCA9IGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKHN0b3ApO1xyXG4gICAgICAgICAgICAgICAgLy9pZiAodm0ucG9zaXRpb24gIT0gdW5kZWZpbmVkICYmIHZtLnBvc2l0aW9uICE9IG51bGwpXHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5zZWxlY3RlZExvY2F0aW9uKVxyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NvbW11dGVyL3NlbGVjdGVkLXN0b3AnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAvL3ZtLm9wZW5NYXBBcHAgPSBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgLy8gICAgdmFyIHVybCA9IFwiXCI7XHJcbiAgICAgICAvLyAgICBpZiAoKG5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKFwiaVBob25lXCIpICE9IC0xKVxyXG4gICAgICAgLy8gfHwgKG5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKFwiaVBvZFwiKSAhPSAtMSlcclxuICAgICAgIC8vICAgICAgICB8fCAobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUGFkXCIpICE9IC0xKSkge1xyXG4gICAgICAgLy8gICAgICAgIHVybCA9IFwiaHR0cDovL21hcHMuYXBwbGUuY29tLz9xPVwiICsgc3RvcC5sYXRpdHVkZSArIFwiLFwiICsgc3RvcC5sb25naXR1ZGU7XHJcbiAgICAgICAvLyAgICB9XHJcbiAgICAgICAvLyAgICBlbHNlIHtcclxuICAgICAgIC8vICAgICAgICB1cmwgPSBcImh0dHA6Ly9tYXBzLmdvb2dsZS5jb20vP3E9XCIgKyBzdG9wLmxhdGl0dWRlICsgXCIsXCIgKyBzdG9wLmxvbmdpdHVkZTtcclxuICAgICAgIC8vICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgIC8vICAgIGlmICh1cmwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgLy8gICAgICAgIC8vIEZvciBJb25pY1xyXG4gICAgICAgLy8gICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3BsYXRmb3JtLWNvcmRvdmEnKSkge1xyXG4gICAgICAgLy8gICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfc3lzdGVtJywgJycpO1xyXG4gICAgICAgLy8gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAvLyAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCk7XHJcbiAgICAgICAvLyAgICAgICAgfVxyXG4gICAgICAgLy8gICAgfVxyXG4gICAgICAgLy99XHJcbiAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbGxTdG9wcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHN0b3BzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuc3RvcHM7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdG9wcyAmJiBzdG9wc1tpXS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9wID0gc3RvcHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcC5kaXN0YW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcC5pY29uID0gJ2ltYWdlcy9waW5fcGlja3VwQDF4LnBuZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RvcHMucHVzaChzdG9wKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwb3B1bGF0ZVN0b3BzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gcG9wdWxhdGVTdG9wcygpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnN0b3BzLmxlbmd0aCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkubWFya2VycyA9W107XHJcbiAgICAgICAgICAgIHZtLmNsb3Nlc3RCdXNTdG9wID0gW107XHJcbiAgICAgICAgICAgIHZtLmFsbE90aGVyU3RvcHMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHN0b3BzVG9DaGVjayA9IFtdO1xyXG4gICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5zdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkTG9jYXRpb24gIT0gdW5kZWZpbmVkICYmIHZtLnNlbGVjdGVkTG9jYXRpb24gIT0gbnVsbCkgey8vaGVyZSBjdWxsIHRoZSBvbmVzIHdpdGggbG9uZyBkaXN0YW5jZXNcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZCA9IHJlY3RpbGluZWFySGF2ZXJzaW5lKHZtLnNlbGVjdGVkTG9jYXRpb24uY29vcmRzLCB2bS5zdG9wc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGQgPD0gdm0uZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc3RvcHNbaV0uZGlzdGFuY2UgPSBkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9wc1RvQ2hlY2sucHVzaCh2bS5zdG9wc1tpXSlcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zdG9wc1tpXS5kaXN0YW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFsbE90aGVyU3RvcHMucHVzaCh2bS5zdG9wc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0b3BzW2ldLmRpc3RhbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hbGxPdGhlclN0b3BzLnB1c2godm0uc3RvcHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRMb2NhdGlvbiAhPSBudWxsICYmIHN0b3BzVG9DaGVjay5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBMb2NhdGlvblNlcnZpY2UuZ2V0RHJpdmluZ0Rpc3RhbmNlcyh2bS5zZWxlY3RlZExvY2F0aW9uLmNvb3Jkcywgc3RvcHNUb0NoZWNrKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLnJvd3NbMF0uZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BzVG9DaGVja1tpXS5kaXN0YW5jZSA9IChwYXJzZUZsb2F0KHJlc3BvbnNlLnJvd3NbMF0uZWxlbWVudHNbaV0uZGlzdGFuY2UudmFsdWUpIC8gMTAwMCAqIDAuNjIxMzcxKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3BzVG9DaGVja1tpXS5kaXN0YW5jZSA+IHZtLmRpc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcHNUb0NoZWNrW2ldLmRpc3RhbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2bS5hbGxPdGhlclN0b3BzLmluZGV4T2Yoc3RvcHNUb0NoZWNrW2ldKSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFsbE90aGVyU3RvcHMucHVzaChzdG9wc1RvQ2hlY2tbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2xvc2VzdEJ1c1N0b3AucHVzaChzdG9wc1RvQ2hlY2tbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdG9wcygpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3doZW4gbG9jYXRpb24gc2VydmljZXMgZXJyLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSh2bS5hbGxPdGhlclN0b3BzLCB2bS5zdG9wcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3RoZXJTdG9wSWNvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IG90aGVyUGluLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDM0LCA2MCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjQsIDU3KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsT3RoZXJTdG9wcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhLmRpc3RhbmNlID09IG51bGwgfHwgYi5kaXN0YW5jZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAxMDAwMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhLmRpc3RhbmNlIC1iLmRpc3RhbmNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uYWxsT3RoZXJTdG9wcywgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wLmljb24gPSBvdGhlclN0b3BJY29uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3AuZGlzdGFuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNldE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3BzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICBcclxuICAgICAgZnVuY3Rpb24gdXBkYXRlU3RvcHMoKVxyXG4gICAgICB7XHJcbiAgICAgICAgICB2bS5jbG9zZXN0QnVzU3RvcC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgaWYoYS5kaXN0YW5jZSA9PSBudWxsIHx8IGIuZGlzdGFuY2UgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwMDAwICAgICAgXHJcbiAgICAgICAgICAgICAgcmV0dXJuIGEuZGlzdGFuY2UgLSBiLmRpc3RhbmNlXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgdm0uYWxsT3RoZXJTdG9wcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgPCBiLm5hbWUpID8gLTEgOiAoYS5uYW1lID4gYi5uYW1lKSA/IDEgOiAwO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIHZhciBvdGhlclN0b3BJY29uID0ge1xyXG4gICAgICAgICAgICAgIHVybDogb3RoZXJQaW4sXHJcbiAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMzQsIDYwKSxcclxuICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyMywgNTcpXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgdmFyIGNsb3Nlc3RTdG9wSWNvbiA9IHtcclxuICAgICAgICAgICAgICB1cmw6IGNsb3Nlc3RQaW4sXHJcbiAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMzQsIDYwKSxcclxuICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyMywgNTcpXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmNsb3Nlc3RCdXNTdG9wLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgIGlmIChzdG9wLmlzSHViKVxyXG4gICAgICAgICAgICAgICAgICBzdG9wLmljb24gPSBodWJJY29uO1xyXG4gICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgc3RvcC5pY29uID0gY2xvc2VzdFN0b3BJY29uO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uYWxsT3RoZXJTdG9wcywgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICBpZiAoc3RvcC5pc0h1YilcclxuICAgICAgICAgICAgICAgICAgc3RvcC5pY29uID0gaHViSWNvbjtcclxuICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgIHN0b3AuaWNvbiA9IG90aGVyU3RvcEljb247XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHZtLmNsb3Nlc3RDb3VudCA9ICRmaWx0ZXIoJ2ZpbHRlcicpKHZtLmNsb3Nlc3RCdXNTdG9wLCB7IGlzSHViOiBmYWxzZSB9KS5sZW5ndGg7XHJcbiAgICAgICAgICB2bS5vdGhlckNvdW50ID0gJGZpbHRlcignZmlsdGVyJykodm0uYWxsT3RoZXJTdG9wcywgeyBpc0h1YjogZmFsc2UgfSkubGVuZ3RoO1xyXG5cclxuICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksICdyZXNpemUnKTtcclxuICAgICAgICAgIHJlc2V0TWFwKCk7XHJcbiAgICAgICAgIFxyXG4gICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiByZXNldE1hcCgpXHJcbiAgICAgIHtcclxuICAgICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLnN0b3BzLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdG9wLmxhdGl0dWRlLCBzdG9wLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKHZtLnNlbGVjdGVkTG9jYXRpb24gIT0gdW5kZWZpbmVkICYmIHZtLnNlbGVjdGVkTG9jYXRpb24gIT0gbnVsbCAmJiB2bS5zdG9wc1swXS5kaXN0YW5jZSAhPSBudWxsICYmIHZtLnN0b3BzWzBdLmRpc3RhbmNlIDwgdm0uZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcodm0uc2VsZWN0ZWRMb2NhdGlvbi5jb29yZHMubGF0aXR1ZGUsIHZtLnNlbGVjdGVkTG9jYXRpb24uY29vcmRzLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5zZXRab29tKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmdldFpvb20oKSAtIDEpOyBcclxuICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgZnVuY3Rpb24gaGF2ZXJzaW5lRm9ybXVsYShvcmlnaW4sIHN0b3ApIHtcclxuICAgICAgICAgIC8vcG9zaXRpb24xID0gIHZtLnBvc2l0aW9uXHJcbiAgICAgICAgICAvL3Bvc2l0aW9uMiA9IHN0b3BcclxuICAgICAgICAgIHZhciBsYXQxID0gb3JpZ2luLmxhdGl0dWRlO1xyXG4gICAgICAgICAgdmFyIGxvbjEgPSBvcmlnaW4ubG9uZ2l0dWRlO1xyXG4gICAgICAgICAgdmFyIGxhdDIgPSBzdG9wLmxhdGl0dWRlO1xyXG4gICAgICAgICAgdmFyIGxvbjIgPSBzdG9wLmxvbmdpdHVkZVxyXG5cclxuICAgICAgICAgIHZhciBSID0gNjM3MTsgLy8ga20gXHJcbiAgICAgICAgICB2YXIgeDEgPSBsYXQyIC0gbGF0MTtcclxuICAgICAgICAgIHZhciBkTGF0ID0geDEgKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgICAgICAgdmFyIHgyID0gbG9uMiAtIGxvbjE7XHJcbiAgICAgICAgICB2YXIgZExvbiA9IHgyICogTWF0aC5QSSAvIDE4MDtcclxuICAgICAgICAgIHZhciBhID0gTWF0aC5zaW4oZExhdCAvIDIpICogTWF0aC5zaW4oZExhdCAvIDIpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyhsYXQxICogTWF0aC5QSSAvIDE4MCkgKiBNYXRoLmNvcyhsYXQyICogTWF0aC5QSSAvIDE4MCkgKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguc2luKGRMb24gLyAyKSAqIE1hdGguc2luKGRMb24gLyAyKTtcclxuICAgICAgICAgIHZhciBjID0gMiAqIE1hdGguYXRhbjIoTWF0aC5zcXJ0KGEpLCBNYXRoLnNxcnQoMSAtIGEpKTtcclxuICAgICAgICAgIHZhciBkID0gUiAqIGMgKiAwLjYyMTM3OyAvL2NvbnZlcnQgdG8gbWlsZXNcclxuICAgICAgICAgIHJldHVybiBkLnRvRml4ZWQoMik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIHJlY3RpbGluZWFySGF2ZXJzaW5lKGxvYzEsIGxvYzIpIHtcclxuICAgICAgICAgIHZhciB0ZW1wUG9pbnQgPSB7XHJcbiAgICAgICAgICAgICAgXCJsYXRpdHVkZVwiOiBsb2MxLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICBcImxvbmdpdHVkZVwiOiBsb2MyLmxvbmdpdHVkZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgIHZhciBkMSA9IHBhcnNlRmxvYXQoaGF2ZXJzaW5lRm9ybXVsYShsb2MxLCB0ZW1wUG9pbnQpKTtcclxuICAgICAgICAgIHZhciBkMiA9IHBhcnNlRmxvYXQoaGF2ZXJzaW5lRm9ybXVsYSh0ZW1wUG9pbnQsIGxvYzIpKTtcclxuICAgICAgICAgIHJldHVybiAoZDEgKyBkMikudG9GaXhlZCgyKTtcclxuICAgICAgIH1cclxuXHJcbiBmdW5jdGlvbiBhY3RpdmF0ZSgpXHJcbiAgICB7XHJcbiAgICAgJGh0dHAuZ2V0KCdjbGllbnRhcHBzZXR0aW5ncy5qc29uJykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgdm0uZGlzdGFuY2UgPSByZXNwb25zZS5kYXRhLnN0b3BEaXN0YW5jZTtcclxuICAgICAgICAgdm0ubXlTdHlsZXMgPSByZXNwb25zZS5kYXRhLmdvb2dsZU1hcE9wdG9ucztcclxuICAgICAgICAgZ2V0TWFwKCk7XHJcbiAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoJ0Vycm9yIExvYWRpbmcgU3RvcHMuJylcclxuICAgICAgICAgLy9hbGVydChlcnIpO1xyXG4gICAgIH0pO1xyXG4gfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvYWxsLXN0b3BzL2FsbC1zdG9wcy5odG1sJztcclxuICAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcblxyXG4gXHJcbiAgICB9XHJcbiAgIFxyXG4gICBcclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdEaXJlY3Rpb25zQ29udHJvbGxlcicsIERpcmVjdGlvbnNDb250cm9sbGVyKTtcclxuXHJcbiAgICBEaXJlY3Rpb25zQ29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywnJGxvY2F0aW9uJywgJyRzdGF0ZVBhcmFtcycsICdTY2hlZHVsZVNlcnZpY2UnLCAnU3RvcERhdGFTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEaXJlY3Rpb25zQ29udHJvbGxlcigkcm9vdFNjb3BlLCRsb2NhdGlvbiwgJHN0YXRlUGFyYW1zLCBTY2hlZHVsZVNlcnZpY2UsIFN0b3BEYXRhU2VydmljZSwgdWlHbWFwSXNSZWFkeSkge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLnNlbGVjdGVkU3RvcCA9IFN0b3BEYXRhU2VydmljZS5nZXRTdG9wKCk7XHJcbiAgICAgICAgdm0uaGFzU3RvcERlc2NyaXB0aW9uID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8vaWYgKHZtLnNlbGVjdGVkU3RvcCA9PSB1bmRlZmluZWQgfHwgdm0uc2VsZWN0ZWRTdG9wID09IG51bGwgfHwgdm0uc2VsZWN0ZWRTdG9wLmxhdGl0dWRlID09IHVuZGVmaW5lZCB8fCB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUgPT0gbnVsbClcclxuICAgICAgICAvLyAgICB2bS5zZWxlY3RlZFN0b3AgPSB7XHJcbiAgICAgICAgLy8gICAgICAgIGxhdGl0dWRlOiA0MC42NTE3MzksXHJcbiAgICAgICAgLy8gICAgICAgIGxvbmdpdHVkZTogLTczLjk1MzE0OFxyXG4gICAgICAgIC8vICAgIH1cclxuICAgICAgICB2YXIgY3VycmVudExvY2F0aW9uID0gU3RvcERhdGFTZXJ2aWNlLmdldEdlb0xvY2F0aW9uKCk7XHJcbiAgICAgICAgLy9jdXJyZW50TG9jYXRpb24gPSB7XHJcbiAgICAgICAgLy8gICAgY29vcmRzOiB7XHJcbiAgICAgICAgLy8gICAgICAgIGxhdGl0dWRlOiAzMi42MDQ3NzcsXHJcbiAgICAgICAgLy8gICAgICAgIGxvbmdpdHVkZTogLTk5LjQzNDMxMjdcclxuICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIHZtLmZyb21Mb2NhdGlvbiA9IGN1cnJlbnRMb2NhdGlvbiAhPSBudWxsID8gY3VycmVudExvY2F0aW9uLmNvb3Jkcy5sYXRpdHVkZSArICcsJyArIGN1cnJlbnRMb2NhdGlvbi5jb29yZHMubG9uZ2l0dWRlIDogJyc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogNDAuNjUxNzM5LFxyXG4gICAgICAgICAgICBsb25naXR1ZGU6IC03My45NTMxNDhcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS56b29tID0gMTQ7XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgIHZhciBteVN0eWxlcyA9IFtcclxuICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInBvaVwiLFxyXG4gICAgICAgICAgICAgICBlbGVtZW50VHlwZTogXCJsYWJlbHNcIixcclxuICAgICAgICAgICAgICAgc3R5bGVyczogW1xyXG4gICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwib2ZmXCIgfVxyXG4gICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgfSxcclxuICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0XCIsXHJcbiAgICAgICAgICAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMuaWNvblwiLFxyXG4gICAgICAgICAgICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IG15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ub3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIHZtLm1hcmtlckV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy9mb3IgZnV0dXJlP1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uc2hvd0RpcmVjdGlvbnMgPSBjdXJyZW50TG9jYXRpb24gPT0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICB2YXIgZGlyZWN0aW9uc0Rpc3BsYXk7XHJcbiAgICAgICAgdmFyIGRpcmVjdGlvbnNTZXJ2aWNlO1xyXG4gICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5ID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNSZW5kZXJlcjtcclxuICAgICAgICAgICAgZGlyZWN0aW9uc1NlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2U7XHJcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcmVjdGlvbnMnKTtcclxuXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldFBhbmVsKGRpcmVjdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNob3dEaXJlY3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcodm0uc2VsZWN0ZWRTdG9wLmxhdGl0dWRlLCB2bS5zZWxlY3RlZFN0b3AubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gdm0uc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZTtcclxuICAgICAgICAgICAgICAvLyAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1hcERpcmVjdGlvbih2bS5mcm9tTG9jYXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZtLmdldERpcmVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBnZW9jb2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcjtcclxuICAgICAgICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7ICdhZGRyZXNzJzogdm0uZnJvbUxvY2F0aW9uIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcERpcmVjdGlvbihyZXNwb25zZVswXS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQoKSArICcsJyArIHJlc3BvbnNlWzBdLmdlb21ldHJ5LmxvY2F0aW9uLmxuZygpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgbWFwRGlyZWN0aW9uID0gZnVuY3Rpb24gKHN0YXJ0KSB7XHJcblxyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbjogc3RhcnQsXHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogdm0uc2VsZWN0ZWRTdG9wLmxhdGl0dWRlICsgJywnICsgdm0uc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNUcmF2ZWxNb2RlLkRSSVZJTkdcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdPSycpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXREaXJlY3Rpb25zKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zdG9wRGVzY3JpcHRpb24gPSB2bS5zZWxlY3RlZFN0b3AuZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnN0b3BEZXNjcmlwdGlvbiAhPT0gXCJcIiAmJiAhYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5zdG9wRGVzY3JpcHRpb24pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5oYXNTdG9wRGVzY3JpcHRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ0RpcmVjdGlvbnMgcmVxdWVzdCBmYWlsZWQgZHVlIHRvICcgKyBzdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgLy92bS5uYXZpZ2F0ZVRvVHJpcFBhZ2UgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAvLyAgICB2YXIgaW5jaWRlbnQgPSB2bS5ub25QZXJmb3JtZWRJbmNpZGVudHNbaW5kZXhdO1xyXG4gICAgICAgIC8vICAgICRsb2NhdGlvbi5wYXRoKCcvc2VsZWN0ZWQtdHJpcC8nICsgMjQ5LjEgKyAnLycgKyBpbmNpZGVudC5CbG9ja0lkICsgJy8nICsgaW5jaWRlbnQuSW5jaWRlbnRJZCk7XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL2NvbW11dGVyL2RpcmVjdGlvbnMvZGlyZWN0aW9ucy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICcnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJob21lLmh0bWxcIiAvPlxyXG5cclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQ29tbXV0ZXJIb21lQ29udHJvbGxlcicsIENvbW11dGVySG9tZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIENvbW11dGVySG9tZUNvbnRyb2xsZXIuJGluamVjdCA9XHJcbiAgICAgICAgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJyxcclxuICAgICAgICAgICAgICckdWliTW9kYWwnLCAnTWVzc2FnZVNlcnZpY2UnLCAnZW52JywgJ3ZlaGljbGVTZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbW11dGVySG9tZUNvbnRyb2xsZXIoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIFJlc2VydmF0aW9uU2VydmljZSxcclxuICAgICAgICBhdXRoU2VydmljZSwgXHJcbiAgICAgICAgJHVpYk1vZGFsLCBNZXNzYWdlU2VydmljZSwgZW52LCB2ZWhpY2xlU2VydmljZSwgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ0Rhc2hib2FyZCcpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCkuYWxpYXMpO1xyXG4gICAgICAgIHZtLmlzVXNlckxvZ2dlZEluID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpO1xyXG4gICAgICAgIHZtLnJlc2VydmF0aW9uc0FsbG93ZWQgPSBlbnYucmVzZXJ2YXRpb25zQWxsb3dlZDtcclxuICAgICAgICB2bS5wYXNzZW5nZXJJZCA9ICcnO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlclJlc2VydmF0aW9ucyA9IFtdO1xyXG4gICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgdm0udmVoaWNsZXMgPSBbXTtcclxuICAgICAgICB2bS51cGRhdGluZ1ZlaGljbGVJbmZvID0gW107XHJcbiAgICAgICAgdm0uY29tbXV0ZXJGZWF0dXJlcyA9IFtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsYXNzXCI6IFwiY2Fyb3VzZWxfX2l0ZW0tLWFsbC1zdG9wc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhlYWRsaW5lXCI6IFwiRXhwbG9yZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiQnVzIFN0b3BzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJGaW5kIGEgYnVzIHN0b3AgbmVhciB5b3UuXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGlua1wiOiBcImNvbW11dGVyL2FsbC1zdG9wc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImN0YVwiIDogXCJWaWV3IFN0b3BzXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGFzc1wiOiBcImNhcm91c2VsX19pdGVtLS1hZHZhbmNlZC1yZXNlcnZhdGlvbnNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoZWFkbGluZVwiOiBcIkJvb2tcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aXRsZVwiOiBcIlJlc2VydmF0aW9uc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiVXAgdG8gdHdvIHdlZWtzIGluIGFkdmFuY2UuXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGlua1wiOiBcImNvbW11dGVyL2Fkdi1zY2hlZHVsZS1zZXR1cFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImN0YVwiOiBcIkdldCBTdGFydGVkXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjbGFzc1wiOiBcImNhcm91c2VsX19pdGVtLS1jb21tdXRlci1zY2hlZHVsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhlYWRsaW5lXCI6IFwiVmlld1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiUHVibGlzaGVkIFNjaGVkdWxlc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiU2VlIGFsbCBvZiB0aGUgcHVibGlzaGVkIHNjaGVkdWxlIHRpbWVzIGF0IGEgZ2xhbmNlLlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxpbmtcIjogXCJjb21tdXRlci9wdWJsaXNoZWQtc2NoZWR1bGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjdGFcIjogXCJTaG93IFNjaGVkdWxlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdO1xyXG5cclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9tZXRob2QgZXhwb3NlZCB0byB2aWV3XHJcbiAgICAgICAgdm0uc2hvd0NvbW11dGVyVHJpcCA9IHNob3dDb21tdXRlclRyaXA7XHJcblxyXG4gICAgICAgIC8vdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgJHNjb3BlLmNhcm91c2VsT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbmF2VGV4dDogW1wiXCIsIFwiXCJdLFxyXG4gICAgICAgICAgICByZXNwb25zaXZlQ2xhc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBuYXY6IHRydWUsXHJcblxyXG4gICAgICAgICAgICByZXNwb25zaXZlOiB7XHJcbiAgICAgICAgICAgICAgICAwOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VQYWRkaW5nOiAzNCxcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFBvc2l0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAzNzU6IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVBhZGRpbmc6IDM0LFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIDc2ODoge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlUGFkZGluZzogMTYsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgOTkyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VQYWRkaW5nOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJSZXNlcnZhdGlvbnMoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFBhc3NlbmdlclJlc2VydmF0aW9uc0ZvclRvZGF5KHZtLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaylcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVyci5zdGF0dXMgIT09IDQwMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignU29ycnkhIENvdWxkIG5vdCBsb2FkIHlvdXIgUmVzZXJ2YXRpb24hJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRWZWhpY2xlcygpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVNlcnZpY2UuZ2V0VmVoaWNsZXNGb3JQYXNzZW5nZXIodm0ucGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd0NvbW11dGVyVHJpcCh0cmlwKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21tdXRlclRyaXBNb2RhbCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3RyaXBzL2NvbW11dGVyLXRyaXAtbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQ29tbXV0ZXJUcmlwTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXBJZDogdHJpcC5pZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbW11dGVyVHJpcE1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmNhbmNlbGxlZCB8fCByZXNwb25zZS5pc01vZGlmaWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VXNlclJlc2VydmF0aW9ucyhnZXRWZWhpY2xlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmlzVXNlckxvZ2dlZEluKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAgICAgZ2V0VXNlclJlc2VydmF0aW9ucyhnZXRWZWhpY2xlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2bS51cGRhdGVQYXJraW5nVmVoaWNsZSA9IGZ1bmN0aW9uIChyZXNlcnZhdGlvbiwgaW5kZXgpIHtcclxuICAgICAgICAgICAgdm0udXBkYXRpbmdWZWhpY2xlSW5mb1tpbmRleF0gPSB0cnVlO1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC51cGRhdGVWZWhpY2xlRm9yUmVzZXJ2YXRpb24ocmVzZXJ2YXRpb24uUmVzZXJ2YXRpb25JZCwgcmVzZXJ2YXRpb24uVmVoaWNsZUlkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRpbmdWZWhpY2xlSW5mb1tpbmRleF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVwZGF0aW5nVmVoaWNsZUluZm9baW5kZXhdID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zaG93U3RvcHNNYXAgPSBmdW5jdGlvbiAoaW5jKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbEdldE1hcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHdpbmRvd0NsYXNzOiAnbWFwLW1vZGFsJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3Jlc2VydmF0aW9uLW1hcC1tb2RhbC9yZXNlcnZhdGlvbi1tYXAuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUmVzZXJ2YXRpb25NYXBDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbl9zdG9wczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5jO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2RhbEdldE1hcC5yZXN1bHQudGhlbihmdW5jdGlvbiAoaXNEb25lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNEb25lKSB7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uY3RhQWN0aW9uID0gZnVuY3Rpb24obGluayl7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKGxpbmspO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvaG9tZS9ob21lLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXRvcC1wYWRkaW5nJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNQdWxsaW5nVGV4dCA9ICdSZWZyZXNoJztcclxuICAgICAgICB2bS5pb25pY1JlZnJlc2hpbmdUZXh0ID0gJ0xvYWRpbmcnO1xyXG4gICAgICAgIHZtLmlvbmljU3Bpbm5lciA9ICdzcGlyYWwnOyAvLyBub25lIHRvIGRpc2FibGUuXHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0udGl0bGUgPSAnSG9tZSc7XHJcbiAgICAgICAgICAgIHZtLmlzVXNlckxvZ2dlZEluID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpO1xyXG4gICAgICAgICAgICB2bS5yZXNlcnZhdGlvbnNBbGxvd2VkID0gZW52LnJlc2VydmF0aW9uc0FsbG93ZWQ7XHJcbiAgICAgICAgICAgIHZtLnBhc3NlbmdlcklkID0gJyc7XHJcbiAgICAgICAgICAgIHZtLnVzZXJSZXNlcnZhdGlvbnMgPSB7fTtcclxuICAgICAgICAgICAgdm0udmVoaWNsZXMgPSBbXTtcclxuICAgICAgICAgICAgdm0udXBkYXRpbmdWZWhpY2xlSW5mbyA9IFtdO1xyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgLmNvbnRyb2xsZXIoJ0FkdlNjaGVkdWxlQ29uZmlybWF0aW9uQ29udHJvbGxlcicsIEFkdlNjaGVkdWxlQ29uZmlybWF0aW9uQ29udHJvbGxlcik7XHJcblxyXG4gICAgQWR2U2NoZWR1bGVDb25maXJtYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckc3RhdGVQYXJhbXMnLCAnJGZpbHRlcicsICckdWliTW9kYWwnLFxyXG4gICAgICAgICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJywgJ1N0b3BEYXRhU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEFkdlNjaGVkdWxlQ29uZmlybWF0aW9uQ29udHJvbGxlcigkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGZpbHRlciwgJHVpYk1vZGFsLFxyXG4gICAgICAgIFJlc2VydmF0aW9uU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBhdXRoU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnQWR2YW5jZSBSZXNlcnZhdGlvbnMgQ29uZmlybWF0aW9uJztcclxuICAgICAgICBpZiAoaXNOb3RGcm9tQWR2U2NoZWR1bGUoKSkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2Fkdi1zY2hlZHVsZS1zZXR1cCcpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgc2VsZWN0ZWRDb25maWcgPSAkc3RhdGVQYXJhbXMub2JqLmNvbmZpZztcclxuICAgICAgICB2YXIgd2Vla3MgPSAkc3RhdGVQYXJhbXMub2JqLnJlc2VydmF0aW9uSW5mbztcclxuICAgICAgICB2YXIgcmVzZXJ2YXRpb25zID0gW107XHJcbiAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA9IHRydWU7XHJcbiAgICAgICBcclxuICAgICAgICB2bS5zdWNjZXNzQW5pbWUgPSBzdWNjZXNzQW5pbWU7XHJcbiAgICAgICAgdm0uc2NoZWR1bGUgPSBzZWxlY3RlZENvbmZpZy5zY2hlZHVsZTtcclxuICAgICAgICB2bS5yZXNlcnZlID0gcmVzZXJ2ZTtcclxuXHJcbiAgICAgICAgdm0uc2hvd1Jlc2VydmF0aW9uID0gc2hvd1Jlc2VydmF0aW9uO1xyXG4gICAgICAgIHZtLmJvb2tSZXR1cm5UcmlwID0gYm9va1JldHVyblRyaXA7XHJcbiAgICAgICAgdm0uYmFjayA9IGJhY2s7XHJcbiAgICAgICAgdm0ucGlja3VwID0gc2VsZWN0ZWRDb25maWcucGlja3VwO1xyXG4gICAgICAgIHZtLmRyb3BvZmYgPSBzZWxlY3RlZENvbmZpZy5kcm9wb2ZmO1xyXG4gICAgICAgIHZtLndlZWtzVG9EaXNwbGF5ID0gZmlsdGVyU2VsZWN0ZWRUcmlwcygpO1xyXG4gICAgICAgIHZtLnJlc2VydmluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAvL1N1Y2Nlc3MgQW5pbWF0aW9uXHJcbiAgICAgICAgZnVuY3Rpb24gc3VjY2Vzc0FuaW1lKCl7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgYW5pbWUoe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0czogJy5hbmltLS1zdWNjZXNzIC5saW5lcyBwYXRoJyxcclxuICAgICAgICAgICAgICAgIHN0cm9rZURhc2hvZmZzZXQ6IFthbmltZS5zZXREYXNob2Zmc2V0LCAwXSxcclxuICAgICAgICAgICAgICAgIGVhc2luZzogJ2Vhc2VJbk91dFNpbmUnLFxyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MDAsXHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdhbHRlcm5hdGUnLFxyXG4gICAgICAgICAgICAgICAgbG9vcDogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgRGl2aXNpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgIC5pc1dhaXRsaXN0QWxsb3dlZEJ5RGl2aXNpb24oKVxyXG4gICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGJvb2tSZXR1cm5UcmlwKCkge1xyXG5cclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLmdldFBpY2t1cEZvclJldHVyblRyaXAoc2VsZWN0ZWRDb25maWcucGlja3VwLmlkLCBzZWxlY3RlZENvbmZpZy5kcm9wb2ZmLmlkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvbmZpZy5zY2hlZHVsZSA9IFwiUE1cIjtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29uZmlnLmRyb3BvZmYgPSBhbmd1bGFyLmNvcHkodm0ucGlja3VwKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29uZmlnLnBpY2t1cCA9IG1hcFBpY2t1cChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZENvbmZpZy52ZWhpY2xlID0geyAnbGljZW5jZXBsYXRlJzogJy0tJywgJ3ZlaGljbGVJZCc6IHVuZGVmaW5lZCB9O1xyXG5cclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnYWR2LXNjaGVkdWxlLXNldHVwJywgeyBvYmo6IHsgY29uZmlnOiBzZWxlY3RlZENvbmZpZyB9IH0pO1xyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIGZldGNoaW5nIHBpY2t1cCBmb3IgcmV0dXJuIHRyaXAuXCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFBpY2t1cChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdClcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuY29weSh2bS5kcm9wb2ZmKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyU2VsZWN0ZWRUcmlwcygpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWVrcywgZnVuY3Rpb24gKHdlZWspIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFJlY29yZHMgPSB7IGZyb206ICcnLCB0bzogJycsIGRheXM6IFtdIH07XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJlY29yZHMuZnJvbSA9ICRmaWx0ZXIoJ2RhdGUnKSh3ZWVrWzBdLmRhdGUsICdNTS9kZC95eXl5Jyk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJlY29yZHMudG8gPSAkZmlsdGVyKCdkYXRlJykod2Vla1t3ZWVrLmxlbmd0aCAtIDFdLmRhdGUsICdNTS9kZC95eXl5Jyk7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2god2VlaywgZnVuY3Rpb24gKGRheSkgeyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhblJlc2VydmUoZGF5KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSZWNvcmRzLmRheXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlOiBkYXkuZGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlaGljbGU6IGRheS52ZWhpY2xlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcDogZ2V0VHJpcChkYXkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXNlcnZlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1dhaXRsaXN0OiBpc1dhaXRsaXN0UmVxdWVzdChkYXkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdGxpc3RDb3VudDogZ2V0V2FpdGxpc3RDb3VudChkYXkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goc2VsZWN0ZWRSZWNvcmRzKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzV2FpdGxpc3RSZXF1ZXN0KGRheSkge1xyXG4gICAgICAgICAgICB2YXIgd2FpdGxpc3RDb3VudCA9IGdldFdhaXRsaXN0Q291bnQoZGF5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAoZGF5LnZlaGljbGUuaWQgJiYgZGF5LmF2YWlsYWJsZVBhcmtpbmcgPD0gMCkgfHwgKHdhaXRsaXN0Q291bnQgIT0gdW5kZWZpbmVkICYmIHdhaXRsaXN0Q291bnQgPj0gMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRXYWl0bGlzdENvdW50KGRheSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHRyaXAgPSBnZXRUcmlwKGRheSk7XHJcbiAgICAgICAgICAgIGlmICh0cmlwLmF2YWlsYWJsZUNhcGFjaXR5IDw9IDApIHJldHVybiB0cmlwLm51bWJlck9mV2FpdGxpc3RzO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUcmlwKGRheSkge1xyXG4gICAgICAgICAgICBpZiAoZGF5LnRyaXBzICYmIGRheS5zZWxlY3RlZFRyaXApIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF5LnRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRheS50cmlwc1tpXS50cmlwSWQgPT0gZGF5LnNlbGVjdGVkVHJpcClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRheS50cmlwc1tpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGJhY2soKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYWR2LXNjaGVkdWxlJywgeyBvYmo6ICRzdGF0ZVBhcmFtcy5vYmogfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc05vdEZyb21BZHZTY2hlZHVsZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5vYmogPT0gdW5kZWZpbmVkIHx8ICRzdGF0ZVBhcmFtcy5vYmogPT0gbnVsbCB8fFxyXG4gICAgICAgICAgICAgICAgJHN0YXRlUGFyYW1zLm9iai5yZXNlcnZhdGlvbkluZm8gPT0gbnVsbCB8fCAkc3RhdGVQYXJhbXMub2JqLnJlc2VydmF0aW9uSW5mbyA9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5SZXNlcnZlKGRheSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkVHJpcCA9IGdldFRyaXAoZGF5KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkYXkuaXNPcGVuICYmIHNlbGVjdGVkVHJpcCAhPSBudWxsICYmIHNlbGVjdGVkVHJpcC50b3RhbFBhc3NlbmdlcnMgPiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlUmVzZXJ2YXRpb25SZXF1ZXN0KCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9ucyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgdmFyIHdlZWtJbmRleCA9IDA7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWVrcywgZnVuY3Rpb24gKHdlZWspIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXlJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2god2VlaywgZnVuY3Rpb24gKGRheSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYW5SZXNlcnZlKGRheSkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmlwID0gZ2V0VHJpcChkYXkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25EYXRlOiBkYXkuZGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBJZDogdHJpcC50cmlwSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWNrdXBTdG9wSWQ6IHZtLnBpY2t1cC5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BvZmZTdG9wSWQ6IHZtLmRyb3BvZmYuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJJZDogcGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkOiB0cmlwLnJvdXRlSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZSA6dm0uc2NoZWR1bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbklkOiBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVoaWNsZUlkOiBkYXkudmVoaWNsZSAhPSBudWxsID8gZGF5LnZlaGljbGUuaWQgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBZHZhbmNlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9ucy5wdXNoKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXNlcnZhdGlvbic6IHJlc2VydmF0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6IHdlZWtJbmRleCArICdfJyArIGRheUluZGV4XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF5SW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHdlZWtJbmRleCsrO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc2VydmF0aW9ucztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc2V0UmVzZXJ2YXRpb25WYXJpYWJsZXMoaWQpIHtcclxuICAgICAgICAgICAgdmFyIGRheSA9IGdldERheUlkZW50aWZpZXIoaWQpO1xyXG4gICAgICAgICAgICBkYXkucmVzZXJ2YXRpb25GYWlsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZGF5LnJlc2VydmF0aW9uRXJyb3IgPSAnJztcclxuICAgICAgICAgICAgZGF5LmlzUmVzZXJ2ZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc2VydmUoKSB7XHJcbiAgICAgICAgICAgIHZhciByZXNlcnZhdGlvbnMgPSBjcmVhdGVSZXNlcnZhdGlvblJlcXVlc3QoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvbnMgJiYgcmVzZXJ2YXRpb25zLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICB2bS5yZXNlcnZpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXNlcnZhdGlvbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIChjcmVhdGVSZXNlcnZhdGlvbikocmVzZXJ2YXRpb25zW2ldLnJlc2VydmF0aW9uLCByZXNlcnZhdGlvbnNbaV0uaWQpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlUmVzZXJ2YXRpb24ocmVxdWVzdCwgaWQpIHtcclxuXHJcbiAgICAgICAgICAgIHJlc2V0UmVzZXJ2YXRpb25WYXJpYWJsZXMoaWQpO1xyXG5cclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmFkZFJlc2VydmF0aW9ucyhwYXNzZW5nZXJJZCwgW3JlcXVlc3RdKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5lcnJvcnMubGVuZ3RoID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya1Jlc2VydmVkKGlkLCByZXNwb25zZS5kYXRhLnJlc3VsdC5pZFswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQW5pbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UmVzZXJ2YXRpb25GYWlsdXJlTWVzc2FnZShpZCwgcmVzcG9uc2UuZGF0YS5yZXN1bHQuZXJyb3JzID8gcmVzcG9uc2UuZGF0YS5yZXN1bHQuZXJyb3JzWzBdIDogcmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFJlc2VydmF0aW9uRmFpbHVyZU1lc3NhZ2UoaWQsIGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERheUlkZW50aWZpZXIoZGF5SWRlbnRpZmllcikge1xyXG4gICAgICAgICAgICB2YXIgaWRQYXJ0cyA9IGRheUlkZW50aWZpZXIuc3BsaXQoJ18nKTtcclxuICAgICAgICAgICAgdmFyIHdlZWsgPSBpZFBhcnRzWzBdO1xyXG4gICAgICAgICAgICB2YXIgZGF5ID0gaWRQYXJ0c1sxXTtcclxuICAgICAgICAgICAgcmV0dXJuIHZtLndlZWtzVG9EaXNwbGF5W3dlZWtdLmRheXNbZGF5XTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFJlc2VydmF0aW9uRmFpbHVyZU1lc3NhZ2UoZGF5SWRlbnRpZmllciwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBnZXREYXlJZGVudGlmaWVyKGRheUlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICBkYXkucmVzZXJ2YXRpb25GYWlsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBkYXkucmVzZXJ2YXRpb25FcnJvciA9IGVycm9yTWVzc2FnZTsgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXJrUmVzZXJ2ZWQoZGF5SWRlbnRpZmllciwgcmVzZXJ2YXRpb25JZCkge1xyXG4gICAgICAgICAgICB2YXIgZGF5ID0gZ2V0RGF5SWRlbnRpZmllcihkYXlJZGVudGlmaWVyKTtcclxuICAgICAgICAgICAgZGF5LmlzUmVzZXJ2ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBkYXkucmVzZXJ2YXRpb24gPSByZXNlcnZhdGlvbklkO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dSZXNlcnZhdGlvbihpZCkge1xyXG5cclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFJlc2VydmF0aW9uQnlJZChwYXNzZW5nZXJJZCwgaWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9hZHYtc2NoZWR1bGUvcmVzZXJ2YXRpb24tbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZXNlcnZhdGlvbk1vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uOiByZXNwb25zZS5kYXRhLnJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuY29udHJvbGxlcignQWR2U2NoZWR1bGVDb250cm9sbGVyJywgQWR2U2NoZWR1bGVDb250cm9sbGVyKTtcclxuICAgIEFkdlNjaGVkdWxlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHN0YXRlJywgJyRzdGF0ZVBhcmFtcycsICckcScsICckbG9jYXRpb24nLCAnJGFuY2hvclNjcm9sbCcsICckdGltZW91dCcsICckdWliTW9kYWwnLFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdTdG9wRGF0YVNlcnZpY2UnLCAndmVoaWNsZVNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnLFxyXG4gICAgICAgICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ01lc3NhZ2VTZXJ2aWNlJywgJ0NvbW1vblNlcnZpY2UnLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ3Ntb290aFNjcm9sbCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEFkdlNjaGVkdWxlQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkcSwgJGxvY2F0aW9uLCAkYW5jaG9yU2Nyb2xsLCAkdGltZW91dCwgJHVpYk1vZGFsLFxyXG4gICAgICAgIGF1dGhTZXJ2aWNlLCBTdG9wRGF0YVNlcnZpY2UsIHZlaGljbGVTZXJ2aWNlLCBQYWdlU2VydmljZSxcclxuICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UsIERpdmlzaW9uU2VydmljZSwgTWVzc2FnZVNlcnZpY2UsIENvbW1vblNlcnZpY2UsIFNjaGVkdWxlU2VydmljZSwgc21vb3RoU2Nyb2xsKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuXHJcbiAgICAgICAgaWYgKGlzTm90RnJvbUFkdlNldHVwKCkgJiYgIWlzRnJvbUFkdkNvbmZpcm0oKSkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2Fkdi1zY2hlZHVsZS1zZXR1cCcpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIHBhc3NlbmdlclJlc2VydmF0aW9ucyA9IFtdO1xyXG4gICAgICAgIHZhciBwaWNrdXAgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGRyb3BvZmYgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGFkdldlZWtzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbkRhdGUgPSBtb21lbnQoKTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcblxyXG4gICAgICAgICAgICAvL2V2ZW50IGJpbmRpbmdzXHJcbiAgICAgICAgICAgIHZtLnJlc2VydmUgPSByZXNlcnZlO1xyXG4gICAgICAgICAgICB2bS5maWx0ZXJXZWVrZW5kID0gZmlsdGVyV2Vla2VuZDtcclxuICAgICAgICAgICAgdm0uc2hvd1NjaGVkdWxlID0gc2hvd1NjaGVkdWxlO1xyXG4gICAgICAgICAgICB2bS5kYXlDbGFzcyA9IGFwcGx5Q2xhc3M7XHJcbiAgICAgICAgICAgIHZtLnJlc2V0UGFzc2VuZ2VyVmVoaWNsZSA9IHJlc2V0UGFzc2VuZ2VyVmVoaWNsZTtcclxuICAgICAgICAgICAgdm0uYmFjayA9IGJhY2s7XHJcbiAgICAgICAgICAgIHZtLnNob3dSZXNlcnZhdGlvbkluZm8gPSBzaG93UmVzZXJ2YXRpb25JbmZvO1xyXG5cclxuICAgICAgICAgICAgLy9nbG9iYWwgdmFyaWFibGVzXHJcbiAgICAgICAgICAgIHZtLm5vVmVoaWNsZSA9IHsgJ2xpY2VuY2VwbGF0ZSc6ICctLScsICdpZCc6IHVuZGVmaW5lZCB9O1xyXG4gICAgICAgICAgICB2bS5jYXJvdXNlbE9wdGlvbnMgPSBzZXRDYXJvdXNlbE9wdGlvbnMoKTtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcgPSAkc3RhdGVQYXJhbXMub2JqLmNvbmZpZztcclxuICAgICAgICAgICAgdm0ucGFzc2VuZ2VyVmVoaWNsZXMgPSAkc3RhdGVQYXJhbXMub2JqLnZlaGljbGVzO1xyXG4gICAgICAgICAgICB2bS53ZWVrcyA9IFtdO1xyXG4gICAgICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vbG9jYWwgdmFyaWFibGVzXHJcbiAgICAgICAgICAgIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgIHBhc3NlbmdlclJlc2VydmF0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICBwaWNrdXAgPSB2bS5zZWxlY3RlZENvbmZpZy5waWNrdXA7XHJcbiAgICAgICAgICAgIGRyb3BvZmYgPSB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmO1xyXG4gICAgICAgICAgICBhZHZXZWVrcyA9IHZtLnNlbGVjdGVkQ29uZmlnLm51bU9mV2Vla3MubmFtZTtcclxuXHJcbiAgICAgICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKHBpY2t1cC5uYW1lICsgJy0nICsgZHJvcG9mZi5uYW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldENhcm91c2VsT3B0aW9ucygpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIG5hdlRleHQ6IFtcIlwiLCBcIlwiXSxcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNpdmVDbGFzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBuYXY6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBsb29wOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGl0ZW1FbGVtZW50OiAnY2FsX193ZWVrJyxcclxuICAgICAgICAgICAgICAgIG9uRHJhZ2dlZDogY2Fyb3VzZWxJdGVtQ2hhbmdlZEV2ZW50LFxyXG4gICAgICAgICAgICAgICAgaXRlbXM6IDFcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhcm91c2VsSXRlbUNoYW5nZWRFdmVudChldmVudCkge1xyXG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGV2ZW50LnBhZ2UuaW5kZXgpO1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA3MDAsXHJcbiAgICAgICAgICAgICAgICBlYXNpbmc6ICdlYXNlSW5RdWFkJyxcclxuICAgICAgICAgICAgICAgIG9mZnNldDogMTIwXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHNtb290aFNjcm9sbChlbGVtZW50LCBvcHRpb25zKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTdGFydERhdGUoaW5wdXQpIHtcclxuICAgICAgICAgICAgdmFyIG1vbWVudElucHV0ID0gbW9tZW50KGlucHV0KTtcclxuICAgICAgICAgICAgdmFyIGRheSA9IG1vbWVudElucHV0LmRheSgpO1xyXG4gICAgICAgICAgICBpZiAoZGF5ID09IDYpIHJldHVybiBtb21lbnRJbnB1dC5hZGQoMSwgJ2RheXMnKS50b0RhdGUoKTtcclxuICAgICAgICAgICAgaWYgKGRheSA9PSAwKSByZXR1cm4gbW9tZW50SW5wdXQudG9EYXRlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBtb21lbnRJbnB1dC5zdWJ0cmFjdChkYXksICdkYXlzJykudG9EYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuXHJcbiAgICAgICAgICAgIGluaXQoKTtcclxuXHJcbiAgICAgICAgICAgIERpdmlzaW9uU2VydmljZVxyXG4gICAgICAgICAgICAgLmlzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvbigpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zKClcclxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHBvcHVsYXRlV2Vla3MoKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBhc3NlbmdlclJlc2VydmF0aW9ucygpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAuZ2V0QWxsUmVzZXJ2YXRpb25zRm9yUGFzc2VuZ2VyKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnJlc2VydmF0aW9ucylcclxuICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJSZXNlcnZhdGlvbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5yZXNlcnZhdGlvbnMuZmlsdGVyKHJlc2VydmF0aW9uc0ZvclNjaGVkdWxlKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXJ2YXRpb25zRm9yU2NoZWR1bGUocikge1xyXG4gICAgICAgICAgICByZXR1cm4gci5zY2hlZHVsZVR5cGUudG9Mb3dlckNhc2UoKSA9PSB2bS5zZWxlY3RlZENvbmZpZy5zY2hlZHVsZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXJ2YXRpb25Gb3JEYXkoZGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgcmVzZXJ2YXRpb25zID0gcGFzc2VuZ2VyUmVzZXJ2YXRpb25zLmZpbHRlcihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudChyLnJlc2VydmF0aW9uRGF0ZSkuZGF5T2ZZZWFyKCkgPT0gZGF0ZS5kYXlPZlllYXIoKSAmJiByLnN0YXR1cyAhPSAnQ2FuY2VsZWQnO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc2VydmF0aW9ucyA9PSBudWxsIHx8IHJlc2VydmF0aW9ucy5sZW5ndGggPT0gMCA/IHVuZGVmaW5lZCA6IHJlc2VydmF0aW9uc1swXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlV2Vla3MoKSB7XHJcbiAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydFdlZWsgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRXZWVrID0gYWR2V2Vla3M7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0RGF0ZSA9IGdldFN0YXJ0RGF0ZShkaXZpc2lvbkRhdGUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDYWxlbmRhcihzdGFydFdlZWssIGVuZFdlZWssIHN0YXJ0RGF0ZSwgaXNJblBhc3QpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNXZWVrZGF5KGRpdmlzaW9uRGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRXZWVrID0gYWR2V2Vla3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZFdlZWsgPSBzdGFydFdlZWsgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGUgPSAobW9tZW50KHN0YXJ0RGF0ZSkuYWRkKDcgKiBhZHZXZWVrcywgJ2RheXMnKSkudG9EYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlQ2FsZW5kYXIoc3RhcnRXZWVrLCBlbmRXZWVrLCBzdGFydERhdGUsIGlzT3V0c2lkZUFsbG93ZWRSYW5nZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFRyaXBzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ud2Vla3NYID0gdm0ud2Vla3M7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlID09IENvbW1vblNlcnZpY2UuU2NoZWR1bGVUeXBlLk1vcm5pbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldFBhcmtpbmcoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzV2Vla2RheShkYXRlKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBtb21lbnQoZGF0ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5kYXkoKSAhPSA2IHx8IGlucHV0LmRheSgpICE9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVDYWxlbmRhcihmcm9tLCB0bywgc3RhcnREYXRlLCBwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnREYXRlID0gbW9tZW50KHN0YXJ0RGF0ZSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciB3ZWVrID0gZnJvbTsgd2VlayA8IHRvOyB3ZWVrKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjYWxlbmRhckRheXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGRheSA9IDA7IGRheSA8IDc7IGRheSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsZW5kYXJEYXlzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF5SWQnOiBkYXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd3ZWVrJzogd2VlayxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2RheU9mV2Vlayc6IGdldFdlZWtEYXkoY3VycmVudERhdGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF0ZSc6IGN1cnJlbnREYXRlLnRvRGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaXNPcGVuJzogc2V0T3BlbihjdXJyZW50RGF0ZSwgcHJlZGljYXRlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2FibGUnOiBkaXNhYmxlKGN1cnJlbnREYXRlLCBwcmVkaWNhdGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2VsZWN0ZWRUcmlwJzogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAndHJpcHMnOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd2ZWhpY2xlJzogdm0uc2VsZWN0ZWRDb25maWcudmVoaWNsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc2VydmF0aW9uJzogcmVzZXJ2YXRpb25Gb3JEYXkoY3VycmVudERhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudERhdGUgPSBjdXJyZW50RGF0ZS5hZGQoMSwgJ2RheXMnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLndlZWtzW3dlZWtdID0gY2FsZW5kYXJEYXlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkaXNhYmxlKGN1cnJlbnREYXRlLCBwcmVkaWNhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByZWRpY2F0ZShjdXJyZW50RGF0ZSkgfHwgcmVzZXJ2YXRpb25Gb3JEYXkoY3VycmVudERhdGUpICE9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldE9wZW4oY3VycmVudERhdGUsIHByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gIXByZWRpY2F0ZShjdXJyZW50RGF0ZSkgJiYgd2FzU2VsZWN0ZWQoY3VycmVudERhdGUpICYmIHJlc2VydmF0aW9uRm9yRGF5KGN1cnJlbnREYXRlKSA9PT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNJblBhc3QoZGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5kYXlPZlllYXIoKSA8IG1vbWVudChkaXZpc2lvbkRhdGUpLmRheU9mWWVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNPdXRzaWRlQWxsb3dlZFJhbmdlKGRhdGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUuZGF5T2ZZZWFyKCkgPiBtb21lbnQoZGl2aXNpb25EYXRlKS5kYXlPZlllYXIoKSArIGFkdldlZWtzICogNztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFdlZWtEYXkoZGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgd2Vla0RheXMgPSBbJ1N1bicsICdNb24nLCAnVHVlJywgJ1dlZCcsICdUaHUnLCAnRnJpJywgJ1NhdCddO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHdlZWtEYXlzW2RhdGUud2Vla2RheSgpXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdhc1NlbGVjdGVkKGRhdGUpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5zZWxlY3RlZENvbmZpZy53ZWVrRGF5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkQ29uZmlnLndlZWtEYXlzW2ldLmlkID09IGRhdGUuZGF5KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUcmlwcygpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2bS53ZWVrcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS53ZWVrc1tqXS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS53ZWVrc1tqXVtpXS5pc09wZW4gJiYgIXZtLndlZWtzW2pdW2ldLmRpc2FibGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChnZXRUcmlwSW5mbykoaiwgaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBhcmtpbmcoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdm0ud2Vla3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ud2Vla3Nbal0ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0ud2Vla3Nbal1baV0uaXNPcGVuICYmICF2bS53ZWVrc1tqXVtpXS5kaXNhYmxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoZ2V0QXZhaWxhYmxlUGFya2luZykoaiwgaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVBhcmtpbmcod2VlaywgZGF5KSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgIC5nZXRBdmFpbGFibGVQYXJraW5nc0ZvclN0b3AocGlja3VwLmlkLCBEYXRlLnBhcnNlKHZtLndlZWtzW3dlZWtdW2RheV0uZGF0ZSkpXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICB2bS53ZWVrc1t3ZWVrXVtkYXldLmF2YWlsYWJsZVBhcmtpbmcgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRyaXBJbmZvKHdlZWssIGRheSkge1xyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgICAuZ2V0Tm9uUGVyZm9ybWVkVHJpcHMocGlja3VwLmlkLCBkcm9wb2ZmLmlkLCB2bS5zZWxlY3RlZENvbmZpZy5zY2hlZHVsZSwgRGF0ZS5wYXJzZSh2bS53ZWVrc1t3ZWVrXVtkYXldLmRhdGUpKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgdm0ud2Vla3Nbd2Vla11bZGF5XS50cmlwcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0Lk5vblBlcmZvcm1lZFRyaXBzO1xyXG4gICAgICAgICAgICAgICAgICBtYXBTZWxlY3RlZFRyaXAod2VlaywgZGF5KTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGlmICh2bS53ZWVrc1t3ZWVrXVtkYXldLnRyaXBzID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgdm0ud2Vla3Nbd2Vla11bZGF5XS5pc09wZW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgdm0ud2Vla3Nbd2Vla11bZGF5XS5kaXNhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFNlbGVjdGVkVHJpcCh3ZWVrLCBkYXkpIHtcclxuICAgICAgICAgICAgaWYgKHZtLndlZWtzW3dlZWtdW2RheV0gPT0gdW5kZWZpbmVkIHx8IHZtLndlZWtzW3dlZWtdW2RheV0udHJpcHMgPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRyaXBzID0gdm0ud2Vla3Nbd2Vla11bZGF5XS50cmlwcztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmlwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkQ29uZmlnLnRyaXBUaW1lLnRyaXBJZCA9PSB0cmlwc1tpXS50cmlwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS53ZWVrc1t3ZWVrXVtkYXldLnNlbGVjdGVkVHJpcCA9IHRyaXBzW2ldLnRyaXBJZDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFwcGx5Q2xhc3MoZGF5KSB7XHJcbiAgICAgICAgICAgIGlmIChpc1dlZWtlbmQoZGF5KSkgcmV0dXJuICdjYWxfX2RheS0tZGlzYWJsZWQnO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoZGF5LnRyaXBzKSB8fCAhZGF5LmlzT3BlbikgcmV0dXJuICdjYWxfX2RheS0taW5hY3RpdmUnO1xyXG4gICAgICAgICAgICByZXR1cm4gJ2NhbF9fZGF5LS1hY3RpdmUnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1NjaGVkdWxlKGRheSkge1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzV2Vla2VuZChkYXkpIHx8IGRheS5kaXNhYmxlKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBkYXkuaXNPcGVuID0gIWRheS5pc09wZW47XHJcblxyXG4gICAgICAgICAgICBpZiAoIWRheS5pc09wZW4pXHJcbiAgICAgICAgICAgICAgICBkYXkudHJpcHMgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgICAgICBnZXRUcmlwSW5mbyhkYXkud2VlaywgZGF5LmRheUlkKTtcclxuICAgICAgICAgICAgZ2V0QXZhaWxhYmxlUGFya2luZyhkYXkud2VlaywgZGF5LmRheUlkKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBoYXNoID0gZGF5LmRheUlkICsgJ18nICsgZGF5LndlZWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJXZWVrZW5kKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGRheSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRheS5kYXlPZldlZWsgIT0gJ1NhdCcgJiYgZGF5LmRheU9mV2VlayAhPSAnU3VuJztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc1dlZWtlbmQoZGF5KSB7XHJcbiAgICAgICAgICAgIGRheS5kYXlPZldlZWsgPT0gJ1NhdCcgfHwgZGF5LmRheU9mV2VlayA9PSAnU3VuJ1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXRQYXNzZW5nZXJWZWhpY2xlKGRheSkge1xyXG4gICAgICAgICAgICBpZiAodm0ucGFzc2VuZ2VyVmVoaWNsZXMgJiYgdm0ucGFzc2VuZ2VyVmVoaWNsZXMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIGRheS52ZWhpY2xlID0gdm0ucGFzc2VuZ2VyVmVoaWNsZXNbMF07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc05vdEZyb21BZHZTZXR1cCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5vYmogPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgfHwgJHN0YXRlUGFyYW1zLm9iaiA9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgIHx8ICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnID09IG51bGxcclxuICAgICAgICAgICAgICAgIHx8ICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnID09IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRnJvbUFkdkNvbmZpcm0oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkc3RhdGVQYXJhbXMub2JqICE9IG51bGxcclxuICAgICAgICAgICAgICAgICYmICRzdGF0ZVBhcmFtcy5vYmogIT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAmJiAkc3RhdGVQYXJhbXMub2JqLnJlc2VydmF0aW9uSW5mbyAhPSBudWxsXHJcbiAgICAgICAgICAgICAgICAmJiAkc3RhdGVQYXJhbXMub2JqLnJlc2VydmF0aW9uSW5mbyAhPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBiYWNrKCkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2Fkdi1zY2hlZHVsZS1zZXR1cCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1Jlc2VydmF0aW9uSW5mbyhyZXNlcnZhdGlvbikge1xyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS9yZXNlcnZhdGlvbi1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZXNlcnZhdGlvbk1vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbjogcmVzZXJ2YXRpb25cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNlcnZlKCkge1xyXG4gICAgICAgICAgICB2YXIgYWxsb3dSZXNlcnZhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0ud2Vla3MsIGZ1bmN0aW9uICh3ZWVrKSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2god2VlaywgZnVuY3Rpb24gKGRheSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXkuaXNPcGVuICYmIGRheS5zZWxlY3RlZFRyaXAgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxvd1Jlc2VydmF0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYWxsb3dSZXNlcnZhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhZHYtc2NoZWR1bGUtY29uZmlybWF0aW9uJyxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBvYmo6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25maWc6IHZtLnNlbGVjdGVkQ29uZmlnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2ZWhpY2xlczogdm0ucGFzc2VuZ2VyVmVoaWNsZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uSW5mbzogdm0ud2Vla3NcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcblxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgLmRpcmVjdGl2ZSgnb3dsQ2Fyb3VzZWwnLCBNVk93bENhcm91c2VsKTtcclxuXHJcbiAgICBNVk93bENhcm91c2VsLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNVk93bENhcm91c2VsKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmluaXRDYXJvdXNlbCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcHJvdmlkZSBhbnkgZGVmYXVsdCBvcHRpb25zIHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1c3RvbU9wdGlvbnMgPSBzY29wZS4kZXZhbCgkKGVsZW1lbnQpLmF0dHIoJ2RhdGEtb3B0aW9ucycpKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb21iaW5lIHRoZSB0d28gb3B0aW9ucyBvYmplY3RzXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGN1c3RvbU9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE9wdGlvbnNba2V5XSA9IGN1c3RvbU9wdGlvbnNba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaW5pdCBjYXJvdXNlbFxyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChlbGVtZW50KS5vd2xDYXJvdXNlbChkZWZhdWx0T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuZGlyZWN0aXZlKCdvd2xDYXJvdXNlbEl0ZW0nLCBNVk93bENhcm91c2VsSXRlbSk7XHJcblxyXG4gICAgTVZPd2xDYXJvdXNlbEl0ZW0uJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1WT3dsQ2Fyb3VzZWxJdGVtKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHRyYW5zY2x1ZGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIC8vIHdhaXQgZm9yIHRoZSBsYXN0IGl0ZW0gaW4gdGhlIG5nLXJlcGVhdCB0aGVuIGNhbGwgaW5pdFxyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLiRsYXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaW5pdENhcm91c2VsKGVsZW1lbnQucGFyZW50KCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQWR2U2NoZWR1bGVTZXR1cENvbnRyb2xsZXInLCBBZHZTY2hlZHVsZVNldHVwQ29udHJvbGxlcik7XHJcblxyXG4gICAgQWR2U2NoZWR1bGVTZXR1cENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRzdGF0ZScsICckdWliTW9kYWwnLCAnJHN0YXRlUGFyYW1zJyxcclxuICAgICAgICAnYXV0aFNlcnZpY2UnLCAnU3RvcERhdGFTZXJ2aWNlJywgJ3ZlaGljbGVTZXJ2aWNlJywgJ0NvbW1vblNlcnZpY2UnLFxyXG4gICAgICAgICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnTWFwU2VydmljZScsICdNYXBJY29uU2VydmljZScsICdQYWdlU2VydmljZScsJ0x1dW1MaW5rZWRTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEFkdlNjaGVkdWxlU2V0dXBDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkdWliTW9kYWwsICRzdGF0ZVBhcmFtcyxcclxuICAgICAgICBhdXRoU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlLCB2ZWhpY2xlU2VydmljZSwgQ29tbW9uU2VydmljZSxcclxuICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UsIE1hcFNlcnZpY2UsIE1hcEljb25TZXJ2aWNlLCBQYWdlU2VydmljZSwgTHV1bUxpbmtlZFNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7ICAgICAgICAgICAgIFxyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdBZHZhbmNlZCBSZXNlcnZhdGlvbnMnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldENvbW11dGVySW5mbygpLmFsaWFzKTtcclxuICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICB2YXIgYWxsU3RvcHMgPSBbXTtcclxuICAgICAgICB2YXIgbm9UcmlwVGltZSA9IHsgJ3BpY2t1cFRpbWUnOiAnT3B0aW9uYWwnLCAndHJpcElkJzogdW5kZWZpbmVkIH07XHJcbiAgICAgICAgdmFyIG5vVmVoaWNsZSA9IHsgJ2xpY2VuY2VwbGF0ZSc6ICctLScsICd2ZWhpY2xlSWQnOiB1bmRlZmluZWQgfTtcclxuICAgICAgICB2YXIgbm9TdG9wID0geyAnaWQnOiB1bmRlZmluZWQsICduYW1lJzogJy0tJywgJ2xhdGl0dWRlJzogbnVsbCwgJ2xvbmdpdHVkZSc6IG51bGwgfTtcclxuICAgICAgICB2YXIgbWFya2VyRXZlbnRzID0gW3sgZXZlbnQ6ICdjbGljaycsIGNhbGxiYWNrOiBpY29uQ2xpY2tIYW5kbGVyIH1dO1xyXG5cclxuICAgICAgICB2bS5tYXAgPSBNYXBTZXJ2aWNlLmluaXRpYWxpemVNYXAoKTtcclxuICAgICAgICB2bS50aXRsZSA9ICdBZHZhbmNlIFJlc2VydmF0aW9ucyBTZXR1cCc7XHJcbiAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNQYXNzZW5nZXJMb2dnZWRJbiA9IGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKTtcclxuICAgICAgICB2bS5tYXJrZXJzID0gW107XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcgPSBnZXREZWZhdWx0Q29uZmlnKCk7XHJcblxyXG4gICAgICAgIHZhciByZXR1cm5UcmlwQ29uZmlnID0gZ2V0UmV0dXJuVHJpcENvbmZpZygpO1xyXG5cclxuICAgICAgICB2bS5waWNrdXBTdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLmRyb3BvZmZTdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLnRyaXBUaW1lcyA9IFtdO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gW107XHJcbiAgICAgICAgdm0uY29vcmRzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLm51bU9mV2Vla3MgPSBbXTtcclxuICAgICAgICB2bS5kYXlzT2ZXZWVrID1cclxuICAgICAgICAgICAgICAgICAgICBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyAnbmFtZSc6ICdTJywgJ3NlbGVjdGVkJzogZmFsc2UsICdpZCc6IDAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICduYW1lJzogJ00nLCAnc2VsZWN0ZWQnOiBmYWxzZSwgJ2lkJzogMSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJ25hbWUnOiAnVCcsICdzZWxlY3RlZCc6IGZhbHNlLCAnaWQnOiAyIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyAnbmFtZSc6ICdXJywgJ3NlbGVjdGVkJzogZmFsc2UsICdpZCc6IDMgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICduYW1lJzogJ1RIJywgJ3NlbGVjdGVkJzogZmFsc2UsICdpZCc6IDQgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICduYW1lJzogJ0YnLCAnc2VsZWN0ZWQnOiBmYWxzZSwgJ2lkJzogNSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJ25hbWUnOiAnUycsICdzZWxlY3RlZCc6IGZhbHNlLCAnaWQnOiA2IH1cclxuICAgICAgICAgICAgICAgICAgICBdO1xyXG5cclxuICAgICAgICB2bS5oYXNUZW1wbGF0ZXMgPSBmYWxzZTtcclxuICAgICAgICB2bS50ZW1wbGF0ZXMgPSBbXTtcclxuICAgICAgICB2bS51c2VEZWZhdWx0VGVtcGxhdGUgPSBmYWxzZTtcclxuICAgICAgICB2bS5vdmVycmlkZVRlbXBsYXRlID0gZmFsc2U7XHJcbiAgICAgICAgdm0uYWRkVGVtcGxhdGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNSZXR1cm5UcmlwUmVxdWVzdCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5vYmogIT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgJiYgJHN0YXRlUGFyYW1zLm9iaiAhPSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICYmICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnICE9IG51bGxcclxuICAgICAgICAgICAgICAgICYmICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnICE9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFJldHVyblRyaXBDb25maWcoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpc1JldHVyblRyaXBSZXF1ZXN0KCkgPyAkc3RhdGVQYXJhbXMub2JqLmNvbmZpZyA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWcoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBzY2hlZHVsZTogQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZyxcclxuICAgICAgICAgICAgICAgIHBpY2t1cDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgZHJvcG9mZjogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgd2Vla0RheXM6IFtdLFxyXG4gICAgICAgICAgICAgICAgdHJpcFRpbWU6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgIG51bU9mV2Vla3M6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgIHZlaGljbGU6IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZtLnBpY2t1cENoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRDb25maWcucGlja3VwIHx8ICF2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAuaWQpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYgPSB2bS5waWNrdXBTdG9wc1swXTtcclxuICAgICAgICAgICAgICAgIHZtLm1hcmtlcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZtLmFkZFRlbXBsYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmID0gbm9TdG9wO1xyXG4gICAgICAgICAgICB2bS5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNldE1hcmtlcnMoKTtcclxuICAgICAgICAgICAgTWFwU2VydmljZS5zZXRNYXBCb3VuZHModm0ubWFya2VycywgbWFya2VyRXZlbnRzKTtcclxuICAgICAgICAgICAgZ2V0RHJvcG9mZnMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmRyb3BvZmZDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cCB8fCAhdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmlkKSB7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2bS5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmICYmIHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuaWQpXHJcbiAgICAgICAgICAgICAgICBnZXRUcmlwVGltZXMoKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdm0uYWRkVGVtcGxhdGUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHNldE1hcmtlcnMoKTtcclxuICAgICAgICAgICAgTWFwU2VydmljZS5zZXRNYXBCb3VuZHModm0ubWFya2VycywgbWFya2VyRXZlbnRzKTtcclxuICAgICAgICB9ICAgICBcclxuXHJcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uZGF5c09mV2Vla3xmaWx0ZXI6e3NlbGVjdGVkOnRydWV9JywgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLndlZWtEYXlzID0gdmFsdWUubWFwKGZ1bmN0aW9uIChkYXkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkYXk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5wYXJraW5nU2VsZWN0ZWQnLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKCF2YWx1ZSlcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLnZlaGljbGUgPSBub1ZlaGljbGU7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0udXNlRGVmYXVsdFRlbXBsYXRlJywgZnVuY3Rpb24gKHZhbHVlKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXZhbHVlKVxyXG4gICAgICAgICAgICAgICAgdm0ucGFya2luZ1NlbGVjdGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBzZXRTZWxlY3RlZFRyaXAoKTtcclxuICAgICAgICAgICAgZmlsdGVyUGlja3VwcygpO1xyXG4gICAgICAgICAgICByZXNldFdlZWtEYXlzKCk7XHJcbiAgICAgICAgICAgIHNldFNlbGVjdGVkVmVoaWNsZSgpO1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS50ZW1wbGF0ZXMubGVuZ3RoID4gMCAmJiB2bS51c2VEZWZhdWx0VGVtcGxhdGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IGdldFRlbXBsYXRlKCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLmRheXNPZldlZWsubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5kYXlzT2ZXZWVrW2ldLnNlbGVjdGVkID0gaXNXZWVrZGF5U2VsZWN0ZWQodm0uZGF5c09mV2Vla1tpXSwgdGVtcGxhdGUuZGF5c09mV2Vlayk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRlbXBsYXRlKCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnRlbXBsYXRlc1tpXS5zY2hlZHVsZSA9PSB2bS5zZWxlY3RlZENvbmZpZy5zY2hlZHVsZSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm0udGVtcGxhdGVzW2ldO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uc2NoZWR1bGVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5kcm9wb2ZmU3RvcHMgPSBbXTtcclxuICAgICAgICAgICAgdm0ubWFya2VycyA9IFtdO1xyXG4gICAgICAgICAgICB2bS5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnVzZURlZmF1bHRUZW1wbGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmaWx0ZXJQaWNrdXBzKCk7XHJcbiAgICAgICAgICAgIHJlc2V0V2Vla0RheXMoKTtcclxuICAgICAgICAgICAgcmVzZXRUcmlwVGltZXMoKTtcclxuICAgICAgICAgICAgc2V0SGFzVGVtcGxhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNsZWFyV2Vla1NlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVzZXRXZWVrRGF5cygpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZtLm5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5hZGRUZW1wbGF0ZSB8fCB2bS5vdmVycmlkZVRlbXBsYXRlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFBpY2t1cFN0b3BJZDogdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIERyb3BvZmZTdG9wSWQ6IHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgVHJpcElkOiB2bS5zZWxlY3RlZENvbmZpZy50cmlwVGltZS50cmlwSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGU6IHZtLnNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlLFxyXG4gICAgICAgICAgICAgICAgICAgIFZlaGljbGVJZCA6IHZtLnNlbGVjdGVkQ29uZmlnLnZlaGljbGUuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWREYXlzIDogZ2V0U2VsZWN0ZWREYXlzKClcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmFkZFBhc3NlbmdlclRlbXBsYXRlKHBhc3NlbmdlcklkLCB0ZW1wbGF0ZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTZWxlY3RlZERheXMoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgd2Vla2RheXMgPSBbXCJTdW5kYXlcIiwgXCJNb25kYXlcIiwgXCJUdWVzZGF5XCIsIFwiV2VkbmVzZGF5XCIsIFwiVGh1cnNkYXlcIiwgXCJGcmlkYXlcIiwgXCJTYXR1cmRheVwiXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZERheXMgPSB7fTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5zZWxlY3RlZENvbmZpZy53ZWVrRGF5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IHdlZWtkYXlzW3ZtLnNlbGVjdGVkQ29uZmlnLndlZWtEYXlzW2ldLmlkXTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRGF5c1trZXldID0gdm0uc2VsZWN0ZWRDb25maWcud2Vla0RheXNbaV0uc2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZERheXM7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbmV4dCgpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdhZHYtc2NoZWR1bGUnLCB7XHJcbiAgICAgICAgICAgICAgICBvYmo6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IHZtLnNlbGVjdGVkQ29uZmlnLCB2ZWhpY2xlczogdm0ucGFzc2VuZ2VyVmVoaWNsZXNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJlZGlyZWN0VG9Mb2dpbigpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZtLnNob3dBZGRWZWhpY2xlRGlhbG9nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxSZXNlcnZlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvYWRkLXZlaGljbGUtbW9kYWwvYWRkLXZlaGljbGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQWRkVmVoaWNsZUNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogXCItZnNcIixcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBhdGxlYXN0T25lVmVoaWNsZUV4aXN0OiB2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtb2RhbFJlc2VydmUucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc0FkZGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFBhc3NlbmdlclZlaGljbGVzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VycygpIHtcclxuICAgICAgICAgICAgdm0ubWFya2VycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cCAmJiB2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAuaWQgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIHZtLm1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogZ2V0TWFwSWNvbih2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAuaXNIdWIpLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5hZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmICYmIHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuaWQgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgIHZtLm1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiBnZXRNYXBJY29uKHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuaXNIdWIpLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmLmFkZHJlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1hcEljb24oaXNIdWIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlzSHViID8gTWFwSWNvblNlcnZpY2UuZ2V0Q29tbXV0ZXJIdWJJY29uKCkgOlxyXG4gICAgICAgICAgICAgICAgTWFwSWNvblNlcnZpY2UuZ2V0Q29tbXV0ZXJTdG9wSWNvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXRXZWVrRGF5cygpIHtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcud2Vla0RheXMgPSBbXTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5kYXlzT2ZXZWVrLCBmdW5jdGlvbiAoZGF5T2ZXZWVrLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXlPZldlZWsuc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXRUcmlwVGltZXMoKSB7XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLnRyaXBUaW1lID0ge307XHJcbiAgICAgICAgICAgIHZtLnRyaXBUaW1lcyA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlclBpY2t1cHMoKSB7XHJcbiAgICAgICAgICAgIHZtLnBpY2t1cFN0b3BzID0gYWxsU3RvcHMuZmlsdGVyKGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RvcC5pc0h1YiAhPSAodm0uc2VsZWN0ZWRDb25maWcuc2NoZWR1bGUgPT0gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5waWNrdXBTdG9wcy5zcGxpY2UoMCwgMCwgbm9TdG9wKTtcclxuXHJcbiAgICAgICAgICAgIHNldFBpY2t1cFN0b3AoKTsgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFBpY2t1cFN0b3AoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgcGlja3VwSWQgPSB1bmRlZmluZWQ7ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBpZiAoaXNSZXR1cm5UcmlwUmVxdWVzdCgpICYmIHJldHVyblRyaXBDb25maWcpXHJcbiAgICAgICAgICAgICAgICBwaWNrdXBJZCA9IHJldHVyblRyaXBDb25maWcucGlja3VwLmlkO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh2bS50ZW1wbGF0ZXMubGVuZ3RoID4gMCAmJiB2bS51c2VEZWZhdWx0VGVtcGxhdGUpXHJcbiAgICAgICAgICAgICAgICBwaWNrdXBJZCA9IGdldFRlbXBsYXRlKCkucGlja3VwSWQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgbWF0Y2hGb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnBpY2t1cFN0b3BzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucGlja3VwU3RvcHNbaV0uaWQgPT0gcGlja3VwSWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cCA9IHZtLnBpY2t1cFN0b3BzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPXRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghbWF0Y2hGb3VuZClcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cCA9IHZtLnBpY2t1cFN0b3BzWzBdO1xyXG5cclxuICAgICAgICAgICAgdm0ucGlja3VwQ2hhbmdlZCgpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldERyb3BvZmZTdG9wKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGRyb3BvZmZJZCA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc1JldHVyblRyaXBSZXF1ZXN0KCkgJiYgcmV0dXJuVHJpcENvbmZpZykgXHJcbiAgICAgICAgICAgICAgICBkcm9wb2ZmSWQgPSByZXR1cm5UcmlwQ29uZmlnLmRyb3BvZmYuaWQ7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHZtLnRlbXBsYXRlcy5sZW5ndGggPiAwICYmIHZtLnVzZURlZmF1bHRUZW1wbGF0ZSlcclxuICAgICAgICAgICAgICAgIGRyb3BvZmZJZCA9IGdldFRlbXBsYXRlKCkuZHJvcG9mZklkO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1hdGNoRm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5kcm9wb2ZmU3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5kcm9wb2ZmU3RvcHNbaV0uaWQgPT0gZHJvcG9mZklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZiA9IHZtLmRyb3BvZmZTdG9wc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaEZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYoIW1hdGNoRm91bmQpXHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmID0gdm0uZHJvcG9mZlN0b3BzWzBdO1xyXG5cclxuICAgICAgICAgICAgdm0uZHJvcG9mZkNoYW5nZWQoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgaWYgKCF2bS5pc1Bhc3NlbmdlckxvZ2dlZEluKVxyXG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUb0xvZ2luKCk7XHJcbiAgICAgICAgICAgIEx1dW1MaW5rZWRTZXJ2aWNlLnZlcmlmeShhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCk7XHJcbiAgICAgICAgICAgIGdldFBhc3NlbmdlclRlbXBsYXRlcygpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBnZXRQYXNzZW5nZXJWZWhpY2xlcygpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBhc3NlbmdlclRlbXBsYXRlcygpIHtcclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFBhc3NlbmdlclRlbXBsYXRlcyhwYXNzZW5nZXJJZClcclxuICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0Lmxlbmd0aCA+IDApIHsgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICBtYXBUZW1wbGF0ZXMocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICBnZXRBZHZSZXNlcnZhdGlvbldpbmRvdygpO1xyXG4gICAgICAgICAgICAgICBnZXRBbGxTdG9wcygpO1xyXG5cclxuICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXBUZW1wbGF0ZXModGVtcGxhdGVzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVtcGxhdGVzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgdm0udGVtcGxhdGVzLnB1c2godGVtcGxhdGVzW2ldKTtcclxuXHJcbiAgICAgICAgICAgIHNldEhhc1RlbXBsYXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRIYXNUZW1wbGF0ZSgpIHtcclxuICAgICAgICAgICAgdmFyIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udGVtcGxhdGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRDb25maWcuc2NoZWR1bGUgPT0gdm0udGVtcGxhdGVzW2ldLnNjaGVkdWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZtLmhhc1RlbXBsYXRlcyA9IGZvdW5kO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGljb25DbGlja0hhbmRsZXIobW9kZWwpIHtcclxuICAgICAgICAgICAgdm0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBZHZSZXNlcnZhdGlvbldpbmRvdygpIHtcclxuICAgICAgICAgICAgdm0ubnVtT2ZXZWVrcyA9IFtdO1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuZ2V0QWR2UmVzZXJ2YXRpb25BbGxvd2VkV2Vla3MoKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG51bVdlZWtzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gbnVtV2Vla3M7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5udW1PZldlZWtzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiBpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyICB3ZWVrVG9TZWxlY3QgPSB2bS5udW1PZldlZWtzW3ZtLm51bU9mV2Vla3MubGVuZ3RoIC0gMV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1JldHVyblRyaXBSZXF1ZXN0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5udW1PZldlZWtzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0ubnVtT2ZXZWVrc1tpXS5uYW1lID09PSByZXR1cm5UcmlwQ29uZmlnLm51bU9mV2Vla3MubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlZWtUb1NlbGVjdCA9IHZtLm51bU9mV2Vla3NbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLm51bU9mV2Vla3MgPSB3ZWVrVG9TZWxlY3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsU3RvcHMoKSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5nZXRBbGxCdXNTdG9wcygpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxTdG9wcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnN0b3BzO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuVHJpcFJlcXVlc3QoKSAmJiByZXR1cm5UcmlwQ29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZyA9IGFuZ3VsYXIuY29weShyZXR1cm5UcmlwQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEhhc1RlbXBsYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLmRheXNPZldlZWsubGVuZ3RoOyBpKyspIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZGF5c09mV2Vla1tpXS5zZWxlY3RlZCA9IGlzV2Vla2RheVNlbGVjdGVkKHZtLmRheXNPZldlZWtbaV0sIHJldHVyblRyaXBDb25maWcud2Vla0RheXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJQaWNrdXBzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNXZWVrZGF5U2VsZWN0ZWQoaW5wdXQsIGNvbmZpZ3VyYXRpb25XZWVrRGF5cykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbmZpZ3VyYXRpb25XZWVrRGF5cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0Lm5hbWUgPT0gY29uZmlndXJhdGlvbldlZWtEYXlzW2ldLm5hbWVcclxuICAgICAgICAgICAgICAgICAgICAmJiBjb25maWd1cmF0aW9uV2Vla0RheXNbaV0uc2VsZWN0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFzc2VuZ2VyVmVoaWNsZXMoKSB7XHJcbiAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0VmVoaWNsZXNGb3JQYXNzZW5nZXIocGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5wYXNzZW5nZXJWZWhpY2xlcylcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzLnNwbGljZSgwLCAwLCBub1ZlaGljbGUpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gW25vVmVoaWNsZV07XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRWZWhpY2xlKCk7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFNlbGVjdGVkVmVoaWNsZSgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IGdldFRlbXBsYXRlKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0udXNlRGVmYXVsdFRlbXBsYXRlICYmIHRlbXBsYXRlICE9IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgICAgICYmIHZtLnNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlID09IFwiQU1cIiAmJiB0ZW1wbGF0ZS52ZWhpY2xlSWQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnBhc3NlbmdlclZlaGljbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnBhc3NlbmdlclZlaGljbGVzW2ldLmlkID09IHRlbXBsYXRlLnZlaGljbGVJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5wYXJraW5nU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy52ZWhpY2xlID0gdm0ucGFzc2VuZ2VyVmVoaWNsZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcudmVoaWNsZSA9IHZtLnBhc3NlbmdlclZlaGljbGVzWzBdO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERyb3BvZmZzKCkge1xyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cCB8fCAhKHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5pZCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXREcm9wb2Zmc0ZvclNlbGVjdGVkUGlja3VwKHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5pZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRyb3BvZmZTdG9wcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LmRyb3BvZmZzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRyb3BvZmZTdG9wcy5zcGxpY2UoMCwgMCwgbm9TdG9wKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0RHJvcG9mZlN0b3AoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUcmlwVGltZXMoKSB7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmlkIHx8ICF2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmLmlkKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0VHJpcFRpbWVzRm9yQWR2YW5jZWRSZXNlcnZhdGlvblxyXG4gICAgICAgICAgICAgICAgKHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5pZCwgdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5pZCwgdm0uc2VsZWN0ZWRDb25maWcuc2NoZWR1bGUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5hbGxUcmlwcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS50cmlwVGltZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5hbGxUcmlwcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0udHJpcFRpbWVzLnNwbGljZSgwLCAwLCBub1RyaXBUaW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkVHJpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFNlbGVjdGVkVHJpcCgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnRlbXBsYXRlcy5sZW5ndGggPiAwICYmIHZtLnVzZURlZmF1bHRUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgICAgICAgICAgIGlmICghdGVtcGxhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcudHJpcFRpbWUgPSB2bS50cmlwVGltZXNbMF07XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnRyaXBUaW1lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0udHJpcFRpbWVzW2ldLnRyaXBJZCA9PSB0ZW1wbGF0ZS50cmlwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLnRyaXBUaW1lID0gdm0udHJpcFRpbWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcudHJpcFRpbWUgPSB2bS50cmlwVGltZXNbMF07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWRpcmVjdFRvTG9naW4oKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS9hZHYtc2NoZWR1bGUtc2V0dXAuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNQdWxsaW5nVGV4dCA9ICdSZWZyZXNoIFJlc2VydmF0aW9ucyc7XHJcbiAgICAgICAgdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nIFJlc2VydmF0aW9ucyc7XHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Jlc2VydmF0aW9uTW9kYWxDb250cm9sbGVyJywgUmVzZXJ2YXRpb25Nb2RhbENvbnRyb2xsZXIpO1xyXG5cclxuICAgIFJlc2VydmF0aW9uTW9kYWxDb250cm9sbGVyLiRpbmplY3QgPSBbJyR1aWJNb2RhbEluc3RhbmNlJywncmVzZXJ2YXRpb24nXTtcclxuXHJcbiAgICBmdW5jdGlvbiBSZXNlcnZhdGlvbk1vZGFsQ29udHJvbGxlcigkdWliTW9kYWxJbnN0YW5jZSwgcmVzZXJ2YXRpb24pIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuXHJcbiAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gW3Jlc2VydmF0aW9uXTtcclxuXHJcbiAgICAgICAgdm0uY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdMYXN0TG9jYXRpb25Db250cm9sbGVyJywgTGFzdExvY2F0aW9uQ29udHJvbGxlcik7XHJcblxyXG4gICAgTGFzdExvY2F0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywnU3RvcERhdGFTZXJ2aWNlJywgJyRxJywgJyRodHRwJywgJ2VudicsICd1aUdtYXBJc1JlYWR5JywgJyRzdGF0ZVBhcmFtcycsICckaW50ZXJ2YWwnLCAnJHdpbmRvdycsICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnJHRpbWVvdXQnLCAnJHN0YXRlJywgJ01lc3NhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTGFzdExvY2F0aW9uQ29udHJvbGxlcigkcm9vdFNjb3BlLFN0b3BEYXRhU2VydmljZSwgJHEsICRodHRwLCBlbnYsIHVpR21hcElzUmVhZHksICRzdGF0ZVBhcmFtcywgJGludGVydmFsLCAkd2luZG93LCBHZW9Mb2NhdGlvblNlcnZpY2UsICR0aW1lb3V0LCAkc3RhdGUsIE1lc3NhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdmFyIG15U3R5bGVzID0gW1xyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6IFwicG9pXCIsXHJcbiAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiBcImxhYmVsc1wiLFxyXG4gICAgICAgICAgICAgICBzdHlsZXJzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJvZmZcIiB9XHJcbiAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICB9LFxyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXRcIixcclxuICAgICAgICAgICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy5pY29uXCIsXHJcbiAgICAgICAgICAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2aXNpYmlsaXR5XCI6IFwib2ZmXCJcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IHRydWUsXHJcbiAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3R5bGVzOiBteVN0eWxlc1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBidXNQaW4sIHN0b3BQaW4sIGxvY2F0aW9uUGluLCBteUxvY2F0aW9uUGluLCBwaW5IdWI7XHJcbiAgICAgICAgdmFyIGsgPSAwLjAwMTtcclxuICAgICAgICBpZigkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuICAgICAgICAgICAgYnVzUGluID0gJ2ltYWdlcy9waW4tdmVoaWNsZS1ibHVlLnBuZyc7XHJcbiAgICAgICAgICAgIHN0b3BQaW4gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZXkucG5nJztcclxuICAgICAgICAgICAgbG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1sb2NhdGlvbi5wbmcnO1xyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24ucG5nJztcclxuICAgICAgICAgICAgcGluSHViID0gJ2ltYWdlcy9waW4taHViLnBuZyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBidXNQaW4gPSAnaW1hZ2VzL3Bpbi12ZWhpY2xlLWJsdWUuc3ZnJztcclxuICAgICAgICAgICAgc3RvcFBpbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5zdmcnO1xyXG4gICAgICAgICAgICBsb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLWxvY2F0aW9uLnN2Zyc7XHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5zdmcnO1xyXG4gICAgICAgICAgICBwaW5IdWIgPSAnaW1hZ2VzL3Bpbi1odWIuc3ZnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmh1Ykljb24gPSB7IHVybDogcGluSHViIH07XHJcbiAgICAgICAgdm0ubXlMb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgIHVybDogbXlMb2NhdGlvblBpbixcclxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoNDIsIDQyKSxcclxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIwLCAyMClcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLnRyaXBEZXRhaWxzID0ge1xyXG4gICAgICAgICAgICBidXNOYW1lOiAnJyxcclxuICAgICAgICAgICAgRVRBOiAnJ1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICB2bS5tYXJrZXJFdmVudCA9IHtcclxuICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uIChnTWFya2VyLCBldmVudE5hbWUsIG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgIHZtLnNob3cgPSAhdm0uc2hvd1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgbGF0aXR1ZGU6IDQ3LjYwNDM1NixcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTIyLjMzNjA4MTdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLnpvb20gPSA0O1xyXG4gICAgICAgIHZtLmluY2lkZW50ID0gU3RvcERhdGFTZXJ2aWNlLmdldEluY2lkZW50KCk7XHJcbiAgICAgICAgdm0udmVoaWNsZUlkID0gU3RvcERhdGFTZXJ2aWNlLmdldFZlaGljbGVJZCgpO1xyXG4gICAgICAvLyAgdm0udmVoaWNsZUlkID0gJzEwMyc7XHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0udmVoaWNsZUlkKSB8fCB2bS52ZWhpY2xlSWQgPT0gbnVsbClcclxuICAgICAgICAgICAgdm0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnN0b3AgPSBTdG9wRGF0YVNlcnZpY2UuZ2V0U3RvcCgpIHx8IG51bGw7XHJcbiAgICAgICAgaWYgKHZtLnN0b3AgIT0gbnVsbCAmJiB2bS5zdG9wLmxhdGl0dWRlICE9IHVuZGVmaW5lZCAmJiB2bS5zdG9wLmxhdGl0dWRlICE9IG51bGwpXHJcbiAgICAgICAgICAgIHZtLnN0b3AuaWNvbiA9IHsgdXJsOiBzdG9wUGluIH07XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB2bS5zdG9wID0gbnVsbDtcclxuICAgICAgICB2bS52ZWhpY2xlID0ge307XHJcbiAgICAgICAgdm0ubXlMb2NhdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2bS5idXNMb2NhdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgIFxyXG4gICAgICAgIHZtLmh1YnMgPSBbXTtcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgaWYgKHZtLmluY2lkZW50KSB7XHJcbiAgICAgICAgICAgIC8vY2hlY2sgZm9yIC12ZSBpbiBzdHJpbmcgYW5kIHNheSBhZ28gb3IgaW5cclxuICAgICAgICAgICAgdm0udHJpcERldGFpbHMuRVRBID0gKHZtLmluY2lkZW50LkVzdGltYXRlZFRpbWVTdHJpbmcuaW5kZXhPZignLScpID4gLTEgPyAnRGVwYXJ0ZWQgJyA6ICcnKSArIHZtLmluY2lkZW50LkVzdGltYXRlZFRpbWVTdHJpbmcucmVwbGFjZSgnLScsICcnKSArICcgbWluJyArICh2bS5pbmNpZGVudC5Fc3RpbWF0ZWRUaW1lU3RyaW5nLmluZGV4T2YoJy0nKSA+IC0xID8gJyBhZ28nIDogJycpO1xyXG4gICAgICAgICAgICB2bS50cmlwRGV0YWlscy5idXNOYW1lID0gKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmluY2lkZW50LlRoZVZlaGljbGUpICYmIHZtLmluY2lkZW50LlRoZVZlaGljbGUgIT0gbnVsbCkgPyB2bS5pbmNpZGVudC5UaGVWZWhpY2xlLlZlaGljbGVOYW1lIDogJyc7XHJcbiAgICAgICAgICAgIHZtLnNjaGVkVHlwZSA9IHZtLmluY2lkZW50LkFNUE07XHJcbiAgICAgICAgICAgIGlmICh2bS5pbmNpZGVudC5JbmNpZGVudEh1YnMgJiYgdm0uaW5jaWRlbnQuSW5jaWRlbnRIdWJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5pbmNpZGVudC5JbmNpZGVudEh1YnMsIGZ1bmN0aW9uIChodWIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaHViLmxhdGl0dWRlICE9IDAgJiYgaHViLmxvbmdpdHVkZSAhPSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5odWJzLnB1c2goaHViKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1hcCgpIHtcclxuICAgICAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFN0b3BEYXRhU2VydmljZS5nZXRWZWhpY2xlKHZtLnZlaGljbGVJZClcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdTb3JycnkhIE1hcCBjb3VsZCBub3QgYmUgbG9hZGVkLicpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh2ZWhpY2xlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5idXNMb2NhdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcGFyc2VGbG9hdCh2ZWhpY2xlLmRhdGEuTURDLkxhc3RMYXRpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBwYXJzZUZsb2F0KHZlaGljbGUuZGF0YS5NREMuTGFzdExvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogeyB1cmw6IGJ1c1BpbiB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksICdyZXNpemUnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNldE1hcCgpXHJcbiAgICAgICAgICAgICAgICB9LCA1MCk7XHJcblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNldE1hcCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgNTApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vLnRoZW4oZnVuY3Rpb24gKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIC8vICAgICB2bS5teUxvY2F0aW9uID0ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgY29vcmRzOiB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgbGF0aXR1ZGU6cG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIGxvbmdpdHVkZTogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAvLyAgICAgICAgfSxcclxuICAgICAgICAgICAgLy8gICAgICAgIGljb246IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgIC8vICAgICB9O1xyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCAncmVzaXplJyk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgcmVzZXRNYXAoKVxyXG4gICAgICAgICAgICAvLyAgICAgfSwgNTApO1xyXG4gICAgICAgICAgICAvL30sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgLy8gICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgcmVzZXRNYXAoKTtcclxuICAgICAgICAgICAgLy8gICAgfSwgNTApO1xyXG4gICAgICAgICAgICAvL30pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICBnZXRNYXAoKTtcclxuXHJcbiAgICAgICAgICAgIHZtLnByb21pc2UgPSAkaW50ZXJ2YWwodXBkYXRlVmVoaWNsZVBvc2l0aW9uLCAxNTAwMCk7XHJcbiAgICAgICB9XHJcblxyXG4gICAgICAgdm0uJG9uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHZtLnByb21pc2UpO1xyXG4gICAgICAgfTtcclxuICAgICAgIGZ1bmN0aW9uIHJlc2V0TWFwKCkge1xyXG4gICAgICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgaWYgKHZtLnNjaGVkVHlwZSA9PSAnQU0nKSB7XHJcbiAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5zdG9wKSAmJiB2bS5zdG9wICE9IG51bGwgJiYgdm0uc3RvcC5sYXRpdHVkZSAhPSBudWxsICYmIHZtLnN0b3AubGF0aXR1ZGUgIT0gMClcclxuICAgICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5zdG9wLmxhdGl0dWRlLCB2bS5zdG9wLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgICBpZiAodm0uYnVzTG9jYXRpb24gIT0gbnVsbCAmJiB2bS5idXNMb2NhdGlvbi5sYXRpdHVkZSAhPSBudWxsICYmIHZtLmJ1c0xvY2F0aW9uLmxhdGl0dWRlICE9IDApXHJcbiAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5idXNMb2NhdGlvbi5sYXRpdHVkZSwgdm0uYnVzTG9jYXRpb24ubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICAgaWYgKHZtLnNjaGVkVHlwZSA9PSAnUE0nKSB7XHJcbiAgICAgICAgICAgICAgIGlmICh2bS5odWJzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5odWJzLCBmdW5jdGlvbiAoaHViKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGh1Yi5sYXRpdHVkZSwgaHViLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICB9XHJcbiAgICAgICAgICAgaWYgKCFib3VuZHMuaXNFbXB0eSgpKSB7XHJcbiAgICAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5zZXRab29tKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmdldFpvb20oKSAtIDEpO1xyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgICAvL2lmICh2bS5idXNMb2NhdGlvbiAhPSBudWxsICYmIHZtLmJ1c0xvY2F0aW9uLmxhdGl0dWRlICE9IG51bGwgJiYgdm0uYnVzTG9jYXRpb24ubGF0aXR1ZGUgIT0gMCkge1xyXG4gICAgICAgICAgIC8vICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAvLyAgICAgICAgbGF0aXR1ZGU6IHZtLmJ1c0xvY2F0aW9uLmxhdGl0dWRlLFxyXG4gICAgICAgICAgIC8vICAgICAgICBsb25naXR1ZGU6IHZtLmJ1c0xvY2F0aW9uLmxvbmdpdHVkZVxyXG4gICAgICAgICAgIC8vICAgIH07XHJcbiAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgfVxyXG5cclxuICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZlaGljbGVQb3NpdGlvbigpIHtcclxuICAgICAgICAgICBpZigkc3RhdGUuY3VycmVudC5uYW1lICE9ICdsYXN0LWxvY2F0aW9uJylcclxuICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwodm0ucHJvbWlzZSk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2UuZ2V0VmVoaWNsZSh2bS52ZWhpY2xlSWQpLnRoZW4oZnVuY3Rpb24gKHZlaGljbGUpIHtcclxuICAgICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZCh2ZWhpY2xlLmRhdGEuTURDKSAmJiB2ZWhpY2xlLmRhdGEuTURDICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB2bS5idXNMb2NhdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHBhcnNlRmxvYXQodmVoaWNsZS5kYXRhLk1EQy5MYXN0TGF0aXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHBhcnNlRmxvYXQodmVoaWNsZS5kYXRhLk1EQy5MYXN0TG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogeyB1cmw6IGJ1c1BpbiB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIC8vdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICAgICAgICAgLy8gICAgbGF0aXR1ZGU6IHBhcnNlRmxvYXQodmVoaWNsZS5kYXRhLk1EQy5MYXN0TGF0aXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgLy8gICAgbG9uZ2l0dWRlOiBwYXJzZUZsb2F0KHZlaGljbGUuZGF0YS5NREMuTGFzdExvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAvL307XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwodm0ucHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgIH1cclxuICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9jb21tdXRlci9sb2NhdGlvbi9sYXN0LWxvY2F0aW9uLmh0bWwnO1xyXG4gICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiAgICB9XHJcblxyXG4gICAgXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcblx0J3VzZSBzdHJpY3QnO1xyXG5cclxuXHRhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdMb2NhdGlvblNlcnZpY2UnLCBMb2NhdGlvblNlcnZpY2UpO1xyXG5cclxuXHRMb2NhdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnXTtcclxuXHJcblx0ZnVuY3Rpb24gTG9jYXRpb25TZXJ2aWNlKCRodHRwLCAkcSkge1xyXG5cclxuXHRcdHZhciBzZXJ2aWNlID0ge1xyXG5cdFx0XHRnZXRMb2NhdGlvbjogZ2V0TG9jYXRpb25Gcm9tR29vZ2xlLFxyXG5cdFx0XHRnZXREcml2aW5nRGlzdGFuY2VzOiBnZXREcml2aW5nRGlzdGFuY2VzXHJcblxyXG5cdFx0fTtcclxuXHJcblx0XHRmdW5jdGlvbiBnZXREcml2aW5nRGlzdGFuY2VzKHBvc2l0aW9uLCBkZXN0aW5hdGlvbnMpIHtcclxuXHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHRcdFx0dmFyIGRlc3RzID0gW107XHJcblx0XHRcdGFuZ3VsYXIuZm9yRWFjaChkZXN0aW5hdGlvbnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XHJcblx0XHRcdFx0ZGVzdHMucHVzaCh7ICdsYXQnOiB2YWx1ZS5sYXRpdHVkZSwgJ2xuZyc6IHZhbHVlLmxvbmdpdHVkZSB9KTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHR2YXIgc2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXN0YW5jZU1hdHJpeFNlcnZpY2U7XHJcblx0XHRcdHNlcnZpY2UuZ2V0RGlzdGFuY2VNYXRyaXgoe1xyXG5cdFx0XHRcdG9yaWdpbnM6IFt7ICdsYXQnOiBwb3NpdGlvbi5sYXRpdHVkZSwgJ2xuZyc6IHBvc2l0aW9uLmxvbmdpdHVkZSB9XSxcclxuXHRcdFx0XHRkZXN0aW5hdGlvbnM6IGRlc3RzLFxyXG5cdFx0XHRcdHRyYXZlbE1vZGU6ICdEUklWSU5HJyxcclxuXHRcdFx0XHR1bml0U3lzdGVtOiBnb29nbGUubWFwcy5Vbml0U3lzdGVtLk1FVFJJQyxcclxuXHRcdFx0XHRhdm9pZEhpZ2h3YXlzOiBmYWxzZSxcclxuXHRcdFx0XHRhdm9pZFRvbGxzOiBmYWxzZVxyXG5cdFx0XHR9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xyXG5cdFx0XHRcdGlmIChzdGF0dXMgIT09ICdPSycpIHtcclxuXHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdCgnQ2Fubm90IGNhbGN1bGF0ZSBkaXN0YW5jZScpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcblx0XHR9XHJcblxyXG5cclxuXHRcdGZ1bmN0aW9uIGdldExvY2F0aW9uRnJvbUdvb2dsZShzZWFyY2hUZXJtKSB7XHJcblx0XHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblx0XHRcdC8vJGh0dHAuZ2V0KCdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uJywge1xyXG5cdFx0XHQvLyAgICBwYXJhbXM6IHtcclxuXHRcdFx0Ly8gICAgICAgIGFkZHJlc3M6IHNlYXJjaFRlcm0sXHJcblx0XHRcdC8vICAgICAgICBzZW5zb3I6IHRydWUsXHJcblx0XHRcdC8vICAgICAgICBrZXk6ICdBSXphU3lDQTVqVmZhN3NKazdPWVJfZFViVHNackdKQTdFMUFkdUknXHJcblx0XHRcdC8vICAgIH1cclxuXHRcdFx0Ly99KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG5cdFx0XHQvLyAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHRcdFx0Ly99LCBmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdC8vICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG5cdFx0XHQvL30pO1xyXG5cdFx0XHQvL3JldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuXHJcblxyXG5cdFx0XHR2YXIgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXI7XHJcblx0XHRcdHZhciBhZGRyZXNzID0gc2VhcmNoVGVybTtcclxuXHJcblx0XHRcdGlmIChnZW9jb2Rlcikge1xyXG5cdFx0XHRcdGdlb2NvZGVyLmdlb2NvZGUoeyAnYWRkcmVzcyc6IGFkZHJlc3MgfSwgZnVuY3Rpb24gKHJlc3VsdHMsIHN0YXR1cykge1xyXG5cdFx0XHRcdFx0aWYgKHN0YXR1cyA9PSBnb29nbGUubWFwcy5HZW9jb2RlclN0YXR1cy5PSykge1xyXG5cdFx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdHMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdChzdGF0dXMpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZVxyXG5cdFx0XHRcdGRlZmVycmVkLnJlamVjdCgnR2VvY29kZXIgc2VydmljZSBub3QgYXZhaWxhYmxlJyk7XHJcblx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuXHJcblx0XHR9XHJcblxyXG5cclxuXHJcblx0XHRyZXR1cm4gc2VydmljZTtcclxuXHJcblx0fVxyXG5cclxuXHJcblxyXG5cclxufSkoKTtcclxuXHJcblxyXG5cclxuXHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTWVzc2FnZUNvbnRyb2xsZXInLCBNZXNzYWdlQ29udHJvbGxlcik7XHJcblxyXG4gICAgTWVzc2FnZUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ21lc3NhZ2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNZXNzYWdlQ29udHJvbGxlcigkbG9jYXRpb24sICR1aWJNb2RhbEluc3RhbmNlLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9IG1lc3NhZ2UudHlwZTtcclxuICAgICAgICB2bS5jb250ZW50ID0gbWVzc2FnZS5tZXNzYWdlO1xyXG5cclxuICAgICAgICB2bS5pc0Vycm9yID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNJbmZvID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNTdWNjZXNzID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc3dpdGNoIChtZXNzYWdlLnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnRXJyb3InOlxyXG4gICAgICAgICAgICAgICAgdm0uaXNFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnSW5mb3JtYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgdm0uaXNJbmZvID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdTdWNjZXNzJzpcclxuICAgICAgICAgICAgICAgIHZtLmlzU3VjY2VzcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnTWVzc2FnZVNlcnZpY2UnLCBNZXNzYWdlU2VydmljZSk7XHJcblxyXG4gICAgTWVzc2FnZVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHVpYk1vZGFsJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTWVzc2FnZVNlcnZpY2UoJGh0dHAsICR1aWJNb2RhbCkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzaG93RXJyb3I6IHNob3dFcnJvcixcclxuICAgICAgICAgICAgc2hvd0luZm9ybWF0aW9uOiBzaG93SW5mb3JtYXRpb24sXHJcbiAgICAgICAgICAgIHNob3dTdWNjZXNzOiBzaG93U3VjY2Vzc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93RXJyb3IobWVzc2FnZSkge1xyXG4gICAgICAgICAgICBzaG93TWVzc2FnZShtZXNzYWdlLCAnRXJyb3InKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd0luZm9ybWF0aW9uKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgc2hvd01lc3NhZ2UobWVzc2FnZSwgJ0luZm9ybWF0aW9uJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dTdWNjZXNzKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgc2hvd01lc3NhZ2UobWVzc2FnZSwgJ1N1Y2Nlc3MnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dNZXNzYWdlKG1lc3NhZ2VUb0Rpc3BsYXksIHR5cGUpIHtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2VPYmogPSB7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlVG9EaXNwbGF5LFxyXG4gICAgICAgICAgICAgICAgdHlwZTogdHlwZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxSZXNlcnZlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tZXNzYWdlL21lc3NhZ2UuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTWVzc2FnZUNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZU9ialxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbW9kYWxSZXNlcnZlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTXlWZWhpY2xlc0NvbnRyb2xsZXInLCBNeVZlaGljbGVzQ29udHJvbGxlcik7XHJcblxyXG4gICAgTXlWZWhpY2xlc0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsICckdWliTW9kYWwnLCAnYXV0aFNlcnZpY2UnLCAndmVoaWNsZVNlcnZpY2UnLCAnTWVzc2FnZVNlcnZpY2UnLCdMdXVtTGlua2VkU2VydmljZScsICdQYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE15VmVoaWNsZXNDb250cm9sbGVyKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJHVpYk1vZGFsLCBhdXRoU2VydmljZSwgdmVoaWNsZVNlcnZpY2UsIE1lc3NhZ2VTZXJ2aWNlLCBMdXVtTGlua2VkU2VydmljZSwgUGFnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciBwYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG5cclxuICAgICAgICB2bS52ZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgIHZtLnZlaGljbGVJbmZvID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlzUmVtb3ZpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdNeSBWZWhpY2xlcycpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdNYW5hZ2UgVmVoaWNsZXMnKTtcclxuXHJcbiAgICAgICAgdm0uYWRkTmV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxSZXNlcnZlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvYWRkLXZlaGljbGUtbW9kYWwvYWRkLXZlaGljbGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQWRkVmVoaWNsZUNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF0bGVhc3RPbmVWZWhpY2xlRXhpc3Q6IHZtLnZlaGljbGVzLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1vZGFsUmVzZXJ2ZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHQuaXNBZGRlZClcclxuICAgICAgICAgICAgICAgICAgICBnZXRWZWhpY2xlcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLnJlbW92ZSA9IGZ1bmN0aW9uIChpZCwgaW5kZXgpIHtcclxuICAgICAgICAgICAgaWYgKGlkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVtb3ZlVmVoaWNsZUNvbmZpcm1hdGlvbiA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVtb3ZlLXZlaGljbGUtbW9kYWwvcmVtb3ZlLXZlaGljbGUtY29uZmlybWF0aW9uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZW1vdmVWZWhpY2xlQ29uZmlybWF0aW9uQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVWZWhpY2xlQ29uZmlybWF0aW9uLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJlbW92ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihyZXN1bHQuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBMdXVtTGlua2VkU2VydmljZS52ZXJpZnkoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQpO1xyXG4gICAgICAgICAgICBnZXRWZWhpY2xlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ubWFrZURlZmF1bHQgPSBmdW5jdGlvbiAodklkLCBpbmRleCkge1xyXG4gICAgICAgICAgICB2ZWhpY2xlU2VydmljZS5tYXJrRGVmYXVsdCh2SWQsIHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsgXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICBnZXRWZWhpY2xlcygpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKGVycm9yLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGdldFZlaGljbGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2ZWhpY2xlU2VydmljZS5nZXRWZWhpY2xlc0ZvclBhc3NlbmdlcihwYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5wYXNzZW5nZXJWZWhpY2xlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB2bS52ZWhpY2xlcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnZlaGljbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFZlaGljbGUgPSB2bS52ZWhpY2xlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5oYXNWZWhpY2xlcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubmVlZHNQYXJraW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZtLmhhc1ZlaGljbGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbXktdmVoaWNsZXMvbXktdmVoaWNsZXMuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaXMtbXlWZWhpY2xlcyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljUHVsbGluZ1RleHQgPSAnUmVmcmVzaCBWZWhpY2xlcyc7XHJcbiAgICAgICAgdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nIFZlaGljbGVzJztcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLnJlZnJlc2ggPSBmdW5jdGlvbiAocmVmcmVzaGVyKSB7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnZlaGljbGVzID0gW107XHJcbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICBcclxuXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgndmVoaWNsZVNlcnZpY2UnLCB2ZWhpY2xlU2VydmljZSk7XHJcblxyXG4gICAgdmVoaWNsZVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCckcScsJ2VudicsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIHZlaGljbGVTZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgc2F2ZTogc2F2ZVZlaGljbGUsXHJcbiAgICAgICAgICAgIGdldFZlaGljbGVzRm9yUGFzc2VuZ2VyOiBnZXRWZWhpY2xlcyxcclxuICAgICAgICAgICAgcmVtb3ZlVmVoaWNsZTogZGVhY3RpdmF0ZVZlaGljbGUsXHJcbiAgICAgICAgICAgIGNhblBhcms6IGdldEF2YWlsYWJsZVBhcmtpbmdGb3JTdG9wLFxyXG4gICAgICAgICAgICBtYXJrRGVmYXVsdCA6bWFya0RlZmF1bHRcclxuICAgICAgICB9OyAgICAgICAgXHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRWZWhpY2xlcyhwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoeyBtZXRob2Q6ICdHRVQnLCAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3Bhc3NlbmdlcnMvJyArIHBhc3NlbmdlcklkICsgJy92ZWhpY2xlcycgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycjsgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZVZlaGljbGUodmVoaWNsZUluZm8sIHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7IGRhdGE6IHZlaGljbGVJbmZvLCBtZXRob2Q6ICdQT1NUJywgJ3VybCc6IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci9wYXNzZW5nZXJzLycgKyBwYXNzZW5nZXJJZCArICcvdmVoaWNsZXMnIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZWFjdGl2YXRlVmVoaWNsZSh2ZWhpY2xlSWQscGFzc2VuZ2VySWQpIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHsgbWV0aG9kOiAnUFVUJywgJ3VybCc6IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci9wYXNzZW5nZXJzLycgKyBwYXNzZW5nZXJJZCArICcvdmVoaWNsZXMnICsgJy8nICsgdmVoaWNsZUlkICsgJy9kZWFjdGl2YXRlJyB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07ICAgICAgIFxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXJrRGVmYXVsdCh2ZWhpY2xlSWQscGFzc2VuZ2VySWQpIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHsgbWV0aG9kOiAnUFVUJywgJ3VybCc6IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci9wYXNzZW5nZXJzLycgKyBwYXNzZW5nZXJJZCArICcvdmVoaWNsZXMnICsgJy8nICsgdmVoaWNsZUlkICsgJy9tYXJrRGVmYXVsdCcgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJyO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvL21vdmUgdGhpcyBvdXQgd2hpbGUgd29ya2luZyBvbiBzZWxlY3RlZCBzdG9wIHBhZ2VcclxuICAgICAgICBmdW5jdGlvbiBnZXRBdmFpbGFibGVQYXJraW5nRm9yU3RvcChzdG9wSWQsIHJlc2VydmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci9zdG9wcy8nICsgc3RvcElkICsgJy9hdmFpbGFibGVQYXJraW5nLycgKyByZXNlcnZhdGlvbkRhdGU7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdQdWJsaXNoZWRTY2hlZHVsZUNvbnRyb2xsZXInLCBQdWJsaXNoZWRTY2hlZHVsZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFB1Ymxpc2hlZFNjaGVkdWxlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJ1B1Ymxpc2hlZFNjaGVkdWxlU2VydmljZScsICckdWliTW9kYWwnLCAnU3RvcERhdGFTZXJ2aWNlJyxcclxuICAgICAgICAnTWVzc2FnZVNlcnZpY2UnLCAnJGZpbHRlcicsICckYW5jaG9yU2Nyb2xsJywgJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFB1Ymxpc2hlZFNjaGVkdWxlQ29udHJvbGxlcigkc2NvcGUsICRsb2NhdGlvbiwgUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlLCAkdWliTW9kYWwsIFN0b3BEYXRhU2VydmljZSxcclxuICAgICAgICBNZXNzYWdlU2VydmljZSwgJGZpbHRlciwgJGFuY2hvclNjcm9sbCwgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ1B1Ymxpc2hlZCBTY2hlZHVsZScpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCkuYWxpYXMpO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICB2YXIgZGQgPSB0b2RheS5nZXREYXRlKCk7XHJcbiAgICAgICAgdmFyIG1tID0gdG9kYXkuZ2V0TW9udGgoKSArIDE7XHJcbiAgICAgICAgdmFyIHl5eXkgPSB0b2RheS5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgIHZtLmRhdGUgPSBtbSArICcvJyArIGRkICsgJy8nICsgeXl5eTtcclxuICAgICAgICB2bS5zY2hlZHVsZUJsb2NrID0gW107XHJcbiAgICAgICAgdm0ucHVibGljU2NoZWR1bGUgPSBbXTtcclxuICAgICAgICB2bS5hbGxTY2hkZXVsZUZvclN0b3AgPSBbXTtcclxuICAgICAgICB2bS5zdG9wc0xhdExvbmcgPSBbXTtcclxuICAgICAgICB2bS5pbmNpZGVudFJlY29yZHMgPSBbXTtcclxuICAgICAgICB2bS5mdXR1cmVSb3V0ZXMgPSBbXTtcclxuICAgICAgICB2bS50dXJuTGF0TG9uZyA9IFtdO1xyXG4gICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgdm0uc2VhcmNoQnkgPSBcIiRcIjtcclxuICAgICAgICB2bS5zZWxlY3RlZFJvdXRlID0gU3RvcERhdGFTZXJ2aWNlLmdldFJvdXRlKCk7XHJcblxyXG4gICAgICAgIHZtLmdldERyb3BPZmZQaWNrVXBDbGFzcyA9IGdldERyb3BPZmZQaWNrVXBDbGFzcztcclxuXHJcblxyXG4gICAgICAgIFB1Ymxpc2hlZFNjaGVkdWxlU2VydmljZS5nZXRTY2hlZHVsZXModm0uZGF0ZSlcclxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdm0uaW5jaWRlbnRSZWNvcmRzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucm91dGVzO1xyXG4gICAgICAgICAgICB2bS5maWx0ZXJDaGFuZ2UoKTtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoJ1NvcnJ5ISBDb3VsZCBub3QgbG9hZCB0aGUgc2NoZWR1bGVzIScpO1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlLmdldFVwQ29taW5nU2NoZWR1bGVzKHZtLmRhdGUpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHZtLmZ1dHVyZVJvdXRlcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vZmlsdGVyIHVzZXJzIGJhc2VkIG9uIHNlYXJjaCByZXN1bHRcclxuICAgICAgICB2bS5maWx0ZXJDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWFyY2hUZXh0ICE9ICcnICYmIHZtLnNlYXJjaFRleHQgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VyY2hUZXJtID0gJ3sgXCInICsgdm0uc2VhcmNoQnkgKyAnXCIgOiBcIicgKyB2bS5zZWFyY2hUZXh0ICsgJ1wiIH0nO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlcmNoVGVybU9iaiA9IEpTT04ucGFyc2Uoc2VyY2hUZXJtKTtcclxuICAgICAgICAgICAgICAgIHZtLmZpbHRlckluY2lkZW50cyA9ICRmaWx0ZXIoJ2ZpbHRlcicpKHZtLmluY2lkZW50UmVjb3Jkcywgc2VyY2hUZXJtT2JqKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJJbmNpZGVudHMgPSB2bS5pbmNpZGVudFJlY29yZHM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHNvcnRSb3V0ZXMoKTtcclxuICAgICAgICAgICAgc29ydEFycml2YWxzKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRSb3V0ZSAhPSBudWxsICYmIHZtLnNlbGVjdGVkUm91dGUucm91dGVJZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV3SGFzaCA9IHZtLnNlbGVjdGVkUm91dGUucm91dGVJZDtcclxuICAgICAgICAgICAgICAgIGlmICgkbG9jYXRpb24uaGFzaCgpICE9PSBuZXdIYXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSAkbG9jYXRpb24uaGFzaCB0byBgbmV3SGFzaGAgYW5kXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gJGFuY2hvclNjcm9sbCB3aWxsIGF1dG9tYXRpY2FsbHkgc2Nyb2xsIHRvIGl0XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLmhhc2gobmV3SGFzaCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbGwgJGFuY2hvclNjcm9sbCgpIGV4cGxpY2l0bHksXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc2luY2UgJGxvY2F0aW9uLmhhc2ggaGFzbid0IGNoYW5nZWRcclxuICAgICAgICAgICAgICAgICAgICAkYW5jaG9yU2Nyb2xsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzb3J0Um91dGVzKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uaW5jaWRlbnRSZWNvcmRzKVxyXG4gICAgICAgICAgICAgICAgdm0uaW5jaWRlbnRSZWNvcmRzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGEubG9uZ05hbWUudG9Mb3dlckNhc2UoKSA+IGIubG9uZ05hbWUudG9Mb3dlckNhc2UoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogKChiLmxvbmdOYW1lLnRvTG93ZXJDYXNlKCkgPiBhLmxvbmdOYW1lLnRvTG93ZXJDYXNlKCkpID8gLTEgOiAwKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc29ydEFycml2YWxzKCkge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uaW5jaWRlbnRSZWNvcmRzLCBmdW5jdGlvbiAocm91dGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyb3V0ZS5zdG9wcylcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocm91dGUuc3RvcHMsIGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdG9wLmFycml2YWxzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcC5hcnJpdmFscy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudChhLCAnaDptbSBhJykuaXNBZnRlcihtb21lbnQoYiwgJ2g6bW0gYScpKSA/IDEgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb21lbnQoYSwgJ2g6bW0gYScpLmlzQmVmb3JlKG1vbWVudChiLCAnaDptbSBhJykpID8gLTEgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0ubmF2aWdhdGVUb1N0b3AgPSBmdW5jdGlvbiAoc2VsZWN0ZWRTdG9wKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRTdG9wLmlzSHViKSByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RvcCA9IHtcclxuICAgICAgICAgICAgICAgICduYW1lJzogc2VsZWN0ZWRTdG9wLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAnaWQnOiBzZWxlY3RlZFN0b3Auc3RvcElkLFxyXG4gICAgICAgICAgICAgICAgJ2Rpc3RhbmNlJzogbnVsbCxcclxuICAgICAgICAgICAgICAgICdpY29uJzogJ2ltYWdlcy9waW4tYnVzc3RvcC5zdmcnLFxyXG4gICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogc2VsZWN0ZWRTdG9wLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgJ2xvbmdpdHVkZSc6IHNlbGVjdGVkU3RvcC5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAnYWRkcmVzcyc6IHNlbGVjdGVkU3RvcC5hZGRyZXNzXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKHN0b3ApO1xyXG4gICAgICAgICAgICB2YXIgbG9jYXRpb25JY29uID0ge1xyXG4gICAgICAgICAgICAgICAgdXJsOiAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5zdmcnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZtLnBvc2l0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgXCJjb29yZHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgIFwibGF0aXR1ZGVcIjogc2VsZWN0ZWRTdG9wLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIFwibG9uZ2l0dWRlXCI6IHNlbGVjdGVkU3RvcC5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBcImljb25cIjogbG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIC8vaWYgKHZtLnBvc2l0aW9uICE9IHVuZGVmaW5lZCAmJiB2bS5wb3NpdGlvbiAhPSBudWxsKVxyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0R2VvTG9jYXRpb24odm0ucG9zaXRpb24pXHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY29tbXV0ZXIvc2VsZWN0ZWQtc3RvcCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmdldE1hcCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG5cclxuICAgICAgICAgICAgdm0uc3RvcHNMYXRMb25nID0gdm0uZmlsdGVySW5jaWRlbnRzW2luZGV4XTtcclxuXHJcbiAgICAgICAgICAgIFB1Ymxpc2hlZFNjaGVkdWxlU2VydmljZS5nZXRUdXJuTGF0TG5ncyh2bS5zdG9wc0xhdExvbmcuaWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlRGF0YSA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAvL2lmIChyb3V0ZURhdGEuUm91dGVEaXIxLlZlcnRpY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vICAgIHZtLnR1cm5MYXRMb25nID0gcm91dGVEYXRhLlJvdXRlRGlyMS5WZXJ0aWNlc1xyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAvL2Vsc2VcclxuICAgICAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAgICAgLy8gICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdTb3JyeSEgQ291bGQgbm90IGxvYWQgdGhlIG1hcCwgY2Fubm90IGZpbmQgdGhlIHN0b3BzLicpO1xyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICBtYXBQYWdlKHJvdXRlRGF0YSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmdldEZ1dHVyZVJvdXRlTWFwID0gZnVuY3Rpb24gKHJvdXRlKSB7XHJcblxyXG4gICAgICAgICAgICB2bS5zdG9wc0xhdExvbmcgPSByb3V0ZTtcclxuXHJcbiAgICAgICAgICAgIFB1Ymxpc2hlZFNjaGVkdWxlU2VydmljZS5nZXRUdXJuTGF0TG5ncyh2bS5zdG9wc0xhdExvbmcuUm91dGVJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGVEYXRhID0gcmVzcG9uc2UuZGF0YTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy9lbHNlXHJcbiAgICAgICAgICAgICAgICAvL3tcclxuICAgICAgICAgICAgICAgIC8vICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignU29ycnkhIENvdWxkIG5vdCBsb2FkIHRoZSBtYXAsIGNhbm5vdCBmaW5kIHRoZSBzdG9wcy4nKTtcclxuICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgbWFwUGFnZShyb3V0ZURhdGEpO1xyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXBQYWdlKHJvdXRlRGF0YSkge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxHZXRNYXAgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ21hcC1tb2RhbCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9zdG9wcy1tYXAtbW9kYWwvc3RvcHMtbWFwLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1N0b3BzTWFwQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZV9zdG9wczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm0uc3RvcHNMYXRMb25nO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcm91dGVEYXRhOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9kYWxHZXRNYXAucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGlzRG9uZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzRG9uZSkge1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7IH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RHJvcE9mZlBpY2tVcENsYXNzKGlzQU0sIGlzSHViKSB7XHJcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWU7XHJcbiAgICAgICAgICAgIGlmIChpc0FNKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNIdWIpXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ2Ryb3BvZmYnO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9ICdwaWNrdXAnO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzSHViKVxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9ICdwaWNrdXAnO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSA9ICdkcm9wb2ZmJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFJvdXRlKG51bGwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL2NvbW11dGVyL3B1Ymxpc2hlZC1zY2hlZHVsZS9wdWJsaXNoZWQtc2NoZWR1bGUuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNQdWxsaW5nVGV4dCA9ICdSZWZyZXNoIFNjaGVkdWxlJztcclxuICAgICAgICB2bS5pb25pY1JlZnJlc2hpbmdUZXh0ID0gJ0xvYWRpbmcgU2NoZWR1bGUnO1xyXG4gICAgICAgIHZtLmlvbmljU3Bpbm5lciA9ICdzcGlyYWwnOyAvLyBub25lIHRvIGRpc2FibGUuXHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcblxyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdQdWJsaXNoZWRTY2hlZHVsZVNlcnZpY2UnLCBQdWJsaXNoZWRTY2hlZHVsZVNlcnZpY2UpO1xyXG5cclxuICAgIFB1Ymxpc2hlZFNjaGVkdWxlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnLCdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBQdWJsaXNoZWRTY2hlZHVsZVNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXRTY2hlZHVsZXM6IGdldFNjaGVkdWxlcyxcclxuICAgICAgICAgICAgZ2V0SW5jaWRlbnRzOiBnZXRJbmNpZGVudHMsXHJcbiAgICAgICAgICAgIGdldEFsbFNjaGVkdWxlRm9yU3RvcDogZ2V0QWxsU2NoZWR1bGVGb3JTdG9wLFxyXG4gICAgICAgICAgICBnZXRUdXJuTGF0TG5nczogZ2V0VHVybkxhdExuZ3MsXHJcbiAgICAgICAgICAgIGdldFVwQ29taW5nU2NoZWR1bGVzOiBnZXRVcENvbWluZ1NjaGVkdWxlc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTY2hlZHVsZXMoZGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zY2hlZHVsZS9wdWJsaXNoZWQnO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VXBDb21pbmdTY2hlZHVsZXMoZGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zY2hlZHVsZS91cGNvbWluZyc7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRUdXJuTGF0TG5ncyhyb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZGaXhlZFJvdXRlQXBpVXJsICsgJ3JvdXRlL3NoYXBlc0J5Um91dGUvJyArIHJvdXRlSWQgKyAnLzIwNic7Ly8gKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0SW5jaWRlbnRzKGJsb2NrSWQsIG1pbkluY0lkLCBpbmNDb3VudCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgaW5jbHVkZVN0b3BzID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdjb21tb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2luY2lkZW50cy8nICsgYmxvY2tJZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbFNjaGVkdWxlRm9yU3RvcChzdG9wSWQsIHJvdXRlSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHJvdXRlSWQgPSAwO1xyXG4gICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ2NvbW1vbi8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvc3RvcC8nICsgc3RvcElkICsgJz9Sb3V0ZUlkPScgKyByb3V0ZUlkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTY2hlZHVsZUNvbnRyb2xsZXInLCBTY2hlZHVsZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFNjaGVkdWxlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHN0YXRlUGFyYW1zJywgJyR1aWJNb2RhbCcsXHJcbiAgICAgICAgJ1NjaGVkdWxlU2VydmljZScsICdlbnYnLCAnU3RvcERhdGFTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gU2NoZWR1bGVDb250cm9sbGVyKCRsb2NhdGlvbiwgJHN0YXRlUGFyYW1zLCAkdWliTW9kYWwsXHJcbiAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLCBlbnYsIFN0b3BEYXRhU2VydmljZSwgdWlHbWFwSXNSZWFkeSwgUmVzZXJ2YXRpb25TZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS51c2VySWQgPSAnYjFjNTdkZjMtNzYwNC00N2ViLWJmNTEtMzE3MzMyYTlmNmEwJyAvL2hhcmQtY29kaW5nLiBXYWl0aW5nIGZvciBzb2NpYWwgbG9naW4gdGFzayB0byBnZXQgb3ZlclxyXG5cclxuICAgICAgICAvL2RlZmF1bHQgdmFsdWVzIHNldC11cFxyXG4gICAgICAgIHZtLlNjaGVkdWxlVHlwZSA9IFwiQU1cIjtcclxuXHJcbiAgICAgICAgLy9mdW5jdGlvbnMgZXhwb3NlZCB0byB2aWV3XHJcbiAgICAgICAgdm0ucmVzZXJ2ZSA9IHJlc2VydmU7XHJcbiAgICAgICAgdm0uY2FuY2VsUmVzZXJ2YXRpb24gPSBjYW5jZWxSZXNlcnZhdGlvbjtcclxuICAgICAgICB2bS5jaGFuZ2VTY2hlZHVsZSA9IGNoYW5nZVNjaGVkdWxlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vdm0uc2VsZWN0ZWRTdG9wID0gU3RvcERhdGFTZXJ2aWNlLmdldFN0b3AoKTtcclxuICAgICAgICB2bS5zZWxlY3RlZFN0b3AgPSB7IFwibmFtZVwiOiBcIlRlc3QgU3RvcCAxXCIsIFwiaWRcIjogMTUyMTMxMTQ1LCBcImRpc3RhbmNlXCI6IG51bGwsIFwiaWNvblwiOiB7IFwidXJsXCI6IFwiaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZXkuc3ZnXCIgfSwgXCJsYXRpdHVkZVwiOiA0My43NTUxNDIyMTE5MTQwNiwgXCJsb25naXR1ZGVcIjogLTExNi41NzU5NzM1MTA3NDIxOSwgXCIkJGhhc2hLZXlcIjogXCJvYmplY3Q6MTEzXCIgfTtcclxuICAgICAgICB2YXIgY3VycmVudExvY2F0aW9uID0gU3RvcERhdGFTZXJ2aWNlLmdldEdlb0xvY2F0aW9uKCk7XHJcbiAgICAgICAgdm0uZnJvbUxvY2F0aW9uID0gY3VycmVudExvY2F0aW9uICE9bnVsbCA/IGN1cnJlbnRMb2NhdGlvbi5jb29yZHMubGF0aXR1ZGUgKyAnLCcgKyBjdXJyZW50TG9jYXRpb24uY29vcmRzLmxvbmdpdHVkZSA6ICcnO1xyXG5cclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgIGxhdGl0dWRlOiA0MC42NTE3MzksXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTczLjk1MzE0OFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnpvb20gPSAxMDtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdm0ub3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIHZtLm1hcmtlckV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy9mb3IgZnV0dXJlP1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uc2hvd0RpcmVjdGlvbnMgPSBjdXJyZW50TG9jYXRpb24gPT0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuXHJcblxyXG4gICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHsgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZih2bS5zaG93RGlyZWN0aW9ucyl7XHJcbiAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcodm0uc2VsZWN0ZWRTdG9wLmxhdGl0dWRlLCB2bS5zZWxlY3RlZFN0b3AubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICBtYXBEaXJlY3Rpb24odm0uZnJvbUxvY2F0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxvYWRJbmNpZGVudHMoKTtcclxuXHJcbiAgICAgICAgdm0uZ2V0RGlyZWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyO1xyXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKHsgJ2FkZHJlc3MnOiB2bS5mcm9tTG9jYXRpb24gfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwRGlyZWN0aW9uKHJlc3BvbnNlWzBdLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCgpICsgJywnICsgcmVzcG9uc2VbMF0uZ2VvbWV0cnkubG9jYXRpb24ubG5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgIFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBtYXBEaXJlY3Rpb24gPSBmdW5jdGlvbiAoc3RhcnQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb25zRGlzcGxheSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zUmVuZGVyZXI7XHJcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb25zU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZTtcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyZWN0aW9ucycpO1xyXG4gICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRQYW5lbChkaXJlY3Rpb25zKTtcclxuXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbjogc3RhcnQsXHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogdm0uc2VsZWN0ZWRTdG9wLmxhdGl0dWRlICsgJywnICsgdm0uc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNUcmF2ZWxNb2RlLkRSSVZJTkdcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdPSycpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXREaXJlY3Rpb25zKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCdEaXJlY3Rpb25zIHJlcXVlc3QgZmFpbGVkIGR1ZSB0byAnICsgc3RhdHVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHZtLm5hdmlnYXRlVG9UcmlwUGFnZSA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgaW5jaWRlbnQgPSB2bS5ub25QZXJmb3JtZWRJbmNpZGVudHNbaW5kZXhdO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NvbW11dGVyL3NlbGVjdGVkLXRyaXAvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBpbmNpZGVudC5CbG9ja0lkICsgJy8nICsgaW5jaWRlbnQuSW5jaWRlbnRJZCk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRJbmNpZGVudHMoKSB7XHJcbiAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTY2hlZHVsZSggdm0uc2VsZWN0ZWRTdG9wLmlkLCB2bS51c2VySWQsIDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLm5vblBlcmZvcm1lZEluY2lkZW50cyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXJ2ZShpbmNpZGVudFRvUmVzZXJ2ZSkge1xyXG4gICAgICAgICAgICAvL2FsZXJ0KGluY2lkZW50VG9SZXNlcnZlLlZlaGljbGUuVmVoaWNsZU5hbWUpO1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxSZXNlcnZlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbW9kYWwvcmVzZXJ2YXRpb24uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUmVzZXJ2YXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICcnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGluY2lkZW50VG9SZXNlcnZlOiBpbmNpZGVudFRvUmVzZXJ2ZSxcclxuICAgICAgICAgICAgICAgICAgICBpc0FkZDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbW9kYWxSZXNlcnZlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vcmVmcmVzaCB0aGUgZ3JpZCB0byBzaG93IHRoZSBpbmNpZGVudCBhcyByZXNlcnZlZFxyXG4gICAgICAgICAgICAgICAgbG9hZEluY2lkZW50cygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWxSZXNlcnZhdGlvbihpbmNpZGVudFRvQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgIHZhciBfcmVzZXJ2YXRpb24gPSBpbmNpZGVudFRvQ2FuY2VsLlRoZVJlc2VydmF0aW9uO1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuY2FuY2VsUmVzZXJ2YXRpb24oX3Jlc2VydmF0aW9uLklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydCgnUmVzZXJ2YXRpb24gQ2FuY2VsbGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZEluY2lkZW50cygpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjaGFuZ2VTY2hlZHVsZSgpIHtcclxuICAgICAgICAgICAgLy9hbGVydCh2bS5TY2hlZHVsZVR5cGUpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignU2VsZWN0ZWRUcmlwQ29udHJvbGxlcicsIFNlbGVjdGVkVHJpcENvbnRyb2xsZXIpO1xyXG5cclxuICAgIFNlbGVjdGVkVHJpcENvbnRyb2xsZXIuJGluamVjdCA9IFsnU2VsZWN0ZWRUcmlwU2VydmljZScsJyRzdGF0ZVBhcmFtcycsICd1aUdtYXBJc1JlYWR5J107XHJcblxyXG4gICAgZnVuY3Rpb24gU2VsZWN0ZWRUcmlwQ29udHJvbGxlcihTZWxlY3RlZFRyaXBTZXJ2aWNlLCAkc3RhdGVQYXJhbXMsIHVpR21hcElzUmVhZHkpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ1NlbGVjdGVkIFRyaXAnO1xyXG4gICAgICAgIHZhciBzdG9wSWQgPSAkc3RhdGVQYXJhbXMuc3RvcElkO1xyXG4gICAgICAgIHZhciBzdGFydExvY2F0aW9uID0ge307XHJcbiAgICAgICAgdmFyIGVuZExvY2F0aW9uID0ge307XHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogNDAuNjUxNzM5LFxyXG4gICAgICAgICAgICBsb25naXR1ZGU6IC03My45NTMxNDhcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS56b29tID0gMTA7XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgIHZtLnN0b3BzTWFya2VyQXJyYXkgPSBbXTtcclxuXHJcbiAgICAgICAgLy9nZXRNYXAoKTtcclxuXHJcbiAgICAgICAgLy9mdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgLy8gICAgdmFyIG1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgLy8gICAgICAgIHpvb206IHZtLnpvb20sXHJcbiAgICAgICAgLy8gICAgICAgIGNlbnRlcjogdm0uY2VudGVyLFxyXG4gICAgICAgIC8vICAgICAgICBtYXBUeXBlSWQ6IGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQXHJcbiAgICAgICAgLy8gICAgfVxyXG4gICAgICAgIC8vICAgIHZtLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCBtYXBPcHRpb25zKTtcclxuICAgICAgICAvL307XHJcblxyXG4gICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHsgIFxyXG4gICAgICAgICAgICAvL3ZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgU2VsZWN0ZWRUcmlwU2VydmljZS5nZXRUcmlwcygkc3RhdGVQYXJhbXMuYmxvY2tJZCwgJHN0YXRlUGFyYW1zLm1pbkluY0lkLCA1KVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2bS51cENvbWluZ1N0b3BzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgZW5kTG9jYXRpb24gPSB2bS51cENvbWluZ1N0b3BzLnNsaWNlKC0xKVswXTtcclxuICAgICAgICAgICAgdm0uZW5kU3RvcGxvY2F0aW9uID0gZW5kTG9jYXRpb24uVGhlU3RvcDtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udXBDb21pbmdTdG9wcy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnVwQ29taW5nU3RvcHNbaV0uVGhlU3RvcC5TdG9wSWQgPT0gc3RvcElkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXJ0U3RvcExvY2F0aW9uID0gdm0udXBDb21pbmdTdG9wc1tpXS5UaGVTdG9wO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnVwQ29taW5nU3RvcHNbaV0uVGhlU3RvcC5TdG9wSWQgIT0gdm0uZW5kU3RvcGxvY2F0aW9uLlN0b3BJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zdG9wc01hcmtlcnMgPSB7IGxhdDogdm0udXBDb21pbmdTdG9wc1tpXS5UaGVTdG9wLkxhdGl0dWRlLCBsbmc6IHZtLnVwQ29taW5nU3RvcHNbaV0uVGhlU3RvcC5Mb25naXR1ZGUgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zdG9wc01hcmtlckFycmF5LnB1c2goeydsb2NhdGlvbicgOiB2bS5zdG9wc01hcmtlcnMsICdzdG9wb3ZlcicgOiBmYWxzZX0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbWFwRGlyZWN0aW9uKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAvL2FsZXJ0KGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBtYXBEaXJlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBzdGFydCA9IHZtLnN0YXJ0U3RvcExvY2F0aW9uLkxhdGl0dWRlICsgJywnICsgdm0uc3RhcnRTdG9wTG9jYXRpb24uTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICB2YXIgZW5kID0gdm0uZW5kU3RvcGxvY2F0aW9uLkxhdGl0dWRlICsgJywnICsgdm0uZW5kU3RvcGxvY2F0aW9uLkxvbmdpdHVkZTtcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnNEaXNwbGF5ID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNSZW5kZXJlcih7XHJcbiAgICAgICAgICAgICAgICBzdXBwcmVzc01hcmtlcnM6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb25zU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZTsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdm0uc3RvcHNNYXJrZXJBcnJheS5zcGxpY2UoLTEsIDEpO1xyXG4gICAgICAgICAgICBkaXJlY3Rpb25zU2VydmljZS5yb3V0ZSh7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW46IHN0YXJ0LFxyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb246IGVuZCxcclxuICAgICAgICAgICAgICAgIHdheXBvaW50czogdm0uc3RvcHNNYXJrZXJBcnJheSxcclxuICAgICAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNUcmF2ZWxNb2RlLkRSSVZJTkdcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdPSycpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXREaXJlY3Rpb25zKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCdEaXJlY3Rpb25zIHJlcXVlc3QgZmFpbGVkIGR1ZSB0byAnICsgc3RhdHVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnU2VsZWN0ZWRUcmlwU2VydmljZScsIFNlbGVjdGVkVHJpcFNlcnZpY2UpO1xyXG5cclxuICAgIFNlbGVjdGVkVHJpcFNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCdlbnYnLCdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZWxlY3RlZFRyaXBTZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0VHJpcHM6IGdldFRyaXBzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRyaXBzKGJsb2NrSWQsIG1pbkluY0lkLCBpbmNDb3VudCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ2NvbW1vbicgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9pbmNpZGVudHMvJyArIGJsb2NrSWQgKyAnP21pbkluY0lkPScgKyBtaW5JbmNJZCArICcmaW5jQ291bnQ9JyArIGluY0NvdW50O1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xhbmRpbmdDb250cm9sbGVyJywgTGFuZGluZ0NvbnRyb2xsZXIpO1xyXG4gICAgTGFuZGluZ0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHdpbmRvdycsICckbG9jYXRpb24nLFxyXG4gICAgICAgICdTY2hlZHVsZVNlcnZpY2UnLCAndWlHbWFwSXNSZWFkeScsICdEaXZpc2lvblNlcnZpY2UnLCAnU3RvcFNlcnZpY2UnLFxyXG4gICAgICAgICdnb29nbGVNYXBzQ29uZmlnJywgJ0dlb0xvY2F0aW9uU2VydmljZScsJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG4gICAgZnVuY3Rpb24gTGFuZGluZ0NvbnRyb2xsZXIoJHdpbmRvdywgJGxvY2F0aW9uLFxyXG4gICAgICAgIFNjaGVkdWxlU2VydmljZSwgdWlHbWFwSXNSZWFkeSwgRGl2aXNpb25TZXJ2aWNlLFN0b3BTZXJ2aWNlLFxyXG4gICAgICAgIGdvb2dsZU1hcHNDb25maWcsIEdlb0xvY2F0aW9uU2VydmljZSwgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdTdG9wcyAvIFJvdXRlcycpO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Rml4ZWRSb3V0ZUluZm8oKS5hbGlhcyk7XHJcbiAgICAgICAgdm0ub3B0aW9uU2VsZWN0aW9uID0gXCJzdG9wXCI7XHJcbiAgICAgICAgdm0uZ290b1JvdXRlcyA9IGdvdG9Sb3V0ZXM7XHJcbiAgICAgICAgdm0uZ290b1N0b3BzID0gZ290b1N0b3BzO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbklkO1xyXG4gICAgICAgIHZhciBnT2JqZWN0O1xyXG4gICAgICAgIHZhciBjbG9zZXN0UGluLCBvdGhlclBpbiwgbG9jYXRpb25QaW4sIG15TG9jYXRpb25QaW4sIGh1Ykljb247XHJcbiAgICAgICAgaWYgKCR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMCkge1xyXG5cclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnBuZyc7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5zdmcnO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uem9vbSA9IDE1O1xyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiAzOS44MDk4NjAsXHJcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IC05OC41NTUxODNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm15U3R5bGVzID0gZ29vZ2xlTWFwc0NvbmZpZy5tYXBTdHlsZXM7XHJcbiAgICAgICAgdm0ubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICB6b29tQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3R5bGVzOiB2bS5teVN0eWxlc1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm15TG9jYXRpb25JY29uID0ge1xyXG4gICAgICAgICAgICB1cmw6IG15TG9jYXRpb25QaW4sXHJcbiAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDQyLCA0MiksXHJcbiAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyMCwgMjApXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdm0uYWxsU3RvcHMgPSBbXTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ290b1JvdXRlcygpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2ZpeGVkLXJvdXRlL2FsbFJvdXRlcycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ290b1N0b3BzKCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZml4ZWQtcm91dGUvc3RvcHMnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1hcCgpIHtcclxuICAgICAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCkudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxvbmdpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U3RvcHMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgXCJyZXNpemVcIik7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3Bvc2l0aW9uIGVycm9yXHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFNlcnZpY2VBcmVhTG9jYXRpb24oZGl2aXNpb25JZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sYXRpdHVkZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxvbmdpdHVkZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkxvbmdpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT09IG51bGwgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9ICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnpvb20gPSByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRTdG9wcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFN0b3BzKCkge1xyXG4gICAgICAgICAgICB2YXIgc3RvcHNzID0gW107XHJcbiAgICAgICAgICAgIHZhciBtYXAgPSB2bS5tYXBDb250cm9sLmdldEdNYXAoKTtcclxuXHJcbiAgICAgICAgICAgIFN0b3BTZXJ2aWNlLmdldEFsbFN0b3BzKGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFsbFN0b3BzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFsbFN0b3BzLmxlbmd0aDsgaSsrKSB7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcCA9IGFsbFN0b3BzW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdG9wLkxhdGl0dWRlLCBzdG9wLkxvbmdpdHVkZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcE1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpbWl6ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMCwyLjk5NDIwMjA4IEMwLDEuMzQwNTQ5OTMgMS4zNDMzMTE5NywwIDIuOTk0MjAyMDgsMCBMMTcuMDA1Nzk3OSwwIEMxOC42NTk0NTAxLDAgMjAsMS4zNDMzMTE5NyAyMCwyLjk5NDIwMjA4IEwyMCwxNy4wMDU3OTc5IEMyMCwxOC42NTk0NTAxIDE4LjY1NjY4OCwyMCAxNy4wMDU3OTc5LDIwIEwyLjk5NDIwMjA4LDIwIEMxLjM0MDU0OTkzLDIwIDAsMTguNjU2Njg4IDAsMTcuMDA1Nzk3OSBMMCwyLjk5NDIwMjA4IFogTTYsMjAgTDEzLjc2OTA4MTIsMjAgTDkuNzU5OTk5OTksMjIuNzYgTDYsMjAgWicsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjRjc2RjFFJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoOSwgMjEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDIwLCAyMylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTAsMCBMMCwxMy4wODk5MjE3IEMwLDEzLjYzNjcyNjkgMC40NDM2Njc0NTcsMTQuMDggMS4wMDY1MzI3NCwxNC4wOCBMMS4zMTA0NzYxOSwxNC4wOCBMMS4zMTA0NzYxOSwxNiBMMy4yLDE2IEwzLjIsMTQuMDggTDEyLjgsMTQuMDggTDEyLjgsMTYgTDE0LjY4OTUyMzgsMTYgTDE0LjY4OTUyMzgsMTQuMDggTDE0Ljk5MzQ2NzMsMTQuMDggQzE1LjU0OTM1OTksMTQuMDggMTYsMTMuNjI3NDgwMSAxNiwxMy4wODk5MjE3IEwxNiwwLjk5MDA3ODI1OSBDMTYsMC40NDMyNzMxMzUgMTUuNTU1MzY5MSwwIDE0Ljk5OTEyODMsMCBMMCwwIFogTTE1LjQxMzkxOTQsNy44NTU1NzIzMSBDMTUuNDEzOTE5NCw4LjEyNjc5NjIzIDE1LjE4MTkzMDEsOC4zNDY2NjY2NyAxNC45MjI1MjA3LDguMzQ2NjY2NjcgTDEuMTM2MDg3MzgsOC4zNDY2NjY2NyBDMC44NjQ2OTUzNTQsOC4zNDY2NjY2NyAwLjY0NDY4ODY0NSw4LjEyNzkwMTQxIDAuNjQ0Njg4NjQ1LDcuODU1NTcyMzEgTDAuNjQ0Njg4NjQ1LDMuMDc3NzYxMDMgQzAuNjQ0Njg4NjQ1LDIuODA2NTM3MSAwLjg3NjY3Nzk5MiwyLjU4NjY2NjY3IDEuMTM2MDg3MzgsMi41ODY2NjY2NyBMMTQuOTIyNTIwNywyLjU4NjY2NjY3IEMxNS4xOTM5MTI3LDIuNTg2NjY2NjcgMTUuNDEzOTE5NCwyLjgwNTQzMTkzIDE1LjQxMzkxOTQsMy4wNzc3NjEwMyBMMTUuNDEzOTE5NCw3Ljg1NTU3MjMxIFogTTAuNjE1Mzg0NjE1LDEuMTMxMjIwNyBDMC42MTUzODQ2MTUsMC44NTk5MjcgMC44NDczNzM5NjIsMC42NCAxLjEwNjc4MzM1LDAuNjQgTDE0Ljg5MzIxNjYsMC42NCBDMTUuMTY0NjA4NywwLjY0IDE1LjM4NDYxNTQsMC44NjI5NTg5ODQgMTUuMzg0NjE1NCwxLjEzMTIyMDcgTDE1LjM4NDYxNTQsMS40Mjg3NzkzIEMxNS4zODQ2MTU0LDEuNzAwMDczIDE1LjE1MjYyNiwxLjkyIDE0Ljg5MzIxNjYsMS45MiBMMS4xMDY3ODMzNSwxLjkyIEMwLjgzNTM5MTMyNCwxLjkyIDAuNjE1Mzg0NjE1LDEuNjk3MDQxMDIgMC42MTUzODQ2MTUsMS40Mjg3NzkzIEwwLjYxNTM4NDYxNSwxLjEzMTIyMDcgWiBNMC42MTUzODQ2MTUsMTAuNTYgQzAuNjE1Mzg0NjE1LDEwLjAyOTgwNjYgMS4wNDMyMTc1OSw5LjYgMS41NzIwNzU4NCw5LjYgTDIuNzM1NjE2NDYsOS42IEMzLjI2Mzk4MjQ0LDkuNiAzLjY5MjMwNzY5LDEwLjAyNjExMDIgMy42OTIzMDc2OSwxMC41NiBDMy42OTIzMDc2OSwxMS4wOTAxOTM0IDMuMjY0NDc0NzIsMTEuNTIgMi43MzU2MTY0NiwxMS41MiBMMS41NzIwNzU4NCwxMS41MiBDMS4wNDM3MDk4NywxMS41MiAwLjYxNTM4NDYxNSwxMS4wOTM4ODk4IDAuNjE1Mzg0NjE1LDEwLjU2IFogTTEyLjMwNzY5MjMsMTAuNTYgQzEyLjMwNzY5MjMsMTAuMDI5ODA2NiAxMi43MzU1MjUzLDkuNiAxMy4yNjQzODM1LDkuNiBMMTQuNDI3OTI0Miw5LjYgQzE0Ljk1NjI5MDEsOS42IDE1LjM4NDYxNTQsMTAuMDI2MTEwMiAxNS4zODQ2MTU0LDEwLjU2IEMxNS4zODQ2MTU0LDExLjA5MDE5MzQgMTQuOTU2NzgyNCwxMS41MiAxNC40Mjc5MjQyLDExLjUyIEwxMy4yNjQzODM1LDExLjUyIEMxMi43MzYwMTc2LDExLjUyIDEyLjMwNzY5MjMsMTEuMDkzODg5OCAxMi4zMDc2OTIzLDEwLjU2IFogTTExLjQyMzk1NSwxMS4xOTk5NTA3IEMxMS42MzQwNjU5LDExLjM3NjczNjMgMTEuNTg0ODgzOSwxMS41MjAwNDkzIDExLjMwNTE2MDUsMTEuNTIwMDQ5MyBMNC42OTQ4Mzk0OCwxMS41MjAwNDkzIEM0LjQxOTEyMDIyLDExLjUyMDA0OTMgNC4zNjgwMTU0MywxMS4zNzQ5ODUxIDQuNTc2MDQ1MDMsMTEuMTk5OTUwNyBMNC4xOTU2MDU1OSwxMS41MjAwNDkzIEM0LjQwNTcxNjQ5LDExLjM0MzI2MzcgNC44MDM4ODcyNSwxMS4xOTk5NTA3IDUuMDY4NTI5ODMsMTEuMTk5OTUwNyBMMTAuOTMxNDcwMiwxMS4xOTk5NTA3IEMxMS4yMDM0NjIsMTEuMTk5OTUwNyAxMS41OTYzNjQ4LDExLjM0NTAxNDkgMTEuODA0Mzk0NCwxMS41MjAwNDkzIEwxMS40MjM5NTUsMTEuMTk5OTUwNyBaIE0xMS40MjM5NTUsMTEuODM5OTUwNyBDMTEuNjM0MDY1OSwxMi4wMTY3MzYzIDExLjU4NDg4MzksMTIuMTYwMDQ5MyAxMS4zMDUxNjA1LDEyLjE2MDA0OTMgTDQuNjk0ODM5NDgsMTIuMTYwMDQ5MyBDNC40MTkxMjAyMiwxMi4xNjAwNDkzIDQuMzY4MDE1NDMsMTIuMDE0OTg1MSA0LjU3NjA0NTAzLDExLjgzOTk1MDcgTDQuMTk1NjA1NTksMTIuMTYwMDQ5MyBDNC40MDU3MTY0OSwxMS45ODMyNjM3IDQuODAzODg3MjUsMTEuODM5OTUwNyA1LjA2ODUyOTgzLDExLjgzOTk1MDcgTDEwLjkzMTQ3MDIsMTEuODM5OTUwNyBDMTEuMjAzNDYyLDExLjgzOTk1MDcgMTEuNTk2MzY0OCwxMS45ODUwMTQ5IDExLjgwNDM5NDQsMTIuMTYwMDQ5MyBMMTEuNDIzOTU1LDExLjgzOTk1MDcgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDcsIDE5KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgxNiwgMTYpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiA2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaGFkb3cgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTS01LjgzMjUyNTk3LDE0LjMxNTU1NDUgQy02LjM1MzUwMjk1LDEzLjU4ODk5MzggLTUuNDM1OTEwNiwxMyAtMy43ODkxNzk3MiwxMyBMMTAuMTg3MTE1NSwxMyBDMTEuODM2NjAxNSwxMyAxMy41OTY5Nzk1LDEzLjU5MDIwNzQgMTQuMTE3MDg2MywxNC4zMTU1NTQ1IEwxOC41MzEzODc3LDIwLjQ3MTc5MTcgQzE5LjA1MjM2NDcsMjEuMTk4MzUyNCAxOC4xMzQ3NzI0LDIxLjc4NzM0NjIgMTYuNDg4MDQxNSwyMS43ODczNDYyIEwyLjUxMTc0NjI0LDIxLjc4NzM0NjIgQzAuODYyMjYwMjgxLDIxLjc4NzM0NjIgLTAuODk4MTE3NzUxLDIxLjE5NzEzODkgLTEuNDE4MjI0NTcsMjAuNDcxNzkxNyBMLTUuODMyNTI1OTcsMTQuMzE1NTU0NSBaIE01LjUwOTk3MTQsMjEuNzg3MzQ2MiBMMTMuMjU5NDc5MywyMS43ODczNDYyIEwxMC4xMzAwMjYzLDIzIEw1LjUwOTk3MTQsMjEuNzg3MzQ2MiBaJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjMDAwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMC4xMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoOSwgMjEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDIxLCAxMClcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiA0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoY2FsbGJhY2spIHtcclxuXHJcbiAgICAgICAgICAgIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICBpZiAoZGl2aXNpb25JZCAhPSBudWxsICYmIGRpdmlzaW9uSWQgIT0gdW5kZWZpbmVkICYmIGRpdmlzaW9uSWQgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoZ2V0TWFwKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9maXhlZC1yb3V0ZS9MYW5kaW5nL2xhbmRpbmcuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtZml4ZWQtcm91dGUtbGFuZGluZyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnc2VhdEF2YWlsYWJpbGl0eScsIHNlYXRBdmFpbGFiaWxpdHkpO1xyXG5cclxuICAgIHNlYXRBdmFpbGFiaWxpdHkuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlYXRBdmFpbGFiaWxpdHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGRpdmlzaW9uQWxsb3dzV2FpdGxpc3Q6ICc9JyxcclxuICAgICAgICAgICAgICAgIHRyaXA6Jz0nXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvc3RvcC9zZWF0LWF2YWlsYWJpbGl0eS5jb21wb25lbnQuaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1NlbGVjdGVkU3RvcENvbnRyb2xsZXInLCBTZWxlY3RlZFN0b3BDb250cm9sbGVyKTtcclxuXHJcbiAgICBTZWxlY3RlZFN0b3BDb250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgJyRzY29wZScsICckdWliTW9kYWwnLCAnJGludGVydmFsJywgJyRzdGF0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N0b3BEYXRhU2VydmljZScsICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRGl2aXNpb25TZXJ2aWNlJywgJ01hcFNlcnZpY2UnLCAnQ29tbW9uU2VydmljZScsICdNYXBJY29uU2VydmljZScsICdQYWdlU2VydmljZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdWZWhpY2xlRGF0YVNlcnZpY2UnLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ0x1dW1MaW5rZWRTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlbGVjdGVkU3RvcENvbnRyb2xsZXIoJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCAkc2NvcGUsICR1aWJNb2RhbCwgJGludGVydmFsLCAkc3RhdGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZSwgUmVzZXJ2YXRpb25TZXJ2aWNlLCBhdXRoU2VydmljZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlLCBNYXBTZXJ2aWNlLCBDb21tb25TZXJ2aWNlLCBNYXBJY29uU2VydmljZSwgUGFnZVNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlaGljbGVEYXRhU2VydmljZSwgU2NoZWR1bGVTZXJ2aWNlLCBMdXVtTGlua2VkU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5zZWxlY3RlZFN0b3AgPSBTdG9wRGF0YVNlcnZpY2UuZ2V0U3RvcCgpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUodm0uc2VsZWN0ZWRTdG9wLm5hbWUpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCkuYWxpYXMpO1xyXG5cclxuICAgICAgICB2bS5odWJzID0gW107XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRIdWIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZyA9IDA7XHJcbiAgICAgICAgdm0ubm9uUGVyZm9ybWVkVHJpcHMgPSBbXTtcclxuICAgICAgICB2bS5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgdm0uY2FsZW5kYXJPcGVuZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5jYWxlbmRhciA9IHt9O1xyXG4gICAgICAgIHZtLmNhbGVuZGFyLm9wZW5lZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmNhbGVuZGFyLmRhdGVPcHRpb25zID0ge307XHJcbiAgICAgICAgdm0uaXNQYXNzZW5nZXJMb2dnZWRJbiA9IGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKTtcclxuICAgICAgICB2bS5oYXNSZXNlcnZhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmFkdlJlc2VydmF0aW9uV2luZG93ID0gMTQ7XHJcbiAgICAgICAgdm0ubWFya2VycyA9IFtdO1xyXG4gICAgICAgIHZtLm1hcCA9IE1hcFNlcnZpY2UuaW5pdGlhbGl6ZU1hcCgpO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbkRhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIG1hcFZlaGljbGVzID0gW107XHJcbiAgICAgICAgdmFyIHZlaGljbGVQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBtYXJrZXJFdmVudHMgPSBbeyBldmVudDogJ2NsaWNrJywgY2FsbGJhY2s6IGljb25DbGlja0hhbmRsZXIgfV07ICAgICAgICBcclxuICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gdHJ1ZTtcclxuICAgICAgICB2bS5jb21wYW5pb25BbGxvd2VkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc3BlY2lhbEV2ZW50ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLnNlbGVjdEd1ZXN0RGF5ID0gc2VsZWN0R3Vlc3REYXk7XHJcblxyXG5cclxuICAgICAgICB2bS5nZXREaXJlY3Rpb25zVG9TZWxlY3RlZFN0b3AgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKHZtLnNlbGVjdGVkU3RvcCk7XHJcbiAgICAgICAgICAgIC8vU3RvcERhdGFTZXJ2aWNlLnNldEdlb0xvY2F0aW9uKHZtLnNlbGVjdGVkTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NvbW11dGVyL2RpcmVjdGlvbnMnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5vcGVuTWFwQXBwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKChuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcImlQaG9uZVwiKSAhPSAtMSlcclxuICAgICAgICAgfHwgKG5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKFwiaVBvZFwiKSAhPSAtMSlcclxuICAgICAgICAgICAgICAgIHx8IChuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcImlQYWRcIikgIT0gLTEpKSB7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcImh0dHA6Ly9tYXBzLmFwcGxlLmNvbS8/cT1cIiArIHZtLnNlbGVjdGVkU3RvcC5sYXRpdHVkZSArIFwiLFwiICsgdm0uc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVybCA9IFwiaHR0cDovL21hcHMuZ29vZ2xlLmNvbS8/cT1cIiArIHZtLnNlbGVjdGVkU3RvcC5sYXRpdHVkZSArIFwiLFwiICsgdm0uc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHVybC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBGb3IgSW9uaWNcclxuICAgICAgICAgICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3BsYXRmb3JtLWNvcmRvdmEnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19zeXN0ZW0nLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGljb25DbGlja0hhbmRsZXIobW9kZWwpIHtcclxuICAgICAgICAgICAgdm0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLm9wZW5DYWxlbmRhciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uY2FsZW5kYXIub3BlbmVkID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgYWRkRGF5cyA9IGZ1bmN0aW9uIChkYXRlLCBkYXlzKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgRGF0ZShkYXRlKTtcclxuICAgICAgICAgICAgcmVzdWx0LnNldERhdGUocmVzdWx0LmdldERhdGUoKSArIGRheXMpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBzZXREYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5jYWxlbmRhci5kYXRlT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICdtaW5EYXRlJzogZGl2aXNpb25EYXRlLFxyXG4gICAgICAgICAgICAgICAgJ21heERhdGUnOiBhZGREYXlzKGRpdmlzaW9uRGF0ZSwgdm0uYWR2UmVzZXJ2YXRpb25XaW5kb3cpXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZWxlY3RHdWVzdERheSgpIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPSBtb21lbnQodm0uc3BlY2lhbEV2ZW50LmRhdGUsICdZWVlZLU1NLUREIEhIOm1tJykudG9EYXRlKCk7XHJcbiAgICAgICAgICAgIHZtLmRhdGVDaGFuZ2VkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEx1dW1MaW5rZWRTZXJ2aWNlLnZlcmlmeShhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCk7XHJcbiAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFNlcnZpY2VEYXRlQnlEaXZpc2lvbihEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGl2aXNpb25EYXRlID0gbW9tZW50KHJlc3BvbnNlLmRhdGEucmVzdWx0LCAnWVlZWS1NTS1ERCBISDptbScpLnRvRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSA9IGRpdmlzaW9uRGF0ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkU2NoZWR1bGUgPSBuZXcgRGF0ZShyZXNwb25zZS5kYXRhLnJlc3VsdCkuZ2V0SG91cnMoKSA8IDEyID8gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZyA6IENvbW1vblNlcnZpY2UuU2NoZWR1bGVUeXBlLkV2ZW5pbmc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRNYXhEYXlzRm9yQWR2UmVzZXJ2YXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZmFsbGJhY2sgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIERpdmlzaW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmlzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvbigpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA9IHJlc3BvbnNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50RGl2aXNpb25UaW1lKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IG1vbWVudChyZXNwb25zZS5kYXRhLnJlc3VsdCwgJ1lZWVktTU0tREQgSEg6bW0nKS50b0RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPSBkaXZpc2lvbkRhdGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFNjaGVkdWxlID0gbmV3IERhdGUocmVzcG9uc2UuZGF0YS5yZXN1bHQpLmdldEhvdXJzKCkgPCAxMlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBDb21tb25TZXJ2aWNlLlNjaGVkdWxlVHlwZS5Nb3JuaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IENvbW1vblNlcnZpY2UuU2NoZWR1bGVUeXBlLkV2ZW5pbmc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRNYXhEYXlzRm9yQWR2UmVzZXJ2YXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldFNwZWNpYWxFdmVudCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZmFsbGJhY2sgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IG5ldyBtb21lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGl2aXNpb25EYXRlID0gbmV3IG1vbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTcGVjaWFsRXZlbnQoKSB7XHJcbiAgICAgICAgICAgIHZtLnNwZWNpYWxFdmVudCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0U3BlY2lhbEV2ZW50KHZtLnNlbGVjdGVkU3RvcC5pZCwgdm0uc2VsZWN0ZWRTY2hlZHVsZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LmRhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc3BlY2lhbEV2ZW50ID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1heERheXNGb3JBZHZSZXNlcnZhdGlvbigpIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0TWF4RGF5c0FsbG93ZWRGb3JSZXNlcnZhdGlvbih2bS5zZWxlY3RlZFN0b3AuaWQsIHZtLnNlbGVjdGVkU2NoZWR1bGUpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hZHZSZXNlcnZhdGlvbldpbmRvdyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHNldERhdGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2V0RGF0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmRhdGVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL3doZW4gdXNlciBjbGlja3Mgb24gY2xlYXIgYnV0dG9uIG9uIHRoZSBjYWxlbmRhciwgdGhlIG1vZGVsIGlzIHNldCB0byBudWxsLCB0aGlzIHdpbGwgcmVzZXQgdGhlIG1vZGVsIGJhY2sgdG8gY3VycmVudCBkYXRlXHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSA9IGRpdmlzaW9uRGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSA9IG1vbWVudChtb21lbnQodm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUpLmZvcm1hdCgnTU0vREQvWVlZWScpKS50b0RhdGUoKTtcclxuXHRcdFx0Ly92bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSA9IG1vbWVudChtb21lbnQudHoodm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUsIERpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpKS5mb3JtYXQoJ01NL0REL1lZWVknKSkudG9EYXRlKCk7XHJcblx0XHRcdFxyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFNjaGVkdWxlID0gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZztcclxuICAgICAgICAgICAgZ2V0U3BlY2lhbEV2ZW50KCk7XHJcbiAgICAgICAgICAgIGdldE5vblBlcmZvcm1lZFRyaXBzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGlja1VwKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdm0uc2VsZWN0ZWRTY2hlZHVsZSA9PSBDb21tb25TZXJ2aWNlLlNjaGVkdWxlVHlwZS5Nb3JuaW5nID8gdm0uc2VsZWN0ZWRTdG9wIDogdm0uc2VsZWN0ZWRIdWI7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RHJvcE9mZigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZtLnNlbGVjdGVkU2NoZWR1bGUgPT0gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZyA/IHZtLnNlbGVjdGVkSHViIDogdm0uc2VsZWN0ZWRTdG9wO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZhciBnZXROb25QZXJmb3JtZWRUcmlwcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0ubm9uUGVyZm9ybWVkVHJpcHMgPSBbXTtcclxuICAgICAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb24gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHZtLmhhc1Jlc2VydmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmNvbXBhbmlvbkFsbG93ZWQgPSBmYWxzZTtcclxuXHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRIdWIgJiYgdm0uc2VsZWN0ZWRTY2hlZHVsZSAmJiB2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Tm9uUGVyZm9ybWVkVHJpcHMoZ2V0UGlja1VwKCkuaWQsIGdldERyb3BPZmYoKS5pZCwgdm0uc2VsZWN0ZWRTY2hlZHVsZSwgcmVzZXJ2YXRpb25UaW1lc3BhbigpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQuTm9uUGVyZm9ybWVkVHJpcHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9uUGVyZm9ybWVkVHJpcHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Ob25QZXJmb3JtZWRUcmlwcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhbmlvbnNBbGxvd2VkKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbkZvcigpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q29tbXV0ZXJWZWhpY2xlSW5mb0ZvclRyaXBzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZXZlcnkgdGltZSBuZXcgbm9uIHBlcmZvcm1lZCBldmVudHMgYXJlIHJldHJpZXZlZCBzdG9wIHBvbGxpbmcgZm9yIG9sZCBhbmQgc3RhcnQgcG9sbGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9wUG9sbGluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2xsVmVoaWNsZXNGb3JSb3V0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZtLmF2YWlsYWJsZVBhcmtpbmcgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5ub25QZXJmb3JtZWRUcmlwcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRBdmFpbGFibGVQYXJraW5nc0ZvclN0b3AoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29tcGFuaW9uc0FsbG93ZWQoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ubm9uUGVyZm9ybWVkVHJpcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5ub25QZXJmb3JtZWRUcmlwc1tpXS5hbGxvd2VkQ29tcGFuaW9ucyA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb21wYW5pb25BbGxvd2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZhciBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbkZvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCF2bS5pc1Bhc3NlbmdlckxvZ2dlZEluKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgIC5nZXRVc2VyUmVzZXJ2YXRpb25Gb3IoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQsIHZtLnNlbGVjdGVkU2NoZWR1bGUsIHJlc2VydmF0aW9uVGltZXNwYW4oKSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnJlc2VydmF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclJlc2VydmF0aW9uID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmhhc1Jlc2VydmF0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRBdmFpbGFibGVQYXJraW5nc0ZvclN0b3Aodm0uc2VsZWN0ZWRTdG9wLmlkLCByZXNlcnZhdGlvblRpbWVzcGFuKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVQYXJraW5nID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZ2V0SHVicyA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAuZ2V0SHVicyh2bS5zZWxlY3RlZFN0b3AuaWQsIHZtLnNlbGVjdGVkU2NoZWR1bGUsIHJlc2VydmF0aW9uVGltZXNwYW4oKSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmh1YnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5odWJzO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5odWJzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkSHViID0gdm0uaHVic1swXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZFNjaGVkdWxlJywgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgZ2V0SHVicygpO1xyXG4gICAgICAgICAgICAgICAgZ2V0U3BlY2lhbEV2ZW50KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnNlbGVjdGVkSHViJywgZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgZ2V0Tm9uUGVyZm9ybWVkVHJpcHMoKTtcclxuICAgICAgICAgICAgICAgIHNldE1hcmtlcnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VycygpIHtcclxuICAgICAgICAgICAgdm0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5tYXJrZXJzID0gW107XHJcblxyXG4gICAgICAgICAgICB2bS5tYXJrZXJzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHZtLnNlbGVjdGVkU3RvcC5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogdm0uc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIGljb246IE1hcEljb25TZXJ2aWNlLmdldENvbW11dGVyU3RvcEljb24oKSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHZtLnNlbGVjdGVkU3RvcC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgYWRkcmVzczogdm0uc2VsZWN0ZWRTdG9wLmFkZHJlc3NcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLm1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogdm0uc2VsZWN0ZWRIdWIubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnNlbGVjdGVkSHViLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIGljb246IE1hcEljb25TZXJ2aWNlLmdldENvbW11dGVySHViSWNvbigpLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogdm0uc2VsZWN0ZWRIdWIubmFtZSxcclxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IHZtLnNlbGVjdGVkSHViLmFkZHJlc3NcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBNYXBTZXJ2aWNlLnNldE1hcEJvdW5kcyh2bS5tYXJrZXJzLCBtYXJrZXJFdmVudHMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJlc2VydmF0aW9uVGltZXNwYW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBEYXRlLnBhcnNlKHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25EYXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnJlc2VydmUgPSBmdW5jdGlvbiAodHJpcCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKCF2bS5pc1Bhc3NlbmdlckxvZ2dlZEluKSB7XHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICghY2FuUmVzZXJ2ZSh0cmlwKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1vZGFsUmVzZXJ2ZSA9ICR1aWJNb2RhbC5vcGVuKGdldFJlc2VydmF0aW9uTW9kYWwodHJpcCkpO1xyXG5cclxuICAgICAgICAgICAgbW9kYWxSZXNlcnZlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gJ2Nsb3NlJyAmJiByZXN1bHQuaXNSZXNlcnZlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldE5vblBlcmZvcm1lZFRyaXBzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gJ3Jlc2VydmF0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcGFzc2VuZ2VyLXRyaXBzJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gJ3ZlaGljbGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0FkZFZlaGljbGVNb2RhbCh0cmlwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Jlc2VydmF0aW9uQ2hhbmdlZCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhblJlc2VydmUodHJpcCkge1xyXG4gICAgICAgICAgICBpZih2bS5oYXNSZXNlcnZhdGlvbikgcmV0dXJuIGZhbHNlOyAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgaWYgKHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmlwLnRvdGFsUGFzc2VuZ2VycyA+MDtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmlwLmF2YWlsYWJsZUNhcGFjaXR5ID4gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZtLmNhbmNlbFJlc2VydmF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzZXJ2YXRpb25JbmZvID1cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbklkOiB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbi5pZCxcclxuICAgICAgICAgICAgICAgICAgICByb3V0ZU5hbWU6IHZtLnBhc3NlbmdlclJlc2VydmF0aW9uLnJvdXRlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJJZDogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lOiB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbi5waWNrdXBUaW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uRGF0ZTogdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb24ucmVzZXJ2YXRpb25EYXRlXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIG1vZGFsQ2FuY2VsUmVzZXJ2YXRpb24gPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9jYW5jZWwtcmVzZXJ2YXRpb24tbW9kYWwvY2FuY2VsLXJlc2VydmF0aW9uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NhbmNlbFJlc2VydmF0aW9uQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbkluZm86IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc2VydmF0aW9uSW5mbztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9kYWxDYW5jZWxSZXNlcnZhdGlvbi5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0Tm9uUGVyZm9ybWVkVHJpcHMoKTtcclxuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Jlc2VydmF0aW9uQ2hhbmdlZCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRDb21tdXRlclZlaGljbGVJbmZvRm9yVHJpcHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21tdXRlclZlaGljbGVzSWRzID0gW107XHJcbiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gMDtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5ub25QZXJmb3JtZWRUcmlwcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByb3V0ZUlkID0gdm0ubm9uUGVyZm9ybWVkVHJpcHNbMF0ucm91dGVJZDtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5ub25QZXJmb3JtZWRUcmlwcywgZnVuY3Rpb24gKHRyaXApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJpcC52ZWhpY2xlSWQgJiYgdHJpcC52ZWhpY2xlSWQgIT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbXV0ZXJWZWhpY2xlc0lkcy5wdXNoKHRyaXAudmVoaWNsZUlkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb21tdXRlclZlaGljbGVzSWRzLmxlbmd0aCA+IDAgJiYgcm91dGVJZCAhPSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIFZlaGljbGVEYXRhU2VydmljZS5HZXRDb21tdXRlclZlaGljbGVzKGNvbW11dGVyVmVoaWNsZXNJZHMsIHJvdXRlSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlWZWhpY2xlcyh2ZWhpY2xlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZXJyIGhlcmVcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlWZWhpY2xlcyh2ZWhpY2xlcykge1xyXG4gICAgICAgICAgICBpZiAobWFwVmVoaWNsZXMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChtYXBWZWhpY2xlcywgZnVuY3Rpb24gKHZlaGljbGVJY29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmVoaWNsZUljb24uc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1hcFZlaGljbGVzID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVoaWNsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB2ZWhpY2xlSW5mbyA9IHZlaGljbGVzW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB2ZWhpY2xlID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZDogdmVoaWNsZUluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiB2bS5tYXAuY29udHJvbC5nZXRHTWFwKCksXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBmbGF0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00xNS4yNDEzMTIyLDIxLjE1Mjc4NjEgTDExLDI2IEw2Ljc1ODYxODU2LDIxLjE1MjcwNjkgQzIuNzg5MTA5NTksMTkuNDkyNzUwNiAwLDE1LjU3Mjg0NzUgMCwxMSBDMCw0LjkyNDg2Nzc1IDQuOTIzNTMyLDAgMTEsMCBDMTcuMDc1MTMyMiwwIDIyLDQuOTIzNTMyIDIyLDExIEMyMiwxNS41NzIwODQ1IDE5LjIxMTM1MTUsMTkuNDkyNjY4NCAxNS4yNDEzMTIyLDIxLjE1Mjc4NjEgWicsLy9nb29nbGUubWFwcy5TeW1ib2xQYXRoLkZPUldBUkRfQ0xPU0VEX0FSUk9XLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMS4xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogLjMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB2ZWhpY2xlSW5mby5oZWFkaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQodmVoaWNsZUluZm8uYW5jaG9yWCwgdmVoaWNsZUluZm8uYW5jaG9yWSkvL2dldEFuY2hvcih2ZWhpY2xlSW5mby5oZWFkaW5nKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZUNvbG9yID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZDogdmVoaWNsZUluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiB2bS5tYXAuY29udHJvbC5nZXRHTWFwKCksXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTAsMTAgQzAsNC40NzcxNTI1IDQuNDc1OTM4MTgsMCAxMCwwIEMxNS41MjI4NDc1LDAgMjAsNC40NzU5MzgxOCAyMCwxMCBDMjAsMTUuNTIyODQ3NSAxNS41MjQwNjE4LDIwIDEwLDIwIEM0LjQ3NzE1MjUsMjAgMCwxNS41MjQwNjE4IDAsMTAgWiBNNSw1IEw1LDEzLjggTDUuODE5MDQ3NjIsMTMuOCBMNS44MTkwNDc2MiwxNSBMNywxNSBMNywxMy44IEwxMywxMy44IEwxMywxNSBMMTQuMTgwOTUyNCwxNSBMMTQuMTgwOTUyNCwxMy44IEwxNSwxMy44IEwxNSw1IEw1LDUgWiBNMTQuNjMzNjk5Niw5LjcxNjEwMjA5IEMxNC42MzM2OTk2LDkuOTkyNTU2MjcgMTQuNDA1NTIyLDEwLjIxNjY2NjcgMTQuMTM3NDEzNCwxMC4yMTY2NjY3IEw1Ljg5OTIxNjY1LDEwLjIxNjY2NjcgQzUuNjI1MTI1MzIsMTAuMjE2NjY2NyA1LjQwMjkzMDQsMTAuMDAyMjUxMyA1LjQwMjkzMDQsOS43MTYxMDIwOSBMNS40MDI5MzA0LDcuMTE3MjMxMjQgQzUuNDAyOTMwNCw2Ljg0MDc3NzA2IDUuNjMxMTA3OTksNi42MTY2NjY2NyA1Ljg5OTIxNjY1LDYuNjE2NjY2NjcgTDE0LjEzNzQxMzQsNi42MTY2NjY2NyBDMTQuNDExNTA0Nyw2LjYxNjY2NjY3IDE0LjYzMzY5OTYsNi44MzEwODIwMyAxNC42MzM2OTk2LDcuMTE3MjMxMjQgTDE0LjYzMzY5OTYsOS43MTYxMDIwOSBaIE01LjM4NDYxNTM4LDUuOCBDNS4zODQ2MTUzOCw1LjU3OTA4NjEgNS41NjA3Njk2Nyw1LjQgNS43ODEyNSw1LjQgTDE0LjIxODc1LDUuNCBDMTQuNDM3ODA1Miw1LjQgMTQuNjE1Mzg0Niw1LjU4NTU0Njg4IDE0LjYxNTM4NDYsNS44IEMxNC42MTUzODQ2LDYuMDIwOTEzOSAxNC40MzkyMzAzLDYuMiAxNC4yMTg3NSw2LjIgTDUuNzgxMjUsNi4yIEM1LjU2MjE5NDc1LDYuMiA1LjM4NDYxNTM4LDYuMDE0NDUzMTMgNS4zODQ2MTUzOCw1LjggWiBNNS4zODQ2MTUzOCwxMS42IEM1LjM4NDYxNTM4LDExLjI2ODYyOTIgNS42NTIwMTA5OSwxMSA1Ljk5MzA4ODk0LDExIEw2LjY5OTIxODc1LDExIEM3LjAzNTI2OTQyLDExIDcuMzA3NjkyMzEsMTEuMjc4MzIwMyA3LjMwNzY5MjMxLDExLjYgQzcuMzA3NjkyMzEsMTEuOTMxMzcwOCA3LjA0MDI5NjcsMTIuMiA2LjY5OTIxODc1LDEyLjIgTDUuOTkzMDg4OTQsMTIuMiBDNS42NTcwMzgyOCwxMi4yIDUuMzg0NjE1MzgsMTEuOTIxNjc5NyA1LjM4NDYxNTM4LDExLjYgWiBNMTIuNjkyMzA3NywxMS42IEMxMi42OTIzMDc3LDExLjI2ODYyOTIgMTIuOTU5NzAzMywxMSAxMy4zMDA3ODEyLDExIEwxNC4wMDY5MTExLDExIEMxNC4zNDI5NjE3LDExIDE0LjYxNTM4NDYsMTEuMjc4MzIwMyAxNC42MTUzODQ2LDExLjYgQzE0LjYxNTM4NDYsMTEuOTMxMzcwOCAxNC4zNDc5ODksMTIuMiAxNC4wMDY5MTExLDEyLjIgTDEzLjMwMDc4MTIsMTIuMiBDMTIuOTY0NzMwNiwxMi4yIDEyLjY5MjMwNzcsMTEuOTIxNjc5NyAxMi42OTIzMDc3LDExLjYgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjNTU1JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiAzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtYXBWZWhpY2xlcy5wdXNoKHZlaGljbGUpO1xyXG4gICAgICAgICAgICAgICAgbWFwVmVoaWNsZXMucHVzaCh2ZWhpY2xlQ29sb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmdW5jdGlvbiBwb2xsVmVoaWNsZXNGb3JSb3V0ZSgpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVBvbGwgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZ2V0Q29tbXV0ZXJWZWhpY2xlSW5mb0ZvclRyaXBzKCk7XHJcblxyXG4gICAgICAgICAgICB9LCAzMDAwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BQb2xsaW5nKCkge1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodmVoaWNsZVBvbGwpKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHZlaGljbGVQb2xsKTtcclxuICAgICAgICAgICAgICAgIHZlaGljbGVQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UmVzZXJ2YXRpb25Nb2RhbCh0cmlwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9yZXNlcnZhdGlvbi1tb2RhbC9yZXNlcnZhdGlvbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZXNlcnZhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25JbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkaXZpc2lvbklkJzogRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3Bhc3NlbmdlcklkJzogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdwaWNrdXBTdG9wJzogZ2V0UGlja1VwKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkcm9wb2ZmU3RvcCc6IGdldERyb3BPZmYoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RyaXAnOiB0cmlwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2NoZWR1bGVUeXBlJzogdm0uc2VsZWN0ZWRTY2hlZHVsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc2VydmF0aW9uRGF0ZSc6IHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25EYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBpc0FkZDogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd0FkZFZlaGljbGVNb2RhbCh0cmlwKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9hZGQtdmVoaWNsZS1tb2RhbC9hZGQtdmVoaWNsZS5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBZGRWZWhpY2xlQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXRsZWFzdE9uZVZlaGljbGVFeGlzdDogZmFsc2VcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1vZGFsUmVzZXJ2ZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICB2bS5yZXNlcnZlKHRyaXApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmdvVG9TY2hlZHVsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFJvdXRlKHN0b3ApO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2NvbW11dGVyL3B1Ymxpc2hlZC1zY2hlZHVsZScpO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB2bS52aWV3UmVzZXJ2YXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21tdXRlclRyaXBNb2RhbCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3RyaXBzL2NvbW11dGVyLXRyaXAtbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQ29tbXV0ZXJUcmlwTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXBJZDogdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb24uaWRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb21tdXRlclRyaXBNb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jYW5jZWxsZWQgfHwgcmVzcG9uc2UuaXNNb2RpZmllZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldE5vblBlcmZvcm1lZFRyaXBzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZXNlcnZhdGlvbkNoYW5nZWQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBzdG9wUG9sbGluZygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9jb21tdXRlci9zdG9wL3NlbGVjdGVkLXN0b3AuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG5cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAgIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKFwib25lTVZBcHBcIilcclxuICAgICAgICAuZGlyZWN0aXZlKFwibm9uUGVyZm9ybWVkVHJpcENvbXBvbmVudFwiLCBub25QZXJmb3JtZWRUcmlwQ29tcG9uZW50KTtcclxuXHJcbiAgICBmdW5jdGlvbiBub25QZXJmb3JtZWRUcmlwQ29tcG9uZW50KCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiBcIkVcIixcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIHRyaXA6IFwiPVwiLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJhcHAvbW9kdWxlcy9jb21tdXRlci9zdG9wL3NlbGVjdGVkU3RvcC1ucHQuY29tcG9uZW50Lmh0bWxcIlxyXG4gICAgICAgIH07XHJcblxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnU3RvcERhdGFTZXJ2aWNlJywgU3RvcERhdGFTZXJ2aWNlKTtcclxuXHJcbiAgICBTdG9wRGF0YVNlcnZpY2UuJGluamVjdCA9IFsnJHEnLCAnJGh0dHAnLCAnZW52JywgJyRjYWNoZUZhY3RvcnknLCAnbG9jYWxTdG9yYWdlU2VydmljZScsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFN0b3BEYXRhU2VydmljZSgkcSwgJGh0dHAsIGVudiwgJGNhY2hlRmFjdG9yeSwgbG9jYWxTdG9yYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxlY3RlZFN0b3AgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGNhY2hlID0gJGNhY2hlRmFjdG9yeSgnTG9jYXRpb25DYWNoZScpO1xyXG5cclxuICAgICAgICB2YXIgc2V0U2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgLy9jYWNoZS5wdXQoXCJzdG9wXCIsIHN0b3ApO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnc3RvcCcsIHN0b3ApO1xyXG4gICAgICAgICAgICBzZWxlY3RlZFN0b3AgPSBzdG9wO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2xlYXJJdGVtRnJvbVN0b3JhZ2UgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2UucmVtb3ZlKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBnZXRTZWxlY3RlZFN0b3AgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vcmV0dXJuIGNhY2hlLmdldChcInN0b3BcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnc3RvcCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZ2V0SW5jaWRlbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnaW5jaWRlbnQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNldEluY2lkZW50ID0gZnVuY3Rpb24gKGluY2lkZW50KSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdpbmNpZGVudCcsIGluY2lkZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGdldFJvdXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3JvdXRlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzZXRSb3V0ZSA9IGZ1bmN0aW9uIChyb3V0ZSkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgncm91dGUnLCByb3V0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBnZXRWZWhpY2xlSWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgndmVoaWNsZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2V0VmVoaWNsZUlkID0gZnVuY3Rpb24gKHZlaGljbGVJZCkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgndmVoaWNsZScsIHZlaGljbGVJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjdXJyR2VvTG9jYXRpb24gPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgIHZhciBzZXRHZW9Mb2NhdGlvbiA9IGZ1bmN0aW9uIChjdXJyTG9jYXRpb24pIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoXCJjdXJyTG9jYXRpb25cIiwgY3VyckxvY2F0aW9uKTtcclxuICAgICAgICAgICAgY3Vyckdlb0xvY2F0aW9uID0gY3VyckxvY2F0aW9uXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBnZXRHZW9Mb2NhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KFwiY3VyckxvY2F0aW9uXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U3RvcERldGFpbHMoc3RvcElkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ3N0b3AvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBzdG9wSWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEluY2lkZW50c0ZvclN0b3Aoc3RvcElkLCBkYXkpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAnc3RvcC8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvaW5jaWRlbnRzLycgKyBzdG9wSWQgKyAnLycgKyBkYXkgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VySW5jaWRlbnRzRm9yU3RvcChzdG9wSWQsIGRheSwgdXNlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ3N0b3AvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2luY2lkZW50cy8nICsgc3RvcElkICsgJy8nICsgZGF5ICsgJy8nICsgdXNlcklkICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlckluY2lkZW50c0J5SWQoaW5jaWRlbnRJZCwgdXNlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ3N0b3AvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2luY2lkZW50LycgKyBpbmNpZGVudElkICsgJy8nICsgdXNlcklkICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAgZnVuY3Rpb24gZ2V0VmVoaWNsZSh2ZWhJZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdjb21tb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3ZlaGljbGUvJyArIHZlaElkICsgJz9ybmQ9JyArbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2ZWhJZCkgfHwgdmVoSWQgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoJ05vIFZlaGljbGUgRm91bmQnKTtcclxuICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAgZnVuY3Rpb24gZ2V0SHVicyhzdG9wSWQsIHNjaGVkdWxlVHlwZSwgdGltZXNwYW4pIHtcclxuICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyAgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvJyArIHN0b3BJZCArICcvaHVicy8nICsgc2NoZWR1bGVUeXBlICsgJy8nICsgdGltZXNwYW4gKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuICAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wKHN0b3BJZCwgcmVzZXJ2YXRpb25EYXRlKSB7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci9zdG9wcy8nICsgc3RvcElkICsgJy9hdmFpbGFibGVQYXJraW5nLycgKyByZXNlcnZhdGlvbkRhdGUgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuICAgICAgICAgZnVuY3Rpb24gZ2V0Tm9uUGVyZm9ybWVkVHJpcHMocGlja3VwU3RvcElkLCBkcm9wb2ZmU3RvcElkLCBzY2hlZHVsZVR5cGUsIHNjaGVkdWxlRGF0ZSl7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvc3RvcHMvbm9ucGVyZm9ybWVkdHJpcHMvJyArIHBpY2t1cFN0b3BJZCArICcvJyBcclxuICAgICAgICAgICAgICAgICArIGRyb3BvZmZTdG9wSWQgKyAnLycgKyBzY2hlZHVsZURhdGUgKyAnLycgKyBzY2hlZHVsZVR5cGUgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfSAgICAgICBcclxuXHJcblxyXG4gICAgICAgICBmdW5jdGlvbiBnZXRNYXhEYXlzQWxsb3dlZEZvclJlc2VydmF0aW9uKHN0b3BJZCxzY2hlZHVsZVR5cGUpIHtcclxuICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zdG9wcy8nICsgc3RvcElkICsgJy9hZHZhbmNlZERheXMvJyArIHNjaGVkdWxlVHlwZSArICAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldERyb3BvZmZzRm9yU2VsZWN0ZWRQaWNrdXAoc3RvcElkKSB7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvJyArIHN0b3BJZCArICcvZHJvcE9mZnM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpO1xyXG4gICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgZnVuY3Rpb24gZ2V0VHJpcFRpbWVzRm9yQWR2YW5jZWRSZXNlcnZhdGlvbihwaWNrdXBTdG9wSWQsIGRyb3BvZmZTdG9wSWQsIHNjaGVkdWxlVHlwZSkge1xyXG4gICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2FsbHRyaXBzLydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHBpY2t1cFN0b3BJZCArICcvJyArIGRyb3BvZmZTdG9wSWQgKyAnLycgKyBzY2hlZHVsZVR5cGUgKyAnLz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldEFsbEJ1c1N0b3BzKCkge1xyXG4gICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zdG9wcy9jb21tdXRlci8wJztcclxuICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldFBpY2t1cEZvclJldHVyblRyaXAoYW1QaWNrdXAsIGFtSHViKSB7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvcGlja3VwLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy8nICsgYW1QaWNrdXAgKyAnLycgKyBhbUh1YjtcclxuICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICBmdW5jdGlvbiBnZXRTcGVjaWFsRXZlbnQoc3RvcElkLCBzY2hlZHVsZSkge1xyXG4gICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3NwZWNpYWxFdmVudC8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICAnLycgKyBzdG9wSWQgKyAnLycgKyBzY2hlZHVsZTtcclxuICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZXRTdG9wOiBzZXRTZWxlY3RlZFN0b3AsXHJcbiAgICAgICAgICAgIGdldFN0b3A6IGdldFNlbGVjdGVkU3RvcCxcclxuICAgICAgICAgICAgc2V0R2VvTG9jYXRpb246IHNldEdlb0xvY2F0aW9uLFxyXG4gICAgICAgICAgICBnZXRHZW9Mb2NhdGlvbjogZ2V0R2VvTG9jYXRpb24sXHJcbiAgICAgICAgICAgIGdldFN0b3BEZXRhaWxzOiBnZXRTdG9wRGV0YWlscyxcclxuICAgICAgICAgICAgZ2V0SW5jaWRlbnRzRm9yU3RvcDogZ2V0SW5jaWRlbnRzRm9yU3RvcCxcclxuICAgICAgICAgICAgZ2V0VXNlckluY2lkZW50c0ZvclN0b3A6IGdldFVzZXJJbmNpZGVudHNGb3JTdG9wLFxyXG4gICAgICAgICAgICBnZXRVc2VySW5jaWRlbnRzQnlJZDogZ2V0VXNlckluY2lkZW50c0J5SWQsXHJcbiAgICAgICAgICAgIGdldFZlaGljbGU6IGdldFZlaGljbGUsXHJcbiAgICAgICAgICAgIGdldEluY2lkZW50OiBnZXRJbmNpZGVudCxcclxuICAgICAgICAgICAgc2V0SW5jaWRlbnQ6IHNldEluY2lkZW50LFxyXG4gICAgICAgICAgICBnZXRSb3V0ZTogZ2V0Um91dGUsXHJcbiAgICAgICAgICAgIHNldFJvdXRlOiBzZXRSb3V0ZSxcclxuICAgICAgICAgICAgZ2V0VmVoaWNsZUlkOiBnZXRWZWhpY2xlSWQsXHJcbiAgICAgICAgICAgIHNldFZlaGljbGVJZDogc2V0VmVoaWNsZUlkLFxyXG4gICAgICAgICAgICBjbGVhckl0ZW06IGNsZWFySXRlbUZyb21TdG9yYWdlLFxyXG4gICAgICAgICAgICBnZXRIdWJzOiBnZXRIdWJzLFxyXG4gICAgICAgICAgICBnZXRBdmFpbGFibGVQYXJraW5nc0ZvclN0b3A6IGdldEF2YWlsYWJsZVBhcmtpbmdzRm9yU3RvcCxcclxuICAgICAgICAgICAgZ2V0Tm9uUGVyZm9ybWVkVHJpcHM6IGdldE5vblBlcmZvcm1lZFRyaXBzLFxyXG4gICAgICAgICAgICBnZXREcm9wb2Zmc0ZvclNlbGVjdGVkUGlja3VwOiBnZXREcm9wb2Zmc0ZvclNlbGVjdGVkUGlja3VwLFxyXG4gICAgICAgICAgICBnZXRUcmlwVGltZXNGb3JBZHZhbmNlZFJlc2VydmF0aW9uOiBnZXRUcmlwVGltZXNGb3JBZHZhbmNlZFJlc2VydmF0aW9uLFxyXG4gICAgICAgICAgICBnZXRNYXhEYXlzQWxsb3dlZEZvclJlc2VydmF0aW9uOiBnZXRNYXhEYXlzQWxsb3dlZEZvclJlc2VydmF0aW9uLFxyXG4gICAgICAgICAgICBnZXRBbGxCdXNTdG9wczogZ2V0QWxsQnVzU3RvcHMsXHJcbiAgICAgICAgICAgIGdldFBpY2t1cEZvclJldHVyblRyaXA6IGdldFBpY2t1cEZvclJldHVyblRyaXAsXHJcbiAgICAgICAgICAgIGdldFNwZWNpYWxFdmVudDogZ2V0U3BlY2lhbEV2ZW50XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnVmVoaWNsZURhdGFTZXJ2aWNlJywgVmVoaWNsZURhdGFTZXJ2aWNlKTtcclxuXHJcbiAgICBWZWhpY2xlRGF0YVNlcnZpY2UuJGluamVjdCA9IFsnJHEnLCAnJGh0dHAnLCAnZW52JywgJyRjYWNoZUZhY3RvcnknLCAnbG9jYWxTdG9yYWdlU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBWZWhpY2xlRGF0YVNlcnZpY2UoJHEsICRodHRwLCBlbnYsICRjYWNoZUZhY3RvcnksIGxvY2FsU3RvcmFnZVNlcnZpY2UsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIEdldENvbW11dGVyVmVoaWNsZXMgOiBnZXRDb21tdXRlclZlaGljbGVzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29tbXV0ZXJWZWhpY2xlcyh2ZWhpY2xlc0FycmF5LCByb3V0ZUlkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL0NvbW11dGVyVmVoaWNsZXMnO1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAndmVoaWNsZUlkcyc6IHZlaGljbGVzQXJyYXksXHJcbiAgICAgICAgICAgICAgICAgICAgJ3JvdXRlSWQnOiByb3V0ZUlkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FsbFJvdXRlc0NvbnRyb2xsZXInLCBBbGxSb3V0ZXNDb250cm9sbGVyKTtcclxuICAgIEFsbFJvdXRlc0NvbnRyb2xsZXIuJGluamVjdCA9IFsgJyRzY29wZScsICckZmlsdGVyJywnJGxvY2F0aW9uJywgJyRpbnRlcnZhbCcsXHJcbiAgICAgICAgJ1NjaGVkdWxlU2VydmljZScsICd1aUdtYXBJc1JlYWR5JywgJ0RpdmlzaW9uU2VydmljZScsICdSb3V0ZVNlcnZpY2UnLCAnU3RvcFNlcnZpY2UnLCAnZ29vZ2xlTWFwc0NvbmZpZycsICdQYWdlU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuICAgIGZ1bmN0aW9uIEFsbFJvdXRlc0NvbnRyb2xsZXIoJHNjb3BlLCAkZmlsdGVyLCAkbG9jYXRpb24sICRpbnRlcnZhbCxcclxuICAgICAgICBTY2hlZHVsZVNlcnZpY2UsIHVpR21hcElzUmVhZHksIERpdmlzaW9uU2VydmljZSwgUm91dGVTZXJ2aWNlLCBTdG9wU2VydmljZSwgZ29vZ2xlTWFwc0NvbmZpZywgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGRpdmlzaW9uSWQ7XHJcbiAgICAgICAgdmFyIGJvdW5kcztcclxuICAgICAgICB2YXIgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHtjb250ZW50OiAnJ30pO1xyXG4gICAgICAgIHZtLmRpc3BsYXlTZWxlY3RlZFJvdXRlcyA9IGRpc3BsYXlTZWxlY3RlZFJvdXRlcztcclxuICAgICAgICB2bS5kaXNwbGF5Um91dGUgPSBkaXNwbGF5Um91dGU7XHJcbiAgICAgICAgdm0uZmlsdGVyQ2hhbmdlID0gZmlsdGVyQ2hhbmdlO1xyXG4gICAgICAgIHZtLmdvdG9TdG9wcyA9IGdvVG9TdG9wcztcclxuICAgICAgIFxyXG4gICAgICAgIHZtLmRpc3BsYXlCdXR0b24gPSBkaXNwbGF5QnV0dG9uO1xyXG4gICAgICAgIHZtLmdvVG9Sb3V0ZSA9IGdvVG9Sb3V0ZTtcclxuICAgICAgICB2bS5oaWdodGxpZ2h0Um91dGUgPSBoaWdodGxpZ2h0Um91dGU7XHJcbiAgICAgICAgdm0uem9vbSA9IDE1O1xyXG4gICAgICAgIHZtLnJvdXRlcyA9IFtdO1xyXG4gICAgICAgIHZtLmZpbHRlcmVkUm91dGVzID0gW107XHJcbiAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgdmFyIHZlaGljbGVQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciB2ZWhpY2xlSWNvbkwxID0gJ2ltYWdlcy9tYXJrZXItYnVzLWwxLnN2Zyc7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnUm91dGVzJyk7XHJcbiAgICAgICAgUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXRGaXhlZFJvdXRlSW5mbygpLmFsaWFzKTtcclxuXHJcbiAgICAgICAgdm0udmVoaWNsZXMgPSBbXTtcclxuICAgICAgICB2bS5hbGxTdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLnRvU3RvcHMgPSBbXTtcclxuICAgICAgICB2bS5yb3V0ZXNPbk1hcCA9IFtdO1xyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgbGF0aXR1ZGU6IDM5LjgwOTg2MCwgXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTk4LjU1NTE4M1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubXlTdHlsZXMgPSBnb29nbGVNYXBzQ29uZmlnLm1hcFN0eWxlcztcclxuICAgICAgICAgICBcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IHZtLm15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlckNoYW5nZShpdGVtKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWFyY2hfdGV4dCA9PT0gdW5kZWZpbmVkIHx8IHZtLnNlYXJjaF90ZXh0ID09PSBudWxsIHx8IHZtLnNlYXJjaF90ZXh0LnRyaW0oKSA9PT0gJycpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2Yodm0uc2VhcmNoX3RleHQudG9Mb3dlckNhc2UoKSkgIT09IC0xIHx8IGl0ZW0uc2hvcnROYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2bS5zZWFyY2hfdGV4dC50b0xvd2VyQ2FzZSgpKSAhPT0gLTE7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBkaXNwbGF5QnV0dG9uKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnJvdXRlc1tpXS5kaXNwbGF5T25NYXApXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZlaGljbGVzQnlSb3V0ZShyb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS52ZWhpY2xlcyAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdLnZlaGljbGVzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdLnZlaGljbGVzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS52ZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFZlaGljbGVzRm9yUm91dGUocm91dGVJZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwQWN0aXZlVmVoaWNsZXMocmVzcG9uc2UsIHJvdXRlSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIHZlaGljbGVzRmFpbHVyZUhhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZtLmhpZ2hsaWdodFBhcmVudCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChlLnRhcmdldCkucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5ibHVyUGFyZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGUudGFyZ2V0KS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGhpZ2h0bGlnaHRSb3V0ZShyb3V0ZUlkLCBzaG93KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdICE9IHVuZGVmaW5lZCAmJiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGVJZF0uZGlzcGxheU9uTWFwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggaW4gdm0ucm91dGVzT25NYXBbcm91dGVJZF0ubGluZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3cpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS5saW5lc1tpbmRleF0uc2V0T3B0aW9ucyh7IHN0cm9rZU9wYWNpdHk6IDAuOCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGVJZF0ubGluZXNbaW5kZXhdLnNldE9wdGlvbnMoeyBzdHJva2VPcGFjaXR5OiAwLjUgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcEFjdGl2ZVZlaGljbGVzKHJlc3BvbnNlLCByb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB2ZWhpY2xlSW5mbyA9IHJlc3BvbnNlLmRhdGFbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHZlaGljbGUgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyICh7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZDogdmVoaWNsZUluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiB2bS5tYXBDb250cm9sLmdldEdNYXAoKSxcclxuICAgICAgICAgICAgICAgICAgICBvcHRpbWl6ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGZsYXQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTE1LjI0MTMxMjIsMjEuMTUyNzg2MSBMMTEsMjYgTDYuNzU4NjE4NTYsMjEuMTUyNzA2OSBDMi43ODkxMDk1OSwxOS40OTI3NTA2IDAsMTUuNTcyODQ3NSAwLDExIEMwLDQuOTI0ODY3NzUgNC45MjM1MzIsMCAxMSwwIEMxNy4wNzUxMzIyLDAgMjIsNC45MjM1MzIgMjIsMTEgQzIyLDE1LjU3MjA4NDUgMTkuMjExMzUxNSwxOS40OTI2Njg0IDE1LjI0MTMxMjIsMjEuMTUyNzg2MSBaJywvL2dvb2dsZS5tYXBzLlN5bWJvbFBhdGguRk9SV0FSRF9DTE9TRURfQVJST1csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLjEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjZmZmJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAuMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm90YXRpb246IHZlaGljbGVJbmZvLmhlYWRpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCh2ZWhpY2xlSW5mby5hbmNob3JYLCB2ZWhpY2xlSW5mby5hbmNob3JZKS8vZ2V0QW5jaG9yKHZlaGljbGVJbmZvLmhlYWRpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIHpJbmRleDogMlxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZUNvbG9yID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZDogdmVoaWNsZUluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiB2bS5tYXBDb250cm9sLmdldEdNYXAoKSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMCwxMCBDMCw0LjQ3NzE1MjUgNC40NzU5MzgxOCwwIDEwLDAgQzE1LjUyMjg0NzUsMCAyMCw0LjQ3NTkzODE4IDIwLDEwIEMyMCwxNS41MjI4NDc1IDE1LjUyNDA2MTgsMjAgMTAsMjAgQzQuNDc3MTUyNSwyMCAwLDE1LjUyNDA2MTggMCwxMCBaIE01LDUgTDUsMTMuOCBMNS44MTkwNDc2MiwxMy44IEw1LjgxOTA0NzYyLDE1IEw3LDE1IEw3LDEzLjggTDEzLDEzLjggTDEzLDE1IEwxNC4xODA5NTI0LDE1IEwxNC4xODA5NTI0LDEzLjggTDE1LDEzLjggTDE1LDUgTDUsNSBaIE0xNC42MzM2OTk2LDkuNzE2MTAyMDkgQzE0LjYzMzY5OTYsOS45OTI1NTYyNyAxNC40MDU1MjIsMTAuMjE2NjY2NyAxNC4xMzc0MTM0LDEwLjIxNjY2NjcgTDUuODk5MjE2NjUsMTAuMjE2NjY2NyBDNS42MjUxMjUzMiwxMC4yMTY2NjY3IDUuNDAyOTMwNCwxMC4wMDIyNTEzIDUuNDAyOTMwNCw5LjcxNjEwMjA5IEw1LjQwMjkzMDQsNy4xMTcyMzEyNCBDNS40MDI5MzA0LDYuODQwNzc3MDYgNS42MzExMDc5OSw2LjYxNjY2NjY3IDUuODk5MjE2NjUsNi42MTY2NjY2NyBMMTQuMTM3NDEzNCw2LjYxNjY2NjY3IEMxNC40MTE1MDQ3LDYuNjE2NjY2NjcgMTQuNjMzNjk5Niw2LjgzMTA4MjAzIDE0LjYzMzY5OTYsNy4xMTcyMzEyNCBMMTQuNjMzNjk5Niw5LjcxNjEwMjA5IFogTTUuMzg0NjE1MzgsNS44IEM1LjM4NDYxNTM4LDUuNTc5MDg2MSA1LjU2MDc2OTY3LDUuNCA1Ljc4MTI1LDUuNCBMMTQuMjE4NzUsNS40IEMxNC40Mzc4MDUyLDUuNCAxNC42MTUzODQ2LDUuNTg1NTQ2ODggMTQuNjE1Mzg0Niw1LjggQzE0LjYxNTM4NDYsNi4wMjA5MTM5IDE0LjQzOTIzMDMsNi4yIDE0LjIxODc1LDYuMiBMNS43ODEyNSw2LjIgQzUuNTYyMTk0NzUsNi4yIDUuMzg0NjE1MzgsNi4wMTQ0NTMxMyA1LjM4NDYxNTM4LDUuOCBaIE01LjM4NDYxNTM4LDExLjYgQzUuMzg0NjE1MzgsMTEuMjY4NjI5MiA1LjY1MjAxMDk5LDExIDUuOTkzMDg4OTQsMTEgTDYuNjk5MjE4NzUsMTEgQzcuMDM1MjY5NDIsMTEgNy4zMDc2OTIzMSwxMS4yNzgzMjAzIDcuMzA3NjkyMzEsMTEuNiBDNy4zMDc2OTIzMSwxMS45MzEzNzA4IDcuMDQwMjk2NywxMi4yIDYuNjk5MjE4NzUsMTIuMiBMNS45OTMwODg5NCwxMi4yIEM1LjY1NzAzODI4LDEyLjIgNS4zODQ2MTUzOCwxMS45MjE2Nzk3IDUuMzg0NjE1MzgsMTEuNiBaIE0xMi42OTIzMDc3LDExLjYgQzEyLjY5MjMwNzcsMTEuMjY4NjI5MiAxMi45NTk3MDMzLDExIDEzLjMwMDc4MTIsMTEgTDE0LjAwNjkxMTEsMTEgQzE0LjM0Mjk2MTcsMTEgMTQuNjE1Mzg0NiwxMS4yNzgzMjAzIDE0LjYxNTM4NDYsMTEuNiBDMTQuNjE1Mzg0NiwxMS45MzEzNzA4IDE0LjM0Nzk4OSwxMi4yIDE0LjAwNjkxMTEsMTIuMiBMMTMuMzAwNzgxMiwxMi4yIEMxMi45NjQ3MzA2LDEyLjIgMTIuNjkyMzA3NywxMS45MjE2Nzk3IDEyLjY5MjMwNzcsMTEuNiBaJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogdm0ucm91dGVzT25NYXBbcm91dGVJZF0ucm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGVJZF0udmVoaWNsZXMucHVzaCh2ZWhpY2xlQ29sb3IpO1xyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGVJZF0udmVoaWNsZXMucHVzaCh2ZWhpY2xlKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB2ZWhpY2xlc0ZhaWx1cmVIYW5kbGVyKCkge1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICBcclxuICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U3RvcHNCeVJvdXRlKHJvdXRlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgU3RvcFNlcnZpY2UuZ2V0U3RvcHNCeVJvdXRlKGRpdmlzaW9uSWQsIHJvdXRlLmlkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdG9wcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlU3RvcHMgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm91dGVTdG9wcy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2ljb24gcGF0aCBhbGxvd3MgdXMgdG8gcm90YXRlIGljb24uXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3AgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocm91dGVTdG9wc1tpXS5MYXRpdHVkZSwgcm91dGVTdG9wc1tpXS5Mb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTAsMi45OTQyMDIwOCBDMCwxLjM0MDU0OTkzIDEuMzQzMzExOTcsMCAyLjk5NDIwMjA4LDAgTDE3LjAwNTc5NzksMCBDMTguNjU5NDUwMSwwIDIwLDEuMzQzMzExOTcgMjAsMi45OTQyMDIwOCBMMjAsMTcuMDA1Nzk3OSBDMjAsMTguNjU5NDUwMSAxOC42NTY2ODgsMjAgMTcuMDA1Nzk3OSwyMCBMMi45OTQyMDIwOCwyMCBDMS4zNDA1NDk5MywyMCAwLDE4LjY1NjY4OCAwLDE3LjAwNTc5NzkgTDAsMi45OTQyMDIwOCBaIE02LDIwIEwxMy43NjkwODEyLDIwIEw5Ljc1OTk5OTk5LDIyLjc2IEw2LDIwIFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiB2bS5zZWxlY3RlZFJvdXRlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCg5LCAyMSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyMCwgMjMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDo1XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3BJY29uID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHJvdXRlU3RvcHNbaV0uTGF0aXR1ZGUsIHJvdXRlU3RvcHNbaV0uTG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDAgTDAsMTMuMDg5OTIxNyBDMCwxMy42MzY3MjY5IDAuNDQzNjY3NDU3LDE0LjA4IDEuMDA2NTMyNzQsMTQuMDggTDEuMzEwNDc2MTksMTQuMDggTDEuMzEwNDc2MTksMTYgTDMuMiwxNiBMMy4yLDE0LjA4IEwxMi44LDE0LjA4IEwxMi44LDE2IEwxNC42ODk1MjM4LDE2IEwxNC42ODk1MjM4LDE0LjA4IEwxNC45OTM0NjczLDE0LjA4IEMxNS41NDkzNTk5LDE0LjA4IDE2LDEzLjYyNzQ4MDEgMTYsMTMuMDg5OTIxNyBMMTYsMC45OTAwNzgyNTkgQzE2LDAuNDQzMjczMTM1IDE1LjU1NTM2OTEsMCAxNC45OTkxMjgzLDAgTDAsMCBaIE0xNS40MTM5MTk0LDcuODU1NTcyMzEgQzE1LjQxMzkxOTQsOC4xMjY3OTYyMyAxNS4xODE5MzAxLDguMzQ2NjY2NjcgMTQuOTIyNTIwNyw4LjM0NjY2NjY3IEwxLjEzNjA4NzM4LDguMzQ2NjY2NjcgQzAuODY0Njk1MzU0LDguMzQ2NjY2NjcgMC42NDQ2ODg2NDUsOC4xMjc5MDE0MSAwLjY0NDY4ODY0NSw3Ljg1NTU3MjMxIEwwLjY0NDY4ODY0NSwzLjA3Nzc2MTAzIEMwLjY0NDY4ODY0NSwyLjgwNjUzNzEgMC44NzY2Nzc5OTIsMi41ODY2NjY2NyAxLjEzNjA4NzM4LDIuNTg2NjY2NjcgTDE0LjkyMjUyMDcsMi41ODY2NjY2NyBDMTUuMTkzOTEyNywyLjU4NjY2NjY3IDE1LjQxMzkxOTQsMi44MDU0MzE5MyAxNS40MTM5MTk0LDMuMDc3NzYxMDMgTDE1LjQxMzkxOTQsNy44NTU1NzIzMSBaIE0wLjYxNTM4NDYxNSwxLjEzMTIyMDcgQzAuNjE1Mzg0NjE1LDAuODU5OTI3IDAuODQ3MzczOTYyLDAuNjQgMS4xMDY3ODMzNSwwLjY0IEwxNC44OTMyMTY2LDAuNjQgQzE1LjE2NDYwODcsMC42NCAxNS4zODQ2MTU0LDAuODYyOTU4OTg0IDE1LjM4NDYxNTQsMS4xMzEyMjA3IEwxNS4zODQ2MTU0LDEuNDI4Nzc5MyBDMTUuMzg0NjE1NCwxLjcwMDA3MyAxNS4xNTI2MjYsMS45MiAxNC44OTMyMTY2LDEuOTIgTDEuMTA2NzgzMzUsMS45MiBDMC44MzUzOTEzMjQsMS45MiAwLjYxNTM4NDYxNSwxLjY5NzA0MTAyIDAuNjE1Mzg0NjE1LDEuNDI4Nzc5MyBMMC42MTUzODQ2MTUsMS4xMzEyMjA3IFogTTAuNjE1Mzg0NjE1LDEwLjU2IEMwLjYxNTM4NDYxNSwxMC4wMjk4MDY2IDEuMDQzMjE3NTksOS42IDEuNTcyMDc1ODQsOS42IEwyLjczNTYxNjQ2LDkuNiBDMy4yNjM5ODI0NCw5LjYgMy42OTIzMDc2OSwxMC4wMjYxMTAyIDMuNjkyMzA3NjksMTAuNTYgQzMuNjkyMzA3NjksMTEuMDkwMTkzNCAzLjI2NDQ3NDcyLDExLjUyIDIuNzM1NjE2NDYsMTEuNTIgTDEuNTcyMDc1ODQsMTEuNTIgQzEuMDQzNzA5ODcsMTEuNTIgMC42MTUzODQ2MTUsMTEuMDkzODg5OCAwLjYxNTM4NDYxNSwxMC41NiBaIE0xMi4zMDc2OTIzLDEwLjU2IEMxMi4zMDc2OTIzLDEwLjAyOTgwNjYgMTIuNzM1NTI1Myw5LjYgMTMuMjY0MzgzNSw5LjYgTDE0LjQyNzkyNDIsOS42IEMxNC45NTYyOTAxLDkuNiAxNS4zODQ2MTU0LDEwLjAyNjExMDIgMTUuMzg0NjE1NCwxMC41NiBDMTUuMzg0NjE1NCwxMS4wOTAxOTM0IDE0Ljk1Njc4MjQsMTEuNTIgMTQuNDI3OTI0MiwxMS41MiBMMTMuMjY0MzgzNSwxMS41MiBDMTIuNzM2MDE3NiwxMS41MiAxMi4zMDc2OTIzLDExLjA5Mzg4OTggMTIuMzA3NjkyMywxMC41NiBaIE0xMS40MjM5NTUsMTEuMTk5OTUwNyBDMTEuNjM0MDY1OSwxMS4zNzY3MzYzIDExLjU4NDg4MzksMTEuNTIwMDQ5MyAxMS4zMDUxNjA1LDExLjUyMDA0OTMgTDQuNjk0ODM5NDgsMTEuNTIwMDQ5MyBDNC40MTkxMjAyMiwxMS41MjAwNDkzIDQuMzY4MDE1NDMsMTEuMzc0OTg1MSA0LjU3NjA0NTAzLDExLjE5OTk1MDcgTDQuMTk1NjA1NTksMTEuNTIwMDQ5MyBDNC40MDU3MTY0OSwxMS4zNDMyNjM3IDQuODAzODg3MjUsMTEuMTk5OTUwNyA1LjA2ODUyOTgzLDExLjE5OTk1MDcgTDEwLjkzMTQ3MDIsMTEuMTk5OTUwNyBDMTEuMjAzNDYyLDExLjE5OTk1MDcgMTEuNTk2MzY0OCwxMS4zNDUwMTQ5IDExLjgwNDM5NDQsMTEuNTIwMDQ5MyBMMTEuNDIzOTU1LDExLjE5OTk1MDcgWiBNMTEuNDIzOTU1LDExLjgzOTk1MDcgQzExLjYzNDA2NTksMTIuMDE2NzM2MyAxMS41ODQ4ODM5LDEyLjE2MDA0OTMgMTEuMzA1MTYwNSwxMi4xNjAwNDkzIEw0LjY5NDgzOTQ4LDEyLjE2MDA0OTMgQzQuNDE5MTIwMjIsMTIuMTYwMDQ5MyA0LjM2ODAxNTQzLDEyLjAxNDk4NTEgNC41NzYwNDUwMywxMS44Mzk5NTA3IEw0LjE5NTYwNTU5LDEyLjE2MDA0OTMgQzQuNDA1NzE2NDksMTEuOTgzMjYzNyA0LjgwMzg4NzI1LDExLjgzOTk1MDcgNS4wNjg1Mjk4MywxMS44Mzk5NTA3IEwxMC45MzE0NzAyLDExLjgzOTk1MDcgQzExLjIwMzQ2MiwxMS44Mzk5NTA3IDExLjU5NjM2NDgsMTEuOTg1MDE0OSAxMS44MDQzOTQ0LDEyLjE2MDA0OTMgTDExLjQyMzk1NSwxMS44Mzk5NTA3IFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDcsIDE5KSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDE2LCAxNilcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OjZcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcFNoYWRvdyA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhyb3V0ZVN0b3BzW2ldLkxhdGl0dWRlLCByb3V0ZVN0b3BzW2ldLkxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNLTUuODMyNTI1OTcsMTQuMzE1NTU0NSBDLTYuMzUzNTAyOTUsMTMuNTg4OTkzOCAtNS40MzU5MTA2LDEzIC0zLjc4OTE3OTcyLDEzIEwxMC4xODcxMTU1LDEzIEMxMS44MzY2MDE1LDEzIDEzLjU5Njk3OTUsMTMuNTkwMjA3NCAxNC4xMTcwODYzLDE0LjMxNTU1NDUgTDE4LjUzMTM4NzcsMjAuNDcxNzkxNyBDMTkuMDUyMzY0NywyMS4xOTgzNTI0IDE4LjEzNDc3MjQsMjEuNzg3MzQ2MiAxNi40ODgwNDE1LDIxLjc4NzM0NjIgTDIuNTExNzQ2MjQsMjEuNzg3MzQ2MiBDMC44NjIyNjAyODEsMjEuNzg3MzQ2MiAtMC44OTgxMTc3NTEsMjEuMTk3MTM4OSAtMS40MTgyMjQ1NywyMC40NzE3OTE3IEwtNS44MzI1MjU5NywxNC4zMTU1NTQ1IFogTTUuNTA5OTcxNCwyMS43ODczNDYyIEwxMy4yNTk0NzkzLDIxLjc4NzM0NjIgTDEwLjEzMDAyNjMsMjMgTDUuNTA5OTcxNCwyMS43ODczNDYyIFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnIzAwMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogLjEwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoOSwgMjEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMjEsIDEwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogNFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3Auc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgICAgICAgICBzdG9wSWNvbi5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgc3RvcFNoYWRvdy5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYWRkIGV2ZW50IGxpc3RuZXIgdG8gY2FsbCBzZXJ2aWNlIGFuZCByZW5kZXIgaW5mbyB3aW5kb3cuXHJcbiAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihzdG9wSWNvbiwgJ2NsaWNrJywgZ2V0QXJyaXZhbHNGb3JTdG9wKHJvdXRlU3RvcHNbaV0sIHN0b3ApKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcHMucHVzaChzdG9wKTtcclxuICAgICAgICAgICAgICAgICAgICBzdG9wcy5wdXNoKHN0b3BJY29uKTtcclxuICAgICAgICAgICAgICAgICAgICBzdG9wcy5wdXNoKHN0b3BTaGFkb3cpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5zdG9wcyA9IHN0b3BzO1xyXG4gICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgXCJyZXNpemVcIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXJyaXZhbHNGb3JTdG9wKHN0b3AsIG1hcmtlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBTdG9wU2VydmljZS5nZXRBcnJpdmFsc0J5U3RvcElkKGRpdmlzaW9uSWQsIHN0b3AuSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnJpdmFscyA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gJzxzcGFuIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7XCI+JyArIHN0b3AuTmFtZSArICc8L3NwYW4+PGJyIC8+JztcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycml2YWxzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ICs9ICc8c3BhbiBzdHlsZT1cImNvbG9yOicgKyBhcnJpdmFsc1tpXS5yb3V0ZS5jb2xvciArICc7XCI+JyArIGFycml2YWxzW2ldLnJvdXRlLnNob3J0TmFtZSArICc8L3NwYW4+PGJyIC8+JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBhcnJpdmFsc1tpXS50cmlwcy5sZW5ndGg7IGorKylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gJyZuYnNwOyZuYnNwOycgKyAoYXJyaXZhbHNbaV0udHJpcHNbal0udmVoaWNsZS5uYW1lID09IG51bGwgPyAnQnVzJyA6IGFycml2YWxzW2ldLnRyaXBzW2pdLnZlaGljbGUubmFtZSkgKyAnIGluICcgKyBhcnJpdmFsc1tpXS50cmlwc1tqXS5ldGFJbk1pbnMgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIG1pbnV0ZXMgPGJyIC8+JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQgPT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAnTm8gY3VycmVudCBhcnJpdmFscyBhdCB0aGlzIHN0b3AnO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChjb250ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93Lm9wZW4odm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIG1hcmtlcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgIFxyXG5cclxuICAgICAgICAvL1RPRE86IGFkZCByZW1vdmUgbGluZXMgZm9yIGNoZWNrIHVuY2hjZWsuXHJcbiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVNlbGVjdGVkUm91dGVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcnQgPSAwOyBydCA8IHZtLmZpbHRlcmVkUm91dGVzLmxlbmd0aDsgcnQrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdXRlID0gdm0uZmlsdGVyZWRSb3V0ZXNbcnRdO1xyXG4gICAgICAgICAgICAgICAgaWYocm91dGUuZGlzcGxheU9uTWFwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcFJvdXRlKHJvdXRlKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGlkZVJvdXRlKHJvdXRlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVJvdXRlKHJvdXRlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChyb3V0ZS5kaXNwbGF5T25NYXApXHJcbiAgICAgICAgICAgICAgICBtYXBSb3V0ZShyb3V0ZSlcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgaGlkZVJvdXRlKHJvdXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlBbGxWZWhpY2xlcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IodmFyIHJvdXRlSWQgaW4gdm0ucm91dGVzT25NYXApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS5kaXNwbGF5T25NYXApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VmVoaWNsZXNCeVJvdXRlKHJvdXRlSWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGFkanVzdE1hcEJvdW5kcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgbnVtYmVyT25NYXAgPSAwO1xyXG4gICAgICAgICAgICBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHJvdXRlIGluIHZtLnJvdXRlc09uTWFwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGVdLmRpc3BsYXlPbk1hcClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBudW1iZXJPbk1hcCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGVdLmxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcy51bmlvbihnZXRMaW5lQm91bmRzKHZtLnJvdXRlc09uTWFwW3JvdXRlXS5saW5lc1tpXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihudW1iZXJPbk1hcCA+IDApIFxyXG4gICAgICAgICAgICAgICAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoaWRlUm91dGUocm91dGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZih2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0hPSB1bmRlZmluZWQgJiYgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uZGlzcGxheU9uTWFwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmRpc3BsYXlPbk1hcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lc1tpXS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLnN0b3BzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5zdG9wc1tpXS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLnZlaGljbGVzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLnZlaGljbGVzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLnZlaGljbGVzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgYWRqdXN0TWFwQm91bmRzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gbWFwUm91dGUocm91dGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGUuaWRdICE9IHVuZGVmaW5lZCAmJiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmRpc3BsYXlPbk1hcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lc1tpXS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uc3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uc3RvcHNbaV0uc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZ2V0VmVoaWNsZXNCeVJvdXRlKHJvdXRlLmlkKTtcclxuICAgICAgICAgICAgICAgIGFkanVzdE1hcEJvdW5kcygpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXSA9IHsgcm91dGU6IHJvdXRlIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUm91dGUgPSByb3V0ZTtcclxuICAgICAgICAgICAgICAgIFJvdXRlU2VydmljZS5nZXRTaGFwZXNCeVJvdXRlKHJvdXRlLmlkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hhcGVzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaGFwZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlY29kZWRQYXRoID0gZ29vZ2xlLm1hcHMuZ2VvbWV0cnkuZW5jb2RpbmcuZGVjb2RlUGF0aChzaGFwZXNbaV0ubGluZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGluZSA9IG5ldyBnb29nbGUubWFwcy5Qb2x5bGluZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBkZWNvZGVkUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZUNvbG9yOiByb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDo1LCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25zOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5GT1JXQVJEX09QRU5fQVJST1csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogcm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMi41XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6ICcyNXB4JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQ6ICcyMDBweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6MVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmVTdHJva2UgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZGVjb2RlZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMS4wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiA4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgemluZGV4OjBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUuc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVN0cm9rZS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGxpbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lcy5wdXNoKGxpbmVTdHJva2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2JyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0ubGluZXMgPSBsaW5lcztcclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uZGlzcGxheU9uTWFwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGdldFN0b3BzQnlSb3V0ZShyb3V0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VmVoaWNsZXNCeVJvdXRlKHJvdXRlLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICBhZGp1c3RNYXBCb3VuZHMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbihkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sYXRpdHVkZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9PSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uem9vbSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0Llpvb21MZXZlbDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGdldEFsbFJvdXRlcygpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBnb1RvUm91dGUocm91dGVJZCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZml4ZWQtcm91dGUvcm91dGUvJyArIHJvdXRlSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBnb1RvU3RvcHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2ZpeGVkLXJvdXRlL3N0b3BzJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRMaW5lQm91bmRzKGxpbmUpIHtcclxuICAgICAgICAgICAgdmFyIGJvdW5kID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG4gICAgICAgICAgICBsaW5lLmdldFBhdGgoKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgYm91bmQuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcoaXRlbS5sYXQoKSwgaXRlbS5sbmcoKSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGJvdW5kO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFJvdXRlU3RhdHVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAuZ2V0Um91dGVzKClcclxuICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm91dGVzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggaW4gcm91dGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gJGZpbHRlcignZmlsdGVyJykodm0uZmlsdGVyZWRSb3V0ZXMsIHsgaWQ6IHJvdXRlc1tpbmRleF0uaWQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyLCBmdW5jdGlvbih2YWx1ZSwga2V5KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLklzQWN0aXZlID0gcm91dGVzW2luZGV4XS5Jc0FjdGl2ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsUm91dGVzKCkge1xyXG4gICAgICAgICAgICBSb3V0ZVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRSb3V0ZXMoKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzID0gcmVzdWx0LmRhdGE7ICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZpbHRlcmVkUm91dGVzID0gdm0ucm91dGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvbGxWZWhpY2xlc0ZvclJvdXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxTdG9wcygpIHtcclxuICAgICAgICAgICAgdm0uYWxsU3RvcHMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHN0b3BzcyA9IFtdO1xyXG4gICAgICAgICAgICBTdG9wU2VydmljZS5nZXRBbGxTdG9wcygpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFsbFN0b3BzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFsbFN0b3BzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RvcHNzLmluY2x1ZGVzKGFsbFN0b3BzW2ldLklkKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFsbFN0b3BzLnB1c2goYWxsU3RvcHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdG9wc3MucHVzaChhbGxTdG9wc1tpXS5JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5hbGxTdG9wcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuTmFtZSA+IGIuTmFtZSA/IDEgOiBhLk5hbWUgPT0gYi5OYW1lID8gMCA6IC0xO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXJlZFN0b3BzID0gdm0uYWxsU3RvcHM7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgZ2V0TWFwKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBzdG9wUG9sbGluZygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb2xsVmVoaWNsZXNGb3JSb3V0ZSgpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVBvbGwgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZ2V0Um91dGVTdGF0dXMoKTtcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlBbGxWZWhpY2xlcygpO1xyXG4gICAgICAgICAgICB9LCAzMDAwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BQb2xsaW5nKCkge1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodmVoaWNsZVBvbGwpKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHZlaGljbGVQb2xsKTtcclxuICAgICAgICAgICAgICAgIHZlaGljbGVQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvZml4ZWQtcm91dGUvcm91dGVzL2FsbC1yb3V0ZXMuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtZml4ZWQtcm91dGUtYWxsLXJvdXRlcyc7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VGaXhlZFJvdXRlTmF2ID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG4gIFxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0ZyU2NoZWR1bGVDb250cm9sbGVyJywgRnJTY2hlZHVsZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIEZyU2NoZWR1bGVDb250cm9sbGVyLiRpbmplY3QgPSBbJyR3aW5kb3cnLCAnRnJTY2hlZHVsZVNlcnZpY2UnLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZScsXHJcbiAgICAgJ0dlb0xvY2F0aW9uU2VydmljZScsICdnb29nbGVNYXBzQ29uZmlnJywgJ3VpR21hcElzUmVhZHknLCAnUGFnZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRnJTY2hlZHVsZUNvbnRyb2xsZXIoJHdpbmRvdywgRnJTY2hlZHVsZVNlcnZpY2UsIFNjaGVkdWxlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLFxyXG4gICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UsIGdvb2dsZU1hcHNDb25maWcsIHVpR21hcElzUmVhZHksIFBhZ2VTZXJ2aWNlLE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnNjaGVkdWxlO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbklkO1xyXG4gICAgICAgIHZtLnNjaGVkdWxlVmlldztcclxuICAgICAgICB2bS5zaG93QmFja0J1dHRvbiA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dUcmlwID0gc2hvd1RyaXA7XHJcbiAgICAgICAgdm0uc2hvd1NjaGVkdWxlcyA9IHNob3dTY2hlZHVsZXM7XHJcbiAgICAgICAgdm0uZmlsdGVyRW1wdHlUaW1lcyA9IGZpbHRlckVtcHR5VGltZXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnU2NoZWR1bGUnKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCkuYWxpYXMpO1xyXG4gICAgICAgIC8vbWFwIHN0dWZmXHJcbiAgICAgICAgdmFyIGNsb3Nlc3RQaW4sIG90aGVyUGluLCBsb2NhdGlvblBpbiwgbXlMb2NhdGlvblBpbiwgaHViSWNvbjtcclxuICAgICAgICBpZiAoJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJUcmlkZW50XCIpID4gMCB8fCAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUVcIikgPiAwKSB7XHJcblxyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24ucG5nJztcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnN2Zyc7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICB2bS56b29tID0gMTU7XHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogNDcuNjA0MzU2LFxyXG4gICAgICAgICAgICBsb25naXR1ZGU6IC0xMjIuMzM2MDgxN1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubXlTdHlsZXMgPSBnb29nbGVNYXBzQ29uZmlnLm1hcFN0eWxlcztcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IHZtLm15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubXlMb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgIHVybDogbXlMb2NhdGlvblBpbixcclxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoNDIsIDQyKSxcclxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIwLCAyMClcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTtcclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlLmdldEN1cnJlbnRQb3NpdGlvbigpLnRoZW4oZnVuY3Rpb24gKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3Jkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB2bS5teUxvY2F0aW9uSWNvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcG9zaXRpb24gZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbihkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vbWFwIHN0dWZmXHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgaWYgKGRpdmlzaW9uSWQgIT0gbnVsbCAmJiBkaXZpc2lvbklkICE9IHVuZGVmaW5lZCAmJiBkaXZpc2lvbklkICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGF0ZVNjaGVkdWxlKCk7XHJcbiAgICAgICAgICAgICAgICBnZXRNYXAoKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZVNjaGVkdWxlKCkge1xyXG4gICAgICAgICAgICBGclNjaGVkdWxlU2VydmljZS5nZXRTY2hlZHVsZShkaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlVmlldyA9IGFuZ3VsYXIuY29weSh2bS5zY2hlZHVsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93U2NoZWR1bGVzKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uc2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlVmlldyA9IHZtLnNjaGVkdWxlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVTY2hlZHVsZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZtLnNob3dCYWNrQnV0dG9uID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93VHJpcCh0cmlwSWQpIHtcclxuICAgICAgICAgICAgdmFyIHRyaXBTY2hlZHVsZTtcclxuICAgICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB2bS5zY2hlZHVsZS5yb3V0ZXMubGVuZ3RoOyByKyspIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHMgPSAwOyBzIDwgdm0uc2NoZWR1bGUucm91dGVzW3JdLnN0b3BzLmxlbmd0aDsgcysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCB2bS5zY2hlZHVsZS5yb3V0ZXNbcl0uc3RvcHNbc10udHJpcHMubGVuZ3RoOyB0KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXS50cmlwc1t0XS5pZCA9PSB0cmlwSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdHJpcFNjaGVkdWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlLnJvdXRlcyA9IFtdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlLnJvdXRlcy5wdXNoKGFuZ3VsYXIuY29weSh2bS5zY2hlZHVsZS5yb3V0ZXNbcl0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlLnJvdXRlc1swXS5zdG9wcy5wdXNoKGFuZ3VsYXIuY29weSh2bS5zY2hlZHVsZS5yb3V0ZXNbcl0uc3RvcHNbc10pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzWzBdLnRyaXBzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlLnJvdXRlc1swXS5zdG9wc1swXS50cmlwcy5wdXNoKGFuZ3VsYXIuY29weSh2bS5zY2hlZHVsZS5yb3V0ZXNbcl0uc3RvcHNbc10udHJpcHNbdF0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzU3RvcEZvdW5kID0gZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBzcyA9IDA7IHNzIDwgdHJpcFNjaGVkdWxlLnJvdXRlc1swXS5zdG9wcy5sZW5ndGg7IHNzKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXS5pZCA9PSB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzW3NzXS5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTdG9wRm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlLnJvdXRlc1swXS5zdG9wc1tzc10udHJpcHMucHVzaChhbmd1bGFyLmNvcHkodm0uc2NoZWR1bGUucm91dGVzW3JdLnN0b3BzW3NdLnRyaXBzW3RdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1N0b3BGb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzLnB1c2goYW5ndWxhci5jb3B5KHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzW3RyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHMubGVuZ3RoIC0gMV0udHJpcHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFNjaGVkdWxlLnJvdXRlc1swXS5zdG9wc1t0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzLmxlbmd0aCAtIDFdLnRyaXBzLnB1c2goYW5ndWxhci5jb3B5KHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXS50cmlwc1t0XSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9CaW5kIHRoZSB0cmlwIHNjaGVkdWxlIHRvIHRoZSB2aWV3XHJcbiAgICAgICAgICAgIHZtLnNjaGVkdWxlVmlldyA9IHRyaXBTY2hlZHVsZTtcclxuICAgICAgICAgICAgdm0uc2hvd0JhY2tCdXR0b24gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyRW1wdHlUaW1lcyh0cmlwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cmlwLnRpbWUubGVuZ3RoID4gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vVUkgSU5URVJBQ1RJT05TXHJcbiAgICAgICAgLy9BZGRzIGFuZCByZW1vdmVzIHRoZSBhY3RpdmUgY2xhc3MgdG8gdGhlIHBhcmVudCBvZiBhbiBlbGVtZW50LlxyXG4gICAgICAgIHZtLmhpZ2hsaWdodFBhcmVudCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChlLnRhcmdldCkucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5ibHVyUGFyZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGUudGFyZ2V0KS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9maXhlZC1yb3V0ZS9zY2hlZHVsZS9mci1zY2hlZHVsZS5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1maXhlZC1yb3V0ZS1zY2hlZHVsZSc7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VGaXhlZFJvdXRlTmF2ID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5zZXJ2aWNlKCdGaXhlZFJvdXRlTm90aWZpY2F0aW9uc1NlcnZpY2UnLCBGaXhlZFJvdXRlTm90aWZpY2F0aW9uc1NlcnZpY2UpO1xyXG5cclxuICAgIEZpeGVkUm91dGVOb3RpZmljYXRpb25zU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBGaXhlZFJvdXRlTm90aWZpY2F0aW9uc1NlcnZpY2UoJGh0dHAsICRxLCBlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBfZ2V0XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldChkaXZpc2lvbklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WRml4ZWRSb3V0ZUFwaVVybCArIFwibm90aWZpY2F0aW9ucy9cIiArIGRpdmlzaW9uSWRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLnNlcnZpY2UoJ0ZyU2NoZWR1bGVTZXJ2aWNlJywgRnJTY2hlZHVsZVNlcnZpY2UpO1xyXG5cclxuICAgIEZyU2NoZWR1bGVTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEZyU2NoZWR1bGVTZXJ2aWNlKCRodHRwLCAkcSwgZW52KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcblxyXG4gICAgICAgICAgICBnZXRTY2hlZHVsZTogX2dldFNjaGVkdWxlXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXQodXJsU2VnbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkZpeGVkUm91dGVBcGlVcmwgKyB1cmxTZWdtZW50XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRTY2hlZHVsZShkaXZpc2lvbklkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KCdzY2hlZHVsZS8nICsgZGl2aXNpb25JZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmZhY3RvcnkoJ1JvdXRlU2VydmljZScsIFJvdXRlU2VydmljZSk7XHJcbiAgICBSb3V0ZVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52JywgJ0RpdmlzaW9uU2VydmljZSddO1xyXG4gICAgZnVuY3Rpb24gUm91dGVTZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBEaXZpc2lvblNlcnZpY2UpXHJcbiAgICB7XHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFJvdXRlKHJvdXRlSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldChyb3V0ZUlkICsgJy8nICsgZGl2aXNpb25JZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0Um91dGVzKCkge1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KCdhbGxSb3V0ZXMvJyArIGRpdmlzaW9uSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFNoYXBlc0J5Um91dGUocm91dGVJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KCdzaGFwZXNCeVJvdXRlLycgKyByb3V0ZUlkICsgJy8nICsgZGl2aXNpb25JZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0Um91dGVzRm9yU3RvcChzdG9wSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3JvdXRlc0J5U3RvcC8nICsgc3RvcElkICsgJy8nICsgZGl2aXNpb25JZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0QXJyaXZhbHNGb3JSb3V0ZShyb3V0ZUlkLCBkaXZpc2lvbklkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KGRpdmlzaW9uSWQgKyAnL2Fycml2YWxzRm9yUm91dGUvJyArIHJvdXRlSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFZlaGljbGVzRm9yUm91dGUocm91dGVJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KGRpdmlzaW9uSWQgKyAnL3ZlaGljbGVzQnlSb3V0ZS8nICsgcm91dGVJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldCh1cmxTZWdtZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WRml4ZWRSb3V0ZUFwaVVybCArICdyb3V0ZS8nICsgdXJsU2VnbWVudFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldFJvdXRlSW5mbyA6IF9nZXRSb3V0ZSxcclxuICAgICAgICAgICAgZ2V0Um91dGVzOiBfZ2V0Um91dGVzLFxyXG4gICAgICAgICAgICBnZXRTaGFwZXNCeVJvdXRlOiBfZ2V0U2hhcGVzQnlSb3V0ZSxcclxuICAgICAgICAgICAgZ2V0Um91dGVzRm9yU3RvcDogX2dldFJvdXRlc0ZvclN0b3AsXHJcbiAgICAgICAgICAgIGdldEFycml2YWxzRm9yUm91dGU6IF9nZXRBcnJpdmFsc0ZvclJvdXRlLFxyXG4gICAgICAgICAgICBnZXRWZWhpY2xlc0ZvclJvdXRlIDogX2dldFZlaGljbGVzRm9yUm91dGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTsgICAgICAgIFxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAgICAuZmFjdG9yeSgnU3RvcFNlcnZpY2UnLCBTdG9wU2VydmljZSk7XHJcblxyXG4gICAgU3RvcFNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52J107XHJcblxyXG4gICAgZnVuY3Rpb24gU3RvcFNlcnZpY2UoJGh0dHAsICRxLCBlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuXHJcbiAgICAgICAgICAgIGdldFN0b3BzQnlSb3V0ZTogX2dldFN0b3BzQnlSb3V0ZSxcclxuICAgICAgICAgICAgZ2V0QXJyaXZhbHNGb3JTdG9wOiBfZ2V0QXJyaXZhbHNGb3JTdG9wLFxyXG4gICAgICAgICAgICBnZXRBbGxTdG9wczogX2dldEFsbFN0b3BzLFxyXG4gICAgICAgICAgICBnZXRTdG9wc0ZvclN0b3A6IF9nZXRTdG9wc0ZvclN0b3AsXHJcbiAgICAgICAgICAgIGdldEFycml2YWxzQnlTdG9wSWQ6IF9nZXRBcnJpdmFsc0J5U3RvcElkLFxyXG4gICAgICAgICAgICBnZXRVcGNvbWluZ0Fycml2YWxzRm9yU3RvcDogX2dldFVwY29taW5nQXJyaXZhbHNGb3JTdG9wXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldEFsbFN0b3BzKGRpdmlzaW9uSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3N0b3BzLycgKyBkaXZpc2lvbklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRTdG9wc0J5Um91dGUoZGl2aXNpb25JZCwgcm91dGVJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldCgnc3RvcHMvJyArIGRpdmlzaW9uSWQgKyAnL3N0b3BzQnlSb3V0ZS8nICsgcm91dGVJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0QXJyaXZhbHNGb3JTdG9wKGRpdmlzaW9uSWQsIGZyb21TdG9wSWQsIHRvU3RvcElkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KCdzdG9wcy8nICsgZGl2aXNpb25JZCArICcvYXJyaXZhbHNCeVN0b3AvJyArIGZyb21TdG9wSWQgKyAnLycgKyB0b1N0b3BJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0VXBjb21pbmdBcnJpdmFsc0ZvclN0b3AoZGl2aXNpb25JZCwgZnJvbVN0b3BJZCwgdG9TdG9wSWQsIG5vT2ZBcnJpdmFscykge1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldCgnc3RvcHMvJyArIGRpdmlzaW9uSWQgKyAnL2Fycml2YWxzQnlTdG9wLycgKyBmcm9tU3RvcElkICsgJy8nICsgdG9TdG9wSWQgKyAnLycgKyBub09mQXJyaXZhbHMgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFN0b3BzRm9yU3RvcChzdG9wSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3N0b3BzQnlTdG9wLycgKyBzdG9wSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0QXJyaXZhbHNCeVN0b3BJZChkaXZpc2lvbklkLCBzdG9wSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3N0b3BzLycgKyBkaXZpc2lvbklkICsgJy9hcnJpdmFscy8nICsgc3RvcElkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXQodXJsU2VnbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkZpeGVkUm91dGVBcGlVcmwgKyB1cmxTZWdtZW50XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9ICAgICAgIFxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmZhY3RvcnkoJ1ZlaGljbGVTZXJ2aWNlJywgVmVoaWNsZVNlcnZpY2UpO1xyXG4gICAgVmVoaWNsZVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnQ29uZmlnRmFjdG9yeScsICdlbnYnLCAnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVmVoaWNsZVNlcnZpY2UoJGh0dHAsICRxLCBDb25maWdGYWN0b3J5LCBlbnYsIERpdmlzaW9uU2VydmljZSlcclxuICAgIHtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgIGdldFZlaGljbGVzRm9yUm91dGU6IF9nZXRWZWhpY2xlc0ZvclJvdXRlXHJcbiAgICAgICAgXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBfZ2V0VmVoaWNsZXNGb3JSb3V0ZShyb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgdmFyIHVybCA9IF9nZXRVcmwoKTtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiB1cmwgKyAnZml4ZWRyb3V0ZS8nICsgZGl2aXNpb25JZCArICcvdmVoaWNsZXNCeVJvdXRlLycgKyByb3V0ZUlkXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFVybCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gZW52Lm9uZU1WRml4ZWRSb3V0ZUFwaVVybDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdGclN0b3BzQ29udHJvbGxlcicsIEZyU3RvcHNDb250cm9sbGVyKTtcclxuXHJcbiAgICBGclN0b3BzQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHdpbmRvdycsICdTdG9wU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnR2VvTG9jYXRpb25TZXJ2aWNlJyxcclxuICAgICAgICAnU2NoZWR1bGVTZXJ2aWNlJywgJ2dvb2dsZU1hcHNDb25maWcnLCAndWlHbWFwSXNSZWFkeScsICdSb3V0ZVNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRnJTdG9wc0NvbnRyb2xsZXIoJGxvY2F0aW9uLCAkd2luZG93LCBTdG9wU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBHZW9Mb2NhdGlvblNlcnZpY2UsXHJcbiAgICAgICAgIFNjaGVkdWxlU2VydmljZSwgZ29vZ2xlTWFwc0NvbmZpZywgdWlHbWFwSXNSZWFkeSwgUm91dGVTZXJ2aWNlLCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5zZWxlY3RlZEZyb21TdG9wO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkVG9TdG9wO1xyXG4gICAgICAgIHZtLmFsbFN0b3BzO1xyXG4gICAgICAgIHZtLmZyb21TdG9wcztcclxuICAgICAgICB2bS50b1N0b3BzO1xyXG4gICAgICAgIHZtLnBvcHVsYXRlRnJvbVN0b3BzID0gcG9wdWxhdGVGcm9tU3RvcHM7XHJcbiAgICAgICAgdm0uc2VsZWN0RnJvbVN0b3AgPSBzZWxlY3RGcm9tU3RvcDtcclxuICAgICAgICB2bS5wb3B1bGF0ZVRvU3RvcHMgPSBwb3B1bGF0ZVRvU3RvcHM7XHJcbiAgICAgICAgdm0uc2VsZWN0VG9TdG9wID0gc2VsZWN0VG9TdG9wO1xyXG4gICAgICAgIHZtLmdvdG9Sb3V0ZXMgPSBnb3RvUm91dGVzO1xyXG4gICAgICAgIHZtLmdvdG9TdG9wcyA9IGdvdG9TdG9wcztcclxuICAgICAgICB2bS5oYW5kbGVLZXlQcmVzcyA9IGhhbmRsZUtleVByZXNzO1xyXG4gICAgICAgIHZtLm1hcFJvdXRlID0gbWFwUm91dGU7XHJcbiAgICAgICAgdm0uY2xlYXJQaW5zID0gY2xlYXJQaW5zO1xyXG4gICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS51cGNvbWluZ1NjaGVkdWxlcztcclxuICAgICAgICB2bS5zaG93RnJvbVN0b3BzID0gdHJ1ZTtcclxuICAgICAgICB2bS5zaG93VG9TdG9wcyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dSb3V0ZXMgPSBmYWxzZTtcclxuICAgICAgICB2bS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICB2YXIgZnJvbVN0b3BQaW4gPSAnaW1hZ2VzL2J1cy1ncmVlbi5zdmcnO1xyXG4gICAgICAgIHZhciB0b1N0b3BQaW4gPSAnaW1hZ2VzL2J1cy1kYXJrYmx1ZS5zdmcnO1xyXG4gICAgICAgIHZhciBtYXJrZXJzID0gW107XHJcbiAgICAgICAgdmFyIGJvdW5kcztcclxuICAgICAgICB2bS5yb3V0ZXNPbk1hcCA9IFtdO1xyXG4gICAgICAgIHZtLmFjdGl2ZVNjaGVkdWxlO1xyXG4gICAgICAgIHZtLmlzQW55Um91dGVTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ1N0b3BzJyk7XHJcbiAgICAgICAgUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXRGaXhlZFJvdXRlSW5mbygpLmFsaWFzKTtcclxuICAgICAgICAvL3ZhciBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coeyBjb250ZW50OiAnJyB9KTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLy9tYXAgc3R1ZmZcclxuICAgICAgICB2YXIgY2xvc2VzdFBpbiwgb3RoZXJQaW4sIGxvY2F0aW9uUGluLCBteUxvY2F0aW9uUGluLCBodWJJY29uO1xyXG4gICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuXHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24uc3ZnJztcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLnpvb20gPSAxNTtcclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgIGxhdGl0dWRlOiA0Ny42MDQzNTYsXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTEyMi4zMzYwODE3XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teVN0eWxlcyA9IGdvb2dsZU1hcHNDb25maWcubWFwU3R5bGVzO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogdm0ubXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teUxvY2F0aW9uSWNvbiA9IHtcclxuICAgICAgICAgICAgdXJsOiBteUxvY2F0aW9uUGluLFxyXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjAsIDIwKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1hcCgpIHtcclxuICAgICAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG4gICAgICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlLmdldEN1cnJlbnRQb3NpdGlvbigpLnRoZW4oZnVuY3Rpb24gKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3Jkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB2bS5teUxvY2F0aW9uSWNvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcG9zaXRpb24gZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbih2bS5kaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdldExpbmVCb3VuZHMobGluZSkge1xyXG4gICAgICAgICAgICB2YXIgYm91bmQgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgIGxpbmUuZ2V0UGF0aCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBib3VuZC5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhpdGVtLmxhdCgpLCBpdGVtLmxuZygpKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gYm91bmQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmdW5jdGlvbiBzZXRNYXBCb3VuZHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobWFya2Vyc1tpXS5wb3NpdGlvbik7XHJcbiAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5zZXRab29tKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmdldFpvb20oKSAtIDEpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gYWRqdXN0TWFwQm91bmRzKCkge1xyXG4gICAgICAgICAgICB2YXIgbnVtYmVyT25NYXAgPSAwO1xyXG4gICAgICAgICAgICBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHJvdXRlIGluIHZtLnJvdXRlc09uTWFwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGVdLmRpc3BsYXlPbk1hcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlck9uTWFwKys7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZV0ubGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzLnVuaW9uKGdldExpbmVCb3VuZHModm0ucm91dGVzT25NYXBbcm91dGVdLmxpbmVzW2ldKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChudW1iZXJPbk1hcCA+IDApXHJcbiAgICAgICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gaGlkZVJvdXRlT25NYXAocm91dGUpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXSAhPSB1bmRlZmluZWQgJiYgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uZGlzcGxheU9uTWFwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmRpc3BsYXlPbk1hcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lc1tpXS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGFkanVzdE1hcEJvdW5kcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyQWxsUm91dGVzT25NYXAoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdm0ucm91dGVzT25NYXAubGVuZ3RoOyByKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyXSAhPSB1bmRlZmluZWQgJiYgdm0ucm91dGVzT25NYXBbcl0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyXS5kaXNwbGF5T25NYXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcl0uZGlzcGxheU9uTWFwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcl0ubGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JdLmxpbmVzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGp1c3RNYXBCb3VuZHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1JvdXRlT25NYXAocm91dGUpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXSAhPSB1bmRlZmluZWQgJiYgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5kaXNwbGF5T25NYXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0ubGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0ubGluZXNbaV0uc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGFkanVzdE1hcEJvdW5kcygpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXSA9IHtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIFJvdXRlU2VydmljZS5nZXRTaGFwZXNCeVJvdXRlKHJvdXRlLmlkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2hhcGVzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaGFwZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRlY29kZWRQYXRoID0gZ29vZ2xlLm1hcHMuZ2VvbWV0cnkuZW5jb2RpbmcuZGVjb2RlUGF0aChzaGFwZXNbaV0ubGluZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBsaW5lID0gbmV3IGdvb2dsZS5tYXBzLlBvbHlsaW5lKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgcGF0aDogZGVjb2RlZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHN0cm9rZUNvbG9yOiByb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgc3Ryb2tlT3BhY2l0eTogMS4wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBzdHJva2VXZWlnaHQ6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIGljb25zOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLlN5bWJvbFBhdGguRk9SV0FSRF9PUEVOX0FSUk9XXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgb2Zmc2V0OiAnMjVweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICByZXBlYXQ6ICcxMDBweCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgfV1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5lID0gbmV3IGdvb2dsZS5tYXBzLlBvbHlsaW5lKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGRlY29kZWRQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlQ29sb3I6IHJvdXRlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbnM6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkZPUldBUkRfT1BFTl9BUlJPVyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiByb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAyLjVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogJzI1cHgnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdDogJzIwMHB4JyxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmVTdHJva2UgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZGVjb2RlZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMS4wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiA4LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgemluZGV4OiAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lU3Ryb2tlLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZVN0cm9rZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lcyA9IGxpbmVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5kaXNwbGF5T25NYXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkanVzdE1hcEJvdW5kcygpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmdW5jdGlvbiBkcm9wU3RvcE1hcmtlcihzdG9wLCBmcm9tVG8pIHtcclxuXHJcbiAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHN0b3BNYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHN0b3AuTGF0aXR1ZGUsIHN0b3AuTG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgIG9wdGltaXplZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBpY29uOiB7IHVybDogZnJvbVRvID09IFwiZnJvbVwiID8gZnJvbVN0b3BQaW4gOiB0b1N0b3BQaW4sIHNjYWxlZFNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDI4LCAyNCkgfSxcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHN0b3BNYXJrZXIuaWQgPSBzdG9wLklkO1xyXG4gICAgICAgICAgIHN0b3BNYXJrZXIuc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgbWFya2Vycy5wdXNoKHN0b3BNYXJrZXIpO1xyXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihzdG9wTWFya2VyLCAnY2xpY2snLCBzaG93U3RvcE5hbWVXaW5kb3coc3RvcCwgc3RvcE1hcmtlcikpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1N0b3BOYW1lV2luZG93KHN0b3AsIG1hcmtlcikge1xyXG4gICAgICAgICAgICB2YXIgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHsgY29udGVudDogJycgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9ICc8c3BhbiBzdHlsZT1cImZvbnQtd2VpZ2h0OiBib2xkO1wiPicgKyBzdG9wLk5hbWUgKyAnPC9zcGFuPjxiciAvPic7XHJcbiAgICAgICAgICAgICAgICBpbmZvV2luZG93LnNldENvbnRlbnQoY29udGVudCk7XHJcbiAgICAgICAgICAgICAgICBpbmZvV2luZG93Lm9wZW4odm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIG1hcmtlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGZ1bmN0aW9uIGRlbGV0ZU1hcmtlcihpZCkge1xyXG4gICAgICAgICAgICAvL0ZpcnN0IGNsZWFyIGFsbCB0aGUgcm91dGVzIG9uIHRoZSBtYXBcclxuICAgICAgICAgICAgY2xlYXJBbGxSb3V0ZXNPbk1hcCgpO1xyXG4gICAgICAgICAgICAvL0ZpbmQgYW5kIHJlbW92ZSB0aGUgbWFya2VyIGZyb20gdGhlIEFycmF5XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1hcmtlcnNbaV0uaWQgPT0gaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1JlbW92ZSB0aGUgbWFya2VyIGZyb20gTWFwICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2Vyc1tpXS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9SZW1vdmUgdGhlIG1hcmtlciBmcm9tIGFycmF5LlxyXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlcnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy9tYXAgc3R1ZmZcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ290b1JvdXRlcygpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2ZpeGVkLXJvdXRlL2FsbFJvdXRlcycpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnb3RvU3RvcHMoKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdmaXhlZC1yb3V0ZS9zdG9wcycpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmRpdmlzaW9uSWQgIT0gbnVsbCAmJiB2bS5kaXZpc2lvbklkICE9IHVuZGVmaW5lZCAmJiB2bS5kaXZpc2lvbklkICE9ICcnKSB7IGdldE1hcCgpOyB9O1xyXG4gXHJcbiAgICAgICAgICAgICQoXCIjdHh0RnJvbVN0b3BOYW1lXCIpLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTsvL0FjdGl2YXRlIHRoZSBjbGFzcyB0byBoaWdobGlnaHQgdGhlIGlucHV0IGNvbnRyb2xcclxuICAgICAgICAgICAgcG9wdWxhdGVGcm9tU3RvcHMoKTsvL0xvYWQgdGhlIGZyb20gc3RvcHNcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vVUkgSU5URVJBQ1RJT05TXHJcbiAgICAgICAgLy9BZGRzIGFuZCByZW1vdmVzIHRoZSBhY3RpdmUgY2xhc3MgdG8gdGhlIHBhcmVudCBvZiBhbiBlbGVtZW50LlxyXG4gICAgICAgIHZtLmhpZ2hsaWdodFBhcmVudCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChlLnRhcmdldCkucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5ibHVyUGFyZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGUudGFyZ2V0KS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL0ZpeCB0byBoYW5kbGUgdXNlciBoaXR0aW5nIGJhY2tzcGFjZSB0byBjbGVhciB0aGUgc3RvcC5cclxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVLZXlQcmVzcyhlLCBmcm9tVG8pIHtcclxuICAgICAgICAgICAgaWYgKCAoZSAmJiBlLmtleUNvZGUgPT09IDgpICYmIC8vY2hlY2sgZm9yIGJhY2tzcGFjZVxyXG4gICAgICAgICAgICAgICAgIChlLmN1cnJlbnRUYXJnZXQgJiYgZS5jdXJyZW50VGFyZ2V0LnNlbGVjdGlvblN0YXJ0ID09IDAgJiYgZS5jdXJyZW50VGFyZ2V0LnNlbGVjdGlvbkVuZCA9PSBlLmN1cnJlbnRUYXJnZXQudmFsdWUubGVuZ3RoKSkgeyAvL2NoZWNrIHdoZW4gYmFja3NwYWNlIGlzIGhpdCwgaWYgdGhlIHdob2xlIHRleHQgaXMgc2VsZWN0ZWRcclxuICAgICAgICAgICAgICAgIGlmIChmcm9tVG8gPT0gXCJmcm9tXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5mcm9tU3RvcE5hbWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyRnJvbVN0b3AoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udG9TdG9wTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUb1N0b3AoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlRnJvbVN0b3BzKCkge1xyXG4gICAgICAgICAgICB2bS5zaG93RnJvbVN0b3BzID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uc2hvd1RvU3RvcHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uc2hvd1JvdXRlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uZnJvbVN0b3BzID0gW107XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZEZyb21TdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3R4dEZyb21TdG9wTmFtZVwiKS5zZWxlY3QoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHZtLmFsbFN0b3BzICYmIHZtLmFsbFN0b3BzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaWx0ZXJlZExpc3QgPSBbXTtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFRvU3RvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uYWxsU3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFsbFN0b3BzW2ldLklkICE9IHZtLnNlbGVjdGVkVG9TdG9wLklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZExpc3QucHVzaCh2bS5hbGxTdG9wc1tpXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRMaXN0ID0gdm0uYWxsU3RvcHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2bS5mcm9tU3RvcHMgPSBmaWx0ZXJlZExpc3Q7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBTdG9wU2VydmljZS5nZXRBbGxTdG9wcyh2bS5kaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFsbFN0b3BzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmZyb21TdG9wcyA9IHZtLmFsbFN0b3BzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZVRvU3RvcHMoKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dGcm9tU3RvcHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uc2hvd1RvU3RvcHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5zaG93Um91dGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS50b1N0b3BzID0gW107XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFRvU3RvcCkge1xyXG4gICAgICAgICAgICAgICAgJChcIiN0eHRUb1N0b3BOYW1lXCIpLnNlbGVjdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uYWxsU3RvcHMgJiYgdm0uYWxsU3RvcHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkTGlzdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkRnJvbVN0b3ApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLmFsbFN0b3BzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5hbGxTdG9wc1tpXS5JZCAhPSB2bS5zZWxlY3RlZEZyb21TdG9wLklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZExpc3QucHVzaCh2bS5hbGxTdG9wc1tpXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRMaXN0ID0gdm0uYWxsU3RvcHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2bS50b1N0b3BzID0gZmlsdGVyZWRMaXN0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgU3RvcFNlcnZpY2UuZ2V0QWxsU3RvcHModm0uZGl2aXNpb25JZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5hbGxTdG9wcyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50b1N0b3BzID0gdm0uYWxsU3RvcHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdEZyb21TdG9wKHN0b3ApIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkRnJvbVN0b3ApIHsgZGVsZXRlTWFya2VyKHZtLnNlbGVjdGVkRnJvbVN0b3AuSWQpIH07XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkRnJvbVN0b3AgPSBzdG9wO1xyXG4gICAgICAgICAgICB2bS5mcm9tU3RvcE5hbWUgPSB2bS5zZWxlY3RlZEZyb21TdG9wLk5hbWU7XHJcblxyXG4gICAgICAgICAgICBkcm9wU3RvcE1hcmtlcihzdG9wLCBcImZyb21cIik7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkVG9TdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3R4dFRvU3RvcE5hbWVcIikuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0RnJvbVN0b3BOYW1lXCIpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsvL1JlbW92ZSB0aGUgY2xhc3MgdG8gaGlnaGxpZ2h0IHRoZSBpbnB1dCBjb250cm9sXHJcbiAgICAgICAgICAgICAgICAkKFwiI3R4dFRvU3RvcE5hbWVcIikucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOy8vQWN0aXZhdGUgdGhlIGNsYXNzIHRvIGhpZ2hsaWdodCB0aGUgaW5wdXQgY29udHJvbFxyXG5cclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlVG9TdG9wcygpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd1JvdXRlc0ZvclNlbGVjdGVkU3RvcHMoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdFRvU3RvcChzdG9wKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFRvU3RvcCkgeyBkZWxldGVNYXJrZXIodm0uc2VsZWN0ZWRUb1N0b3AuSWQpIH07XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkVG9TdG9wID0gc3RvcDtcclxuICAgICAgICAgICAgdm0udG9TdG9wTmFtZSA9IHZtLnNlbGVjdGVkVG9TdG9wLk5hbWU7XHJcblxyXG4gICAgICAgICAgICBkcm9wU3RvcE1hcmtlcihzdG9wLCBcInRvXCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEZyb21TdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3R4dEZyb21TdG9wTmFtZVwiKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVGcm9tU3RvcHMoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNob3dSb3V0ZXNGb3JTZWxlY3RlZFN0b3BzKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXBSb3V0ZShzY2hlZHVsZSkge1xyXG4gICAgICAgICAgICBpZiAoc2NoZWR1bGUuaXNTZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgc2hvd1JvdXRlT25NYXAoc2NoZWR1bGUucm91dGUpO1xyXG4gICAgICAgICAgICAgICAgdm0uYWN0aXZlU2NoZWR1bGUgPSBzY2hlZHVsZTtcclxuICAgICAgICAgICAgICAgIHZtLmlzQW55Um91dGVTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBoaWRlUm91dGVPbk1hcChzY2hlZHVsZS5yb3V0ZSk7XHJcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVTY2hlZHVsZSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uaXNIaWRkZW4gPSBzY2hlZHVsZS5pc1NlbGVjdGVkO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyRnJvbVN0b3AoKSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZU1hcmtlcih2bS5zZWxlY3RlZEZyb21TdG9wLklkKVxyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZEZyb21TdG9wID0gbnVsbDtcclxuICAgICAgICAgICAgcG9wdWxhdGVGcm9tU3RvcHMoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhclRvU3RvcCgpIHtcclxuICAgICAgICAgICAgZGVsZXRlTWFya2VyKHZtLnNlbGVjdGVkVG9TdG9wLklkKVxyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFRvU3RvcCA9IG51bGw7XHJcbiAgICAgICAgICAgIHBvcHVsYXRlVG9TdG9wcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dSb3V0ZXNGb3JTZWxlY3RlZFN0b3BzKCkge1xyXG4gICAgICAgICAgICBzZXRNYXBCb3VuZHMoKTtcclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZEZyb21TdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3R4dEZyb21TdG9wTmFtZVwiKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVGcm9tU3RvcHMoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRUb1N0b3ApIHtcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0VG9TdG9wTmFtZVwiKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVUb1N0b3BzKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2bS5zaG93RnJvbVN0b3BzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNob3dUb1N0b3BzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnNob3dSb3V0ZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5sb2FkaW5nUm91dGVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgU3RvcFNlcnZpY2UuZ2V0QXJyaXZhbHNGb3JTdG9wKHZtLmRpdmlzaW9uSWQsIHZtLnNlbGVjdGVkRnJvbVN0b3AuSWQsIHZtLnNlbGVjdGVkVG9TdG9wLklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZ1JvdXRlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwY29taW5nU2NoZWR1bGVzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnVwY29taW5nU2NoZWR1bGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVwY29taW5nU2NoZWR1bGVzW2ldLmlzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNBbnlSb3V0ZVNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyUGlucygpIHtcclxuICAgICAgICAgICAgdm0uaXNIaWRkZW4gPSAhdm0uaXNIaWRkZW47XHJcbiAgICAgICAgICAgIGlmICghdm0uaXNIaWRkZW4pIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udXBjb21pbmdTY2hlZHVsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS51cGNvbWluZ1NjaGVkdWxlc1tpXS5pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5pc0FueVJvdXRlU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGNsZWFyQWxsUm91dGVzT25NYXAoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvZml4ZWQtcm91dGUvc3RvcHMvZnItc3RvcHMuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtZml4ZWQtcm91dGUtc3RvcHMnO1xyXG4gICAgICAgIHZtLmlvbmljVXNlRml4ZWRSb3V0ZU5hdiA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignU3RvcHNGb3JSb3V0ZUNvbnRyb2xsZXInLCBTdG9wc0ZvclJvdXRlQ29udHJvbGxlcik7XHJcblxyXG4gICAgU3RvcHNGb3JSb3V0ZUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRzdGF0ZVBhcmFtcycsICckaW50ZXJ2YWwnLCAnJHNjb3BlJyxcclxuICAgICAgICAnR2VvTG9jYXRpb25TZXJ2aWNlJywgJ2dvb2dsZU1hcHNDb25maWcnLCAndWlHbWFwSXNSZWFkeScsICdSb3V0ZVNlcnZpY2UnLFxyXG4gICAgICAgICAnRGl2aXNpb25TZXJ2aWNlJywgJ1NjaGVkdWxlU2VydmljZScsICdQb3J0YWxVdGlsaXR5U2VydmljZScsICdQYWdlU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTdG9wc0ZvclJvdXRlQ29udHJvbGxlcigkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGludGVydmFsLCAkc2NvcGUsXHJcbiAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlLCBnb29nbGVNYXBzQ29uZmlnLCB1aUdtYXBJc1JlYWR5LCBSb3V0ZVNlcnZpY2UsXHJcbiAgICAgICAgIERpdmlzaW9uU2VydmljZSwgU2NoZWR1bGVTZXJ2aWNlLCBQb3J0YWxVdGlsaXR5U2VydmljZSwgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzOyAgICAgICAgXHJcbiAgICAgICAgdmFyIHZlaGljbGVQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBhcnJpdmFsUG9sbCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgZGl2aXNpb25JZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgcm91dGVJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgdmVoaWNsZVBvbGxJbnRlcnZhbCA9IDIwMDAwO1xyXG4gICAgICAgIHZhciBhcnJpdmFsUG9sbEludGVydmFsID0gMjAwMDA7XHJcbiAgICAgICAgdmFyIGZpeGVkUm91dGVMYW5kaW5nUm91dGUgPSAnZml4ZWQtcm91dGUtbGFuZGluZyc7XHJcbiAgICAgICAgdmFyIHN0b3BzTG9hZGVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ1N0b3BzIGZvciBSb3V0ZScpO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Rml4ZWRSb3V0ZUluZm8oKS5hbGlhcyk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICB2bS5yb3V0ZSA9IHt9O1xyXG4gICAgICAgICAgICB2bS5yb3V0ZUFycml2YWxzID0gW107XHJcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS52ZWhpY2xlTWFya2VycyA9IFtdO1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFN0b3BJZCA9ICcnO1xyXG5cclxuICAgICAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgICAgICB2bS56b29tID0gMTU7XHJcbiAgICAgICAgICAgIHZtLmNlbnRlciA9IHsgbGF0aXR1ZGU6IDQ3LjYwNDM1NiwgbG9uZ2l0dWRlOiAtMTIyLjMzNjA4MTcgfTtcclxuICAgICAgICAgICAgdm0ubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHN0eWxlczogZ29vZ2xlTWFwc0NvbmZpZy5tYXBTdHlsZXNcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmICghUG9ydGFsVXRpbGl0eVNlcnZpY2UuaGFzVmFsdWUoJHN0YXRlUGFyYW1zLnJvdXRlSWQpKVxyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKGZpeGVkUm91dGVMYW5kaW5nUm91dGUpO1xyXG5cclxuICAgICAgICAgICAgcm91dGVJZCA9ICRzdGF0ZVBhcmFtcy5yb3V0ZUlkO1xyXG4gICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghUG9ydGFsVXRpbGl0eVNlcnZpY2UuaGFzVmFsdWUoZGl2aXNpb25JZCkpXHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2RpdmlzaW9uJyk7XHJcblxyXG4gICAgICAgICAgICBSb3V0ZVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRSb3V0ZUluZm8ocm91dGVJZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyhmaXhlZFJvdXRlTGFuZGluZ1JvdXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbihnZXRTdG9wQXJyaXZhbHNGb3JSb3V0ZSk7XHJcbiAgICAgICAgfSAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXRQaW5VcmwoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQb3J0YWxVdGlsaXR5U2VydmljZS5pc0lFKCkgP1xyXG4gICAgICAgICAgICAgICAgJ2ltYWdlcy9waW4tbXktbG9jYXRpb24ucG5nJ1xyXG4gICAgICAgICAgICAgICAgOiAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5zdmcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5XHJcbiAgICAgICAgICAgICAgICAucHJvbWlzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0TWFwSW5mbylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0U2hhcGVGb3JSb3V0ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGdldFZlaGljbGVzRm9yUm91dGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4ocG9sbFZlaGljbGVzRm9yUm91dGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwSW5mbyhtYXBzKSB7XHJcbiAgICAgICAgICAgIEdlb0xvY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldEN1cnJlbnRQb3NpdGlvbigpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oY3VycmVudFBvc2l0aW9uU3VjY2Vzc0hhbmRsZXIsIGN1cnJlbnRQb3NpdGlvbkZhaWx1cmVIYW5kbGVyKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3VycmVudFBvc2l0aW9uU3VjY2Vzc0hhbmRsZXIocG9zaXRpb24sIG1hcHMpIHtcclxuICAgICAgICAgICAgdm0ucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBjb29yZHM6IHtcclxuICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGljb246IGdldExvY2F0aW9uSWNvbigpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZtLmNlbnRlci5sYXRpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZTtcclxuICAgICAgICAgICAgdm0uY2VudGVyLmxvbmdpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGU7XHJcblxyXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldExvY2F0aW9uSWNvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHVybDogZ2V0UGluVXJsKCksXHJcbiAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyMCwgMjApXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjdXJyZW50UG9zaXRpb25GYWlsdXJlSGFuZGxlcihlcnIpIHtcclxuICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFNlcnZpY2VBcmVhTG9jYXRpb24oZGl2aXNpb25JZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxvbmdpdHVkZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkxvbmdpdHVkZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRWZWhpY2xlc0ZvclJvdXRlKCkge1xyXG4gICAgICAgICAgICBSb3V0ZVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRWZWhpY2xlc0ZvclJvdXRlKHJvdXRlSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4odmVoaWNsZXNTdWNjZXNzSGFuZGxlciwgdmVoaWNsZXNGYWlsdXJlSGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdmVoaWNsZXNTdWNjZXNzSGFuZGxlcihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICBtYXBBY3RpdmVWZWhpY2xlcyhyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXBBY3RpdmVWZWhpY2xlcyhyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZUluZm8gPSByZXNwb25zZS5kYXRhW2ldOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChjb250YWlucyh2bS52ZWhpY2xlTWFya2VycywgdmVoaWNsZUluZm8uaWQpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZlaGljbGVJbmZvLmxhdGl0dWRlLCB2ZWhpY2xlSW5mby5sb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVNYXJrZXJzKHZlaGljbGVJbmZvKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBoZWFkaW5nTWFya2VyID0gZ2V0SGVhZGluZ01hcmtlcih2ZWhpY2xlSW5mbyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZlaGljbGVNYXJrZXIgPSBnZXRWZWhpY2xlTWFya2VyKHZlaGljbGVJbmZvKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZU1hcmtlcnMucHVzaChoZWFkaW5nTWFya2VyKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS52ZWhpY2xlTWFya2Vycy5wdXNoKHZlaGljbGVNYXJrZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlTWFya2Vycyh2ZWhpY2xlSW5mbykge1xyXG4gICAgICAgICAgICB2YXIgbWFya2VycyA9IGZpbmRBbGwodm0udmVoaWNsZU1hcmtlcnMsIHZlaGljbGVJbmZvLmlkKTtcclxuICAgICAgICAgICAgdmFyIG1hcCA9IHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpO1xyXG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZlaGljbGVJbmZvLmxhdGl0dWRlLCB2ZWhpY2xlSW5mby5sb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAobWFya2VyLm1hcmtlclR5cGUgPT09ICdoZWFkaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gbWFya2VyLmdldEljb24oKTtcclxuICAgICAgICAgICAgICAgICAgICBpY29uLnJvdGF0aW9uID0gdmVoaWNsZUluZm8uaGVhZGluZztcclxuICAgICAgICAgICAgICAgICAgICBpY29uLmFuY2hvciA9IG5ldyBnb29nbGUubWFwcy5Qb2ludCh2ZWhpY2xlSW5mby5hbmNob3JYLCB2ZWhpY2xlSW5mby5hbmNob3JZKS8vZ2V0QW5jaG9yKGhlYWRpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGljb24ub3JpZ2luID0gbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlci5zZXRJY29uKGljb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgICAgIG1hcmtlci5zZXREdXJhdGlvbih2ZWhpY2xlUG9sbEludGVydmFsKTtcclxuICAgICAgICAgICAgICAgIG1hcmtlci5zZXRQb3NpdGlvbihwb3NpdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcihtYXAsIFwicmVzaXplXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRIZWFkaW5nTWFya2VyKHZlaGljbGVJbmZvKSB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBtYXAgPSB2bS5tYXBDb250cm9sLmdldEdNYXAoKTtcclxuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2ZWhpY2xlSW5mby5sYXRpdHVkZSwgdmVoaWNsZUluZm8ubG9uZ2l0dWRlKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgIGlkOiB2ZWhpY2xlSW5mby5pZCxcclxuICAgICAgICAgICAgICAgIG1hcmtlclR5cGU6ICdoZWFkaW5nJyxcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgICAgICAgICAgZmxhdDp0cnVlLFxyXG4gICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMTUuMjQxMzEyMiwyMS4xNTI3ODYxIEwxMSwyNiBMNi43NTg2MTg1NiwyMS4xNTI3MDY5IEMyLjc4OTEwOTU5LDE5LjQ5Mjc1MDYgMCwxNS41NzI4NDc1IDAsMTEgQzAsNC45MjQ4Njc3NSA0LjkyMzUzMiwwIDExLDAgQzE3LjA3NTEzMjIsMCAyMiw0LjkyMzUzMiAyMiwxMSBDMjIsMTUuNTcyMDg0NSAxOS4yMTEzNTE1LDE5LjQ5MjY2ODQgMTUuMjQxMzEyMiwyMS4xNTI3ODYxIFonLC8vZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5GT1JXQVJEX0NMT1NFRF9BUlJPVyxcclxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogMS4xLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAuMyxcclxuICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjogdmVoaWNsZUluZm8uaGVhZGluZyxcclxuICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCh2ZWhpY2xlSW5mby5hbmNob3JYLCB2ZWhpY2xlSW5mby5hbmNob3JZKS8vZ2V0QW5jaG9yKHZlaGljbGVJbmZvLmhlYWRpbmcpXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgekluZGV4OiAxXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZlaGljbGVNYXJrZXIodmVoaWNsZUluZm8pIHtcclxuICAgICAgICAgICAgdmFyIG1hcCA9IHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpO1xyXG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZlaGljbGVJbmZvLmxhdGl0dWRlLCB2ZWhpY2xlSW5mby5sb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgaWQ6IHZlaGljbGVJbmZvLmlkLFxyXG4gICAgICAgICAgICAgICAgbWFya2VyVHlwZTogJ3ZlaGljbGUnLFxyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgICAgICAgZmxhdDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMCwxMCBDMCw0LjQ3NzE1MjUgNC40NzU5MzgxOCwwIDEwLDAgQzE1LjUyMjg0NzUsMCAyMCw0LjQ3NTkzODE4IDIwLDEwIEMyMCwxNS41MjI4NDc1IDE1LjUyNDA2MTgsMjAgMTAsMjAgQzQuNDc3MTUyNSwyMCAwLDE1LjUyNDA2MTggMCwxMCBaIE01LDUgTDUsMTMuOCBMNS44MTkwNDc2MiwxMy44IEw1LjgxOTA0NzYyLDE1IEw3LDE1IEw3LDEzLjggTDEzLDEzLjggTDEzLDE1IEwxNC4xODA5NTI0LDE1IEwxNC4xODA5NTI0LDEzLjggTDE1LDEzLjggTDE1LDUgTDUsNSBaIE0xNC42MzM2OTk2LDkuNzE2MTAyMDkgQzE0LjYzMzY5OTYsOS45OTI1NTYyNyAxNC40MDU1MjIsMTAuMjE2NjY2NyAxNC4xMzc0MTM0LDEwLjIxNjY2NjcgTDUuODk5MjE2NjUsMTAuMjE2NjY2NyBDNS42MjUxMjUzMiwxMC4yMTY2NjY3IDUuNDAyOTMwNCwxMC4wMDIyNTEzIDUuNDAyOTMwNCw5LjcxNjEwMjA5IEw1LjQwMjkzMDQsNy4xMTcyMzEyNCBDNS40MDI5MzA0LDYuODQwNzc3MDYgNS42MzExMDc5OSw2LjYxNjY2NjY3IDUuODk5MjE2NjUsNi42MTY2NjY2NyBMMTQuMTM3NDEzNCw2LjYxNjY2NjY3IEMxNC40MTE1MDQ3LDYuNjE2NjY2NjcgMTQuNjMzNjk5Niw2LjgzMTA4MjAzIDE0LjYzMzY5OTYsNy4xMTcyMzEyNCBMMTQuNjMzNjk5Niw5LjcxNjEwMjA5IFogTTUuMzg0NjE1MzgsNS44IEM1LjM4NDYxNTM4LDUuNTc5MDg2MSA1LjU2MDc2OTY3LDUuNCA1Ljc4MTI1LDUuNCBMMTQuMjE4NzUsNS40IEMxNC40Mzc4MDUyLDUuNCAxNC42MTUzODQ2LDUuNTg1NTQ2ODggMTQuNjE1Mzg0Niw1LjggQzE0LjYxNTM4NDYsNi4wMjA5MTM5IDE0LjQzOTIzMDMsNi4yIDE0LjIxODc1LDYuMiBMNS43ODEyNSw2LjIgQzUuNTYyMTk0NzUsNi4yIDUuMzg0NjE1MzgsNi4wMTQ0NTMxMyA1LjM4NDYxNTM4LDUuOCBaIE01LjM4NDYxNTM4LDExLjYgQzUuMzg0NjE1MzgsMTEuMjY4NjI5MiA1LjY1MjAxMDk5LDExIDUuOTkzMDg4OTQsMTEgTDYuNjk5MjE4NzUsMTEgQzcuMDM1MjY5NDIsMTEgNy4zMDc2OTIzMSwxMS4yNzgzMjAzIDcuMzA3NjkyMzEsMTEuNiBDNy4zMDc2OTIzMSwxMS45MzEzNzA4IDcuMDQwMjk2NywxMi4yIDYuNjk5MjE4NzUsMTIuMiBMNS45OTMwODg5NCwxMi4yIEM1LjY1NzAzODI4LDEyLjIgNS4zODQ2MTUzOCwxMS45MjE2Nzk3IDUuMzg0NjE1MzgsMTEuNiBaIE0xMi42OTIzMDc3LDExLjYgQzEyLjY5MjMwNzcsMTEuMjY4NjI5MiAxMi45NTk3MDMzLDExIDEzLjMwMDc4MTIsMTEgTDE0LjAwNjkxMTEsMTEgQzE0LjM0Mjk2MTcsMTEgMTQuNjE1Mzg0NiwxMS4yNzgzMjAzIDE0LjYxNTM4NDYsMTEuNiBDMTQuNjE1Mzg0NiwxMS45MzEzNzA4IDE0LjM0Nzk4OSwxMi4yIDE0LjAwNjkxMTEsMTIuMiBMMTMuMzAwNzgxMiwxMi4yIEMxMi45NjQ3MzA2LDEyLjIgMTIuNjkyMzA3NywxMS45MjE2Nzk3IDEyLjY5MjMwNzcsMTEuNiBaJyxcclxuICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogdm0ucm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgekluZGV4OiAyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsIHNob3dWZWhpY2xlTnVtYmVyKG1hcCwgbWFya2VyLCB2ZWhpY2xlSW5mby5uYW1lKSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbWFya2VyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1ZlaGljbGVOdW1iZXIobWFwLCBtYXJrZXIsIG51bWJlcikge1xyXG5cclxuICAgICAgICAgICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7IGNvbnRlbnQ6ICcnIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAnPHNwYW4gc3R5bGU9XCJmb250LXdlaWdodDogYm9sZDtcIj4nICsgJyMnK251bWJlciArICc8L3NwYW4+PGJyIC8+JztcclxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChjb250ZW50KTtcclxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1hcmtlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTWFya2VyKGNvbGxlY3Rpb24sIG1hcmtlcikge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gY29udGFpbnMoY29sbGVjdGlvbiwgbWFya2VyLmlkKTtcclxuICAgICAgICAgICAgY29sbGVjdGlvbltpbmRleF0uc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICBjb2xsZWN0aW9uLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250YWlucyhsaXN0LCBpZCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChsaXN0W2ldLmlkID09PSBpZCkgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmluZEFsbChsaXN0LCBpZCkge1xyXG4gICAgICAgICAgICB2YXIgbWFya2VycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobGlzdFtpXS5pZCA9PT0gaWQpXHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2Vycy5wdXNoKGxpc3RbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBtYXJrZXJzO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZlaGljbGVzRmFpbHVyZUhhbmRsZXIoKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9sbFZlaGljbGVzRm9yUm91dGUoKSB7XHJcbiAgICAgICAgICAgIHZlaGljbGVQb2xsID0gJGludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGdldFZlaGljbGVzRm9yUm91dGUoKTtcclxuICAgICAgICAgICAgfSwgdmVoaWNsZVBvbGxJbnRlcnZhbCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U3RvcEFycml2YWxzRm9yUm91dGUoKSB7XHJcbiAgICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldEFycml2YWxzRm9yUm91dGUocm91dGVJZCwgZGl2aXNpb25JZClcclxuICAgICAgICAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVBcnJpdmFsU3VjY2VzcywgaGFuZGxlQXJyaXZhbEZhaWx1cmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihwb2xsQXJyaXZhbHNGb3JSb3V0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVBcnJpdmFsU3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2bS5yb3V0ZUFycml2YWxzID0gcmVzcG9uc2UuZGF0YS5hcnJpdmFscztcclxuICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFzdG9wc0xvYWRlZClcclxuICAgICAgICAgICAgICAgIG1hcFN0b3BzRm9yRGlzcGxheSgpOztcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTaGFwZUZvclJvdXRlKCkge1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gdm0ubWFwQ29udHJvbC5nZXRHTWFwKCk7XHJcbiAgICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFNoYXBlc0J5Um91dGUocm91dGVJZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaGFwZXMgPSByZXN1bHQuZGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5lID0gbmV3IGdvb2dsZS5tYXBzLlBvbHlsaW5lKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLmdlb21ldHJ5LmVuY29kaW5nLmRlY29kZVBhdGgoc2hhcGVzWzBdLmxpbmUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlQ29sb3I6IHZtLnJvdXRlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogNC4wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiA0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwIDogbWFwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbnM6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkZPUldBUkRfQ0xPU0VEX0FSUk9XLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogM1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAnMjVweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAnMjAwcHgnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXAuZml0Qm91bmRzKGdldExpbmVCb3VuZHMobGluZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRMaW5lQm91bmRzKGxpbmUpIHtcclxuICAgICAgICAgICAgdmFyIGJvdW5kID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG4gICAgICAgICAgICBsaW5lLmdldFBhdGgoKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgYm91bmQuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcoaXRlbS5sYXQoKSwgaXRlbS5sbmcoKSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGJvdW5kO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZUFycml2YWxGYWlsdXJlKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFN0b3BzRm9yRGlzcGxheSgpIHtcclxuICAgICAgICAgICAgdmFyIG1hcCA9IHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZUFycml2YWxzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHN0b3BJbmZvID0gdm0ucm91dGVBcnJpdmFsc1tpXS5zdG9wO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdG9wSW5mby5MYXRpdHVkZSwgc3RvcEluZm8uTG9uZ2l0dWRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3RvcCA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBzdG9wSW5mby5JZCxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMCwyLjk5NDIwMjA4IEMwLDEuMzQwNTQ5OTMgMS4zNDMzMTE5NywwIDIuOTk0MjAyMDgsMCBMMTcuMDA1Nzk3OSwwIEMxOC42NTk0NTAxLDAgMjAsMS4zNDMzMTE5NyAyMCwyLjk5NDIwMjA4IEwyMCwxNy4wMDU3OTc5IEMyMCwxOC42NTk0NTAxIDE4LjY1NjY4OCwyMCAxNy4wMDU3OTc5LDIwIEwyLjk5NDIwMjA4LDIwIEMxLjM0MDU0OTkzLDIwIDAsMTguNjU2Njg4IDAsMTcuMDA1Nzk3OSBMMCwyLjk5NDIwMjA4IFogTTYsMjAgTDEzLjc2OTA4MTIsMjAgTDkuNzU5OTk5OTksMjIuNzYgTDYsMjAgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogdm0ucm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDksIDIxKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMjAsIDIzKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgekluZGV4OiA1LFxyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBpY29uID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHN0b3BJbmZvLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgICAgICAgICBvcHRpbWl6ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDAgTDAsMTMuMDg5OTIxNyBDMCwxMy42MzY3MjY5IDAuNDQzNjY3NDU3LDE0LjA4IDEuMDA2NTMyNzQsMTQuMDggTDEuMzEwNDc2MTksMTQuMDggTDEuMzEwNDc2MTksMTYgTDMuMiwxNiBMMy4yLDE0LjA4IEwxMi44LDE0LjA4IEwxMi44LDE2IEwxNC42ODk1MjM4LDE2IEwxNC42ODk1MjM4LDE0LjA4IEwxNC45OTM0NjczLDE0LjA4IEMxNS41NDkzNTk5LDE0LjA4IDE2LDEzLjYyNzQ4MDEgMTYsMTMuMDg5OTIxNyBMMTYsMC45OTAwNzgyNTkgQzE2LDAuNDQzMjczMTM1IDE1LjU1NTM2OTEsMCAxNC45OTkxMjgzLDAgTDAsMCBaIE0xNS40MTM5MTk0LDcuODU1NTcyMzEgQzE1LjQxMzkxOTQsOC4xMjY3OTYyMyAxNS4xODE5MzAxLDguMzQ2NjY2NjcgMTQuOTIyNTIwNyw4LjM0NjY2NjY3IEwxLjEzNjA4NzM4LDguMzQ2NjY2NjcgQzAuODY0Njk1MzU0LDguMzQ2NjY2NjcgMC42NDQ2ODg2NDUsOC4xMjc5MDE0MSAwLjY0NDY4ODY0NSw3Ljg1NTU3MjMxIEwwLjY0NDY4ODY0NSwzLjA3Nzc2MTAzIEMwLjY0NDY4ODY0NSwyLjgwNjUzNzEgMC44NzY2Nzc5OTIsMi41ODY2NjY2NyAxLjEzNjA4NzM4LDIuNTg2NjY2NjcgTDE0LjkyMjUyMDcsMi41ODY2NjY2NyBDMTUuMTkzOTEyNywyLjU4NjY2NjY3IDE1LjQxMzkxOTQsMi44MDU0MzE5MyAxNS40MTM5MTk0LDMuMDc3NzYxMDMgTDE1LjQxMzkxOTQsNy44NTU1NzIzMSBaIE0wLjYxNTM4NDYxNSwxLjEzMTIyMDcgQzAuNjE1Mzg0NjE1LDAuODU5OTI3IDAuODQ3MzczOTYyLDAuNjQgMS4xMDY3ODMzNSwwLjY0IEwxNC44OTMyMTY2LDAuNjQgQzE1LjE2NDYwODcsMC42NCAxNS4zODQ2MTU0LDAuODYyOTU4OTg0IDE1LjM4NDYxNTQsMS4xMzEyMjA3IEwxNS4zODQ2MTU0LDEuNDI4Nzc5MyBDMTUuMzg0NjE1NCwxLjcwMDA3MyAxNS4xNTI2MjYsMS45MiAxNC44OTMyMTY2LDEuOTIgTDEuMTA2NzgzMzUsMS45MiBDMC44MzUzOTEzMjQsMS45MiAwLjYxNTM4NDYxNSwxLjY5NzA0MTAyIDAuNjE1Mzg0NjE1LDEuNDI4Nzc5MyBMMC42MTUzODQ2MTUsMS4xMzEyMjA3IFogTTAuNjE1Mzg0NjE1LDEwLjU2IEMwLjYxNTM4NDYxNSwxMC4wMjk4MDY2IDEuMDQzMjE3NTksOS42IDEuNTcyMDc1ODQsOS42IEwyLjczNTYxNjQ2LDkuNiBDMy4yNjM5ODI0NCw5LjYgMy42OTIzMDc2OSwxMC4wMjYxMTAyIDMuNjkyMzA3NjksMTAuNTYgQzMuNjkyMzA3NjksMTEuMDkwMTkzNCAzLjI2NDQ3NDcyLDExLjUyIDIuNzM1NjE2NDYsMTEuNTIgTDEuNTcyMDc1ODQsMTEuNTIgQzEuMDQzNzA5ODcsMTEuNTIgMC42MTUzODQ2MTUsMTEuMDkzODg5OCAwLjYxNTM4NDYxNSwxMC41NiBaIE0xMi4zMDc2OTIzLDEwLjU2IEMxMi4zMDc2OTIzLDEwLjAyOTgwNjYgMTIuNzM1NTI1Myw5LjYgMTMuMjY0MzgzNSw5LjYgTDE0LjQyNzkyNDIsOS42IEMxNC45NTYyOTAxLDkuNiAxNS4zODQ2MTU0LDEwLjAyNjExMDIgMTUuMzg0NjE1NCwxMC41NiBDMTUuMzg0NjE1NCwxMS4wOTAxOTM0IDE0Ljk1Njc4MjQsMTEuNTIgMTQuNDI3OTI0MiwxMS41MiBMMTMuMjY0MzgzNSwxMS41MiBDMTIuNzM2MDE3NiwxMS41MiAxMi4zMDc2OTIzLDExLjA5Mzg4OTggMTIuMzA3NjkyMywxMC41NiBaIE0xMS40MjM5NTUsMTEuMTk5OTUwNyBDMTEuNjM0MDY1OSwxMS4zNzY3MzYzIDExLjU4NDg4MzksMTEuNTIwMDQ5MyAxMS4zMDUxNjA1LDExLjUyMDA0OTMgTDQuNjk0ODM5NDgsMTEuNTIwMDQ5MyBDNC40MTkxMjAyMiwxMS41MjAwNDkzIDQuMzY4MDE1NDMsMTEuMzc0OTg1MSA0LjU3NjA0NTAzLDExLjE5OTk1MDcgTDQuMTk1NjA1NTksMTEuNTIwMDQ5MyBDNC40MDU3MTY0OSwxMS4zNDMyNjM3IDQuODAzODg3MjUsMTEuMTk5OTUwNyA1LjA2ODUyOTgzLDExLjE5OTk1MDcgTDEwLjkzMTQ3MDIsMTEuMTk5OTUwNyBDMTEuMjAzNDYyLDExLjE5OTk1MDcgMTEuNTk2MzY0OCwxMS4zNDUwMTQ5IDExLjgwNDM5NDQsMTEuNTIwMDQ5MyBMMTEuNDIzOTU1LDExLjE5OTk1MDcgWiBNMTEuNDIzOTU1LDExLjgzOTk1MDcgQzExLjYzNDA2NTksMTIuMDE2NzM2MyAxMS41ODQ4ODM5LDEyLjE2MDA0OTMgMTEuMzA1MTYwNSwxMi4xNjAwNDkzIEw0LjY5NDgzOTQ4LDEyLjE2MDA0OTMgQzQuNDE5MTIwMjIsMTIuMTYwMDQ5MyA0LjM2ODAxNTQzLDEyLjAxNDk4NTEgNC41NzYwNDUwMywxMS44Mzk5NTA3IEw0LjE5NTYwNTU5LDEyLjE2MDA0OTMgQzQuNDA1NzE2NDksMTEuOTgzMjYzNyA0LjgwMzg4NzI1LDExLjgzOTk1MDcgNS4wNjg1Mjk4MywxMS44Mzk5NTA3IEwxMC45MzE0NzAyLDExLjgzOTk1MDcgQzExLjIwMzQ2MiwxMS44Mzk5NTA3IDExLjU5NjM2NDgsMTEuOTg1MDE0OSAxMS44MDQzOTQ0LDEyLjE2MDA0OTMgTDExLjQyMzk1NSwxMS44Mzk5NTA3IFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjZmZmJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoNywgMTkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgxNiwgMTYpXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDYsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNoYWRvdyA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIGlkOiBzdG9wSW5mby5JZCxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNLTUuODMyNTI1OTcsMTQuMzE1NTU0NSBDLTYuMzUzNTAyOTUsMTMuNTg4OTkzOCAtNS40MzU5MTA2LDEzIC0zLjc4OTE3OTcyLDEzIEwxMC4xODcxMTU1LDEzIEMxMS44MzY2MDE1LDEzIDEzLjU5Njk3OTUsMTMuNTkwMjA3NCAxNC4xMTcwODYzLDE0LjMxNTU1NDUgTDE4LjUzMTM4NzcsMjAuNDcxNzkxNyBDMTkuMDUyMzY0NywyMS4xOTgzNTI0IDE4LjEzNDc3MjQsMjEuNzg3MzQ2MiAxNi40ODgwNDE1LDIxLjc4NzM0NjIgTDIuNTExNzQ2MjQsMjEuNzg3MzQ2MiBDMC44NjIyNjAyODEsMjEuNzg3MzQ2MiAtMC44OTgxMTc3NTEsMjEuMTk3MTM4OSAtMS40MTgyMjQ1NywyMC40NzE3OTE3IEwtNS44MzI1MjU5NywxNC4zMTU1NTQ1IFogTTUuNTA5OTcxNCwyMS43ODczNDYyIEwxMy4yNTk0NzkzLDIxLjc4NzM0NjIgTDEwLjEzMDAyNjMsMjMgTDUuNTA5OTcxNCwyMS43ODczNDYyIFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjMDAwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IC4xMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCg5LCAyMSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDIxLCAxMClcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDQsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIoaWNvbiwgJ2NsaWNrJywgc2hvd1N0b3BJbmZvKG1hcCwgaWNvbiwgc3RvcEluZm8uTmFtZSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzdG9wc0xvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1N0b3BJbmZvKG1hcCwgbWFya2VyLCBuYW1lKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHsgY29udGVudDogJycgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9ICc8c3BhbiBzdHlsZT1cImZvbnQtd2VpZ2h0OiBib2xkO1wiPicgICsgbmFtZSArICc8L3NwYW4+PGJyIC8+JztcclxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChjb250ZW50KTtcclxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1hcmtlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBvblN0b3BDbGljayhtYXJrZXIsIGV2ZW50TmFtZSwgbW9kZWwpIHtcclxuICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvbGxBcnJpdmFsc0ZvclJvdXRlKCkge1xyXG4gICAgICAgICAgICBpZiAoIVBvcnRhbFV0aWxpdHlTZXJ2aWNlLmhhc1ZhbHVlKGFycml2YWxQb2xsKSkge1xyXG4gICAgICAgICAgICAgICAgYXJyaXZhbFBvbGwgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFN0b3BBcnJpdmFsc0ZvclJvdXRlKClcclxuICAgICAgICAgICAgICAgIH0sIGFycml2YWxQb2xsSW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBzdG9wUG9sbGluZygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzdG9wUG9sbGluZygpIHtcclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZlaGljbGVQb2xsKSkge1xyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbCh2ZWhpY2xlUG9sbCk7XHJcbiAgICAgICAgICAgICAgICB2ZWhpY2xlUG9sbCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGFycml2YWxQb2xsKSkge1xyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChhcnJpdmFsUG9sbCk7XHJcbiAgICAgICAgICAgICAgICBhcnJpdmFsUG9sbCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9maXhlZC1yb3V0ZS9zdG9wcy1mb3Itcm91dGUvc3RvcHMtZm9yLXJvdXRlLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLWZpeGVkLXJvdXRlLXN0b3BzLWZvci1yb3V0ZSc7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VGaXhlZFJvdXRlTmF2ID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FjdGl2ZVRyaXBDb250cm9sbGVyJywgYWN0aXZlVHJpcENvbnRyb2xsZXIpO1xyXG5cclxuICAgIGFjdGl2ZVRyaXBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9jYXRpb24nLCAnJGludGVydmFsJywgJyR3aW5kb3cnLCAnJHVpYk1vZGFsJyxcclxuICAgICAgICAgICAgICAgICdDb25maWdGYWN0b3J5JywgJ1NjaGVkdWxlU2VydmljZScsICd1aUdtYXBJc1JlYWR5JywgJ0RpdmlzaW9uU2VydmljZScsICdhdXRoU2VydmljZScsXHJcbiAgICAgICAgICAgICAgICAnVXRpbGl0eUZhY3RvcnknLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywgJ0NvbW11bmljYXRpb25zU2VydmljZScsICdTZXR0aW5nc1NlcnZpY2UnLCAgJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGFjdGl2ZVRyaXBDb250cm9sbGVyKCRzY29wZSwgJGxvY2F0aW9uLCAkaW50ZXJ2YWwsICR3aW5kb3csICR1aWJNb2RhbCxcclxuICAgICAgICBDb25maWdGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UsIHVpR21hcElzUmVhZHksIERpdmlzaW9uU2VydmljZSwgYXV0aFNlcnZpY2UsXHJcbiAgICAgICAgVXRpbGl0eUZhY3RvcnksIFJlZGlyZWN0aW9uU2VydmljZSwgQ29tbXVuaWNhdGlvbnNTZXJ2aWNlLCBTZXR0aW5nc1NlcnZpY2UsICBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdBY3RpdmUgVHJpcCcpO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0RHJ0SW5mbygpLmFsaWFzKTtcclxuXHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGF1dG9SZWZyZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgdm0uY2FuY2VsVHJpcCA9IGNhbmNlbFRyaXA7XHJcbiAgICAgICAgdm0uZ2V0QWN0aXZlVHJpcCA9IGdldEFjdGl2ZVRyaXA7XHJcbiAgICAgICAgdm0udHJ5Q29udGFjdERyaXZlciA9IHRyeUNvbnRhY3REcml2ZXI7XHJcbiAgICAgICAgdm0uaXNDYW5jZWxsaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uYWN0aXZlVHJpcDtcclxuICAgICAgICB2bS5jb250YWN0aW5nRHJpdmVyID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSAnJztcclxuICAgICAgICB2YXIgb3BlcmF0b3JJZCA9IG51bGw7XHJcbiAgICAgICAgdmFyIGRpcmVjdGlvbnNEaXNwbGF5ID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNSZW5kZXJlcih7IHN1cHByZXNzTWFya2VyczogdHJ1ZSwgZHJhZ2dhYmxlOiBmYWxzZSB9KTtcclxuICAgICAgICB2YXIgZGlyZWN0aW9uc1NlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2UoKTtcclxuICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS52ZWhpY2xlSW5mbyA9IG51bGw7XHJcbiAgICAgICAgdm0uZHJhd2VyU3RhdGUgPSAxO1xyXG5cclxuICAgICAgICB2YXIgY2xvc2VzdFBpbiwgb3RoZXJQaW4sIGxvY2F0aW9uUGluLCBteUxvY2F0aW9uUGluLCBodWJJY29uO1xyXG4gICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuICAgICAgICAgICAgY2xvc2VzdFBpbiA9ICdpbWFnZXMvZGVmYXVsdC9pLWRydC1waW4tYi5wbmcnO1xyXG4gICAgICAgICAgICBvdGhlclBpbiA9ICdpbWFnZXMvZGVmYXVsdC9pLWRydC1waW4tZy5wbmcnO1xyXG4gICAgICAgICAgICBsb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLWxvY2F0aW9uLnBuZyc7XHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG4gICAgICAgICAgICBodWJJY29uID0gJ2ltYWdlcy9waW4taHViLnBuZyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjbG9zZXN0UGluID0gJ2ltYWdlcy9kZWZhdWx0L2ktcGluLWRydC1iLnN2Zyc7XHJcbiAgICAgICAgICAgIG90aGVyUGluID0gJ2ltYWdlcy9kZWZhdWx0L2ktZHJ0LXBpbi1nLnN2Zyc7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbG9jYXRpb24uc3ZnJztcclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnN2Zyc7XHJcbiAgICAgICAgICAgIGh1Ykljb24gPSAnaW1hZ2VzL3Bpbi1odWIuc3ZnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldEF1dG9SZWZyZXNoKCkge1xyXG4gICAgICAgICAgICBhdXRvUmVmcmVzaCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRBY3RpdmVUcmlwKCk7XHJcbiAgICAgICAgICAgIH0sIDMwMDAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRyeUNvbnRhY3REcml2ZXIodHlwZSkge1xyXG4gICAgICAgICAgICB2bS5jb250YWN0aW5nRHJpdmVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0udHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgIFNldHRpbmdzU2VydmljZVxyXG4gICAgICAgICAgICAgICAuZ2V0U2V0dGluZ3MoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPj0gMTApIHtcclxuICAgICAgICAgICAgICAgICAgIGNvbnRhY3REcml2ZXIoKTtcclxuICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgIENvbGxlY3RQYXNzZW5nZXJNb2JpbGUoKTtcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgJHNjb3BlLnN3aXBlVXAgPSBmdW5jdGlvbiAoJGV2ZW50KSB7XHJcbiAgICAgICAgICBpZiAodm0uZHJhd2VyU3RhdGUgPCAyKSB7XHJcbiAgICAgICAgICAgIHZtLmRyYXdlclN0YXRlICs9IDE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnN3aXBlRG93biA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgIGlmICh2bS5kcmF3ZXJTdGF0ZSA+IDApIHtcclxuICAgICAgICAgICAgdm0uZHJhd2VyU3RhdGUgLT0gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93U3VwcG9ydFBvcFVwKCkge1xyXG4gICAgICAgICAgICAvLyBnZXQgaGVscCBwaG9uZSBudW1iZXJcclxuICAgICAgICAgICAgdmFyIGhlbHBQaG9uZSA9IERpdmlzaW9uU2VydmljZS5nZXRTdXBwb3J0UGhvbmVOdW1iZXIoKTtcclxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIkNvdWxkIG5vdCBjb250YWN0IGRyaXZlci4gUGxlYXNlIGNhbGwgSGVscCBkZXNrIGF0IDxhIGhyZWY9J3RlbDpcIiArIGhlbHBQaG9uZSArIFwiJz5cIiArIGhlbHBQaG9uZSArIFwiPC9hPlwiO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCIgPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8aDMgY2xhc3M9XCJtb2RhbC10aXRsZVwiPlN1cHBvcnQ8L2gzPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+JyArIG1lc3NhZ2UgKyAnPC9wPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi13YXJuaW5nXCIgdHlwZT1cImJ1dHRvblwiIG5nLWNsaWNrPVwiY2xvc2UoKVwiPk9LPC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicsXHJcbiAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJGxvY2F0aW9uLnJlcGxhY2UoKS5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250YWN0RHJpdmVyKCkge1xyXG4gICAgICAgICAgICBDb21tdW5pY2F0aW9uc1NlcnZpY2UuY29udGFjdERyaXZlcih2bS5hY3RpdmVUcmlwLlRyaXBJRCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0udHlwZSA9PSBcImNhbGxcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwidGVsOlwiICsgcmVzcG9uc2UucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZtLnR5cGUgPT0gXCJzbXNcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IFwic21zOlwiICsgcmVzcG9uc2UucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vSGFuZGxlIFZhbGlkYXRpb24gMTAwMDAxID0gRHJpdmVyIHBob25lIG1pc3NpbmdcclxuICAgICAgICAgICAgICAgICAgICAvL0hhbmRsZSBWYWxpZGF0aW9uIDEwMDAwMiA9IFBhc3NlbmdlciBwaG9uZSBtaXNzaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd1N1cHBvcnRQb3BVcCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93U3VwcG9ydFBvcFVwKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5jb250YWN0aW5nRHJpdmVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0uY29udGFjdGluZ0RyaXZlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgc2hvd1N1cHBvcnRQb3BVcCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIENvbGxlY3RQYXNzZW5nZXJNb2JpbGUoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgcGFzc2VuZ2VyTW9iaWxlTW9kYWwgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9hY3RpdmVUcmlwL3Bhc3Nlbmdlci1tb2JpbGUtbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUGFzc2VuZ2VyTW9iaWxlQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnc20nLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJJZDogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcGFzc2VuZ2VyTW9iaWxlTW9kYWwucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhY3REcml2ZXIoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihyZXNwb25zZSA9PSBmYWxzZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAnQ291bGQgbm90IHVwZGF0ZSB5b3VyIG1vYmlsZSBudW1iZXIuJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWN0aXZlVHJpcCgpIHtcclxuICAgICAgICAgICAgLy8gdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRsYXN0cmlwZGV0YWlscyh2bS5wYXNzZW5nZXJJZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uYWN0aXZlVHJpcCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBwcm9taXNlV2luZG93ID0gb3B0aW9ucy5wcm9taXNlV2luZG93O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydFBpY2t1cFdpbmRvd1RpbWUgPSBuZXcgbW9tZW50KHZtLmFjdGl2ZVRyaXAuU3RhcnRQaWNrdXBXaW5kb3dUaW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kUGlja3VwV2luZG93VGltZSA9IG5ldyBtb21lbnQodm0uYWN0aXZlVHJpcC5FbmRQaWNrdXBXaW5kb3dUaW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVUcmlwLnByb21pc2VXaW5kb3dTdGFydFRpbWUgPSBzdGFydFBpY2t1cFdpbmRvd1RpbWUuZm9ybWF0KCdoOm1tIEEnKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVUcmlwLnByb21pc2VXaW5kb3dFbmRUaW1lID0gZW5kUGlja3VwV2luZG93VGltZS5mb3JtYXQoJ2g6bW0gQScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBtYXBUcmlwKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVUcmlwID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zY2hlZHVsZU1hcmtlcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ29uLWRlbWFuZC9yZXNlcnZhdGlvbnMnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vZ2V0TWFwKCk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVUcmlwID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgLy8gZ2V0TWFwKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uem9vbSA9IDE1O1xyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgbGF0aXR1ZGU6IDM5LjgwOTg2MCxcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtOTguNTU1MTgzXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teVN0eWxlcyA9IFtcclxuICB7XHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNlYmUzY2RcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiM1MjM3MzVcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuc3Ryb2tlXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2Y1ZjFlNlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJhZG1pbmlzdHJhdGl2ZVwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnkuc3Ryb2tlXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2M5YjJhNlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJhZG1pbmlzdHJhdGl2ZS5sYW5kX3BhcmNlbFwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnkuc3Ryb2tlXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2RjZDJiZVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJhZG1pbmlzdHJhdGl2ZS5sYW5kX3BhcmNlbFwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcInZpc2liaWxpdHlcIjogXCJvZmZcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwiYWRtaW5pc3RyYXRpdmUubGFuZF9wYXJjZWxcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0LmZpbGxcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjYWU5ZTkwXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcImxhbmRzY2FwZS5uYXR1cmFsXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNkZmQyYWVcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicG9pXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNkZmQyYWVcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicG9pXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMudGV4dC5maWxsXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiIzkzODE3Y1wiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJwb2kuYnVzaW5lc3NcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJwb2kucGFya1wiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnkuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNhNWIwNzZcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicG9pLnBhcmtcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcInZpc2liaWxpdHlcIjogXCJvZmZcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicG9pLnBhcmtcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0LmZpbGxcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjNDQ3NTMwXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInJvYWRcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2Y1ZjFlNlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmFydGVyaWFsXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNmZGZjZjhcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicm9hZC5oaWdod2F5XCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNmOGM5NjdcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicm9hZC5oaWdod2F5XCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeS5zdHJva2VcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZTliYzYyXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInJvYWQuaGlnaHdheS5jb250cm9sbGVkX2FjY2Vzc1wiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnlcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZTk4ZDU4XCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInJvYWQuaGlnaHdheS5jb250cm9sbGVkX2FjY2Vzc1wiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnkuc3Ryb2tlXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2RiODU1NVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmxvY2FsXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHNcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmxvY2FsXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMudGV4dC5maWxsXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiIzgwNmI2M1wiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0LmxpbmVcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2RmZDJhZVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0LmxpbmVcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0LmZpbGxcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjOGY3ZDc3XCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXQubGluZVwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuc3Ryb2tlXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2ViZTNjZFwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0LnN0YXRpb25cIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2RmZDJhZVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ3YXRlclwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnkuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNiOWQzYzJcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwid2F0ZXJcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0LmZpbGxcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjOTI5OThkXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IHZtLm15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWxUcmlwKHRyaXApIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB0cmlwVG9DYW5jZWwgPSB7XHJcbiAgICAgICAgICAgICAgICAndHJpcElkJzogdHJpcC5UcmlwSUQsXHJcbiAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiB0cmlwLlBhc3NlbmdlcklELFxyXG4gICAgICAgICAgICAgICAgJ2Zyb20nOiB0cmlwLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5OYW1lLFxyXG4gICAgICAgICAgICAgICAgJ3RvJzogdHJpcC5FbmRBZGRyZXNzVmlld01vZGVsLk5hbWUsXHJcbiAgICAgICAgICAgICAgICAnc2NoZWR1bGVkVGltZSc6IHRyaXAuU2NoZWR1bGVkUGlja3VwVGltZVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIG1vZGFsQ2FuY2VsVHJpcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvdHJpcC1jYW5jZWxsYXRpb24tcHJvbXB0Lmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICcnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXBUb0NhbmNlbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJpcFRvQ2FuY2VsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbE9wdGlvbnM6IHZtLnJlc2VydmF0aW9uRm9ybU9wdGlvbnMuc2hvd0NhbmNlbE9wdGlvbnNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1vZGFsQ2FuY2VsVHJpcC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKFwiU3VjY2VzcyFcIiwgXCJUcmlwIGNhbmNlbGxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnb24tZGVtYW5kL3Jlc2VydmF0aW9ucycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCJVbmFibGUgdG8gY2FuY2VsIHRoZSB0cmlwLlwiKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbih2bS5kaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sYXRpdHVkZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aXZlVHJpcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldEF1dG9SZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLyppZih2bS5hY3RpdmVUcmlwICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcFRyaXAoKTsqL1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFRyaXAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNjaGVkdWxlTWFya2VycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuXHJcbiAgICAgICAgICAgIHZtLnNjaGVkdWxlTWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHZtLmFjdGl2ZVRyaXAuU3RhcnRBZGRyZXNzVmlld01vZGVsLkxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogdm0uYWN0aXZlVHJpcC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgJ2ljb24nOiAnaW1hZ2VzL2RlZmF1bHQvaS1kcnQtcGluLWIucG5nJywgJ3RyaXBJZCc6IHZtLmFjdGl2ZVRyaXAuVHJpcElEXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5zY2hlZHVsZU1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB2bS5hY3RpdmVUcmlwLkVuZEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUsICdsb25naXR1ZGUnOiB2bS5hY3RpdmVUcmlwLkVuZEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgJ2ljb24nOiAnaW1hZ2VzL2RlZmF1bHQvaS1kcnQtcGluLWcucG5nJywgJ3RyaXBJZCc6IHZtLmFjdGl2ZVRyaXAuVHJpcElEXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodm0uYWN0aXZlVHJpcC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUsIHZtLmFjdGl2ZVRyaXAuU3RhcnRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5hY3RpdmVUcmlwLkVuZEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUsIHZtLmFjdGl2ZVRyaXAuRW5kQWRkcmVzc1ZpZXdNb2RlbC5Mb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgdHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1RyYXZlbE1vZGUuRFJJVklOR1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdm0udmVoaWNsZUluZm8gPSB7XHJcbiAgICAgICAgICAgICAgICBjb29yZHM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB2bS5hY3RpdmVUcmlwLlZlaGljbGVMYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAnbG9uZ2l0dWRlJzogdm0uYWN0aXZlVHJpcC5WZWhpY2xlTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGljb246ICdpbWFnZXMvaS1jYXItZ3JlZW4uc3ZnJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgXCJyZXNpemVcIik7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHJlcXVlc3QsIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBnb29nbGUubWFwcy5EaXJlY3Rpb25zU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0RGlyZWN0aW9ucyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vd2luZG93LmFsZXJ0KCdEaXJlY3Rpb25zIHJlcXVlc3QgZmFpbGVkIGR1ZSB0byAnICsgc3RhdHVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgaWYgKCFhdXRoU2VydmljZS5pc0xvZ2dlZEluKCkpIHtcclxuICAgICAgICAgICAgICAgIFJlZGlyZWN0aW9uU2VydmljZSwgc2F2ZSgnL29uLWRlbWFuZC9hY3RpdmUtdHJpcCcpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2xvZ2luJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGl2aXNpb25JZCAhPSBudWxsICYmIGRpdmlzaW9uSWQgIT0gdW5kZWZpbmVkICYmIGRpdmlzaW9uSWQgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycygpIHtcclxuICAgICAgICAgICAgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uSWQ6IGRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICBPcGVyYXRvcklkOiBvcGVyYXRvcklkXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0RGl2aXNpb25QYXJhbWV0ZXJzKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnBhc3NlbmdlcnNMaW1pdCA9IHBhcmFtcy5QYXNzZW5nZXJzTGltaXQgPyBldmFsKHBhcmFtcy5QYXNzZW5nZXJzTGltaXQpIDogNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93V2lsbENhbGwgPSBwYXJhbXMuQWxsb3dXaWxsQ2FsbCA/IGV2YWwocGFyYW1zLkFsbG93V2lsbENhbGwudG9Mb3dlckNhc2UoKSk6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dFcXVpcG1lbnQgPSBwYXJhbXMuQWxsb3dFcXVpcG1lbnQgPyBldmFsKHBhcmFtcy5BbGxvd0VxdWlwbWVudC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNBZHZhbmNlZFJlc2VydmF0aW9uID0gcGFyYW1zLkFsbG93QWR2YW5jZWRSZXNlcnZhdGlvbiA/IGV2YWwocGFyYW1zLkFsbG93QWR2YW5jZWRSZXNlcnZhdGlvbi50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dNdWx0aXBsZVNlYXRCb29raW5nID0gcGFyYW1zLkFsbG93TXVsdGlwbGVTZWF0Qm9va2luZyA/IGV2YWwocGFyYW1zLkFsbG93TXVsdGlwbGVTZWF0Qm9va2luZy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNXaGVlbENoYWlyID0gcGFyYW1zLkhhc1doZWVsQ2hhaXIgPyBldmFsKHBhcmFtcy5IYXNXaGVlbENoYWlyLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc1BDQSA9IHBhcmFtcy5IYXNQZXJzb25hbENhcmVBc3Npc3RhbnQgPyBldmFsKHBhcmFtcy5IYXNQZXJzb25hbENhcmVBc3Npc3RhbnQudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzU2VydmljZUFuaW1hbCA9IHBhcmFtcy5IYXNTZXJ2aWNlQW5pbWFsID8gZXZhbChwYXJhbXMuSGFzU2VydmljZUFuaW1hbC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNDb21wYW5pb24gPSBwYXJhbXMuSGFzQ29tcGFuaW9ucyA/IGV2YWwocGFyYW1zLkhhc0NvbXBhbmlvbnMudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuXHRcdFx0XHRcdFx0XHQgb3B0aW9ucy5jb21wYW5pb25zTGltaXQgPSBwYXJhbXMuSGFzQ29tcGFuaW9ucyA9PSBmYWxzZSA/IDA6IHBhcmFtcy5Db21wYW5pb25zTGltaXQgPyBldmFsKHBhcmFtcy5Db21wYW5pb25zTGltaXQpOiAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dDdXN0b21Mb2NhdGlvbiA9IHBhcmFtcy5BbGxvd0N1c3RvbUxvY2F0aW9uID8gZXZhbChwYXJhbXMuQWxsb3dDdXN0b21Mb2NhdGlvbi50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dPbmx5U2FtZURheUFkdlJlcyA9IHBhcmFtcy5BbGxvd09ubHlTYW1lRGF5QWR2UmVzID8gZXZhbChwYXJhbXMuQWxsb3dPbmx5U2FtZURheUFkdlJlcy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucHJvbWlzZVdpbmRvdyA9IHBhcmFtcy5Qcm9taXNlV2luZG93ID8gZXZhbChwYXJhbXMuUHJvbWlzZVdpbmRvdykgOiAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNob3dDYW5jZWxPcHRpb25zID0gcGFyYW1zLkNhbmNlbFJlYXNvblJlcXVpcmVkID8gZXZhbChwYXJhbXMuQ2FuY2VsUmVhc29uUmVxdWlyZWQudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnJlc2VydmF0aW9uVHlwZSA9IHZtLnJlc2VydmF0aW9uVHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93RmFyaW5nID0gcGFyYW1zLkFsbG93RmFyaW5nID8gZXZhbChwYXJhbXMuQWxsb3dGYXJpbmcudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93TG9jYXRpb25Ob3RlcyA9IHBhcmFtcy5BbGxvd0xvY2F0aW9uTm90ZXMgPyBldmFsKHBhcmFtcy5BbGxvd0xvY2F0aW9uTm90ZXMpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd1Bhc3NlbmdlclRvQ2FsbCA9IHBhcmFtcy5BbGxvd1BDRCA/IGV2YWwocGFyYW1zLkFsbG93UENELnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd1Bhc3NlbmdlclRvU21zID0gcGFyYW1zLkFsbG93UFNEID8gZXZhbChwYXJhbXMuQWxsb3dQU0QudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93Q2hpbGRyZW4gPSBwYXJhbXMuQWxsb3dDaGlsZHJlbiA/IGV2YWwocGFyYW1zLkFsbG93Q2hpbGRyZW4pIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzZXJ2YXRpb25Gb3JtT3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgXHQvL2V4dHJhIG9wdGlvbnMgb25seSBuZWVkZWQgYnkgdXNlciByZXNlcnZhdGlvbnMgZGlyZWN0aXZlLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNQYXNzZW5nZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNSZWFkT25seSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hdXRvUmVmcmVzaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5iYXRjaERheXMgPSBwYXJhbXMuQmF0Y2hEYXlzID8gZXZhbChwYXJhbXMuQmF0Y2hEYXlzKSA6IDc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5taW5Gcm9tRGF5cyA9IHBhcmFtcy5NaW5Gcm9tRGF5cyA/IGV2YWwocGFyYW1zLk1pbkZyb21EYXlzKSA6IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlc2VydmF0aW9uRm9ybU9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgcmVzcG9uc2UuZGF0YS5SZXR1cm5NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGdldE1hcCgpO1xyXG4gICAgICAgICAgICAvL2dldEFjdGl2ZVRyaXAoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYWN0aXZhdGUocG9wdWxhdGVEaXZpc2lvblBhcmFtZXRlcnMpO1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoYXV0b1JlZnJlc2gpKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGF1dG9SZWZyZXNoKTtcclxuICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9hY3RpdmVUcmlwL2FjdGl2ZS10cmlwLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Bhc3Nlbmdlck1vYmlsZUNvbnRyb2xsZXInLCBQYXNzZW5nZXJNb2JpbGVDb250cm9sbGVyKTtcclxuXHJcbiAgICBQYXNzZW5nZXJNb2JpbGVDb250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckdWliTW9kYWxJbnN0YW5jZScsICdzZXR0aW5ncycsICdTZXR0aW5nc1NlcnZpY2UnLCAnVXRpbGl0eUZhY3RvcnknXTtcclxuXHJcbiAgICBmdW5jdGlvbiBQYXNzZW5nZXJNb2JpbGVDb250cm9sbGVyKCRsb2NhdGlvbiwgJHVpYk1vZGFsSW5zdGFuY2UsIHNldHRpbmdzLCBTZXR0aW5nc1NlcnZpY2UsIFV0aWxpdHlGYWN0b3J5KSB7XHJcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczp0cnVlICovXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS51cGRhdGVTZXR0aW5ncyA9IHVwZGF0ZVNldHRpbmdzO1xyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICAgICB2bS5wYXNzZW5nZXJJZCA9IHNldHRpbmdzLnBhc3NlbmdlcklkO1xyXG4gICAgICAgIHZtLmNsaWVudFRlbGVwaG9uZSA9ICcnO1xyXG4gICAgICAgIHZtLmlzVXBkYXRpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmdzKCkge1xyXG4gICAgICAgICAgICB2bS5pc1VwZGF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHZtLmNsaWVudFRlbGVwaG9uZSAhPSBcIlwiICYmICFpc05hTih2bS5jbGllbnRUZWxlcGhvbmUpICYmIHZtLmNsaWVudFRlbGVwaG9uZSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb2JpbGVOdW1iZXIgPSBcIisxXCIgKyB2bS5jbGllbnRUZWxlcGhvbmU7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJQYXNzZW5nZXJJZFwiOiB2bS5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICBcIkNsaWVudFRlbGVwaG9uZVwiOiBtb2JpbGVOdW1iZXJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFNldHRpbmdzU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgLnVwZGF0ZVNldHRpbmdzKHNldHRpbmdzKVxyXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgIHZtLmlzVXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgIHZtLmlzVXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzVXBkYXRpbmcgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBudW1iZXInKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGNsb3NlTW9kYWwgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UocmVzcG9uc2UpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7IH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdUcmlwQ2FuY2VsbGF0aW9uQ29udHJvbGxlcicsIFRyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBUcmlwQ2FuY2VsbGF0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsICd0cmlwVG9DYW5jZWwnLCAnc2hvd0NhbmNlbE9wdGlvbnMnLCAnVXRpbGl0eUZhY3RvcnknLCAnU2NoZWR1bGVTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVHJpcENhbmNlbGxhdGlvbkNvbnRyb2xsZXIoJHVpYk1vZGFsSW5zdGFuY2UsIHRyaXBUb0NhbmNlbCwgc2hvd0NhbmNlbE9wdGlvbnMsIFV0aWxpdHlGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRyaXBUb0NhbmNlbCA9IHRyaXBUb0NhbmNlbDtcclxuICAgICAgICB2bS5zaG93Q2FuY2VsT3B0aW9ucyA9IHNob3dDYW5jZWxPcHRpb25zO1xyXG4gICAgICAgIHZtLmNhbmNlbEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnJlYXNvbkNvbW1lbnQgPSAnJztcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsVHJpcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uZGlzYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICdUcmlwSUQnOiB0cmlwVG9DYW5jZWwudHJpcElkLFxyXG4gICAgICAgICAgICAgICAgICAgICdQYXNzZW5nZXJJRCc6IHRyaXBUb0NhbmNlbC5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAnT3BlcmF0aW9uSUQnOiBudWxsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAodm0uc2hvd0NhbmNlbE9wdGlvbnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKHZtLmNhbmNlbFJlYXNvbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkNhbmNlbFJlYXNvbklkID0gdm0uY2FuY2VsUmVhc29uLlJlYXNvbklkO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuQ2FuY2VsUmVhc29uVGV4dCA9IHZtLmNhbmNlbFJlYXNvbi5SZWFzb247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodm0ucmVhc29uQ29tbWVudC50cmltKCkgIT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LkNhbmNlbFJlYXNvblRleHQgKz0gJyAtICcgKyB2bS5yZWFzb25Db21tZW50LnRyaW0oKS5yZXBsYWNlKC9bXmEtekEtWlxcZCxAIVxcLlxcKFxcKVxcLVxcKiBcXHNdL2csICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVxdWVzdC5DYW5jZWxSZWFzb25UZXh0Lmxlbmd0aCA+IDI1MClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIkNvbW1lbnQgdG9vIGxvbmcuIFBsZWFzZSBtYWtlIGl0IHNob3J0ZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodm0uY2FuY2VsUmVhc29uLlJlYXNvbiA9PT0gJ090aGVyJyAmJiB2bS5yZWFzb25Db21tZW50LnRyaW0oKSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIllvdSBzZWxlY3RlZCBPdGhlciwgcGxlYXNlIHR5cGUgYSByZWFzb24uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiUGxlYXNlIHByb3ZpZGUgYSByZWFzb24gZm9yIGNhbmNlbGxhdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5jYW5jZWxwb3N0KHJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoeyAnYWN0aW9uJzogJ2Nsb3NlJywgJ2lzQ2FuY2VsJzogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2FuY2VsRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLmNhbmNlbEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLk1ha2VEaXNhYmxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uZGlzYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5kaXNhbGxvd1NwZWNpYWxDaGFyID0gZnVuY3Rpb24oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYodm0ucmVhc29uQ29tbWVudC50cmltKCkgIT09ICcnKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2bS5yZWFzb25Db21tZW50ID0gdm0ucmVhc29uQ29tbWVudC5yZXBsYWNlKC9bXmEtekEtWlxcZCxAIVxcLlxcKFxcKVxcLVxcKiBcXHNdL2csICcnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgLy9maXJzdCBnZXQgcGFyYW1ldGVyIHRvIGNoZWNrIGlmIHRyaXAgY2FuY2VsIHN0YXR1cyBpcyBuZWVkZWQuXHJcbiAgICAgICAgICAgIC8vZ2V0IHRyaXAgY2FuY2VsbGF0aW9uIHN0YXR1c2VzXHJcbiAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHZtLnNob3dDYW5jZWxPcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0VHJpcENhbmNlbFN0YXR1c0xpc3QoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jYW5jZWxSZWFzb25zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmNvbnRyb2xsZXIoJ0ZhcmluZ01vZGFsQ29udHJvbGxlcicsIEZhcmluZ01vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgRmFyaW5nTW9kYWxDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICdVdGlsaXR5RmFjdG9yeScsICdGYXJpbmdTZXJ2aWNlJywgJyRsb2cnLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1Byb2ZpbGVTZXJ2aWNlJywgJ3Jlc2VydmF0aW9uUmVxdWVzdCcsICdzZXJ2aWNlRGF0ZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEZhcmluZ01vZGFsQ29udHJvbGxlcigkc2NvcGUsIFV0aWxpdHlGYWN0b3J5LCBGYXJpbmdTZXJ2aWNlLCAkbG9nLCAkdWliTW9kYWxJbnN0YW5jZSwgRGl2aXNpb25TZXJ2aWNlLCBQcm9maWxlU2VydmljZSwgcmVzZXJ2YXRpb25SZXF1ZXN0LCBzZXJ2aWNlRGF0ZSApIHtcclxuICAgICAgICAkc2NvcGUuY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgICRzY29wZS5zYXZlQ29tcGFuaW9ucyA9IHNhdmVDb21wYW5pb25zO1xyXG4gICAgICAgICRzY29wZS5yZXNldENvbXBhbmlvbnMgPSByZXNldENvbXBhbmlvbnM7XHJcbiAgICAgICAgJHNjb3BlLmVkaXRDb21wYW5pb25zID0gZWRpdENvbXBhbmlvbnM7XHJcbiAgICAgICAgJHNjb3BlLmluY3JlYXNlQ291bnQgPSBpbmNyZWFzZUNvdW50O1xyXG4gICAgICAgICRzY29wZS5kZWNyZWFzZUNvdW50ID0gZGVjcmVhc2VDb3VudDtcclxuICAgICAgICAkc2NvcGUuYm9va1RyaXAgPSBib29rVHJpcDtcclxuICAgICAgICAkc2NvcGUuaXNIaWRkZW4gPSB0cnVlO1xyXG4gICAgICAgICRzY29wZS5sb2NhdGlvbk5vdGVzID0geyAnZnJvbSc6ICcnLCAndG8nOiAnJyB9XHJcblxyXG4gICAgICAgICRzY29wZS5tYXhDb3VudCA9ICRzY29wZS4kcGFyZW50Lm9wdGlvbnMuaXNDb21wYW5pb24gPyAkc2NvcGUuJHBhcmVudC5vcHRpb25zLmNvbXBhbmlvbnNMaW1pdCA6IDA7XHJcbiAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkNvdW50ID0gMDtcclxuICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0ID0gcmVzZXJ2YXRpb25SZXF1ZXN0OyAgXHJcbiAgICAgICAgJHNjb3BlLnNlcnZpY2VEYXRlID0gc2VydmljZURhdGUuZm9ybWF0KCdZWVlZLU1NLUREJyk7XHJcbiAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkZhcmUgPSAwO1xyXG4gICAgICAgICRzY29wZS5iYXNlRmFyZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAkc2NvcGUubWF4Q29tcGFuaW9uQ291bnRXYXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGxhc3RGYXJlVHlwZXMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGxhc3RDb21wYW5pb25GYXJlID0gMDtcclxuICAgICAgICB2YXIgbGFzdENvbXBhbmlvbkNvdW50ID0gMDtcclxuICAgICAgICB2YXIgcmVzZXJ2YXRpb25UaW1lID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICRzY29wZS5mYXJlVHlwZXMgPSBbXTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5jcmVhc2VDb3VudChpbmRleClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIEFkZGVkIGNoZWNrIHRvIG1ha2Ugc3VyZSB0aGUgdXNlciBkb2VzIG5vdCBhZGQgbW9yZSB0aGFuICRzY29wZS5tYXhDb3VudFxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNvbXBhbmlvbkNvdW50IDwgJHNjb3BlLm1heENvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmFyZVR5cGVzW2luZGV4XS5OdW1iZXJPZlBhc3NlbmdlcnMrKztcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW5pb25GYXJlID0gJHNjb3BlLmNvbXBhbmlvbkZhcmUgKyAkc2NvcGUuZmFyZVR5cGVzW2luZGV4XS5GYXJlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWF4Q29tcGFuaW9uQ291bnRXYXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWF4Q29tcGFuaW9uQ291bnRXYXJuaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZGVjcmVhc2VDb3VudChpbmRleCkge1xyXG4gICAgICAgICAgICAvLyBBZGRlZCBjaGVjayB0byBtYWtlIHN1cmUgdGhlIHVzZXIgZG9lcyBub3QgcmVtb3ZlIGxlc3MgdGhhbiAwLlxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmZhcmVUeXBlc1tpbmRleF0uTnVtYmVyT2ZQYXNzZW5nZXJzID4gMCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZhcmVUeXBlc1tpbmRleF0uTnVtYmVyT2ZQYXNzZW5nZXJzLS07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFuaW9uRmFyZSA9ICRzY29wZS5jb21wYW5pb25GYXJlIC0gJHNjb3BlLmZhcmVUeXBlc1tpbmRleF0uRmFyZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW5pb25Db3VudC0tO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1heENvbXBhbmlvbkNvdW50V2FybmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgXHJcbiAgICAgICBcclxuICAgICAgICB2YXIgZnJvbUxvY2F0aW9uID0gcmVzZXJ2YXRpb25SZXF1ZXN0LmZyb21Mb2NhdGlvbjtcclxuICAgICAgICB2YXIgdG9Mb2NhdGlvbiA9IHJlc2VydmF0aW9uUmVxdWVzdC50b0xvY2F0aW9uO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuSXNXaGVlbENoYWlyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuSXNQQ0EgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc1NlcnZpY2VBbmltYWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5UcmlwRmFyZXMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5CYXNlRmFyZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJHNjb3BlLm1heENvbXBhbmlvbkNvdW50V2FybmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0KTtcclxuXHJcbiAgICAgICAgICAgIC8vcmVzZXQgY29tcGFuaW9ucyBhbmQgYWNjZXNzaWJpbGl0eVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZUNvbXBhbmlvbnMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dDb21wYW5pb25TZWxlY3Rpb24gPSAhJHNjb3BlLnNob3dDb21wYW5pb25TZWxlY3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc2V0Q29tcGFuaW9ucygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuZmFyZVR5cGVzID0gYW5ndWxhci5jb3B5KGxhc3RGYXJlVHlwZXMpO1xyXG4gICAgICAgICAgICAvL3Jlc2V0IHdoZWVsY2hhaXJzIGV0Yy5cclxuICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkZhcmUgPSBsYXN0Q29tcGFuaW9uRmFyZTtcclxuICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkNvdW50ID0gbGFzdENvbXBhbmlvbkNvdW50O1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0NvbXBhbmlvblNlbGVjdGlvbiA9ICEkc2NvcGUuc2hvd0NvbXBhbmlvblNlbGVjdGlvbjtcclxuICAgICAgICAgICAgJHNjb3BlLm1heENvbXBhbmlvbkNvdW50V2FybmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvL2NvbXBhbmlvbiBvYmplY3Qgc2hvdWxkIGJlIHJlc2V0IHRvIDAgY291bnRcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZWRpdENvbXBhbmlvbnMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGFzdEZhcmVUeXBlcyA9IGFuZ3VsYXIuY29weSgkc2NvcGUuZmFyZVR5cGVzKTtcclxuICAgICAgICAgICAgbGFzdENvbXBhbmlvbkZhcmUgPSAkc2NvcGUuY29tcGFuaW9uRmFyZTtcclxuICAgICAgICAgICAgbGFzdENvbXBhbmlvbkNvdW50ID0gJHNjb3BlLmNvbXBhbmlvbkNvdW50O1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0NvbXBhbmlvblNlbGVjdGlvbiA9ICEkc2NvcGUuc2hvd0NvbXBhbmlvblNlbGVjdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGJvb2tUcmlwKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuYmFzZUZhcmUgPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdDYW4gbm90IGdldCBmYXJpbmcgaW5mb3JtYXRpb24uIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCRzY29wZS4kcGFyZW50Lm9wdGlvbnMuYWxsb3dMb2NhdGlvbk5vdGVzKSB7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzLmZyb20gPSAkc2NvcGUubG9jYXRpb25Ob3Rlcy5mcm9tO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzLnRvID0gJHNjb3BlLmxvY2F0aW9uTm90ZXMudG87XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5UcmlwRmFyZXMgPSAkc2NvcGUuZmFyZVR5cGVzO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRvdGFsVHJpcEZhcmUgPSAkc2NvcGUuYmFzZUZhcmUgKyAkc2NvcGUuY29tcGFuaW9uRmFyZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Db21wYW5pb25zQ291bnQgPSAkc2NvcGUuY29tcGFuaW9uQ291bnQ7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuQmFzZUZhcmUgPSAkc2NvcGUuYmFzZUZhcmU7XHJcbiAgICAgICAgICAgICRzY29wZS4kcGFyZW50LnNhdmVSZXNlcnZhdGlvbigkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0KTtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RmFyZXMoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0ZWRUaW1lID0gcmVzZXJ2YXRpb25UaW1lLmZvcm1hdCgnTU0vREQvWVlZWSBoaDptbSBBJyk7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRyaXBGYXJlcyAhPSBudWxsICYmICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVHJpcEZhcmVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5mYXJlVHlwZXMgPSAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRyaXBGYXJlcztcclxuICAgICAgICAgICAgICAgICRzY29wZS5iYXNlRmFyZSA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuQmFzZUZhcmU7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goJHNjb3BlLmZhcmVUeXBlcywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuTnVtYmVyT2ZQYXNzZW5nZXJzID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFuaW9uQ291bnQgKz0gdmFsdWUuTnVtYmVyT2ZQYXNzZW5nZXJzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFuaW9uRmFyZSArPSAodmFsdWUuRmFyZSAqIHZhbHVlLk51bWJlck9mUGFzc2VuZ2Vycyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzICYmICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3Rlcy5mcm9tICE9ICcnKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2NhdGlvbk5vdGVzLmZyb20gPSAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMuZnJvbTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMgJiYgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzLnRvICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvY2F0aW9uTm90ZXMudG8gPSAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMudG87XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5mYXJlVHlwZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIEZhcmluZ1NlcnZpY2UuR2V0Wm9uZUZhcmVzKCRzY29wZS5kaXZpc2lvbklkLCAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmZyb21ab25lLCAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnRvWm9uZSwgcmVzZXJ2YXRpb25UaW1lLmZvcm1hdChcIllZWVktTU0tREQgSEhtbXNzXCIpLCAkc2NvcGUuc2VydmljZURhdGUpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmFyZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZmFyZXMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZmFyZVR5cGVzLnB1c2goeyBQYXNzZW5nZXJGYXJlVHlwZUlkOiB2YWx1ZS5QYXNzZW5nZXJGYXJlVHlwZUlkLCBOdW1iZXJPZlBhc3NlbmdlcnM6IDAsIE5hbWU6IHZhbHVlLkZhcmVUeXBlLCBGYXJlOiB2YWx1ZS5GYXJlLCBab25lRmFyZUlkOiB2YWx1ZS5ab25lRmFyZUlkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldEJhc2VGYXJlKGZhcmVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXNlRmFyZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdDYW4gbm90IGdldCBmYXJpbmcgaW5mb3JtYXRpb24uIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYmFzZUZhcmUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgYWN0aXZhdGUoZ2V0RmFyZXMpO1xyXG4gICAgICAgIGZ1bmN0aW9uIHNldERlZmF1bHRGYXJlKGZhcmVzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGZhcmVzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmFyZXNbaV0uSXNEZWZhdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gZmFyZXNbaV0uRmFyZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0QmFzZUZhcmUoZmFyZXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL2RlZmF1bHQgZmFyZSBpcyBzZXQsIGlmIGZhcmUgaXMgZm91bmQgaXQgd2lsbCBvdmVyIHdyaXRlIGl0XHJcbiAgICAgICAgICAgIHNldERlZmF1bHRGYXJlKGZhcmVzKTtcclxuICAgICAgICAgICAgUHJvZmlsZVNlcnZpY2UuR2V0UGFzc2VuZ2VyQWdlKCRzY29wZS4kcGFyZW50LnBhc3Nlbmdlci5JZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhZ2UgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmFyZXMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZhcmVzW2ldLkZyb21BZ2UgPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWdlID49IGZhcmVzW2ldLkZyb21BZ2UgJiYgKGZhcmVzW2ldLlRvQWdlID09IHVuZGVmaW5lZCB8fCBhZ2UgPD0gZmFyZXNbaV0uVG9BZ2UpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXNlRmFyZSA9IGZhcmVzW2ldLkZhcmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuZGl2aXNpb25JZCAhPSBudWxsICYmICRzY29wZS5kaXZpc2lvbklkICE9IHVuZGVmaW5lZCAmJiAkc2NvcGUuZGl2aXNpb25JZCAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgIT0gJHNjb3BlLiRwYXJlbnQucmVzZXJ2YXRpb25UeXBlRW51bS5BU0FQKVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uVGltZSA9ICRzY29wZS4kcGFyZW50LmdldFJlc2VydmF0aW9uRGF0ZVRpbWUoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25UaW1lID0gbW9tZW50LnR6KERpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpKTtcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uU2VydmljZS5nZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb25UaW1lKCRzY29wZS5kaXZpc2lvbklkLCByZXNlcnZhdGlvblRpbWUuZm9ybWF0KFwiWVlZWS1NTS1ERCBISG1tc3NcIikpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VydmljZURhdGUgPSBtb21lbnQocmVzcG9uc2UuZGF0YS5yZXN1bHQpLmZvcm1hdChcIllZWVktTU0tRERcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAnQ2FuIG5vdCBnZXQgZmFyaW5nIGluZm9ybWF0aW9uLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5iYXNlRmFyZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignRGFzaGJvYXJkQ29udHJvbGxlcicsIERhc2hib2FyZENvbnRyb2xsZXIpO1xyXG5cclxuICAgIERhc2hib2FyZENvbnRyb2xsZXIuJGluamVjdCA9IFtcclxuICAgICAgICAnJHNjb3BlJyxcclxuICAgICAgICAnJHN0YXRlUGFyYW1zJyxcclxuICAgICAgICAnJGxvY2F0aW9uJyxcclxuICAgICAgICAnJHVpYk1vZGFsJyxcclxuICAgICAgICAnJHJvb3RTY29wZScsICAgICAgICBcclxuICAgICAgICAnJGludGVydmFsJyxcclxuICAgICAgICAnRGl2aXNpb25TZXJ2aWNlJyxcclxuICAgICAgICAnUmVzZXJ2YXRpb25TZXJ2aWNlJyxcclxuICAgICAgICAnU2NoZWR1bGVTZXJ2aWNlJyxcclxuICAgICAgICAnYXV0aFNlcnZpY2UnLFxyXG4gICAgICAgICdVdGlsaXR5RmFjdG9yeScsICAgICAgICBcclxuICAgICAgICAnQ29uZmlnRmFjdG9yeScsXHJcbiAgICAgICAgJ2VudicsXHJcbiAgICAgICAgJ1BhZ2VTZXJ2aWNlJyxcclxuICAgICAgICAnT25lTXZTZXJ2aWNlcydcclxuICAgIF07XHJcblxyXG4gICAgZnVuY3Rpb24gRGFzaGJvYXJkQ29udHJvbGxlcigkc2NvcGUsICRzdGF0ZVBhcmFtcywgJGxvY2F0aW9uLCAkdWliTW9kYWwsICRyb290U2NvcGUsICRpbnRlcnZhbCwgRGl2aXNpb25TZXJ2aWNlLFxyXG4gICAgICAgIFJlc2VydmF0aW9uU2VydmljZSwgU2NoZWR1bGVTZXJ2aWNlLCBhdXRoU2VydmljZSwgVXRpbGl0eUZhY3RvcnksQ29uZmlnRmFjdG9yeSwgZW52LCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnVzZXJJZCA9ICcnO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ0Rhc2hib2FyZCcpO1xyXG4gICAgICAgIHZtLmlzVXNlckxvZ2dlZEluID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlclJlc2VydmF0aW9ucyA9IFtdO1xyXG4gICAgICAgIHZtLnRvZGF5c1RyaXBzID0gW107XHJcbiAgICAgICAgdm0uYWxsb3dlZFNlcnZpY2VzID0gW107XHJcbiAgICAgICAgdm0ubG9hZGluZ1NlcnZpY2VzID0gZmFsc2U7XHJcbiAgICAgICAgdm0uYWxsb3dGYXJpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5wYXNzZW5nZXJJZCA9ICcnO1xyXG4gICAgICAgIHZhciBhdXRvUmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2bS5jdXJyZW50WWVhciA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICB2bS5zaG93RHJ0ID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0NvbW11dGVyID0gZmFsc2U7ICAgICAgICBcclxuICAgICAgICB2bS5jb21tdXRlckluZm8gPSBPbmVNdlNlcnZpY2VzLmdldENvbW11dGVySW5mbygpOyAgIFxyXG4gICAgICAgIHZtLmRydEluZm8gPSBPbmVNdlNlcnZpY2VzLmdldERydEluZm8oKTtcclxuXHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuXHJcbiAgICAgICAgdm0ubG9naW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLm1lbnVDbGFzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmFsbG93ZWRTZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgJiYgdm0uYWxsb3dlZFNlcnZpY2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbENvdW50ID0gdm0uYWxsb3dlZFNlcnZpY2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnY29sLXNtLScgKyAxMiAvIGVsQ291bnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuICdjb2wtc20tMTInO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVEaXZpc2lvblBhcmFtZXRlcnMoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldERpdmlzaW9uUGFyYW1ldGVycyhkaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wcm9taXNlV2luZG93ID0gcGFyYW1zLlByb21pc2VXaW5kb3cgPyBldmFsKHBhcmFtcy5Qcm9taXNlV2luZG93KSA6IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2hvd0NhbmNlbE9wdGlvbnMgPSBwYXJhbXMuQ2FuY2VsUmVhc29uUmVxdWlyZWQgPyBldmFsKHBhcmFtcy5DYW5jZWxSZWFzb25SZXF1aXJlZC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dMb2NhdGlvbk5vdGVzID0gcGFyYW1zLkFsbG93TG9jYXRpb25Ob3RlcyA/IGV2YWwocGFyYW1zLkFsbG93TG9jYXRpb25Ob3Rlcy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFsbG93RmFyaW5nID0gcGFyYW1zLkFsbG93RmFyaW5nID8gZXZhbChwYXJhbXMuQWxsb3dGYXJpbmcudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93Q2hpbGRyZW4gPSBwYXJhbXMuQWxsb3dDaGlsZHJlbiA/IGV2YWwocGFyYW1zLkFsbG93Q2hpbGRyZW4pIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd011bHRpcGxlU2VhdEJvb2tpbmcgPSBwYXJhbXMuQWxsb3dNdWx0aXBsZVNlYXRCb29raW5nID8gZXZhbChwYXJhbXMuQWxsb3dNdWx0aXBsZVNlYXRCb29raW5nLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hUcmlwc0FuZFJlc2VydmF0aW9ucyhjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCByZXNwb25zZS5kYXRhLlJldHVybk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBnZXRQYXNzZW5nZXJUcmlwcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UudHJpcHNGb3JTZXJ2aWNlRGF0ZSh2bS5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgdm0udG9kYXlzVHJpcHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2VXaW5kb3cgPSBvcHRpb25zLnByb21pc2VXaW5kb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgIHZtLnRvZGF5c1RyaXBzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShhLnNjaGVkUGlja3VwVGltZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYi5zY2hlZFBpY2t1cFRpbWUpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udG9kYXlzVHJpcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlcnZpY2VEYXRlID0gdm0udG9kYXlzVHJpcHNbaV0uc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0udG9kYXlzVHJpcHNbaV0uZXN0aW1hdGVkUGlja3VwVGltZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIHBpY2t1cFRpbWUgPSB2bS50b2RheXNUcmlwc1tpXS5zY2hlZFBpY2t1cFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgcHJvbWlzZVdpbmRvd3NFbmRUaW1lID0gRGF0ZUZhY3RvcnkuZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWUocGlja3VwVGltZSwgcHJvbWlzZVdpbmRvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92bS50b2RheXNUcmlwc1tpXS5wcm9taXNlV2luZG93U3RhcnRUaW1lID0gJGZpbHRlcignZGF0ZScpKHBpY2t1cFRpbWUsICdoOm1tIGEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ZtLnRvZGF5c1RyaXBzW2ldLnByb21pc2VXaW5kb3dFbmRUaW1lID0gJGZpbHRlcignZGF0ZScpKHByb21pc2VXaW5kb3dzRW5kVGltZSwgJ2g6bW0gYScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRQaWNrdXBXaW5kb3dUaW1lID0gbmV3IG1vbWVudCh2bS50b2RheXNUcmlwc1tpXS5zdGFydFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmRQaWNrdXBXaW5kb3dUaW1lID0gbmV3IG1vbWVudCh2bS50b2RheXNUcmlwc1tpXS5lbmRQaWNrdXBXaW5kb3dUaW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50b2RheXNUcmlwc1tpXS5wcm9taXNlV2luZG93U3RhcnRUaW1lID0gc3RhcnRQaWNrdXBXaW5kb3dUaW1lLmZvcm1hdCgnaDptbSBBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udG9kYXlzVHJpcHNbaV0ucHJvbWlzZVdpbmRvd0VuZFRpbWUgPSBlbmRQaWNrdXBXaW5kb3dUaW1lLmZvcm1hdCgnaDptbSBBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZChjYWxsYmFjaykgJiYgY2FsbGJhY2sgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgIFxyXG4gICAgICAgIC8vdm0uYWxsb3dDYW5jZWwgPSBmdW5jdGlvbiAodHJpcCkge1xyXG4gICAgICAgIC8vICAgIHJldHVybiB0cmlwLlN0YXR1cyAhPT0gJ1Jlc2VydmVkJztcclxuICAgICAgICAvL30gICAgIFxyXG5cclxuICAgICAgICB2YXIgZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zRm9yVG9kYXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5nZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnNGb3JUb2RheSh2bS5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnJlc2VydmF0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclJlc2VydmF0aW9ucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnJlc2VydmF0aW9uczsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnIuc3RhdHVzICE9PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiJ1NvcnJ5ISBDb3VsZCBub3QgbG9hZCB5b3VyIFJlc2VydmF0aW9uISdcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0QXV0b1JlZnJlc2goKSB7XHJcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0xvZ2dlZEluKCkpIHtcclxuICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gJGludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmZXRjaFRyaXBzQW5kUmVzZXJ2YXRpb25zKCk7XHJcbiAgICAgICAgICAgICAgICB9LCAzMDAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0ubG9hZGluZ1NlcnZpY2VzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBhbGlhcyA9IGFsaWFzTm90Rm91bmRJblJvdXRlKClcclxuICAgICAgICAgICAgICAgID8gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uQWxpYXMoKVxyXG4gICAgICAgICAgICAgICAgOiAkc3RhdGVQYXJhbXMuZGl2aXNpb247XHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5zZXREaXZpc2lvbihhbGlhcylcclxuICAgICAgICAgICAgICAgIC50aGVuKGhhbmRsZVN1Y2Nlc3MsIGhhbmRsZUZhaWx1cmUpOyAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWxpYXNOb3RGb3VuZEluUm91dGUoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzVW5kZWZpbmVkKCRzdGF0ZVBhcmFtcy5kaXZpc2lvbikgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICRzdGF0ZVBhcmFtcy5kaXZpc2lvbiA9PT0gbnVsbCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgJHN0YXRlUGFyYW1zLmRpdmlzaW9uLnRyaW0oKSA9PT0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVTdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5hbGxvd2VkU2VydmljZXMgPSBzb3J0KHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uU2VydmljZXMpO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0NvbW11dGVyID0gIWFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29tbXV0ZXJJbmZvKTtcclxuICAgICAgICAgICAgICAgIHZtLnNob3dEcnQgPSAhYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5kcnRJbmZvKTtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5pc1VzZXJMb2dnZWRJbilcclxuICAgICAgICAgICAgICAgICAgICBmZXRjaFVzZXJEZXRhaWxzKCk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmRpdmlzaW9uTmFtZSA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5EaXZpc2lvbk5hbWUgPyByZXNwb25zZS5kYXRhLnJlc3VsdC5EaXZpc2lvbk5hbWUgOiAnT25lIFBvcnRhbCcpO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zdXBwb3J0UGhvbmVOdW1iZXIgPSAocmVzcG9uc2UuZGF0YS5yZXN1bHQuU3VwcG9ydFBob25lTnVtYmVyID8gcmVzcG9uc2UuZGF0YS5yZXN1bHQuU3VwcG9ydFBob25lTnVtYmVyIDogJycpO1xyXG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1NlcnZpY2VzID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9TZXRzIHRoZSBwYWdlIG5hbWUgYW5kIGhlYWRsaW5lIGZyb20gdGhlIGRhdGFiYXNlLlxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgkcm9vdFNjb3BlLmRpdmlzaW9uTmFtZSk7ICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGl2aXNpb24nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRmFpbHVyZShlcnJvcikge1xyXG4gICAgICAgICAgICB2bS5sb2FkaW5nU2VydmljZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2RpdmlzaW9uJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgc29ydCA9IGZ1bmN0aW9uIChzZXJ2aWNlcykge1xyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZXMuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGEuRGlzcGxheU9yZGVyKSAtIHBhcnNlSW50KGIuRGlzcGxheU9yZGVyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZmV0Y2hVc2VyRGV0YWlscyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0udXNlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24udXNlcklkO1xyXG4gICAgICAgICAgICB2bS5wYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICBwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycyhzZXRBdXRvUmVmcmVzaCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0uc2hvd1N0b3BzTWFwID0gZnVuY3Rpb24gKGluYykge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxHZXRNYXAgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ21hcC1tb2RhbCcsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9yZXNlcnZhdGlvbi1tYXAtbW9kYWwvcmVzZXJ2YXRpb24tbWFwLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Jlc2VydmF0aW9uTWFwQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25fc3RvcHM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluYztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9kYWxHZXRNYXAucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGlzRG9uZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzRG9uZSkge1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG5cclxuICAgICAgICB2YXIgZmV0Y2hUcmlwc0FuZFJlc2VydmF0aW9ucyA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5zaG93Q29tbXV0ZXIpIGdldFBhc3NlbmdlclJlc2VydmF0aW9uc0ZvclRvZGF5KCk7XHJcbiAgICAgICAgICAgIGlmICh2bS5zaG93RHJ0KSB7XHJcblx0XHRcdFx0Ly8gZ2V0IGFsbCBEUlQgdHJpcHMgb2YgaW50ZXJlc3QgdG8gdGhlIHBhc3NlbmdlclxyXG4gICAgICAgICAgICBcdGdldFBhc3NlbmdlclRyaXBzKCk7XHJcbiAgICAgICAgICAgIFx0Ly8gZ2V0IGN1cnJlbnQgdHJpcFxyXG4gICAgICAgICAgICBcdFNjaGVkdWxlU2VydmljZS5nZXRsYXN0cmlwZGV0YWlscyh2bS5wYXNzZW5nZXJJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgc3RvcEF1dG9SZWZyZXNoKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB2YXIgc3RvcEF1dG9SZWZyZXNoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoYXV0b1JlZnJlc2gpKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGF1dG9SZWZyZXNoKTtcclxuICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdkaXZpc2lvbkNoYW5nZWQnLCBzdG9wQXV0b1JlZnJlc2gpO1xyXG5cclxuICAgICAgICB2bS5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIChwYXRoLCBzZXJ2aWNlVHlwZSwgc2VydmljZUlkKSB7XHJcbiAgICAgICAgICAgIC8vJHJvb3RTY29wZS4kYnJvYWRjYXN0KHNlcnZpY2VJZCk7XHJcbiAgICAgICAgICAgIGlmIChzZXJ2aWNlVHlwZSA9PT0gJ2V4dGVybmFsJylcclxuICAgICAgICAgICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3BsYXRmb3JtLWNvcmRvdmEnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgaGVyZSBmb3IgSW9uaWMgZnJhbWV3b3JrLlxyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHBhdGgsICdfc3lzdGVtJywgJycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBwYXRoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZpY2VUeXBlID09PSAnaW50ZXJuYWwnKVxyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgocGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICBcclxuXHJcbiAgICAgICAgdm0uc2hvd0NvbW11dGVyVHJpcCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21tdXRlclRyaXBNb2RhbCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3RyaXBzL2NvbW11dGVyLXRyaXAtbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQ29tbXV0ZXJUcmlwTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXBJZDogdHJpcC5pZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbW11dGVyVHJpcE1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmNhbmNlbGxlZCB8fCByZXNwb25zZS5pc01vZGlmaWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zRm9yVG9kYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uc2hvd0RydFRyaXAgPSBmdW5jdGlvbiAodHJpcCkge1xyXG4gICAgICAgICAgICB2YXIgX3RyaXBNb2RhbFJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICBwYXNzZW5nZXJUcmlwOiB0cmlwLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VEYXRlOiB2bS5zZXJ2aWNlRGF0ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBkcnRUcmlwTW9kYWwgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC90cmlwcy9kcnQtdHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlwTW9kYWxSZXF1ZXN0OiBfdHJpcE1vZGFsUmVxdWVzdFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGRydFRyaXBNb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5hY3Rpb24gPT09ICdjYW5jZWwnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsVHJpcCh0cmlwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbFRyaXAodHJpcCkge1xyXG4gICAgICAgICAgICB2YXIgdHJpcFRvQ2FuY2VsID0ge1xyXG4gICAgICAgICAgICAgICAgJ3RyaXBJZCc6IHRyaXAuVHJpcElkLFxyXG4gICAgICAgICAgICAgICAgJ3Bhc3NlbmdlcklkJzogdHJpcC5QYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICdmcm9tJzogdHJpcC5zdGFydE5hbWUsXHJcbiAgICAgICAgICAgICAgICAndG8nOiB0cmlwLmVuZE5hbWUsXHJcbiAgICAgICAgICAgICAgICAnc2NoZWR1bGVkVGltZSc6IHRyaXAuc2NoZWRQaWNrdXBUaW1lXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgbW9kYWxDYW5jZWxUcmlwID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1wcm9tcHQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVHJpcENhbmNlbGxhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpcFRvQ2FuY2VsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmlwVG9DYW5jZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsT3B0aW9uczogb3B0aW9ucy5zaG93Q2FuY2VsT3B0aW9uc1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2RhbENhbmNlbFRyaXAucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc0NhbmNlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcyhcIlN1Y2Nlc3MhXCIsIFwiVHJpcCBjYW5jZWxsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyVHJpcHMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiVW5hYmxlIHRvIGNhbmNlbCB0aGUgdHJpcC5cIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvLyBJb25pYyBwYXJhbWV0ZXJzXHJcbiAgICAgICAgaWYgKGVudi5pb25pYykge1xyXG4gICAgICAgICAgICB2bS5hcHBWZXJzaW9uID0gZW52LmlvbmljLmFwcFZlcnNpb247XHJcbiAgICAgICAgICAgIHZtLmFwcFZlcnNpb24gKz0gZW52LmlvbmljLnNvZnR3YXJlVmVyc2lvbiA9PSBudWxsID8gJycgOiAnICcgKyBlbnYuaW9uaWMuc29mdHdhcmVWZXJzaW9uO1xyXG4gICAgICAgICAgICB2bS5hcHBWZXJzaW9uICs9IGVudi5pb25pYy5lbnZpcm9ubWVudCA9PSBudWxsID8gJycgOiAnLicgKyBlbnYuaW9uaWMuZW52aXJvbm1lbnQ7XHJcbiAgICAgICAgICAgIHZtLmFwcFZlcnNpb24gKz0gZW52LmlvbmljLmxvY2FsRW52aXJvbm1lbnQgPT0gbnVsbCA/ICcnIDogJy4nICsgZW52LmlvbmljLmxvY2FsRW52aXJvbm1lbnQ7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZtLmFwcFZlcnNpb24gPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XHJcbiAgICAgICAgfSAgICAgICAgXHJcblxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKTtcclxuICAgIGFwcC5jb250cm9sbGVyKCdEaXNwbGF5U2NoZWR1bGVkVHJpcENvbnRyb2xsZXInLCBEaXNwbGF5VHJpcE1vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgRGlzcGxheVRyaXBNb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRodHRwJywgJ1V0aWxpdHlGYWN0b3J5JywgJ0RhdGVGYWN0b3J5JyxcclxuICAgICAgICAnJGxvZycsICckdWliTW9kYWxJbnN0YW5jZScsICd0cmlwJywgJ0NvbmZpZ0ZhY3RvcnknLCdvcHRpb25zJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRGlzcGxheVRyaXBNb2RhbENvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgVXRpbGl0eUZhY3RvcnksIERhdGVGYWN0b3J5LFxyXG4gICAgICAgICRsb2csICR1aWJNb2RhbEluc3RhbmNlLCB0cmlwLENvbmZpZ0ZhY3RvcnksIG9wdGlvbnMpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50cmlwID0gdHJpcDtcclxuXHJcbiAgICAgICAgdmFyIHN5c3RlbVBhcmFtcyA9IG9wdGlvbnM7XHJcblxyXG4gICAgICAgIHZtLmFsbG93RmFyaW5nID0gc3lzdGVtUGFyYW1zLmFsbG93RmFyaW5nO1xyXG4gICAgICAgIHZtLmFsbG93Q2hpbGRyZW4gPSBzeXN0ZW1QYXJhbXMuYWxsb3dDaGlsZHJlbjtcclxuICAgICAgICB2bS5hbGxvd0xvY2F0aW9uTm90ZXMgPSBzeXN0ZW1QYXJhbXMuYWxsb3dMb2NhdGlvbk5vdGVzOyBcclxuXHJcbiAgICAgICAgdmFyIHN0YXJ0VGltZSA9IG5ldyBtb21lbnQodm0udHJpcC5TY2hlZHVsZWRQaWNrdXBUaW1lKTtcclxuICAgICAgICB2bS50cmlwLnByb21pc2VXaW5kb3dTdGFydFRpbWUgPSBzdGFydFRpbWUuZm9ybWF0KCdoOm1tIEEnKTtcclxuICAgICAgICBpZiAobW9tZW50LmlzTW9tZW50KHN0YXJ0VGltZSkpXHJcbiAgICAgICAgICAgIHZtLnRyaXAucHJvbWlzZVdpbmRvd0VuZFRpbWUgPSBzdGFydFRpbWUuYWRkKHBhcnNlSW50KHN5c3RlbVBhcmFtcy5wcm9taXNlV2luZG93KSwgJ20nKS5mb3JtYXQoJ2g6bW0gQScpO1xyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICAgICB2bS5jYW5jZWxUcmlwID0gY2FuY2VsVHJpcDtcclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsVHJpcCh0cmlwSWQpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbiAgICBhcHAuZmFjdG9yeSgnRmFyaW5nU2VydmljZScsIEZhcmluZ1NlcnZpY2UpO1xyXG4gICAgRmFyaW5nU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRmFyaW5nU2VydmljZSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnksIGF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIEdldFpvbmVJREZvckxvY2F0aW9uOiBnZXRab25lSURGb3JMb2NhdGlvbixcclxuICAgICAgICAgICAgR2V0Wm9uZUZhcmVzOiBnZXRab25lRmFyZXNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRab25lRmFyZXMoZGl2aXNpb25JZCwgZnJvbVpvbmUsIHRvWm9uZSwgcmVzZXJ2YXRpb25UaW1lLCBzZXJ2aWNlRGF0ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcImZhcmluZy9cIiArIGRpdmlzaW9uSWQgKyBcIi9cIiArIGZyb21ab25lICsgXCIvXCIgKyB0b1pvbmUgKyBcIi9cIiArIHJlc2VydmF0aW9uVGltZSArIFwiL1wiICsgc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICBkZWZlci5yZWplY3QocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFpvbmVJREZvckxvY2F0aW9uKGxhdGl0dWRlLCBsb25naXR1ZGUsIGRpdmlzaW9uSWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3Nob3VsZCBoYXZlIG1ldGhvZCBpbiBzZWN1cmVkIGFwaSBcclxuICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF91cmwgPSBvbmVNVlVSTCArIFwiZmFyaW5nL2dldFpvbmVJZEZvckxvY2F0aW9uL1wiICsgZGl2aXNpb25JZCArIFwiL1wiICsgbGF0aXR1ZGUgKyBcIi9cIiArIGxvbmdpdHVkZSArIFwiL1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmZhY3RvcnkoJ0ZlZWRiYWNrU2VydmljZScsIEZlZWRiYWNrU2VydmljZSk7XHJcbiAgICBGZWVkYmFja1NlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnQ29uZmlnRmFjdG9yeScsJ2F1dGhTZXJ2aWNlJywnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRmVlZGJhY2tTZXJ2aWNlKCRodHRwLCAkcSwgQ29uZmlnRmFjdG9yeSwgYXV0aFNlcnZpY2UsRGl2aXNpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIFNhdmVGZWVkYmFjazogc2F2ZUZlZWRiYWNrLFxyXG4gICAgICAgICAgICBhZGRDb21tdXRlckZlZWRiYWNrIDogYWRkQ29tbXV0ZXJGZWVkYmFja1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVGZWVkYmFjayhmZWVkYmFja1JlcXVlc3QpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF91cmwgPSBvbmVNVlVSTCArIFwidHJpcC9cIiArIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkICsgXCIvZmVlZGJhY2svc2F2ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogX3VybCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZmVlZGJhY2tSZXF1ZXN0KSxcclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICBkZWZlci5yZWplY3QocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZENvbW11dGVyRmVlZGJhY2soZmVlZGJhY2tSZXF1ZXN0LCByZXNlcnZhdGlvbklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF91cmwgPSBvbmVNVlVSTCArIFwiY29tbXV0ZXIvXCIgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCIvcmVzZXJ2YXRpb25zL2ZlZWRiYWNrL1wiICsgYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgKyBcIi9cIiArIHJlc2VydmF0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmZWVkYmFja1JlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignRml4ZWRSb3V0ZXNDb250cm9sbGVyJywgRml4ZWRSb3V0ZXNDb250cm9sbGVyKTtcclxuXHJcbiAgICBGaXhlZFJvdXRlc0NvbnRyb2xsZXIuJGluamVjdCA9IFsgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3VwY29taW5nU2NoZWR1bGVzJywgJ2Zyb21TdG9wTmFtZScsJ09uZU12U2VydmljZXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBGaXhlZFJvdXRlc0NvbnRyb2xsZXIoICR1aWJNb2RhbEluc3RhbmNlLCB1cGNvbWluZ1NjaGVkdWxlcywgZnJvbVN0b3BOYW1lLE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnVwY29taW5nU2NoZWR1bGVzID0gdXBjb21pbmdTY2hlZHVsZXM7XHJcbiAgICAgICAgdm0uZnJvbVN0b3BOYW1lID0gZnJvbVN0b3BOYW1lO1xyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICAgICB2bS5mckluZm8gPSBPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHsgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbG9jYXRpb25TZWFyY2hEaXJlY3RpdmUnLCBsb2NhdGlvblNlYXJjaERpcmVjdGl2ZSk7XHJcblxyXG4gICAgbG9jYXRpb25TZWFyY2hEaXJlY3RpdmUuJGluamVjdCA9IFsnTG9jYXRpb25GYWN0b3J5JywgJyRyb290U2NvcGUnLCAnJHEnLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ1V0aWxpdHlGYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGxvY2F0aW9uU2VhcmNoRGlyZWN0aXZlKExvY2F0aW9uRmFjdG9yeSwgJHJvb3RTY29wZSwgJHEsIFNjaGVkdWxlU2VydmljZSwgVXRpbGl0eUZhY3RvcnksIGF1dGhTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICAvLyBVc2FnZTpcclxuICAgICAgICAvLyAgICAgPExvY2F0aW9uLXNlYXJjaC1kaXJlY3RpdmU+PC9Mb2NhdGlvbi1zZWFyY2gtZGlyZWN0aXZlPlxyXG4gICAgICAgIC8vIENyZWF0ZXM6XHJcbiAgICAgICAgLy8gXHJcbiAgICAgICAgLy9sb2NhdGlvbmZpbHRlcj0wIG1lYW5zIFNob3cgTG9jYXRpb25zIHRoYXQgYXJlIE1hbnVhbGx5IGFkZGVkIHRvIHRoZSBvbmVNViBEYXRhYmFzZShmb3Igbm93KVxyXG4gICAgICAgIC8vbG9jYXRpb25maWx0ZXI9MSBtZWFucyBTaG93IExvY2F0aW9ucyBib3RoIHRoYXQgYXJlIE1hbnVhbGx5IGFkZGVkIHRvIHRoZSBvbmVNViBEYXRhYmFzZSBhbmQgYWxzbyBmcm9tIHRoZSBnb29nbGUgYXBpKGZvciBub3cpXHJcbiAgICAgICAgLy9sb2NhdGlvbmZpbHRlciBpcyBkeW5hbWljIGVub3VnaCB0byBiZSBleHBhbmRlZCBpbiBmdXR1cmVcclxuXHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgbGluazogbGluayxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIG9uTG9jYXRpb25TZWxlY3RlZDogJyYnLCBtaW5sZW5ndGg6ICc9bWlubGVuZ3RoJywgbG9jYXRpb25maWx0ZXI6ICdAJyxcclxuICAgICAgICAgICAgICAgIGxhYmVsbmFtZTogJz1sYWJlbG5hbWUnLCBzZWxlY3RlZGxvY2F0aW9uOiAnPXNlbGVjdGVkbG9jYXRpb24nLCBwYXNzZW5nZXJJZDogJ0AnLCBnb29nbGVvbmx5OiAnQCcgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9sb2NhdGlvblNlYXJjaC5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgc2NvcGUudHlwZSA9IGF0dHJzLmxhYmVsbmFtZTtcclxuXHRcdH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlcigkc2NvcGUpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSBMb2NhdGlvbkZhY3RvcnkuZ2V0TG9jYXRpb25zO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0ID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5pbml0aWFsVmFsdWUgPSAnJztcclxuICAgICAgICBcclxuICAgICAgICAgICAgJHNjb3BlLnJlc3VsdHNBUEkgPSBmdW5jdGlvbiAodXNlcklucHV0U3RyaW5nLCB0aW1lb3V0UHJvbWlzZSkge1xyXG4gICAgICAgICAgICAgICAgLy92YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgXHRyZXR1cm4gJHNjb3BlLmRhdGEodXNlcklucHV0U3RyaW5nLCAkc2NvcGUubG9jYXRpb25maWx0ZXIsICRzY29wZS5kaXZpc2lvbklkLCAkc2NvcGUucGFzc2VuZ2VySWQsICRzY29wZS5nb29nbGVvbmx5LCB7IHRpbWVvdXQ6IHRpbWVvdXRQcm9taXNlIH0pXHJcbiAgICAgICAgICAgICAgICAvLy50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBmaWx0ZXJlZFJlc3VsdCA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKCRzY29wZS5zZWxlY3RlZGxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGZpbHRlcmVkUmVzdWx0ID0gcmVzdWx0LmRhdGEuZmlsdGVyKGZ1bmN0aW9uIChsb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICByZXR1cm4gbG9jYXRpb24ubG9jLkxvY2F0aW9uSWQgIT0gJHNjb3BlLnNlbGVjdGVkbG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAgIC8vICBkZWZlci5yZXNvbHZlKGZpbHRlcmVkUmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgICAgICAgICAvL3JldHVybiBkZWZlci5wcm9taXNlO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL1NldCBzZWxlY3RlZCBsb2NhdGlvbiBmcm9tIEdvb2dsZSBBcGlcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkR29vZ2xlTG9jYXRpb25Gcm9tID0gZnVuY3Rpb24gKGFkZHJlc3MpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhZGRyZXNzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYWRkID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS50eXBlc1swXSA9PSBcInN0cmVldF9udW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkID0gYWRkICsgXCIgXCIgKyBhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS5zaG9ydF9uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzW2ldLnR5cGVzWzBdID09IFwicm91dGVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkID0gYWRkICsgXCIgXCIgKyBhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS5zaG9ydF9uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzW2ldLnR5cGVzWzBdID09IFwibG9jYWxpdHlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5DaXR5ID0gYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0uc2hvcnRfbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS50eXBlc1swXSA9PSBcImFkbWluaXN0cmF0aXZlX2FyZWFfbGV2ZWxfMVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlN0YXRlID0gYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0uc2hvcnRfbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS50eXBlc1swXSA9PSBcInBvc3RhbF9jb2RlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuWmlwQ29kZSA9IGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzW2ldLnNob3J0X25hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2RvIG5vdGhpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkFkZHJlc3MxID0gYWRkO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuRnJvbSA9IGFkZHJlc3MuZm9ybWF0dGVkX2FkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5MYXRpdHVkZSA9IGFkZHJlc3MuZ2VvbWV0cnkubG9jYXRpb24ubGF0O1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuTG9uZ2l0dWRlID0gYWRkcmVzcy5nZW9tZXRyeS5sb2NhdGlvbi5sbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Hb29nbGVQbGFjZUlkID0gYWRkcmVzcy5wbGFjZV9pZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUub25Mb2NhdGlvblNlbGVjdGVkTm90aWZ5ID0gZnVuY3Rpb24gKExvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0ID0ge307XHJcbiAgICAgICAgICAgICAgICBpZiAoTG9jYXRpb24gIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IExvY2F0aW9uLm9yaWdpbmFsT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmogIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmlzR29vZ2xlTG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdvb2dsZUxvY2F0aW9uRnJvbShvYmoubG9jKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QgPSBvYmoubG9jO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoJHNjb3BlLm9uTG9jYXRpb25TZWxlY3RlZCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5vbkxvY2F0aW9uU2VsZWN0ZWQoeyBsb2NhdGlvbjogJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE1hcENlbnRlcigpIHtcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKCRzY29wZS5kaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsICYmICByZXNwb25zZS5kYXRhLnJlc3VsdCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzUmVzdCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIExvY2F0aW9uRmFjdG9yeS5zZXRhZGQoJHNjb3BlLmFkZHJlc3NSZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICcnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoY2FsbGJhY2spe1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hZGRyZXNzUmVzdCA9PSB1bmRlZmluZWQgfHwgJHNjb3BlLmFkZHJlc3NSZXN0ID09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5kaXZpc2lvbklkICE9IG51bGwgJiYgJHNjb3BlLmRpdmlzaW9uSWQgIT0gdW5kZWZpbmVkICYmICRzY29wZS5kaXZpc2lvbklkICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignY2xvc2VzdExvY2F0aW9uJywgZnVuY3Rpb24gKGV2ZW50LCBsb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50eXBlID09PSAnRlJPTScpXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmluaXRpYWxWYWx1ZSA9IGxvY2F0aW9uLnRpdGxlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJ2luaXRpYWxMb2NhdGlvblZhbHVlJywgZnVuY3Rpb24gKGV2ZW50LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICBcdCRzY29wZS5pbml0aWFsVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCdob21lTG9jYXRpb25EaXNhYmxlJywgZnVuY3Rpb24gKGV2ZW50LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICBcdGlmICgkc2NvcGUudHlwZSAhPSAnRlJPTScpIHtcclxuICAgICAgICAgICAgXHRcdCRzY29wZS5kaXNhYmxlSW5wdXQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignaG9tZUxvY2F0aW9uVGV4dCcsIGZ1bmN0aW9uIChldmVudCwgdGV4dCkge1xyXG4gICAgICAgICAgICBcdGlmICgkc2NvcGUudHlwZSAhPSAnRlJPTScpIHtcclxuICAgICAgICAgICAgXHRcdCRzY29wZS5pbml0aWFsVmFsdWUgPSB0ZXh0O1xyXG4gICAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCd0b2dnbGUtZnJvbS1hZGRyZXNzJywgZnVuY3Rpb24gKGV2ZW50LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50eXBlID09ICdGUk9NJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlSW5wdXQgPSAhdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgYWN0aXZhdGUoZ2V0TWFwQ2VudGVyKTtcclxuXHRcdH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkgeyBcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnbG9jYXRpb25TZXJ2aWNlJywgbG9jYXRpb25TZXJ2aWNlKTtcclxuICAgIGxvY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5J107XHJcblxyXG5mdW5jdGlvbiBsb2NhdGlvblNlcnZpY2UoJGh0dHAsICRxLCBDb25maWdGYWN0b3J5KSB7XHJcblxyXG4gICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgc2F2ZUxvY2F0aW9uOiBzYXZlTG9jYXRpb24sXHJcbiAgICAgICAgaXNBZGRyZXNzSW5TZXJ2aWNlOiBpc0FkZHJlc3NJblNlcnZpY2UsXHJcbiAgICAgICAgZ2V0TG9jYXRpb25UeXBlczogZ2V0TG9jYXRpb25UeXBlcyxcclxuICAgICAgICBnZXRSZXZlcnNlR2VvQ29kZTogZ2V0UmV2ZXJzZUdlb0NvZGUsXHJcbiAgICAgICAgZ2V0R2VvQ29kZTogZ2V0R2VvQ29kZSxcclxuICAgICAgICBnZXRMb2NhdGlvbkRhdGE6IGdldExvY2F0aW9uRGF0YSxcclxuICAgICAgICBlZGl0TWFudWFsTG9jYXRpb246IGVkaXRNYW51YWxMb2NhdGlvblxyXG4gICAgfTtcclxuICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuXHJcblxyXG4gICAgZnVuY3Rpb24gc2F2ZUxvY2F0aW9uKHNhdmVMb2NhdGlvbikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHNhdmVMb2NhdGlvbik7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IG9uZU1WVVJMICsgJ1RyaXAvU2F2ZUxvY2F0aW9uJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShzYXZlTG9jYXRpb24pLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGlzQWRkcmVzc0luU2VydmljZShBZGRyZXNzKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IG9uZU1WVVJMICsgJ1RyaXAvSXNBZGRyZXNzSW5TZXJ2aWNlJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShBZGRyZXNzKSxcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRMb2NhdGlvblR5cGVzKCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnLi4vU2VydmljZUFyZWEvR2V0TG9jYXRpb25UeXBlcyc7XHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRSZXZlcnNlR2VvQ29kZShsYXRsbmcpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/bGF0bG5nPScgKyBsYXRsbmc7XHJcbiAgICAgICAgJGh0dHAuZ2V0KCcvL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uJywge1xyXG4gICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgIGxhdGxuZzogbGF0bG5nLFxyXG4gICAgICAgICAgICAgICAgc2Vuc29yOiB0cnVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogZmFsc2VcclxuICAgICAgICAgICAgLy8kaHR0cCh7XHJcbiAgICAgICAgICAgIC8vICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgIC8vICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAvLyAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldEdlb0NvZGUoYWRkcmVzcykge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9hZGRyZXNzPScgKyBhZGRyZXNzO1xyXG4gICAgICAgICRodHRwLmdldCgnLy9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbicsIHtcclxuICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBhZGRyZXNzLFxyXG4gICAgICAgICAgICAgICAgc2Vuc29yOiB0cnVlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogZmFsc2VcclxuICAgICAgICAgICAgLy8kaHR0cCh7XHJcbiAgICAgICAgICAgIC8vICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgIC8vICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAvLyAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG4gICAgZnVuY3Rpb24gZ2V0TG9jYXRpb25EYXRhKERpdmlzaW9uSWQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJyc7XHJcbiAgICAgICAgLy8gaWYgKExvY2F0aW9uaWQgPiAwKVxyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdUcmlwL0dldE1hbnVhbExvY2F0aW9ucy8/RGl2aXNpb25JZD0nICsgRGl2aXNpb25JZDtcclxuICAgICAgICAgICAgICAgIC8vZWxzZVxyXG4gICAgICAgICAgICAgICAgLy8gICAgc2VydmljZVVybCA9ICcuLi9TZXJ2aWNlQXJlYS9HZXRNYW51YWxMb2NhdGlvbnMnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGVkaXRNYW51YWxMb2NhdGlvbihsb2NhdGlvbklkKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICcnO1xyXG4gICAgICAgIC8vIGlmIChMb2NhdGlvbmlkID4gMClcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAnVHJpcC9FZGl0TWFudWFsTG9jYXRpb24vP2xvY2F0aW9uSWQ9JyArIGxvY2F0aW9uSWQ7XHJcbiAgICAgICAgICAgICAgICAvL2Vsc2VcclxuICAgICAgICAgICAgICAgIC8vICAgIHNlcnZpY2VVcmwgPSAnLi4vU2VydmljZUFyZWEvR2V0TWFudWFsTG9jYXRpb25zJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcblxyXG59XHJcblxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgLy9kZWJ1Z2dlcjtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdNb2JpbGl0eUFpZHNTZXJ2aWNlJywgTW9iaWxpdHlBaWRzU2VydmljZSk7XHJcbiAgICBNb2JpbGl0eUFpZHNTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ0NvbmZpZ0ZhY3RvcnknXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNb2JpbGl0eUFpZHNTZXJ2aWNlKCRodHRwLCAkcSwgQ29uZmlnRmFjdG9yeSkge1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0RGl2aXNpb25BaWRzOiBnZXREaXZpc2lvbkFpZHMsXHJcbiAgICAgICAgICAgIHNhdmVEaXZpc2lvbkFpZHM6IHNhdmVEaXZpc2lvbkFpZHNcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERpdmlzaW9uQWlkcyhkaXZpc2lvbklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF91cmwgPSBvbmVNVlVSTCArIFwiTW9iaWxpdHlBaWRzL1wiICsgZGl2aXNpb25JZCArIFwiP3JuZD1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZURpdmlzaW9uQWlkcyhkaXZpc2lvbklkLCBhaWRzKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF91cmwgPSBvbmVNVlVSTCArIFwiTW9iaWxpdHlBaWRzL1wiICsgZGl2aXNpb25JZCArIFwiP3JuZD1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGFpZHMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdOZWdvdGlhdGlvbkNvbnRyb2xsZXInLCBOZWdvdGlhdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE5lZ290aWF0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsICckc2NvcGUnLCAnJGZpbHRlcicsJ2F1dGhTZXJ2aWNlJywnRGl2aXNpb25TZXJ2aWNlJyxcclxuICAgICAgICAnVHJpcE5lZ290aWF0aW9uTG9nU2VydmljZScsICdEYXRlRmFjdG9yeScsICduZWdvdGlhdGlvblJlcXVlc3QnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBOZWdvdGlhdGlvbkNvbnRyb2xsZXIoJHVpYk1vZGFsSW5zdGFuY2UsICRzY29wZSwgJGZpbHRlcixhdXRoU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLFxyXG4gICAgICAgIFRyaXBOZWdvdGlhdGlvbkxvZ1NlcnZpY2UsIERhdGVGYWN0b3J5LCBuZWdvdGlhdGlvblJlcXVlc3QpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5wcm9wb3NlZFNsb3RzID0gbmVnb3RpYXRpb25SZXF1ZXN0LnByb3Bvc2VkU2xvdHM7XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRTbG90ID0gJyc7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb24gPSBhbmd1bGFyLmNvcHkobmVnb3RpYXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uUmVxdWVzdCk7XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvblR5cGUgPSAnJztcclxuXHJcbiAgICAgICAgdmFyIHVzZXJJZCA9IDA7XHJcbiAgICAgICAgdmFyIHRyaXBSZXF1ZXN0SWQgPSAwO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlRGF0ZSA9IG5lZ290aWF0aW9uUmVxdWVzdC5zZXJ2aWNlRGF0ZTtcclxuICAgICAgICB2YXIgcHJvbWlzZVdpbmRvdyA9IDA7XHJcblxyXG4gICAgICAgIC8vZm9yY2VkIHRvIHVzZSB0aGlzIGFzIHBheCBhbmQgb3BzIHBvcnRhbCByZXNlcnZhdGlvbiBvYmplY3RzIGFyZSBub3QgaW4gc3luYy4gICAgICAgIFxyXG4gICAgICAgIHZhciByZXNlcnZhdGlvblR5cGVFbnVtID0ge1xyXG4gICAgICAgICAgICAxOiBcIkFTQVBcIixcclxuICAgICAgICAgICAgMjogXCJBRFZBTkNFRFwiLFxyXG4gICAgICAgICAgICAzOiBcIkFQUE9JTlRNRU5UXCJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS50b1Byb21pc2VXaW5kb3cgPSBmdW5jdGlvbiAocHJvcG9zZWRTbG90KSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RhcnRUaW1lID0gJGZpbHRlcignZGF0ZScpKHByb3Bvc2VkU2xvdC5Qcm9wb3NlZFN0YXJ0V2luZG93LCAnaDptbSBhJyk7XHJcbiAgICAgICAgICAgIC8vdmFyIGVuZFRpbWUgPSBEYXRlRmFjdG9yeS5nZXRQcm9taXNlV2luZG93RW5kVGltZShpbnB1dCwgcHJvbWlzZVdpbmRvdyk7XHJcbiAgICAgICAgICAgIHZhciBlbmRUaW1lID0gJGZpbHRlcignZGF0ZScpKHByb3Bvc2VkU2xvdC5Qcm9wb3NlZEVuZFdpbmRvdywgJ2g6bW0gYScpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHN0YXJ0VGltZSArICcgLSAnICsgZW5kVGltZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdG9UaGlydHlUaHJlZUhvdXJDbG9jayA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gRGF0ZUZhY3RvcnkuZ2V0Q3VzdG9tVGltZShpbnB1dCwgc2VydmljZURhdGUpO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRyaXBSZXF1ZXN0SWQgPSBuZWdvdGlhdGlvblJlcXVlc3QudHJpcFJlcXVlc3RJZDtcclxuXHJcbiAgICAgICAgICAgIHVzZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZDtcclxuICAgICAgICAgICAgcHJvbWlzZVdpbmRvdyA9IERpdmlzaW9uU2VydmljZS5nZXRTeXN0ZW1QYXJhbWV0ZXJzKCkuUHJvbWlzZVdpbmRvdztcclxuXHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25UeXBlID0gcmVzZXJ2YXRpb25UeXBlRW51bVt2bS5yZXNlcnZhdGlvbi5yZXNlcnZhdGlvblR5cGVdO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBjbG9zZU1vZGFsID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnJlamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIFRyaXBOZWdvdGlhdGlvbkxvZ1NlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAuYWRkUmVqZWN0aW9uTG9nKHRyaXBSZXF1ZXN0SWQsIHVzZXJJZCk7XHJcblxyXG4gICAgICAgICAgICBjbG9zZU1vZGFsKHtcclxuICAgICAgICAgICAgICAgIGNhbk5lZ290aWF0ZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIHZtLmNsb3NlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjbG9zZU1vZGFsKHtcclxuICAgICAgICAgICAgICAgIGNhbk5lZ290aWF0ZTogZmFsc2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5hY2NlcHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFNsb3QgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZWdvdGlhdGlvbkxvZ0lkID0gZ2V0TmVnb3RpYXRlZExvZ0lkKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgVHJpcE5lZ290aWF0aW9uTG9nU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRBcHByb3ZhbExvZyh0cmlwUmVxdWVzdElkLCBuZWdvdGlhdGlvbkxvZ0lkLCB1c2VySWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW5OZWdvdGlhdGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVGltZTogdm0uc2VsZWN0ZWRTbG90LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlwUmVxdWVzdElkOiB0cmlwUmVxdWVzdElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWdvdGlhdGlvbkxvZ0lkOiBuZWdvdGlhdGlvbkxvZ0lkXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE5lZ290aWF0ZWRMb2dJZCgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkU2xvdCAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5wcm9wb3NlZFNsb3RzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnByb3Bvc2VkU2xvdHNbaV0uUHJvcG9zZWREYXRlID09IHZtLnNlbGVjdGVkU2xvdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZtLnByb3Bvc2VkU2xvdHNbaV0uaWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdSZXNlcnZhdGlvbkVycm9yTW9kYWxDb250cm9sbGVyJywgUmVzZXJ2YXRpb25FcnJvck1vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgUmVzZXJ2YXRpb25FcnJvck1vZGFsQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsICdtZXNzYWdlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUmVzZXJ2YXRpb25FcnJvck1vZGFsQ29udHJvbGxlcigkdWliTW9kYWxJbnN0YW5jZSwgbWVzc2FnZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZtLm1zZyA9IG1lc3NhZ2UubWVzc2FnZS5FcnJvck1lc3NhZ2U7XHJcbiAgICAgICAgdm0uaGVhZGVyID0gbWVzc2FnZS5oZWFkZXIgfHwgXCJJbmZvcm1hdGlvblwiIDtcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWw7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCJcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ3Jlc2VydmF0aW9uRm9ybURpcmVjdGl2ZScsIHJlc2VydmF0aW9uRm9ybURpcmVjdGl2ZSk7XHJcblxyXG4gICAgcmVzZXJ2YXRpb25Gb3JtRGlyZWN0aXZlLiRpbmplY3QgPSBbJyR3aW5kb3cnLCAnTG9jYXRpb25GYWN0b3J5JywgJ1V0aWxpdHlGYWN0b3J5JywgJ1NjaGVkdWxlU2VydmljZScsXHJcbiAgICAgICAgJ0RhdGVGYWN0b3J5JywnJHEnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0dlb0xvY2F0aW9uU2VydmljZScsICdTdG9wU2VydmljZScsICdGYXJpbmdTZXJ2aWNlJywgJyR0aW1lb3V0JyxcclxuICAgICAgICAnUHJvZmlsZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gcmVzZXJ2YXRpb25Gb3JtRGlyZWN0aXZlKCR3aW5kb3csIExvY2F0aW9uRmFjdG9yeSwgIFV0aWxpdHlGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UsXHJcbiAgICAgICAgRGF0ZUZhY3RvcnksICRxLCBEaXZpc2lvblNlcnZpY2UsIEdlb0xvY2F0aW9uU2VydmljZSwgU3RvcFNlcnZpY2UsIEZhcmluZ1NlcnZpY2UsICR0aW1lb3V0LFxyXG4gICAgICAgIFByb2ZpbGVTZXJ2aWNlLE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICAvLyBVc2FnZTpcclxuICAgICAgICAvLyAgICAgPHJlc2VydmF0aW9uLWZvcm0tZGlyZWN0aXZlPjwvcmVzZXJ2YXRpb24tZm9ybS1kaXJlY3RpdmU+XHJcbiAgICAgICAgLy8gQ3JlYXRlczpcclxuICAgICAgICAvLyAgICAgIEFuIGluc3RhbmNlIG9mIHRoZSByZXNlcnZhdGlvbiBmb3JtIHdoaWNoIGNhbiB1c2VkIHRvIGJvb2sgYSByZXNlcnZhdGlvbi5cclxuICAgICAgICAvLyAgICAgIFRoZXJlIGFyZSB0aHJlZSB2YXJpYXRpb25zIG9mIHRoaXMgZm9ybSBjb250cm9sbGVkIGJ5IHRoZSB2YXJpYWJsZSAncmVzZXJ2YXRpb25UeXBlJ1xyXG4gICAgICAgIC8vICAgICAgMS4gcmVzZXJ2YXRpb25UeXBlID0gJ3Bhc3QnXHJcbiAgICAgICAgLy8gICAgICAgICBUaGlzIGlzIHRoZSBmb3JtIHdoaWNoIGNhbiBiZSB1c2VkIHdoZW4gdGhlIG9wZXJhdG9yIHdhbnRzIHRvIHJlY29uY2lsZSBwcmV2aW91cyByZXNlcnZhdGlvbnNcclxuICAgICAgICAvLyAgICAgIDIuIHJlc2VydmF0aW9uVHlwZSA9ICdjdXJyZW50J1xyXG4gICAgICAgIC8vICAgICAgICAgVGhpcyBpcyB0aGUgZm9ybSB3aGljaCBjYW4gYmUgdXNlZCBmb3IgYm9va2luZyBhIGN1cnJlbnQgcmVzZXJ2YXRpb25cclxuICAgICAgICAvLyAgICAgIDMuIHJlc2VydmF0aW9uVHlwZSA9ICdmdXR1cmUnXHJcbiAgICAgICAgLy8gICAgICAgICBUaGlzIGlzIHRoZSBmb3JtIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGJvb2sgZnV0dXJlIHJlc2VydmF0aW9uc1xyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7IHBhc3NlbmdlcjogJzwnLCBvcHRpb25zOiAnPCcsIG1vZGU6ICdAJywgbm90aWZ5U3VjZXNzZnVsbFJlc2VydmF0aW9uOiAnPW9uUmVzZXJ2YXRpb25TdWNjZXNzJyB9LFxyXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcGFzc2VuZ2VyUmVzZXJ2YXRpb25Gb3JtLmh0bWwnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAvLyBJZiBzY29wZS4kd2F0Y2goJ29wdGlvbicpIGxvYWRzIGxhdGUsIElFIGluIGEgc2xvdyBjb25uZWN0aW9uLCB0aGVuIHRoZSB3YXRjaCBORVZFUiBmaXJlcy5cclxuICAgICAgICAgICAgLy8gVGhpcyBpcyBoZXJlIHRvIHJ1biBzY29wZS5hY3RpdmF0ZSgpIGlmIG9uIGxvYWQsIHNjb3BlLm9wdGlvbnMgZXhpc3RzLlxyXG4gICAgICAgICAgICBpZiAoc2NvcGUuaXNMb2FkaW5nICYmIHNjb3BlLm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnb3B0aW9ucycsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgc2NvcGUub3B0aW9ucyA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vZWxzZSBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0aW9ucyA9IG5ld1ZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5hY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgLy9zY29wZS4kd2F0Y2goJ3Bhc3NlbmdlcicsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gICAgaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlICYmIG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL2lmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgLy8gICAgc2NvcGUucGFzc2VuZ2VyID0gSlNPTi5wYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL31cclxuICAgICAgICAgICAgLy8gICAgICAgIC8vZWxzZSBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzY29wZS5wYXNzZW5nZXIgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgLy8gICAgICAgIC8vfVxyXG4gICAgICAgICAgICAvLyAgICAgICAgLy9pZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUpXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgc2NvcGUucmVzZXRGb3JtKCk7XHJcbiAgICAgICAgICAgIC8vICAgIH07XHJcbiAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRzY29wZSwkdWliTW9kYWwpIHtcclxuICAgICAgICAgICAgLypNZXRob2RzIGV4cG9zZWQgdG8gdmlldyovXHJcbiAgICAgICAgXHQkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0ID0ge307XHJcbiAgICAgICAgXHQkc2NvcGUuYWlkcyA9IFtdO1xyXG4gICAgICAgIFx0JHNjb3BlLmFzc2lzdGFudHMgPSBbXTtcclxuICAgICAgICBcdCRzY29wZS5wb3B1bGF0ZVJ1bnMgPSBwb3B1bGF0ZVJ1bnM7XHJcbiAgICAgICAgXHQkc2NvcGUucG9wdWxhdGVDb3VudCA9IHBvcHVsYXRlQ291bnQ7XHJcbiAgICAgICAgXHQkc2NvcGUuY2hpbGRyZW5Db3VudCA9IGNoaWxkcmVuQ291bnQ7XHJcbiAgICAgICAgICAgICRzY29wZS5wb3B1bGF0ZUhvdXJzID0gcG9wdWxhdGVIb3VycztcclxuICAgICAgICAgICAgJHNjb3BlLnBvcHVsYXRlTWludXRlcyA9IHBvcHVsYXRlTWludXRlcztcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGFTZXJ2aWNlRnJvbSA9IExvY2F0aW9uRmFjdG9yeS5kYXRhU2VydmljZUZyb207XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhU2VydmljZVRvID0gTG9jYXRpb25GYWN0b3J5LmRhdGFTZXJ2aWNlVG87XHJcbiAgICAgICAgICAgICRzY29wZS5zYXZlUmVzZXJ2YXRpb24gPSBzYXZlUmVzZXJ2YXRpb247XHJcbiAgICAgICAgICAgICRzY29wZS5kaXNhYmxlU2F2ZUJ1dHRvbiA9IGRpc2FibGVTYXZlQnV0dG9uO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2V0UGlja3VwRGF0ZVRpbWUgPSBzZXRQaWNrdXBEYXRlVGltZTtcclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2YXRlID0gYWN0aXZhdGU7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNldEZvcm0gPSByZXNldEZvcm07XHJcbiAgICAgICAgICAgICRzY29wZS5jbG9zZURhdGVUaW1lUGlja2VyID0gY2xvc2VEYXRlVGltZVBpY2tlcjtcclxuICAgICAgICAgICAgJHNjb3BlLnRpbWVwaWNrZXJDbGlja2VkID0gdGltZXBpY2tlckNsaWNrZWQ7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNldERhdGVPcHRpb25GaWVsZHMgPSByZXNldERhdGVPcHRpb25GaWVsZHM7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNldERhdGVzID0gcmVzZXREYXRlcztcclxuICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlGYXJpbmcgPSBkaXNwbGF5RmFyaW5nO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGlzYWJsZUZhcmluZ0J1dHRvbiA9IGRpc2FibGVGYXJpbmdCdXR0b247XHJcbiAgICAgICAgICAgICRzY29wZS5nZXRSZXNlcnZhdGlvbkRhdGVUaW1lID0gZ2V0UmVzZXJ2YXRpb25EYXRlVGltZTtcclxuICAgICAgICAgICAgJHNjb3BlLnRvZ2dsZU9wdGlvbnMgPSB0b2dnbGVPcHRpb25zO1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLmlzSGlkZGVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93Q2FsZW5kYXJCdXR0b24gPSB0cnVlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0NhbGVuZGFyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8qTWV0aG9kcyBleHBvc2VkIHRvIHZpZXcqL1xyXG4gICAgICAgICAgICAkc2NvcGUucnVucyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZ1J1bnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5kaXZpc2lvbjtcclxuICAgICAgICAgICAgJHNjb3BlLm9wZXJhdG9yO1xyXG4gICAgICAgICAgICAkc2NvcGUuc3lzdGVtUGFyYW1ldGVycztcclxuICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUubWluRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgIC8vICRzY29wZS5vcHRpb25zID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVxdWVzdERhdGVUaW1lID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNEYXRlU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmlzR3BzRW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICRzY29wZS5oYXNHcHNCZWVuQ2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0ZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBmb3JtYXRZZWFyOiAneXknLFxyXG4gICAgICAgICAgICAgICAgbWluRGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgIHN0YXJ0aW5nRGF5OiAxLFxyXG4gICAgICAgICAgICAgICAgc2hvd1dlZWtzOiBmYWxzZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUudGltZXBpY2tlck9iamVjdCA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUuaXNGUlNlcnZpY2VBY3RpdmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5pc1VzZXJBbGxvd2VkVG9NYWtlQVJlc2VydmF0aW9uID0gaXNVc2VyQWxsb3dlZFRvTWFrZUFSZXNlcnZhdGlvbjtcclxuXHJcbiAgICAgICAgICAgIGluaXRpYWxpemVMb2NhdGlvbk5vdGVzKCk7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaXNBbGxvd2VkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIC8vZW51bSB0byBtYXRjaCBlbnVtIGluIFNlcnZlciBzaWRlIGNvZGVcclxuICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uVHlwZUVudW0gPSB7XHJcbiAgICAgICAgICAgICAgICBBU0FQOiAxLFxyXG4gICAgICAgICAgICAgICAgQURWQU5DRUQ6IDIsXHJcbiAgICAgICAgICAgICAgICBBUFBPSU5UTUVOVDogM1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25UeXBlRW51bSA9IHJlc2VydmF0aW9uVHlwZUVudW07XHJcblxyXG4gICAgICAgICAgICB2YXIgdGltZUZvcm1hdCA9ICdoOm1tIEEnO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZU9wdGlvbnMoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNIaWRkZW4gPSAhJHNjb3BlLmlzSGlkZGVuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZUNvdW50KGNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEFycmF5KGNvdW50KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2hpbGRyZW5Db3VudChjb3VudCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IGNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbkFycmF5LnB1c2goaSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGRyZW5BcnJheTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzQ2FsZW5kZXJCdXR0b25BY3RpdmUoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuZGlzcGxheURhdGVUaW1lcGlja2VyICYmICEkc2NvcGUuaXNEYXRlU2VsZWN0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9GaW5kIG91dCBpZiBGUiBpcyBhY3RpdmUgZm9yIHRoaXMgZGl2aXNpb24uIFRoaXMgd2lsbCBiZSB1c2VkIGxhdGVyIG9uIHdoaWxlIHJlc2VydmluZ1xyXG4gICAgICAgICAgICAgICAgLy8gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSW5mbygpXHJcbiAgICAgICAgICAgICAgICAvLyAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICB2YXIgZGl2aXNpb25JbmZvID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkaXZpc2lvbkluZm8uU2VydmljZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgaWYgKGRpdmlzaW9uSW5mby5TZXJ2aWNlc1tpXS5TZXJ2aWNlSWQgPT0gXCJmaXhlZFwiKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAkc2NvcGUuaXNGUlNlcnZpY2VBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNGUlNlcnZpY2VBY3RpdmUgPSFhbmd1bGFyLmlzVW5kZWZpbmVkKE9uZU12U2VydmljZXMuZ2V0Rml4ZWRSb3V0ZUluZm8oKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgZ2V0U2VydmljZURhdGUoKS8vcHJvbWlzZSBjaGFpbmluZy5cclxuICAgICAgICAgICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZVJ1bnMpO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5pc1N0YXJ0RHAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBkdCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZU9wdGlvbnMubWluRGF0ZSA9IG5ldyBEYXRlKGR0LnNldERhdGUoZHQuZ2V0RGF0ZSgpICsgJHNjb3BlLm9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01pbkRheXMpKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlT3B0aW9ucy5tYXhEYXRlID0gbmV3IERhdGUoZHQuc2V0RGF0ZShkdC5nZXREYXRlKCkgKyAkc2NvcGUub3B0aW9ucy5wYXNzZW5nZXJCb29raW5nTWF4RGF5cykpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGVWaWV3ID0gJHNjb3BlLmRhdGVPcHRpb25zLm1pbkRhdGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0NhbGVuZGFyID0gISRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93Q2FsZW5kYXJCdXR0b24gPSBpc0NhbGVuZGVyQnV0dG9uQWN0aXZlKCk7XHJcbiAgICAgICAgICAgICAgICAvL3NldFJlc2VydmF0aW9uVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgcmVzZXRGb3JtKCk7XHJcblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAvLyBMaXN0ZW4gdG8gR2VvbG9jYXRpb25zZXJ2aWNlIHRvIGZpbmQgb3V0IGlmIEdQUyBpcyBlbmFibGVkLlxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCdHZW9Mb2NhdGlvblNlcnZpY2UuZ3BzSXNBdmFpbGFibGUnLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pc0dwc0VuYWJsZWQgPSBkYXRhLmdwc0lzRW5hYmxlZDtcclxuICAgICAgICAgICAgICAgIGlmICghZGF0YS5ncHNJc0VuYWJsZWQgJiYgJHNjb3BlLm9wdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAmJiAkc2NvcGUub3B0aW9ucy5hbGxvd1Jlc2VydmF0aW9uT25seVdoZW5HcHNJc09uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuaXNHcHNFbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCd0b2dnbGUtZnJvbS1hZGRyZXNzJywgISRzY29wZS5vcHRpb25zLmFsbG93UmVzZXJ2YXRpb25Pbmx5V2hlbkdwc0lzT24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHNob3cgdG9hc3QgbWVzc2FnZSBvbmNlLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdC1jb250YWluZXInKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKCdJbmZvcm1hdGlvbicsICdFbmFibGUgZ3BzIHRvIG1ha2UgYSByZXNlcnZhdGlvbi4nLCAxMDAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdhaXQgMiBzZWNvbmRzLCB0aGVuIGhpZGUgYW55IG1vZGFscyB0aGF0IG1heSBoYXZlIGJlZW4gZGlzcGxheWVkLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSUUuIHRoZSAnUGxlYXNlIGZpbmQgYW5kIHNlbGVjdCB5b3VyIGhvbWUgYWRkcmVzcydcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnW3VpYi1tb2RhbC13aW5kb3c9bW9kYWwtd2luZG93XScpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdtb2RhbC1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEaXNwbGF5IG1lc3NhZ2UgZm9yIDE1IHNlY29uZHMgdGhlbiByZWRpcmVjdCB0byBkYXNoYm9hcmQuICBDaGFuZ2VkIHRvIDEwIHNlY29uZHMgcGVyIEphc29uIHJlcXVlc3QuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNVc2VyQWxsb3dlZFRvTWFrZUFSZXNlcnZhdGlvbigpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnW3VpYi1tb2RhbC13aW5kb3c9bW9kYWwtd2luZG93XScpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnbW9kYWwtb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVwbGFjZSgnIy8nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCh0cnVlKTsgIC8vIEkgbXVzdCBkbyBhIGhhcmQgcmVmcmVzaCB0byB3aXBlIG91dCBhbnkgbW9kYWxzIGNvbnRyb2xsZXJzIHRoYXQgbWF5IG9yIG1heSBub3QgYmUgbG9hZGVkLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTUwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmhhc0dwc0JlZW5DaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy8gRnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIHRoZSBkaXZpc2lvbiBvbmx5IGFsbG93cyByZXNlcnZhdGlvbiB3aGVuIEdQUyBpcyBvblxyXG4gICAgICAgICAgICAvLyBBTkQgaWYgZ3BzIGlzIG9uLlxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBpc1VzZXJBbGxvd2VkVG9NYWtlQVJlc2VydmF0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBpZighJHNjb3BlLmhhc0dwc0JlZW5DaGVja2VkKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGFzR3BzQmVlbkNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIEdlb0xvY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFBvc2l0aW9uKClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciByID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucyAmJiAkc2NvcGUub3B0aW9ucy5hbGxvd1Jlc2VydmF0aW9uT25seVdoZW5HcHNJc09uICYmICRzY29wZS5oYXNHcHNCZWVuQ2hlY2tlZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgciA9ICRzY29wZS5vcHRpb25zLmFsbG93UmVzZXJ2YXRpb25Pbmx5V2hlbkdwc0lzT24gPyRzY29wZS5pc0dwc0VuYWJsZWQgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEN1cnJlbnRUaW1lKClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnREYXRlID0gbW9tZW50LnR6KERpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpKTsvL25ldyBEYXRlKG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgMTAgKiA2MCAqIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRIb3VyID0gcGFyc2VJbnQoY3VycmVudERhdGUuZm9ybWF0KCdISCcpKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50TWludXRlID0gcGFyc2VJbnQoY3VycmVudERhdGUuZm9ybWF0KCdtbScpKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGltZTEySHIgPSAoY3VycmVudEhvdXIgPiAxMiA/IChjdXJyZW50SG91ciAtIDEyKSA6IChjdXJyZW50SG91ciA9PSAwID8gMTIgOiBjdXJyZW50SG91cikpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUaW1lNW1JbnYgPSBjdXJyZW50TWludXRlID09IDAgPyAwIDogKGN1cnJlbnRNaW51dGUgPT0gNSA/IDUgOiAoTWF0aC5jZWlsKGN1cnJlbnRNaW51dGUvNSkqNSkpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3QuQU1QTVZpZXcgPSBjdXJyZW50RGF0ZS5mb3JtYXQoJ2EnKS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3Quc2NoZWRIclZpZXcgPSBjdXJyZW50VGltZTEySHIgPCAxMCA/IFwiMFwiICsgY3VycmVudFRpbWUxMkhyLnRvU3RyaW5nKCk6IGN1cnJlbnRUaW1lMTJIci50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3Quc2NoZWRNaW5WaWV3ID0gY3VycmVudE1pbnV0ZSA8IDUgPyBcIjBcIiArIGN1cnJlbnRUaW1lNW1JbnYudG9TdHJpbmcoKSA6IGN1cnJlbnRUaW1lNW1JbnYudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlVmlldyA9ICRzY29wZS5kYXRlT3B0aW9ucy5taW5EYXRlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkSHIgPSAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3Quc2NoZWRIclZpZXc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWRNaW4gPSAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3Quc2NoZWRNaW5WaWV3O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLkFNUE0gPSAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3QuQU1QTVZpZXc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlVmlldztcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9IFxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVzZXRGb3JtKCkge1xyXG4gICAgICAgICAgICAgICAgcmVzZXREYXRlT3B0aW9uRmllbGRzKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0Jyk7XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuY2xpY2tNb2JpbGl0eUFpZCA9IGZ1bmN0aW9uIChhaWQpIHtcclxuICAgICAgICAgICAgXHRpZiAoJHNjb3BlLmFpZHMgJiYgJHNjb3BlLmFpZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuYWlkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBcdFx0XHQkc2NvcGUuYWlkc1tpXS5Jc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIFx0XHR9XHJcbiAgICAgICAgICAgIFx0XHRpZiAoYWlkKSB7XHJcbiAgICAgICAgICAgIFx0XHRcdGFpZC5Jc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgXHRcdH1cclxuICAgICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlTW9iaWxpdHlBaWRzKCkge1xyXG4gICAgICAgICAgICBcdCQoXCIjcmRvTm9Nb2JpbGl0eUFpZHNcIikucHJvcChcImNoZWNrZWRcIiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIFx0UHJvZmlsZVNlcnZpY2UuR2V0RGVmYXVsdE1vYmlsaXR5QWlkcygkc2NvcGUub3B0aW9ucy5EaXZpc2lvbklkLCAkc2NvcGUucGFzc2VuZ2VyLklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRlZmF1bHRNb2JpbGl0eUFpZHMpIHtcclxuICAgICAgICAgICAgICAgIFx0Ly8gY2xlYXIgYWlkcyBsaXN0c1xyXG4gICAgICAgICAgICAgICAgXHQkc2NvcGUuYWlkcy5sZW5ndGggPSAwO1xyXG4gICAgICAgICAgICAgICAgXHQkc2NvcGUuYXNzaXN0YW50cy5sZW5ndGggPSAwO1xyXG5cclxuICAgICAgICAgICAgICAgIFx0Ly8gY3JlYXRlIG5vIGFpZHMgY2hvaWNlXHJcbiAgICAgICAgICAgICAgICBcdHZhciBub0FpZHMgPSB7XHJcbiAgICAgICAgICAgICAgICBcdFx0SXNTZWxlY3RlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIFx0XHRLZXlOYW1lOiBcIm5vIGFpZHNcIixcclxuXHRcdFx0XHRcdFx0R3JvdXA6IDIsXHJcbiAgICAgICAgICAgICAgICBcdFx0RGlzcGxheU5hbWU6IFwiTm8gTW9iaWxpdHkgQWlkIFJlcXVpcmVkXCJcclxuICAgICAgICAgICAgICAgIFx0fTtcclxuICAgICAgICAgICAgICAgIFx0JHNjb3BlLmFpZHMucHVzaChub0FpZHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIFx0Ly8gYXBwZW5kIGFsbCBhaWRzIGFsbG93ZWQgYnkgZGl2aXNpb25cclxuICAgICAgICAgICAgICAgIFx0dmFyIGFpZENvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgIFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZhdWx0TW9iaWxpdHlBaWRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHR2YXIgbW9iaWxpdHlBaWQgPSBkZWZhdWx0TW9iaWxpdHlBaWRzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0aWYgKG1vYmlsaXR5QWlkLkdyb3VwID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0bW9iaWxpdHlBaWQuc2VsZWN0ZWQgPSBtb2JpbGl0eUFpZC5Jc1NlbGVjdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHQkc2NvcGUuYXNzaXN0YW50cy5wdXNoKG1vYmlsaXR5QWlkKTtcclxuICAgICAgICAgICAgICAgICAgICBcdH0gZWxzZSBpZiAobW9iaWxpdHlBaWQuR3JvdXAgPT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRpZiAobW9iaWxpdHlBaWQuSXNTZWxlY3RlZCA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0aWYgKGFpZENvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0bW9iaWxpdHlBaWQuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRhaWRDb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdG1vYmlsaXR5QWlkLnNlbGVjdGVkID0gbW9iaWxpdHlBaWQuSXNTZWxlY3RlZDtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0aWYgKG1vYmlsaXR5QWlkLklzU2VsZWN0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdCAgICBub0FpZHMuSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHQkc2NvcGUuYWlkcy5wdXNoKG1vYmlsaXR5QWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgcmVzcG9uc2UuTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiByZXNldERhdGVPcHRpb25GaWVsZHMoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0ID0ge307XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5QYXNzZW5nZXJDb3VudCA9IFwiMVwiO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Db21wYW5pb25zQ291bnQgPSBcIjBcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QubW9iaWxpdHlBaWQgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuSXNXaGVlbENoYWlyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LklzUENBID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LklzU2VydmljZUFuaW1hbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5UcmlwRmFyZXMgPSBbXTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LklzQVNBUCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzZXRSZXNlcnZhdGlvblR5cGUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNldERhdGVzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW5pdGlhbGl6ZUxvY2F0aW9uTm90ZXMoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZUxvY2F0aW9uTm90ZXMoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wdGlvbnMgJiYgJHNjb3BlLm9wdGlvbnMuYWxsb3dMb2NhdGlvbk5vdGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZnJvbSc6ICcnLCAndG8nOiAnJ1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuc2hvd0xvY2F0aW9uTm90ZXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgJ2Zyb20nOiBmYWxzZSwgJ3RvJzogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAvL307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgXHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVzZXREYXRlcygpIHtcclxuICAgICAgICAgICAgICAgIHNldEN1cnJlbnRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wdGlvbnMuaXNBZHZhbmNlZFJlc2VydmF0aW9uICYmICgkc2NvcGUub3B0aW9ucy5wYXNzZW5nZXJCb29raW5nTWluRGF5cyA+IDApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFBpY2t1cERhdGVUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzRGF0ZVNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dDYWxlbmRhckJ1dHRvbiA9IGlzQ2FsZW5kZXJCdXR0b25BY3RpdmUoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0UmVzZXJ2YXRpb25UeXBlKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbiAmJiAoJHNjb3BlLm9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01pbkRheXMgPiAwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlID0gJHNjb3BlLnJlc2VydmF0aW9uVHlwZUVudW0uQURWQU5DRUQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wdGlvbnMuYWxsb3dBU0FQUmVzZXJ2YXRpb25zKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSA9ICRzY29wZS5yZXNlcnZhdGlvblR5cGVFbnVtLkFTQVA7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLm9wdGlvbnMuaXNBZHZhbmNlZFJlc2VydmF0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSA9ICRzY29wZS5yZXNlcnZhdGlvblR5cGVFbnVtLkFEVkFOQ0VEO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjbG9zZURhdGVUaW1lUGlja2VyKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbiAmJiAoJHNjb3BlLm9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01pbkRheXMgPiAwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0RGF0ZXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZ2V0IG9sZCBkYXRlcyB0aW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkSHJWaWV3ID0gJHNjb3BlLnNjaGVkSHI7XHJcbiAgICAgICAgICAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkTWluVmlldyA9ICRzY29wZS5zY2hlZE1pbjtcclxuICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3QuQU1QTVZpZXcgPSAkc2NvcGUuQU1QTTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlzcGxheURhdGVUaW1lcGlja2VyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGVWaWV3ID0gJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuaXNEYXRlU2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0UmVzZXJ2YXRpb25UeXBlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93Q2FsZW5kYXJCdXR0b24gPSBpc0NhbGVuZGVyQnV0dG9uQWN0aXZlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gdGltZXBpY2tlckNsaWNrZWQoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlciA9ICEkc2NvcGUuZGlzcGxheURhdGVUaW1lcGlja2VyO1xyXG4gICAgICAgICAgICAgICAgLy8kc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LklzQVNBUCA9ICEkc2NvcGUuZGlzcGxheURhdGVUaW1lcGlja2VyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSA9IFN0cmluZyhyZXNlcnZhdGlvblR5cGVFbnVtLkFEVkFOQ0VEKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYoJHNjb3BlLm9wdGlvbnMuYWxsb3dBcHBvaW50bWVudHMpXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgPSBTdHJpbmcocmVzZXJ2YXRpb25UeXBlRW51bS5BUFBPSU5UTUVOVCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNEYXRlU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93Q2FsZW5kYXJCdXR0b24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHNldEN1cnJlbnRUaW1lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmljZURhdGUoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU2NoZWR1bGVTZXJ2aWNlLmdldFNlcnZpY2VEYXRlQnlEaXZpc2lvbigkc2NvcGUub3B0aW9ucy5EaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlcnZpY2VEYXRlID0gbW9tZW50KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCRzY29wZS5zZXJ2aWNlRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vZGUgPT0gXCJyZWNvbmNpbGlhdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUgPSAkc2NvcGUuc2VydmljZURhdGUuc3VidHJhY3QoMSwgJ2RheXMnKS5mb3JtYXQoJ01NLURELVlZWVknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pbkRhdGUgPSBuZXcgRGF0ZSgxOTkwLCA1LCAyMik7IC8vbm9yIHN1cmUgd2h5IHRoaXMgaXMgaGFyZC1jb2RlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWF4RGF0ZUFsbG93ZWQgPSAkc2NvcGUuc2VydmljZURhdGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiRmFpbGVkIHRvIGdldCBzZXJ2aWNlIGRhdGUuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZUhvdXJzKCkgeyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiAgbmV3IEFycmF5ICgnMDEnLCAnMDInLCAnMDMnLCAnMDQnLCAnMDUnLCAnMDYnLCAnMDcnLCAnMDgnLCAnMDknLCAnMTAnLCAnMTEnLCAnMTInKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZU1pbnV0ZXMoKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWludXRlc0FycmF5ID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDYwOyBpKz01KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWludXRlc0FycmF5LnB1c2goaSA8IDEwID8gKCcwJyArIGkudG9TdHJpbmcoKSkgOiBpLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1pbnV0ZXNBcnJheTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFBpY2t1cERhdGVUaW1lKClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkSHIgPSAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3Quc2NoZWRIclZpZXc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWRNaW4gPSAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3Quc2NoZWRNaW5WaWV3O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLkFNUE0gPSAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3QuQU1QTVZpZXc7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlVmlldztcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNEYXRlU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCkgfHwgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCA9PT0gbnVsbCB8fCAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSA9PSByZXNlcnZhdGlvblR5cGVFbnVtLkFTQVApXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGhycyA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLkFNUE0gPT09IFwiUE1cIiAmJiBwYXJzZUludCgkc2NvcGUuc2NoZWRIcikgIT0gMTIpXHJcbiAgICAgICAgICAgICAgICAgICAgaHJzID0gcGFyc2VJbnQoJHNjb3BlLnNjaGVkSHIpICsgMTI7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICgkc2NvcGUuQU1QTSA9PT0gXCJBTVwiICYmIHBhcnNlSW50KCRzY29wZS5zY2hlZEhyKSA9PSAxMilcclxuICAgICAgICAgICAgICAgICAgICBocnMgPSAwO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGhycyA9IHBhcnNlSW50KCRzY29wZS5zY2hlZEhyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdERhdGVUaW1lID0gbmV3IERhdGUoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUpLnNldEhvdXJzKGhycywgcGFyc2VJbnQoJHNjb3BlLnNjaGVkTWluKSwgMCk7ICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGlzcGxheVNlbGVjdGVkRGF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGlzcGxheURhdGVUaW1lcGlja2VyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZVJ1bnMoKSB7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGF0ZU1vYmlsaXR5QWlkcygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wYXNzZW5nZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdSdW5zID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vIGxldCBydW5EYXRlID0gbW9tZW50KCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlKS5mb3JtYXQoJ01NLURELVlZWVknKTtcclxuICAgICAgICAgICAgICAgIC8vbGV0IGlzb0Zvcm1hdFJ1bkRhdGUgPSBtb21lbnQoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUsICdNTS1ERC1ZWVlZJykuZm9ybWF0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2RlID09IFwicmVjb25jaWxpYXRpb25cIilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0UGFzdFJ1bnMoJHNjb3BlLm9wdGlvbnMuRGl2aXNpb25JZCwgcnVuRGF0ZSlcclxuICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nUnVucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJ1bnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5ydW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucnVuc1tpXS5TdGFydFRpbWVEaXNwbGF5ID0gRGF0ZUZhY3RvcnkuZ2V0Q3VzdG9tVGltZSgkc2NvcGUucnVuc1tpXS5TdGFydFRpbWUsIHJ1bkRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJ1bnNbaV0uRW5kVGltZURpc3BsYXkgPSBEYXRlRmFjdG9yeS5nZXRDdXN0b21UaW1lKCRzY29wZS5ydW5zW2ldLkVuZFRpbWUsIHJ1bkRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCByZXNwb25zZS5kYXRhLlJldHVybk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nUnVucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgcmVzcG9uc2UuZGF0YS5SZXR1cm5NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRBY3RpdmVSdW5zKCRzY29wZS5vcHRpb25zLkRpdmlzaW9uSWQsIHJ1bkRhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZ1J1bnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ydW5zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucnVucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJ1bnNbaV0uU3RhcnRUaW1lRGlzcGxheSA9IERhdGVGYWN0b3J5LmdldEN1c3RvbVRpbWUoJHNjb3BlLnJ1bnNbaV0uU3RhcnRUaW1lLCBydW5EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ydW5zW2ldLkVuZFRpbWVEaXNwbGF5ID0gRGF0ZUZhY3RvcnkuZ2V0Q3VzdG9tVGltZSgkc2NvcGUucnVuc1tpXS5FbmRUaW1lLCBydW5EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uUnVucyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5ydW5zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxvZ2lzdGljU3RhdHVzICE9ICcxMDknICYmIHZhbHVlLlN0YXR1cyAhPSAnRnJvemVuJyAmJiAhdmFsdWUuSXNEZWxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25SdW5zLnB1c2godmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLnJ1bnMuc3BsaWNlKCRzY29wZS5ydW5zLmluZGV4T2YodmFsdWUpKzEsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJ1bnMgPSByZXNlcnZhdGlvblJ1bnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIHJlc3BvbnNlLmRhdGEuUmV0dXJuTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdSdW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCByZXNwb25zZS5kYXRhLlJldHVybk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uU3VjZXNzZnVsbFJlc2VydmF0aW9uKHRyaXAsIGlzQVNBUCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoJHNjb3BlLm5vdGlmeVN1Y2Vzc2Z1bGxSZXNlcnZhdGlvbikgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5ub3RpZnlTdWNlc3NmdWxsUmVzZXJ2YXRpb24odHJpcCwgaXNBU0FQKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzYXZlUmVzZXJ2YXRpb24ocmVzZXJ2YXRpb25SZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgLy8gRG91YmxlIGNoZWNrIHRvIHNlZSBpZiBHUFMgaXMgcmVxdWlyZWQgYW5kIGlmIEdQUyBpcyBlbmFibGVkLlxyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5vcHRpb25zLmFsbG93UmVzZXJ2YXRpb25Pbmx5V2hlbkdwc0lzT24gJiYgaXNVc2VyQWxsb3dlZFRvTWFrZUFSZXNlcnZhdGlvbigpKXtcclxuICAgICAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldEN1cnJlbnRQb3NpdGlvbigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVXNlckFsbG93ZWRUb01ha2VBUmVzZXJ2YXRpb24oKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgPT0gcmVzZXJ2YXRpb25UeXBlRW51bS5BRFZBTkNFRCB8fCByZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlID09IHJlc2VydmF0aW9uVHlwZUVudW0uQVBQT0lOVE1FTlQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5pc0RhdGVTZWxlY3RlZClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVwaWNrZXJDbGlja2VkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL3Jlc2VydmF0aW9uVHlwZSAxLCAyLCAzXHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5pc0RhdGVTZWxlY3RlZClcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvblJlcXVlc3QuSXNBU0FQID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBocnMgPSBnZXRIb3VycygpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtaW5zID0gJHNjb3BlLnNjaGVkTWluO1xyXG5cclxuICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvblRpbWUgPSBocnMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSA/IChcIjBcIiArIGhycy50b1N0cmluZygpICsgbWlucykgOiAoaHJzLnRvU3RyaW5nKCkgKyBtaW5zKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGVSZXF1ZXN0KHJlc2VydmF0aW9uUmVxdWVzdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL0NoZWNrIGZvciBGUiBleGNsdXNpb25cclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmlzRlJTZXJ2aWNlQWN0aXZlKS8vY2hlY2sgaWYgRlIgaXMgYWN0aXZlIGZvciB0aGlzIGRpdmlzaW9uXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hlY2tGaXhlZFJvdXRlcyA9ICRzY29wZS5vcHRpb25zLmNoZWNrRlJCZWZvcmVEUlQ7IC8vc3lzdGVtIHBhcmFtZXRlciB3aGljaCB0ZWxscyB3aGV0aGVyIHRvIGNoZWNrIGZvciBmaXhlZCByb3V0ZSBiZWZvcmUgYm9va2luZyBhIGRydFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbm9PZkFycml2YWxzID0gJHNjb3BlLm9wdGlvbnMubm9PZkZSQXJyaXZhbHM7IC8vc3lzdGVtIHBhcmFtZXRlciB3aGljaCB0ZWxscyBob3cgbWFueSBmaXhlZCByb3RlIGFycml2YWxzIHRvIHNob3dcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrRml4ZWRSb3V0ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0b3BTZXJ2aWNlLmdldFVwY29taW5nQXJyaXZhbHNGb3JTdG9wKCRzY29wZS5vcHRpb25zLkRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbi5Mb2NhdGlvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uUmVxdWVzdC5Ub0xvY2F0aW9uLkxvY2F0aW9uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9PZkFycml2YWxzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVwY29taW5nU2NoZWR1bGVzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXBjb21pbmdTY2hlZHVsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Rml4ZWRSb3V0ZXModXBjb21pbmdTY2hlZHVsZXMsIHJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmVUcmlwKHJlc2VydmF0aW9uUmVxdWVzdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlVHJpcChyZXNlcnZhdGlvblJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlVHJpcChyZXNlcnZhdGlvblJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRIb3VycygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBocnMgPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5BTVBNID09PSBcIlBNXCIgJiYgcGFyc2VJbnQoJHNjb3BlLnNjaGVkSHIpICE9IDEyKVxyXG4gICAgICAgICAgICAgICAgICAgIGhycyA9IHBhcnNlSW50KCRzY29wZS5zY2hlZEhyKSArIDEyO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLkFNUE0gPT09IFwiQU1cIiAmJiBwYXJzZUludCgkc2NvcGUuc2NoZWRIcikgPT0gMTIpXHJcbiAgICAgICAgICAgICAgICAgICAgaHJzID0gMDtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBocnMgPSBwYXJzZUludCgkc2NvcGUuc2NoZWRIcik7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGhycztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFJlc2VydmF0aW9uRGF0ZVRpbWUocmVzZXJ2YXRpb25SZXF1ZXN0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaHJzID0gZ2V0SG91cnMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUuc2V0SG91cnMoaHJzLCBwYXJzZUludCgkc2NvcGUuc2NoZWRNaW4pLCAwKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJfZGF0ZSA9IGQuZ2V0RGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJfbW9udGggPSBkLmdldE1vbnRoKCkgKzE7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3Vycl95ZWFyID0gZC5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGlucHV0RGF0ZSA9IGN1cnJfeWVhciArIFwiL1wiICtjdXJyX21vbnRoICsgXCIvXCIgKyBjdXJyX2RhdGUgKyBcIiBcIiAraHJzLnRvU3RyaW5nKCkgKyBcIjpcIiArJHNjb3BlLnNjaGVkTWluO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQudHooaW5wdXREYXRlLCBcIllZWVkvTS9EIEhIOm1tXCIsIERpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiByZXNlcnZlVHJpcChyZXNlcnZhdGlvblJlcXVlc3QpIHtcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIkNyZWF0aW5nIFRyaXBcIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2F2ZVRyaXBSZXEgPSB7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdmFyIHNhdmVkVHJpcCA9IHtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5QYXNzZW5nZXJJRCA9IHBhcnNlSW50KCRzY29wZS5wYXNzZW5nZXIuSWQpO1xyXG4gICAgICAgICAgICAgICAgLy9oZXJlIGZpZ3VyZSBvdXQgZnJvbSByZXNlcnZhdGlvblR5cGUgd2hhdCBBU0FQLCBBZHZhbmNlZCwgQXBwb2ludG1lbnRcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzZXJ2YXRpb25SZXF1ZXN0ICYmIChyZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlICE9IHJlc2VydmF0aW9uVHlwZUVudW0uQVNBUCkgJiYgcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uVGltZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXF1ZXN0IGFkdmFuY2VkIHJlc2VydmF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wYXNzZW5nZXIpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBocnMgPSBnZXRIb3VycygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZShyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlLnNldEhvdXJzKGhycywgcGFyc2VJbnQoJHNjb3BlLnNjaGVkTWluKSwgMCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJfZGF0ZSA9IGQuZ2V0RGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vycl9tb250aCA9IGQuZ2V0TW9udGgoKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyX3llYXIgPSBkLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dERhdGUgPSBjdXJyX3llYXIgKyBcIi9cIiArIGN1cnJfbW9udGggKyBcIi9cIiArIGN1cnJfZGF0ZSArIFwiIFwiICsgaHJzLnRvU3RyaW5nKCkgKyBcIjpcIiArICRzY29wZS5zY2hlZE1pbjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlJlcXVlc3RlZFN0YXJ0RGF0ZVRpbWUgPSBtb21lbnQudHooaW5wdXREYXRlLCBcIllZWVkvTS9EIEhIOm1tXCIgLERpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5SZXF1ZXN0ZWRTdGFydERhdGVUaW1lID0gRGF0ZUZhY3RvcnkuZ2V0RGF0ZUZyb21DdXN0b21UaW1lKHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvblRpbWUsIG1vbWVudChyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlKSk7Ly9ub24gYXNhcCBmaWVsZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuT3BlcmF0aW9uSUQgPSAoJHNjb3BlLm9wdGlvbnMuT3BlcmF0b3JJZCAhPSBudWxsKSA/ICRzY29wZS5vcHRpb25zLk9wZXJhdG9ySWQgOiBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mUGFzc2VuZ2VycyA9IHJlc2VydmF0aW9uUmVxdWVzdC5QYXNzZW5nZXJDb3VudDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mV2hlZWxDaGFpclBhc3NlbmdlcnMgPSAwO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuTnVtT2ZYTFdoZWVsQ2hhaXJQYXNzZW5nZXJzID0gMDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mU2Nvb3RlclBhc3NlbmdlcnMgPSAwO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuTnVtT2ZXYWxrZXJQYXNzZW5nZXJzID0gMDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mUENBcyA9IDA7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5OdW1PZlNlcnZpY2VBbmltYWxzID0gMDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mQmlrZVBhc3NlbmdlcnMgPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmFsbG93RXF1aXBtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5haWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBcdGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmFpZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0dmFyIG1vYmlsaXR5QWlkID0gJHNjb3BlLmFpZHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdGlmIChtb2JpbGl0eUFpZC5Jc1NlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdCAgICBzYXZlVHJpcFJlcS5TZWxlY3RlZE1vYmlsaXR5QWlkSWQgPSBtb2JpbGl0eUFpZC5NVk1vYmlsaXR5QWlkc0lkO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdHZhciBrZXlOYW1lID0gbW9iaWxpdHlBaWQuS2V5TmFtZS50cmltKCkudG9Mb3dlckNhc2UoKVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdGlmIChrZXlOYW1lID09IFwid2NcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0c2F2ZVRyaXBSZXEuTnVtT2ZQYXNzZW5nZXJzID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlBhc3NlbmdlckNvdW50IC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHNhdmVUcmlwUmVxLk51bU9mV2hlZWxDaGFpclBhc3NlbmdlcnMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH0gZWxzZSBpZiAoa2V5TmFtZSA9PSBcIndjeGxcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0c2F2ZVRyaXBSZXEuTnVtT2ZQYXNzZW5nZXJzID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlBhc3NlbmdlckNvdW50IC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHNhdmVUcmlwUmVxLk51bU9mWExXaGVlbENoYWlyUGFzc2VuZ2VycyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0fSBlbHNlIGlmIChrZXlOYW1lID09IFwic2N0clwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRzYXZlVHJpcFJlcS5OdW1PZlBhc3NlbmdlcnMgPSByZXNlcnZhdGlvblJlcXVlc3QuUGFzc2VuZ2VyQ291bnQgLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0c2F2ZVRyaXBSZXEuTnVtT2ZTY29vdGVyUGFzc2VuZ2VycyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0fSBlbHNlIGlmIChrZXlOYW1lID09IFwid2tyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHNhdmVUcmlwUmVxLk51bU9mUGFzc2VuZ2VycyA9IHJlc2VydmF0aW9uUmVxdWVzdC5QYXNzZW5nZXJDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRzYXZlVHJpcFJlcS5OdW1PZldhbGtlclBhc3NlbmdlcnMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH0gZWxzZSBpZiAoa2V5TmFtZSA9PSAnYmlyaycpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHQgICAgc2F2ZVRyaXBSZXEuTnVtT2ZQYXNzZW5nZXJzID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlBhc3NlbmdlckNvdW50IC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHQgICAgc2F2ZVRyaXBSZXEuTnVtT2ZCaWtlUGFzc2VuZ2VycyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFzc2lzdGFudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0Zm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuYXNzaXN0YW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHR2YXIgYXNzaXN0YW50ID0gJHNjb3BlLmFzc2lzdGFudHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdGlmIChhc3Npc3RhbnQuSXNTZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdHZhciBrZXlOYW1lID0gYXNzaXN0YW50LktleU5hbWUudHJpbSgpLnRvTG93ZXJDYXNlKClcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRpZiAoa2V5TmFtZSA9PSBcInNhXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuTnVtT2ZTZXJ2aWNlQW5pbWFscyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0fSBlbHNlIGlmIChrZXlOYW1lID09IFwicGNhXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuTnVtT2ZQQ0FzID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuTnVtT2ZDb21wYW5pb25zID0gcmVzZXJ2YXRpb25SZXF1ZXN0LkNvbXBhbmlvbnNDb3VudDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlJ1bklkID0gcmVzZXJ2YXRpb25SZXF1ZXN0ICYmIHJlc2VydmF0aW9uUmVxdWVzdC5SdW4gJiYgcmVzZXJ2YXRpb25SZXF1ZXN0LlJ1bi5SdW5JZCA/IHJlc2VydmF0aW9uUmVxdWVzdC5SdW4uUnVuSWQgOiBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbCA9IHJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5FbmRBZGRyZXNzVmlld01vZGVsID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5SZXNlcnZhdGlvblR5cGUgPSByZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKHNhdmVUcmlwUmVxLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbCwge30pIHx8IHNhdmVUcmlwUmVxLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbCA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIFwiSW52YWxpZCBsb2NhdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHMoc2F2ZVRyaXBSZXEuRW5kQWRkcmVzc1ZpZXdNb2RlbCwge30pIHx8IHNhdmVUcmlwUmVxLkVuZEFkZHJlc3NWaWV3TW9kZWwgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBcIkludmFsaWQgbG9jYXRpb25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zICYmICRzY29wZS5vcHRpb25zLmFsbG93TG9jYXRpb25Ob3Rlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5Mb2NhdGlvbk5vdGUgPSByZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3Rlcy5mcm9tLnRyaW0oKTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5FbmRBZGRyZXNzVmlld01vZGVsLkxvY2F0aW9uTm90ZSA9IHJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzLnRvLnRyaW0oKTsgXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5UcmlwRmFyZXMgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlRyaXBGYXJlcyA9IHJlc2VydmF0aW9uUmVxdWVzdC5UcmlwRmFyZXM7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzZXJ2YXRpb25SZXF1ZXN0LlRvdGFsVHJpcEZhcmUgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlRvdGFsVHJpcEZhcmUgPSByZXNlcnZhdGlvblJlcXVlc3QuVG90YWxUcmlwRmFyZTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuSXNEaXZpc2lvbkFkdmFuY2VkID0gJHNjb3BlLm9wdGlvbnMuaXNBZHZhbmNlZFJlc2VydmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuU2VydmljZURhdGUgPSAkc2NvcGUuc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5Jc1dpbGxDYWxsID0gcmVzZXJ2YXRpb25SZXF1ZXN0LklzV2lsbENhbGw7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vZGUgPT0gXCJyZWNvbmNpbGlhdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9SZWNvbmNpbGlhdGlvbiBDYXNlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzYXZlVHJpcFJlcS5SdW5JZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUnVuSWQgPSAtMTsgLy9zZXR0aW5nIGl0IHRvIGFuIGludCB2YWx1ZSwgZWxzZSB0aGUgcmVxdWVzdCBvYmplY3QgaXMgZ29pbmcgYXMgbnVsbCB0byB0aGUgc2VydmVyXHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUnVuRGF0ZSA9IHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VEYXRlID0gbW9tZW50KHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLkFycml2ZVBpY2tVcERhdGVUaW1lVVRDID0gRGF0ZUZhY3RvcnkuZ2V0RGF0ZUZyb21DdXN0b21UaW1lKHJlc2VydmF0aW9uUmVxdWVzdC5BcnJpdmVQaWNrVXBUaW1lLCBzZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUGVyZm9ybVBpY2tVcERhdGVUaW1lVVRDID0gRGF0ZUZhY3RvcnkuZ2V0RGF0ZUZyb21DdXN0b21UaW1lKHJlc2VydmF0aW9uUmVxdWVzdC5QZXJmb3JtUGlja1VwVGltZSwgc2VydmljZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLkFycml2ZURyb3BPZmZEYXRlVGltZVVUQyA9IERhdGVGYWN0b3J5LmdldERhdGVGcm9tQ3VzdG9tVGltZShyZXNlcnZhdGlvblJlcXVlc3QuQXJyaXZlRHJvcE9mZlRpbWUsIHNlcnZpY2VEYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5QZXJmb3JtRHJvcE9mZkRhdGVUaW1lVVRDID0gRGF0ZUZhY3RvcnkuZ2V0RGF0ZUZyb21DdXN0b21UaW1lKHJlc2VydmF0aW9uUmVxdWVzdC5QZXJmb3JtRHJvcE9mZlRpbWUsIHNlcnZpY2VEYXRlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLnNhdmVQYXN0VHJpcChzYXZlVHJpcFJlcSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkVHJpcCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRGb3JtKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjZXNzZnVsbFJlc2VydmF0aW9uKHNhdmVkVHJpcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8ocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIGVycm9ybXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkc2NvcGUubW9kZSA9PSBcInJlc2VydmF0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgIFx0Ly8gcmVxdWVzdCBkZW1hbmQgcmVzZXJ2YXRpb25cclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2Uuc2NoZWR1bGVwb3N0KHNhdmVUcmlwUmVxKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWRUcmlwID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldEZvcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcyhyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNlc3NmdWxsUmVzZXJ2YXRpb24oc2F2ZWRUcmlwLCBwYXJzZUludChyZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlKSA9PSByZXNlcnZhdGlvblR5cGVFbnVtLkFTQVApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEuZXJyb3JzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6b25lRXhjbEluZGV4ID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9jRXhjbEluZGV4ID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FwYWNpdHlFcnJvciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5lZ290aWF0ZWRSZXNwb25zZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHJlc3BvbnNlLmRhdGEuZXJyb3JzLCBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVyckNvZGUgPSB2YWx1ZS5FcnJvckNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TaG93IHRoZSBvdmVyLXJpZGUgcG9wLXVwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVyckNvZGUgPT0gLTgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgem9uZUV4Y2xJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnJDb2RlID09IC03KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY0V4Y2xJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnJDb2RlID09IDkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwYWNpdHlFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVyckNvZGUgPT0gMTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVnb3RpYXRlZFJlc3BvbnNlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoem9uZUV4Y2xJbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1Jlc2VydmF0aW9uRXJyb3JNb2RhbChyZXNwb25zZS5kYXRhLmVycm9yc1t6b25lRXhjbEluZGV4XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJldFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9jRXhjbEluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93T3ZlcnJpZGVNb2RhbChyZXNwb25zZS5kYXRhLmVycm9yc1tsb2NFeGNsSW5kZXhdKS50aGVuKGZ1bmN0aW9uIChyZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobG9jRXhjbEluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93UmVzZXJ2YXRpb25FcnJvck1vZGFsKHJlc3BvbnNlLmRhdGEuZXJyb3JzW2xvY0V4Y2xJbmRleF0pLnRoZW4oZnVuY3Rpb24gKHJldFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChuZWdvdGlhdGVkUmVzcG9uc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFuYWdlTmVnb3RpYXRpb24ocmVzcG9uc2UsIHNhdmVUcmlwUmVxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNhcGFjaXR5RXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93UmVzZXJ2YXRpb25FcnJvck1vZGFsKHJlc3BvbnNlLmRhdGEuZXJyb3JzWzBdLCBcIkNhcGFjaXR5IFVuYXZhaWxhYmxlXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignQ3JlYXRpbmcgUmVzZXJ2YXRpb24nLCByZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignQ3JlYXRpbmcgUmVzZXJ2YXRpb24nLCByZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgZXJyb3Jtc2cuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc2FibGVTYXZlQnV0dG9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzU2F2aW5nO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gbWFuYWdlTmVnb3RpYXRpb24ocmVzcG9uc2UsIHRyaXBSZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICB0cmlwUmVxdWVzdC5OZWdvdGlhdGlvbkluZm8gPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5lZ290aWF0aW9uTW9kYWwocmVzcG9uc2UuZGF0YSwgdHJpcFJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG5lZ290aWF0ZWRSZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmVOZWdvdGlhdGVkVHJpcChuZWdvdGlhdGVkUmVxdWVzdCwgdHJpcFJlcXVlc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2VydmVOZWdvdGlhdGVkVHJpcChuZWdvdGlhdGVkUmVxdWVzdCwgdHJpcFJlcXVlc3QpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobmVnb3RpYXRlZFJlcXVlc3RcclxuICAgICAgICAgICAgICAgICAgICAmJiBuZWdvdGlhdGVkUmVxdWVzdC5OZWdvdGlhdGlvbkluZm9cclxuICAgICAgICAgICAgICAgICAgICAmJiBuZWdvdGlhdGVkUmVxdWVzdC5OZWdvdGlhdGlvbkluZm8uSXNOZWdvdGlhdGVkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRyaXBSZXF1ZXN0Lk5lZ290aWF0aW9uSW5mbyA9IG5lZ290aWF0ZWRSZXF1ZXN0Lk5lZ290aWF0aW9uSW5mbztcclxuICAgICAgICAgICAgICAgICAgICB0cmlwUmVxdWVzdC5SZXF1ZXN0ZWRTdGFydERhdGVUaW1lID0gbmVnb3RpYXRlZFJlcXVlc3QuTmVnb3RpYXRpb25JbmZvLlNlbGVjdGVkVGltZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVOZWdvdGlhdGVkVHJpcCh0cmlwUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNjaGVkdWxlTmVnb3RpYXRlZFRyaXAodHJpcFJlcXVlc3QpIHtcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5zY2hlZHVsZXBvc3QodHJpcFJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZWRUcmlwID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0Rm9ybSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgb25TdWNlc3NmdWxsUmVzZXJ2YXRpb24oc2F2ZWRUcmlwLCBwYXJzZUludCh0cmlwUmVxdWVzdC5SZXNlcnZhdGlvblR5cGUpID09IHJlc2VydmF0aW9uVHlwZUVudW0uQVNBUCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignQ3JlYXRpbmcgUmVzZXJ2YXRpb24nLCByZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgZXJyb3Jtc2cuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlOZWdvdGlhdGlvbk1vZGFsKG5lZ290aWF0aW9uUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG5lZ290aWF0aW9uTW9kYWwgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9uZWdvdGlhdGlvbi1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTmVnb3RpYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0aW9uUmVxdWVzdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wb3NlZFNsb3RzOiBuZWdvdGlhdGlvblJlc3BvbnNlLnJlc3VsdC5Qcm9wb3NlZFNsb3RzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uUmVxdWVzdDogJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwUmVxdWVzdElkOiBuZWdvdGlhdGlvblJlc3BvbnNlLnJlc3VsdC50cmlwUmVxdWVzdElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VEYXRlOiAkc2NvcGUuc2VydmljZURhdGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBuZWdvdGlhdGlvbk1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuY2FuTmVnb3RpYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTmVnb3RpYXRpb25JbmZvOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXNOZWdvdGlhdGVkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzcG9uc2Uuc2VsZWN0ZWRUaW1lICYmIHJlc3BvbnNlLmNhbk5lZ290aWF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5lZ290aWF0aW9uSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElzTmVnb3RpYXRlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZFRpbWU6IHJlc3BvbnNlLnNlbGVjdGVkVGltZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwUmVxdWVzdElkOiByZXNwb25zZS50cmlwUmVxdWVzdElkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5lZ290aWF0aW9uTG9nSWQ6IHJlc3BvbnNlLm5lZ290aWF0aW9uTG9nSWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc2FibGVGYXJpbmdCdXR0b24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5pc0FsbG93ZWQgfHwgJHNjb3BlLmlzU2F2aW5nKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uID09IG51bGwgfHwgYW5ndWxhci5lcXVhbHMoJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24sIHt9KVxyXG4gICAgICAgICAgICAgICAgICAgIHx8ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbiA9PSBudWxsIHx8IGFuZ3VsYXIuZXF1YWxzKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbiwge30pKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkaXNwbGF5RmFyaW5nKClcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtb2RhbE92ZXJyaWRlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvZmFyaW5nL2ZhcmluZy1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRmFyaW5nTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3dDbGFzczogJ3Bob25lLW1vZGFsLS1mdWxsc2NyZWVuJyxcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uUmVxdWVzdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZpY2VEYXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNlcnZpY2VEYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxPdmVycmlkZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dSZXNlcnZhdGlvbkVycm9yTW9kYWwobXNnLGhlYWRlcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kYWxPdmVycmlkZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3Jlc2VydmF0aW9uLW1vZGFsLW1lc3NhZ2UuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Jlc2VydmF0aW9uRXJyb3JNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHsgbWVzc2FnZTogbXNnLCBoZWFkZXI6aGVhZGVyIH07fVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIG1vZGFsT3ZlcnJpZGUucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3dGaXhlZFJvdXRlcyhfdXBjb21pbmdTY2hlZHVsZXMsIF9mcm9tU3RvcE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsRlIgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9maXhlZC1yb3V0ZXMuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0ZpeGVkUm91dGVzQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBjb21pbmdTY2hlZHVsZXM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF91cGNvbWluZ1NjaGVkdWxlcyB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcm9tU3RvcE5hbWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9mcm9tU3RvcE5hbWUgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIG1vZGFsRlIucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlUmVxdWVzdChyZXNlcnZhdGlvblJlcXVlc3QpIHtcclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLnBhc3NlbmdlciB8fCAhJHNjb3BlLnBhc3Nlbmdlci5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBzZWxlY3QgYSBQYXNzZW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wYXNzZW5nZXIuSXNEZWFjdGl2YXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBzZWxlY3QgYW4gQWN0aXZlIFBhc3NlbmdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm1vZGUgPT0gJ3Jlc2VydmF0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghcmVzZXJ2YXRpb25SZXF1ZXN0LklzQVNBUCAmJiAkc2NvcGUub3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24pIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uVGltZSB8fCByZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25UaW1lID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgUmVzZXJ2YXRpb24gVGltZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aW1lWm9uZSA9IERpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcV9kYXRlID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZS5nZXREYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVxX21vbnRoID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZS5nZXRNb250aCgpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXFfeWVhciA9IHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXFfaW5wdXQgPSByZXFfeWVhciArIFwiL1wiICsgcmVxX21vbnRoICsgXCIvXCIgKyByZXFfZGF0ZSArIFwiIFwiICsgcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uVGltZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0RGF0ZVRpbWUgPSBtb21lbnQudHoocmVxX2lucHV0LCBcIllZWVkvTS9EIEhIbW1cIiwgdGltZVpvbmUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciByZXF1ZXN0ZWREYXRlVGltZSA9IERhdGVGYWN0b3J5LmdldERhdGVGcm9tQ3VzdG9tVGltZShyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25UaW1lLCBtb21lbnQocmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudERhdGVUaW1lID0gbW9tZW50LnR6KHRpbWVab25lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnREYXRlVGltZSA9IGN1cnJlbnREYXRlVGltZS5jbG9uZSgpLnR6KFwiQW1lcmljYS9TZWF0dGxlXCIpOy8vRGl2aXNpb25TZXJ2aWNlLmdldFRpbWVab25lKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0RGF0ZVRpbWUuaXNCZWZvcmUoY3VycmVudERhdGVUaW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBlbnRlciBhIFJlc2VydmF0aW9uIFRpbWUgd2hpY2ggaXMgZ3JlYXRlciB0aGFuIHRoZSBjdXJyZW50IHRpbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgRnJvbSBMb2NhdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc2VydmF0aW9uUmVxdWVzdC5Ub0xvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgVG8gTG9jYXRpb25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24uR29vZ2xlUGxhY2VJZCAmJiByZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbi5Hb29nbGVQbGFjZUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24uR29vZ2xlUGxhY2VJZCA9PSByZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbi5Hb29nbGVQbGFjZUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIkZyb20gYW5kIFRvIGxvY2F0aW9ucyBzaG91bGQgbm90IGJlIHNhbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uLkxvY2F0aW9uSWQgJiYgcmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24uTG9jYXRpb25JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbi5Mb2NhdGlvbklkID09IHJlc2VydmF0aW9uUmVxdWVzdC5Ub0xvY2F0aW9uLkxvY2F0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIkZyb20gYW5kIFRvIGxvY2F0aW9ucyBzaG91bGQgbm90IGJlIHNhbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL1ZhbGlkYXRpb25zIGZvciByZWNvbmNpbGlhdGlvblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2RlID09IFwicmVjb25jaWxpYXRpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlID09IG51bGwgfHwgcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgUmVzZXJ2YXRpb24gRGF0ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc2VydmF0aW9uUmVxdWVzdC5BcnJpdmVQaWNrVXBUaW1lIHx8IHJlc2VydmF0aW9uUmVxdWVzdC5BcnJpdmVQaWNrVXBUaW1lID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBBcnJpdmUgUGlja1VwVGltZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc2VydmF0aW9uUmVxdWVzdC5QZXJmb3JtRHJvcE9mZlRpbWUgfHwgcmVzZXJ2YXRpb25SZXF1ZXN0LlBlcmZvcm1Ecm9wT2ZmVGltZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgUGVyZm9ybSBEcm9wT2ZmVGltZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXJ2YXRpb25SZXF1ZXN0LlJ1biA9PSBudWxsIHx8ICFyZXNlcnZhdGlvblJlcXVlc3QuUnVuLlJ1bklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBzZWxlY3QgYSBSdW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiB6b25lRm9yTG9jYXRpb24obG9jYXRpb24sIHR5cGUpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBGYXJpbmdTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgLkdldFpvbmVJREZvckxvY2F0aW9uKGxvY2F0aW9uLkxhdGl0dWRlLCBsb2NhdGlvbi5Mb25naXR1ZGUsICRzY29wZS5vcHRpb25zLkRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnZnJvbScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmZyb21ab25lID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQgPT0gbnVsbCA/IDA6IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnRvWm9uZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0ID09IG51bGwgPyAwIDogcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRMb2NhdGlvbkZyb20gPSBmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uID0gbG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNBbGxvd2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucy5hbGxvd1Jlc2VydmF0aW9uT25seVdoZW5HcHNJc09uKVxyXG4gICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWRMb2NhdGlvbkluQWxsb3dlZEJvb2tpbmdSYW5nZShsb2NhdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgem9uZUZvckxvY2F0aW9uKGxvY2F0aW9uLCAnZnJvbScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZExvY2F0aW9uVG8gPSBmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbiA9IGxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgem9uZUZvckxvY2F0aW9uKGxvY2F0aW9uLCAndG8nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCdjbG9zZXN0TG9jYXRpb24nLCBmdW5jdGlvbiAoZXZlbnQsIGxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbiA9IGxvY2F0aW9uLmxvYztcclxuICAgICAgICAgICAgICAgIHpvbmVGb3JMb2NhdGlvbihsb2NhdGlvbi5sb2MsICdmcm9tJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignaG9tZUxvY2F0aW9uJywgZnVuY3Rpb24gKGV2ZW50LCBsb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTG9jYXRpb25Ubyhsb2NhdGlvbik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaXNTZWxlY3RlZExvY2F0aW9uSW5BbGxvd2VkQm9va2luZ1JhbmdlKHNlbGVjdGVkTG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIEdlb0xvY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFBvc2l0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaGRpc3RhbmNlID0gZ2V0SGF2ZXJzaW5lRGlzdGFuY2VJbkZlZXQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGl0dWRlOiBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsIGxvbmdpdHVkZTogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGl0dWRlOiBzZWxlY3RlZExvY2F0aW9uLkxhdGl0dWRlLCBsb25naXR1ZGU6IHNlbGVjdGVkTG9jYXRpb24uTG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF4QWxsb3dlZERpc3RhbmNlID0gJHNjb3BlLm9wdGlvbnMubWF4UmFkaXVzVG9BbGxvd0Jvb2tpbmc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoZGlzdGFuY2UgPiBtYXhBbGxvd2VkRGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignQ2Fubm90IGJvb2sgdHJpcCEnLCAnVGhlIHBpY2t1cCBsb2NhdGlvbiBtdXN0IGJlIHdpdGhpbiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heEFsbG93ZWREaXN0YW5jZSArICcgZmVldCBvZiB5b3VyIGN1cnJlbnQgbG9jYXRpb24uJywgMTUwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNBbGxvd2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEhhdmVyc2luZURpc3RhbmNlSW5GZWV0KGN1cnJlbnRMb2NhdGlvbiwgc2VsZWN0ZWRMb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxhdDEgPSBjdXJyZW50TG9jYXRpb24ubGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9uMSA9IGN1cnJlbnRMb2NhdGlvbi5sb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGF0MiA9IHNlbGVjdGVkTG9jYXRpb24ubGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9uMiA9IHNlbGVjdGVkTG9jYXRpb24ubG9uZ2l0dWRlXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIFIgPSA2MzcxO1xyXG4gICAgICAgICAgICAgICAgdmFyIHgxID0gbGF0MiAtIGxhdDE7XHJcbiAgICAgICAgICAgICAgICB2YXIgZExhdCA9IHgxICogTWF0aC5QSSAvIDE4MDtcclxuICAgICAgICAgICAgICAgIHZhciB4MiA9IGxvbjIgLSBsb24xO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRMb24gPSB4MiAqIE1hdGguUEkgLyAxODA7XHJcbiAgICAgICAgICAgICAgICB2YXIgYSA9IE1hdGguc2luKGRMYXQgLyAyKSAqIE1hdGguc2luKGRMYXQgLyAyKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5jb3MobGF0MSAqIE1hdGguUEkgLyAxODApICogTWF0aC5jb3MobGF0MiAqIE1hdGguUEkgLyAxODApICpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbihkTG9uIC8gMikgKiBNYXRoLnNpbihkTG9uIC8gMik7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcCA9IDIgKiBNYXRoLmFzaW4oTWF0aC5zcXJ0KGEpKTtcclxuICAgICAgICAgICAgICAgIHZhciBkID0gUiAqIGMgKiAwLjYyMTM3ICogNTI4MDsgLy9jb252ZXJ0IHRvIGZlZXRcclxuICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIoZCkudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiXHJcbisoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgncmVzZXJ2YXRpb25NYXBEaXJlY3RpdmUnLCByZXNlcnZhdGlvbk1hcERpcmVjdGl2ZSk7XHJcblxyXG4gICAgcmVzZXJ2YXRpb25NYXBEaXJlY3RpdmUuJGluamVjdCA9IFsnJHdpbmRvdycsICckaHR0cCcsICckZmlsdGVyJywgJ0NvbmZpZ0ZhY3RvcnknLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ0RhdGVGYWN0b3J5JywgJ3VpR21hcElzUmVhZHknLCAnVXRpbGl0eUZhY3RvcnknLCAnJGludGVydmFsJ107XHJcblxyXG4gICAgZnVuY3Rpb24gcmVzZXJ2YXRpb25NYXBEaXJlY3RpdmUoJHdpbmRvdywgJGh0dHAsICRmaWx0ZXIsIENvbmZpZ0ZhY3RvcnksIFNjaGVkdWxlU2VydmljZSwgRGF0ZUZhY3RvcnksIHVpR21hcElzUmVhZHksIFV0aWxpdHlGYWN0b3J5LCAkaW50ZXJ2YWwpIHtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBsaW5rOiB7XHJcbiAgICAgICAgICAgICAgICBwcmU6IHByZUxpbmssXHJcbiAgICAgICAgICAgICAgICBwb3N0OiBwb3N0TGlua1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZTogeyBwYXNzZW5nZXI6ICdAJywgdHJpcFJlcXVlc3Q6ICdAJywgY3VycmVudFRyaXA6ICdAJywgZGlzcGF0Y2hTZWxlY3RlZFJ1bklkOiAnQCcsIGRpc3BhdGNoU2VsZWN0ZWRUcmlwOiAnQCd9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb25NYXAuaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5taW5sZW5ndGhsaW1pdCA9IDM7XHJcbiAgICAgICAgICAgICRzY29wZS5tYXAgPSB7XHJcbiAgICAgICAgICAgICAgICBjZW50ZXI6IHtcclxuICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogNDAuNjgwNjM4LFxyXG4gICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogLTk5LjIyODUxNlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHpvb206IDEwLFxyXG4gICAgICAgICAgICAgICAgbGluZVN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjMzMzJyxcclxuICAgICAgICAgICAgICAgICAgICB3ZWlnaHQ6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC43XHJcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUcmFmZmljID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFJ1bklkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93VHJhZmZpYyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLm1hcENvbnRyb2wgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB6b29tQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnREaXZpc2lvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICRzY29wZS5zdG9wTWFya2VyID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5hZGRyZXNzUmVzdCA9IG51bGw7XHJcbiAgICAgICAgICAgICRzY29wZS5zZXRNYXAgPSBzZXRNYXA7XHJcbiAgICAgICAgICAgICRzY29wZS5nZXRDdXJyZW50QWN0aXZlVHJpcCA9IGdldEN1cnJlbnRBY3RpdmVUcmlwO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2V0Q3VycmVudFRyaXBNYXAgPSBzZXRDdXJyZW50VHJpcE1hcDtcclxuICAgICAgICAgICAgJHNjb3BlLnNldFNlbGVjdGVkVHJpcE1hcCA9IHNldFNlbGVjdGVkVHJpcE1hcDtcclxuICAgICAgICAgICAgLy8kc2NvcGUuc2V0TmV3RGlzcGF0Y2hTZWxlY3RlZFJ1bklkID0gc2V0TmV3RGlzcGF0Y2hTZWxlY3RlZFJ1bklkO1xyXG4gICAgICAgICAgICAkc2NvcGUuY2xlYXJNYXJrZXJzID0gY2xlYXJNYXJrZXJzO1xyXG4gICAgICAgICAgICB2YXIgYXV0b1JlZnJlc2hNYXJrZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICRzY29wZS50cmlwaWQgPSBudWxsO1xyXG4gICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VySWQgPSBudWxsO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcFJ1bklkID0gbnVsbDtcclxuICAgICAgICAgICAgdmFyIGlzVHJpcEFjdGl2ZTtcclxuICAgICAgICAgICAgdmFyIGlzQ2FuY2VsYWJsZTtcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlciA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmN1cnJlbnRUcmlwID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5kaXNwYXRjaFNlbGVjdGVkUnVuSWQgPSBudWxsO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXAgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbFRyaXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmRpc2FibGVDYW5jZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLnZlaGljbGVzTWFya2VyRGV0YWlscyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRUcmlwbWFya2VyRGV0YWlscyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUuY2VudGVyTGF0TG9uZztcclxuICAgICAgICAgICAgLy8kc2NvcGUucGFzc2VuZ2VyRGV0YWlscyA9ICRzY29wZS5wYXNzZW5nZXI7XHJcbiAgICAgICAgICAgIC8vIGluc3RhbnRpYXRlIGdvb2dsZSBtYXAgb2JqZWN0cyBmb3IgZGlyZWN0aW9uc1xyXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9uc0Rpc3BsYXkgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKHsgc3VwcHJlc3NNYXJrZXJzOiB0cnVlLCBkcmFnZ2FibGU6IGZhbHNlIH0pO1xyXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9uc1NlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2UoKTtcclxuXHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0Q3VycmVudERpdmlzaW9uKCkudGhlbihmdW5jdGlvbiAoZGl2aXNpb25EYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RGl2aXNpb24gPSBkaXZpc2lvbkRhdGE7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIC8vRXJyb3IgaGFuZGxpbmcgVEJEXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0U2VsZWN0ZWRUcmlwTWFwKCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZigkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXBbaV0uVHlwZSA9PSAncGlja3VwJylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gPSAnLi4vLi4vaW1hZ2VzL3BpY2t1cC5wbmcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiA9ICcuLi8uLi9pbWFnZXMvZHJvcG9mZi5wbmcnO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRUcmlwbWFya2VyRGV0YWlscy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RyaXBJZCc6ICRzY29wZS5kaXNwYXRjaFNlbGVjdGVkVHJpcFtpXS5UcmlwSUQsICdzY2hlZHVsZVRpbWUnOiAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXBbaV0uU2NoZWRUaW1lVmlldyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwW2ldLkxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwW2ldLkxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2xvY2F0aW9uTmFtZSc6ICRzY29wZS5kaXNwYXRjaFNlbGVjdGVkVHJpcFtpXS5Mb2FjdGlvbk5hbWUsICdsb2NhdGlvbkFkZHJlc3MnOiAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXBbaV0uTG9hY3Rpb25BZGRyZXNzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnaWNvbic6IGljb25cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBpY29uID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgc2V0Qm91bmRzKCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvL21hcmtlciBjbGljayBmdW5jdGlvblxyXG4gICAgICAgICAgICAkc2NvcGUudHJpcE1hcmtlckV2ZW50ID0ge1xyXG4gICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uIChnTWFya2VyLCBldmVudE5hbWUsIG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGVsLiRpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcENvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dUcmlwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRDdXJyZW50VHJpcE1hcCgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tTGF0ID0gJHNjb3BlLmN1cnJlbnRUcmlwLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5MYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tTG9uZyA9ICRzY29wZS5jdXJyZW50VHJpcC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvTGF0ID0gJHNjb3BlLmN1cnJlbnRUcmlwLkVuZEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuVG9Mb25nID0gJHNjb3BlLmN1cnJlbnRUcmlwLkVuZEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LnRyaXBJZCA9ICRzY29wZS5jdXJyZW50VHJpcC5UcmlwSUQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudHJpcElkID0gJHNjb3BlLmN1cnJlbnRUcmlwLlRyaXBJRDtcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlVHJpcCgkc2NvcGUudHJpcFJlcXVlc3QpO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRBY3RpdmVUcmlwKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlcklkID0gJHNjb3BlLnBhc3Nlbmdlci5JZFxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wYXNzZW5nZXIuSWQgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIGVycm9ybXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRsYXN0cmlwZGV0YWlscygkc2NvcGUucGFzc2VuZ2VyLklkKVxyXG4gICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHggPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcFJ1bklkID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuUnVuSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tTGF0ID0gKHJlc3BvbnNlLmRhdGEucmVzdWx0LlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5MYXRpdHVkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tTG9uZyA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvTGF0ID0gKHJlc3BvbnNlLmRhdGEucmVzdWx0LkVuZEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuVG9Mb25nID0gKHJlc3BvbnNlLmRhdGEucmVzdWx0LkVuZEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LnRyaXBJZCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LlRyaXBJRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBJZCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LlRyaXBJRDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVUcmlwKCRzY29wZS50cmlwUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAvL1V0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBJZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkdWxlTWFya2VycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgZXJyb3Jtc2cuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldE1hcCgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXAgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhdGl0dWRlOiAkc2NvcGUuY2VudGVyTGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogJHNjb3BlLmNlbnRlckxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgem9vbTogMTUsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmlzRmxlZXRNYXApIHtcclxuICAgICAgICAgICAgICAgICAgICBhdXRvUmVmcmVzaE1hcmtlciA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEZsZWV0TWFya2VycygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDUwMDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVUcmlwKCRzY29wZS50cmlwUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2NoZWR1bGVUcmlwKHRyaXBSZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVNYXJrZXJzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0TWFwKCRzY29wZS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkdWxlTWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB0cmlwUmVxdWVzdC5Gcm9tTGF0LCAnbG9uZ2l0dWRlJzogdHJpcFJlcXVlc3QuRnJvbUxvbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiAnLi4vLi4vaW1hZ2VzL3BpY2t1cC5wbmcnLCAndHJpcElkJzogJHNjb3BlLnRyaXBSZXF1ZXN0LnRyaXBJZFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVNYXJrZXJzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHRyaXBSZXF1ZXN0LlRvTGF0LCAnbG9uZ2l0dWRlJzogdHJpcFJlcXVlc3QuVG9Mb25nLFxyXG4gICAgICAgICAgICAgICAgICAgICdpY29uJzogJy4uLy4uL2ltYWdlcy9kcm9wb2ZmLnBuZycsICd0cmlwSWQnOiAkc2NvcGUudHJpcFJlcXVlc3QudHJpcElkXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodHJpcFJlcXVlc3QuRnJvbUxhdCwgdHJpcFJlcXVlc3QuRnJvbUxvbmcpLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHRyaXBSZXF1ZXN0LlRvTGF0LCB0cmlwUmVxdWVzdC5Ub0xvbmcpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRyYXZlbE1vZGU6IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNUcmF2ZWxNb2RlLkRSSVZJTkdcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb25zU2VydmljZS5yb3V0ZShyZXF1ZXN0LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0RGlyZWN0aW9ucyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZGlyZWN0aW9uc0Rpc3BsYXkuc2V0UGFuZWwoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcmVjdGlvbnNMaXN0JykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5kaXJlY3Rpb25zLnNob3dMaXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0Qm91bmRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCdEaXJlY3Rpb25zIHJlcXVlc3QgZmFpbGVkIGR1ZSB0byAnICsgc3RhdHVzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIoJHNjb3BlLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEJvdW5kcygpIHtcclxuICAgICAgICAgICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5zZWxlY3RlZFRyaXBtYXJrZXJEZXRhaWxzLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdG9wLmxhdGl0dWRlLCBzdG9wLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xlYXJNYXJrZXJzKCkgeyAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnZlaGljbGVzTWFya2VyRGV0YWlscyA9IFtdO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0RmxlZXRNYXJrZXJzKCkge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJNYXJrZXJzKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGF0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHZhciBsb25nID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnRyaXBJZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldERyaXZlckdQUygkc2NvcGUudHJpcElkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcFJ1bklkID0gcmVzcG9uc2UuZGF0YS5SdW5JZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RyaXBBY3RpdmUgPSByZXNwb25zZS5kYXRhLklzVHJpcEFjdGl2ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNUcmlwQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXNzZW5nZXJJZCA9ICRzY29wZS5wYXNzZW5nZXJJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0bGFzdHJpcGRldGFpbHMoJHNjb3BlLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuU3RhcnRBZGRyZXNzVmlld01vZGVsLkFkZHJlc3MxICsgJywgJyArIHJlc3BvbnNlLmRhdGEucmVzdWx0LlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5DaXR5ICsgJywgJyArIHJlc3BvbnNlLmRhdGEucmVzdWx0LlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5aaXBDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5UbyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkVuZEFkZHJlc3NWaWV3TW9kZWwuQWRkcmVzczEgKyAnLCAnICsgcmVzcG9uc2UuZGF0YS5yZXN1bHQuRW5kQWRkcmVzc1ZpZXdNb2RlbC5DaXR5ICsgJywgJyArIHJlc3BvbnNlLmRhdGEucmVzdWx0LkVuZEFkZHJlc3NWaWV3TW9kZWwuWmlwQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbUxhdCA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tTG9uZyA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuVG9MYXQgPSAocmVzcG9uc2UuZGF0YS5yZXN1bHQuRW5kQWRkcmVzc1ZpZXdNb2RlbC5MYXRpdHVkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvTG9uZyA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5FbmRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVUcmlwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2FuY2VsVHJpcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwSWQgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5UcmlwSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlNodXR0bGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5WZWhpY2xlTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuUnVuTmFtZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LlJ1bk5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlN0YXJ0VGltZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkVzdGltYXRlZFBpY2t1cFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LkVuZFRpbWUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Fc3RpbWF0ZWREZXN0aW5hdGlvblRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRpc2FibGVDYW5jZWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZVRyaXAoJHNjb3BlLnRyaXBSZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwSWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Gcm9tID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuVG8gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5hY3RpdmVUcmlwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbmNlbFRyaXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZU1hcmtlcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zdG9wQXV0b1JlZnJlc2hNYXJrZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3dpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgZXJyb3Jtc2cuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDYW5jZWxhYmxlID0gcmVzcG9uc2UuZGF0YS5Jc0NhbmNlbGFibGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0NhbmNlbGFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlQ2FuY2VsID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5kaXNwYXRjaFNlbGVjdGVkUnVuSWQgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0QWN0aXZlUnVucyhjdXJyZW50RGl2aXNpb24uRGl2aXNpb25JRCwgbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLnJlc3VsdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBY3RpdmVSdW5zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRbaV1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5nZXRBY3RpdmVSdW5zLlJ1bklkID09ICRzY29wZS5kaXNwYXRjaFNlbGVjdGVkUnVuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMYXRpdHVkZSAhPSBudWxsICYgJHNjb3BlLmdldEFjdGl2ZVJ1bnMuTGF0ZXN0VmVoaWNsZUxvbmdpdHVkZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9ICcuLi8uLi9pbWFnZXMvVmVoaWNsZUN1cnJlbnRUcmlwLnBuZydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS52ZWhpY2xlc01hcmtlckRldGFpbHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZlaGljbGVOYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuVmVoaWNsZU5hbWUsICdkcml2ZXJOYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuRHJpdmVyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTGF0aXR1ZGUsICdsb25naXR1ZGUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdydW5OYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuTmFtZSwgJ3J1bklkJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuSWQsICdpY29uJzogaWNvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICRzY29wZS5yZXR1cm5Nc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJHNjb3BlLnJldHVybk1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0QWN0aXZlUnVucyhjdXJyZW50RGl2aXNpb24uRGl2aXNpb25JRCwgbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXNwb25zZS5kYXRhLnJlc3VsdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBY3RpdmVSdW5zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTGF0aXR1ZGUgIT0gbnVsbCAmICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMb25naXR1ZGUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWN0aXZlVHJpcFJ1bklkICE9IG51bGwgJiYgJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuSWQgPT0gJHNjb3BlLmFjdGl2ZVRyaXBSdW5JZCAmJiBpc1RyaXBBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gJy4uLy4uL2ltYWdlcy9WZWhpY2xlQ3VycmVudFRyaXAucG5nJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlaGljbGVzTWFya2VyRGV0YWlscy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmVoaWNsZU5hbWUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5WZWhpY2xlTmFtZSwgJ2RyaXZlck5hbWUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5Ecml2ZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMYXRpdHVkZSwgJ2xvbmdpdHVkZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3J1bk5hbWUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5SdW5OYW1lLCAncnVuSWQnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5SdW5JZCwgJ2ljb24nOiBpY29uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgkc2NvcGUuZ2V0QWN0aXZlUnVucy5Ecml2ZXJJZCAhPSBudWxsICYmICRzY29wZS5nZXRBY3RpdmVSdW5zLlZlaGljbGVJZCAhPSBudWxsKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5nZXRBY3RpdmVSdW5zLk51bU9mQWN0aXZlVHJpcHMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSAnLi4vLi4vaW1hZ2VzL1ZlaGljbGVBY3RpdmVUcmlwcy5wbmcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZlaGljbGVzTWFya2VyRGV0YWlscy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZlaGljbGVOYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuVmVoaWNsZU5hbWUsICdkcml2ZXJOYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuRHJpdmVyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuTGF0ZXN0VmVoaWNsZUxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuTGF0ZXN0VmVoaWNsZUxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3J1bk5hbWUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5SdW5OYW1lLCAncnVuSWQnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5SdW5JZCwgJ2ljb24nOiBpY29uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9ICcuLi8uLi9pbWFnZXMvVmVoaWNsZU5vVHJpcHMucG5nJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS52ZWhpY2xlc01hcmtlckRldGFpbHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2ZWhpY2xlTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlZlaGljbGVOYW1lLCAnZHJpdmVyTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkRyaXZlck5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMYXRpdHVkZSwgJ2xvbmdpdHVkZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdydW5OYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuTmFtZSwgJ3J1bklkJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuSWQsICdpY29uJzogaWNvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9EbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICRzY29wZS5yZXR1cm5Nc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJHNjb3BlLnJldHVybk1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vbWFya2VyIGNsaWNrIGZ1bmN0aW9uXHJcbiAgICAgICAgICAgICRzY29wZS5tYXJrZXJFdmVudCA9IHtcclxuICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoZ01hcmtlciwgZXZlbnROYW1lLCBtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbC4kaWQpIHsgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHN0b3BBdXRvUmVmcmVzaE1hcmtlcigpIHtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChhdXRvUmVmcmVzaE1hcmtlcikpIHtcclxuICAgICAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGF1dG9SZWZyZXNoTWFya2VyKTtcclxuICAgICAgICAgICAgICAgICAgICBhdXRvUmVmcmVzaE1hcmtlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBzdG9wQXV0b1JlZnJlc2hNYXJrZXIoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcHJlTGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFNlcnZpY2VBcmVhTG9jYXRpb24oKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2VudGVyTGF0aXR1ZGUgPSByZXNwb25zZS5kYXRhLkxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jZW50ZXJMb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLkxvbmdpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuYWRkcmVzc1Jlc3QgPSByZXNwb25zZS5kYXRhLkFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTG9jYXRpb25GYWN0b3J5LnNldGFkZCgkc2NvcGUuYWRkcmVzc1Jlc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3Njb3BlLm1hcENlbnRlci5sYXRpdHVkZSA9IGxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3Njb3BlLm1hcENlbnRlci5sb25naXR1ZGUgPSBsb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUudHJpcFJlcXVlc3QubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNjb3BlLnRyaXBSZXF1ZXN0ID09IFwic3RyaW5nXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudHJpcFJlcXVlc3QgPSBKU09OLnBhcnNlKHNjb3BlLnRyaXBSZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzRmxlZXRNYXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNGbGVldE1hcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2V0TWFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1V0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJHNjb3BlLnJldHVybk1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAkc2NvcGUucmV0dXJuTXNnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3N0TGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiY3VycmVudFRyaXBcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRUcmlwID0gSlNPTi5wYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRUcmlwID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNldEN1cnJlbnRUcmlwTWFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcInBhc3NlbmdlclwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG5ld1ZhbHVlICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcInN0cmluZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFzc2VuZ2VyID0gSlNPTi5wYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucGFzc2VuZ2VyID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmdldEN1cnJlbnRBY3RpdmVUcmlwKClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcImRpc3BhdGNoU2VsZWN0ZWRSdW5JZFwiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG5ld1ZhbHVlICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRSdW5JZCA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbGVhck1hcmtlcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWRUcmlwbWFya2VyRGV0YWlscyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kaXNwYXRjaFNlbGVjdGVkUnVuSWQgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5zZXROZXdEaXNwYXRjaFNlbGVjdGVkUnVuSWQoKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2NvcGUuJHdhdGNoKFwiZGlzcGF0Y2hTZWxlY3RlZFRyaXBcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kaXNwYXRjaFNlbGVjdGVkVHJpcCA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZFRyaXBtYXJrZXJEZXRhaWxzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkVHJpcG1hcmtlckRldGFpbHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXAgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2V0U2VsZWN0ZWRUcmlwTWFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Jlc2VydmF0aW9uc0NvbnRyb2xsZXInLFxyXG5cdFx0WyckbG9jYXRpb24nLCAnJHNjb3BlJywgJyRzdGF0ZScsICckdGltZW91dCcsICckd2luZG93JywgJyR1aWJNb2RhbCcsXHJcbiAgICAgICAgICdDb25maWdGYWN0b3J5JywgJ1NjaGVkdWxlU2VydmljZScsICd1aUdtYXBJc1JlYWR5JywgJ0RpdmlzaW9uU2VydmljZScsICdNZXNzYWdlQm94JyxcclxuICAgICAgICAgJ1V0aWxpdHlGYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJywgJ0dlb0xvY2F0aW9uU2VydmljZScsICdMb2NhdGlvbkZhY3RvcnknLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywgJ1Byb2ZpbGVTZXJ2aWNlJywgJ2dvb2dsZU1hcHNDb25maWcnLFxyXG4gICAgICAgICAnUGFnZVNlcnZpY2UnLFxyXG4gICAgICAgICAgcmVzZXJ2YXRpb25zQ29udHJvbGxlcl1cclxuICAgICAgICApO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJlc2VydmF0aW9uc0NvbnRyb2xsZXJcclxuXHRcdCgkbG9jYXRpb24sICRzY29wZSwgJHN0YXRlLCAkdGltZW91dCwgJHdpbmRvdywgJHVpYk1vZGFsLFxyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnksIFNjaGVkdWxlU2VydmljZSwgdWlHbWFwSXNSZWFkeSwgRGl2aXNpb25TZXJ2aWNlLCBNZXNzYWdlQm94LFxyXG5cdFx0VXRpbGl0eUZhY3RvcnksIGF1dGhTZXJ2aWNlLCBHZW9Mb2NhdGlvblNlcnZpY2UsIExvY2F0aW9uRmFjdG9yeSwgUmVkaXJlY3Rpb25TZXJ2aWNlLCBQcm9maWxlU2VydmljZSwgZ29vZ2xlTWFwc0NvbmZpZ1xyXG4gICAgICAgICxQYWdlU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdOZXcgUmVzZXJ2YXRpb24nKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZSgnT24gRGVtYW5kJyk7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25SZXF1ZXN0ID0ge307XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdm0ubWluRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdm0ubWF4RGF0ZUFsbG93ZWQgPSBuZXcgRGF0ZSgyMDE3LCAyLCAyOCk7XHJcblxyXG4gICAgICAgIHZtLmN1cnJlbnRQYXNzZW5nZXIgPSB7IFwiSWRcIjogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgfTtcclxuICAgICAgICB2YXIgb3BlcmF0b3JJZCA9IG51bGw7XHJcbiAgICAgICAgdm0udXNlclJlc2VydmF0aW9uT3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIHZtLmhhc0FjdGl2ZVRyaXAgPSBmYWxzZTtcclxuICAgICAgICB2bS5oYXNGdXR1cmVUcmlwcyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnBvc2l0aW9uID0gbnVsbDtcclxuICAgICAgICB2bS5yZXNlcnZhdGlvblR5cGUgPSAnY3VycmVudCc7XHJcbiAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSAnJztcclxuICAgICAgICB2bS5ob21lUGFzc2VuZ2VySWQgPSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgY2xvc2VzdFBpbiwgb3RoZXJQaW4sIGxvY2F0aW9uUGluLCBteUxvY2F0aW9uUGluLCBodWJJY29uO1xyXG4gICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnBuZyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24uc3ZnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBnZXRBY3RpdmVUcmlwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0bGFzdHJpcGRldGFpbHModm0uY3VycmVudFBhc3Nlbmdlci5JZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5oYXNBY3RpdmVUcmlwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UudHJpcHNGb3JTZXJ2aWNlRGF0ZSh2bS5jdXJyZW50UGFzc2VuZ2VyLklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdC5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5oYXNGdXR1cmVUcmlwcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5oYXNGdXR1cmVUcmlwcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBjdXJyZW50IHRpbWUgYW5kIHNlZSBpZiB0aGUgd2luZG93IGlzIGluIHRoZSBmdXR1cmUgXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaGFzQWN0aXZlVHJpcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmhhc0Z1dHVyZVRyaXBzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlRGl2aXNpb25QYXJhbWV0ZXJzKCkge1xyXG4gICAgICAgICAgICBnZXRBY3RpdmVUcmlwKCk7XHJcblxyXG4gICAgICAgICAgICB2bS51c2VyUmVzZXJ2YXRpb25PcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25JZDogZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgIE9wZXJhdG9ySWQ6IG9wZXJhdG9ySWRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXREaXZpc2lvblBhcmFtZXRlcnMoZGl2aXNpb25JZClcclxuICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gdm0udXNlclJlc2VydmF0aW9uT3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wYXNzZW5nZXJzTGltaXQgPSBwYXJhbXMuUGFzc2VuZ2Vyc0xpbWl0ID8gZXZhbChwYXJhbXMuUGFzc2VuZ2Vyc0xpbWl0KSA6IDU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd1dpbGxDYWxsID0gcGFyYW1zLkFsbG93V2lsbENhbGwgPyBldmFsKHBhcmFtcy5BbGxvd1dpbGxDYWxsLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd1Bhc3NlbmdlcldpbGxDYWxsID0gcGFyYW1zLkFsbG93UGFzc2VuZ2VyV2lsbENhbGwgPyBldmFsKHBhcmFtcy5BbGxvd1Bhc3NlbmdlcldpbGxDYWxsLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0VxdWlwbWVudCA9IHBhcmFtcy5BbGxvd0VxdWlwbWVudCA/IGV2YWwocGFyYW1zLkFsbG93RXF1aXBtZW50LnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24gPSBwYXJhbXMuQWxsb3dBZHZhbmNlZFJlc2VydmF0aW9uID8gZXZhbChwYXJhbXMuQWxsb3dBZHZhbmNlZFJlc2VydmF0aW9uLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd011bHRpcGxlU2VhdEJvb2tpbmcgPSBwYXJhbXMuQWxsb3dNdWx0aXBsZVNlYXRCb29raW5nID8gZXZhbChwYXJhbXMuQWxsb3dNdWx0aXBsZVNlYXRCb29raW5nLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc1doZWVsQ2hhaXIgPSBwYXJhbXMuSGFzV2hlZWxDaGFpciA/IGV2YWwocGFyYW1zLkhhc1doZWVsQ2hhaXIudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzQ29tcGFuaW9uID0gcGFyYW1zLkhhc0NvbXBhbmlvbnMgPyBldmFsKHBhcmFtcy5IYXNDb21wYW5pb25zLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcblx0XHRcdFx0XHRcdFx0IG9wdGlvbnMuY29tcGFuaW9uc0xpbWl0ID0gcGFyYW1zLkhhc0NvbXBhbmlvbnMgPT0gZmFsc2UgPyAwOiBwYXJhbXMuQ29tcGFuaW9uc0xpbWl0ID8gZXZhbChwYXJhbXMuQ29tcGFuaW9uc0xpbWl0KTogMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzUENBID0gcGFyYW1zLkhhc1BDQSA/IGV2YWwocGFyYW1zLkhhc1BDQS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNTZXJ2aWNlQW5pbWFsID0gcGFyYW1zLkhhc1NlcnZpY2VBbmltYWwgPyBldmFsKHBhcmFtcy5IYXNTZXJ2aWNlQW5pbWFsLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0N1c3RvbUxvY2F0aW9uID0gcGFyYW1zLkFsbG93Q3VzdG9tTG9jYXRpb24gPyBldmFsKHBhcmFtcy5BbGxvd0N1c3RvbUxvY2F0aW9uLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wcm9taXNlV2luZG93ID0gcGFyYW1zLlByb21pc2VXaW5kb3cgPyBldmFsKHBhcmFtcy5Qcm9taXNlV2luZG93KSA6IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucmVzZXJ2YXRpb25UeXBlID0gdm0ucmVzZXJ2YXRpb25UeXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dPbmx5U2FtZURheUFkdlJlcyA9IHBhcmFtcy5BbGxvd09ubHlTYW1lRGF5QWR2UmVzID8gZXZhbChwYXJhbXMuQWxsb3dPbmx5U2FtZURheUFkdlJlcy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZHJvcG9mZkhvbWVMb2NhdGlvbk9ubHkgPSBwYXJhbXMuRHJvcG9mZkhvbWVMb2NhdGlvbk9ubHkgPyBldmFsKHBhcmFtcy5Ecm9wb2ZmSG9tZUxvY2F0aW9uT25seS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaG9tZVBhc3NlbmdlcklkID0gb3B0aW9ucy5kcm9wb2ZmSG9tZUxvY2F0aW9uT25seSA/IHZtLmN1cnJlbnRQYXNzZW5nZXIuSWQgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuY2hlY2tGUkJlZm9yZURSVCA9IHBhcmFtcy5DaGVja0ZSQmVmb3JlRFJUID8gZXZhbChwYXJhbXMuQ2hlY2tGUkJlZm9yZURSVC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubm9PZkZSQXJyaXZhbHMgPSBwYXJhbXMuTm9PZkZSQXJyaXZhbHMgPyBldmFsKHBhcmFtcy5Ob09mRlJBcnJpdmFscykgOiAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dBU0FQUmVzZXJ2YXRpb25zID0gcGFyYW1zLkFsbG93QVNBUFJlc2VydmF0aW9ucyA/IGV2YWwocGFyYW1zLkFsbG93QVNBUFJlc2VydmF0aW9ucykgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93QXBwb2ludG1lbnRzID0gcGFyYW1zLkFsbG93QXBwb2ludG1lbnRzID8gZXZhbChwYXJhbXMuQWxsb3dBcHBvaW50bWVudHMpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0xvY2F0aW9uTm90ZXMgPSBwYXJhbXMuQWxsb3dMb2NhdGlvbk5vdGVzID8gZXZhbChwYXJhbXMuQWxsb3dMb2NhdGlvbk5vdGVzKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dSZXNlcnZhdGlvbk9ubHlXaGVuR3BzSXNPbiA9IHBhcmFtcy5BbGxvd0Jvb2tpbmdJZmZHcHNJc09uID8gZXZhbChwYXJhbXMuQWxsb3dCb29raW5nSWZmR3BzSXNPbikgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1heFJhZGl1c1RvQWxsb3dCb29raW5nID0gcGFyYW1zLk1heFJhZGl1c1RvQWxsb3dCb29raW5nID8gZXZhbChwYXJhbXMuTWF4UmFkaXVzVG9BbGxvd0Jvb2tpbmcpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0ZhcmluZyA9IHBhcmFtcy5BbGxvd0ZhcmluZyA/IGV2YWwocGFyYW1zLkFsbG93RmFyaW5nKSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNhbWVEYXlSZXNMb3dlckJvdW5kID0gcGFyYW1zLlNhbWVEYXlSZXNMb3dlckJvdW5kID8gcGFyYW1zLlNhbWVEYXlSZXNMb3dlckJvdW5kIDogXCIwMDowMFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2FtZURheVJlc1VwcGVyQm91bmQgPSBwYXJhbXMuU2FtZURheVJlc1VwcGVyQm91bmQgPyBwYXJhbXMuU2FtZURheVJlc1VwcGVyQm91bmQgOiBcIjI0OjAwXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5mdXR1cmVSZXNMb3dlckJvdW5kID0gcGFyYW1zLkZ1dHVyZVJlc0xvd2VyQm91bmQgPyBwYXJhbXMuRnV0dXJlUmVzTG93ZXJCb3VuZCA6IFwiMDA6MDBcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmZ1dHVyZVJlc1VwcGVyQm91bmQgPSBwYXJhbXMuRnV0dXJlUmVzVXBwZXJCb3VuZCA/IHBhcmFtcy5GdXR1cmVSZXNVcHBlckJvdW5kIDogXCIyNDowMFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dDaGlsZHJlbiA9IHBhcmFtcy5BbGxvd0NoaWxkcmVuID8gZXZhbChwYXJhbXMuQWxsb3dDaGlsZHJlbikgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNoaWxkcmVuTGltaXQgPSBwYXJhbXMuQ2hpbGRyZW5MaW1pdCA/IGV2YWwocGFyYW1zLkNoaWxkcmVuTGltaXQpIDogMztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzZXJ2YXRpb25Gb3JtT3B0aW9ucyA9IG9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgXHQgLy8gdXNlIFRPIGhvbWUgbG9jYXRpb24gaWYgcHJlc2VudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmRyb3BvZmZIb21lTG9jYXRpb25Pbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHQkdGltZW91dChnZXREZXN0aW5hdGlvbkhvbWVMb2NhdGlvbiwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2V4dHJhIG9wdGlvbnMgb25seSBuZWVkZWQgYnkgdXNlciByZXNlcnZhdGlvbnMgZGlyZWN0aXZlLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNQYXNzZW5nZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNSZWFkT25seSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hdXRvUmVmcmVzaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5iYXRjaERheXMgPSBwYXJhbXMuQmF0Y2hEYXlzID8gZXZhbChwYXJhbXMuQmF0Y2hEYXlzKSA6IDc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5taW5Gcm9tRGF5cyA9IHBhcmFtcy5NaW5Gcm9tRGF5cyA/IGV2YWwocGFyYW1zLk1pbkZyb21EYXlzKSA6IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01pbkRheXMgPSBwYXJhbXMuUGFzc2VuZ2VyQm9va2luZ01pbkRheXMgPyBldmFsKHBhcmFtcy5QYXNzZW5nZXJCb29raW5nTWluRGF5cykgOiAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01heERheXMgPSBwYXJhbXMuUGFzc2VuZ2VyQm9va2luZ01heERheXMgPyBldmFsKHBhcmFtcy5QYXNzZW5nZXJCb29raW5nTWF4RGF5cykgOiAxNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXNlcnZhdGlvbkZvcm1PcHRpb25zID0gb3B0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIHJlc3BvbnNlLmRhdGEuUmV0dXJuTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZ2V0TWFwKCk7XHJcblx0XHR9XHJcblxyXG4gICAgICAgIHZtLm9uUmVzZXJ2YXRpb25TdWNjZXNzID0gZnVuY3Rpb24gKHRyaXAsIGlzQVNBUCkge1xyXG4gICAgICAgICAgICB2bS5hZGRlZFRyaXAgPSB0cmlwOyAvL2hlcmUgd2UgY2FuIGRpc3BsYXkgYSB0cmlwIG9uIG91ciBleGlzdGluZyBtYXBcclxuICAgICAgICAgICAgaWYgKGlzQVNBUClcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdvbi1kZW1hbmQvYWN0aXZlLXRyaXAnKTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2NoZWR1bGVUcmlwRGlzcGxheSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL2Rpc3BsYXlUcmlwLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEaXNwbGF5U2NoZWR1bGVkVHJpcENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpcDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyaXA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm0ucmVzZXJ2YXRpb25Gb3JtT3B0aW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2NoZWR1bGVUcmlwRGlzcGxheS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9sb2FkTWFzdGVyUnVucygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAvL29wZW4gbW9kYWxcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zaG93TWFwID1mYWxzZTtcclxuICAgICAgIHZtLnpvb20gPSAxNTtcclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgbGF0aXR1ZGU6IDM5LjgwOTg2MCxcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtOTguNTU1MTgzXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICB2bS5teVN0eWxlcyA9IGdvb2dsZU1hcHNDb25maWcubWFwU3R5bGVzO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogdm0ubXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teUxvY2F0aW9uSWNvbiA9IHtcclxuICAgICAgICAgICAgdXJsOiBteUxvY2F0aW9uUGluLFxyXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjAsIDIwKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT09IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnpvb20gPSByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dNYXAgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIEdlb0xvY2F0aW9uU2VydmljZS5nZXRDdXJyZW50UG9zaXRpb24oKS50aGVuKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBvc2l0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvb3Jkc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkxhdGl0dWRlXCI6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiTG9uZ2l0dWRlXCI6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpY29uXCI6IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9oZXJlIGdldCBjbG9zZXN0IGxvY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgTG9jYXRpb25GYWN0b3J5LmdldExvY2F0aW9ucygnJywgJ2ZhbHNlJywgZGl2aXNpb25JZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHR2YXIgZmlsdGVyZWRSZXN1bHRzID0gYW5ndWxhci5jb3B5KHJlc3VsdC5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBcdHZhciBmaWx0ZXJlZFJlc3VsdCA9IExvY2F0aW9uRmFjdG9yeS5maW5kQ2xvc2VzdExvY2F0aW9uKHZtLnBvc2l0aW9uLmNvb3JkcywgZmlsdGVyZWRSZXN1bHRzKTtcclxuICAgICAgICAgICAgICAgICAgICBcdC8vc2hvdyBzZWxlY3RlZCBsb2NhdGlvbiBpZmYgdGhlIGN1cnJlbnQgZ3BzIGlzIHdpdGhpbiAzMDAgZnQgb2YgYSBidWlsZGluZ1xyXG4gICAgICAgICAgICAgICAgICAgIFx0Ly8xIG1pbGUgfj0gNTI4MCBmdFxyXG4gICAgICAgICAgICAgICAgICAgIFx0aWYgKGZpbHRlcmVkUmVzdWx0ICYmIHBhcnNlRmxvYXQoZmlsdGVyZWRSZXN1bHQuZGlzdGFuY2UpICogNTI4MCA8PSAzMDApXHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdCRzY29wZS4kYnJvYWRjYXN0KCdjbG9zZXN0TG9jYXRpb24nLCBmaWx0ZXJlZFJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFx0Ly8gZ2V0IGRlc3RpbmF0aW9uIEhvbWUgbG9jYXRpb25cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wb3NpdGlvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHRcdFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERlc3RpbmF0aW9uSG9tZUxvY2F0aW9uKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICBcdFByb2ZpbGVTZXJ2aWNlLkdldEhvbWVBZGRyZXNzKHZtLmN1cnJlbnRQYXNzZW5nZXIuSWQpXHJcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKGhvbWVBZGRyZXNzKSB7XHJcblx0XHRcdFx0XHQkc2NvcGUuJGJyb2FkY2FzdCgnaG9tZUxvY2F0aW9uRGlzYWJsZScsIHRydWUpO1xyXG5cdFx0XHRcdFx0aWYgKGhvbWVBZGRyZXNzKSB7XHJcblx0XHRcdFx0XHQgICAgLy8gc2V0IFRPIGFkZHJlc3MgdG8gdGhlIGhvbWUgYWRkcmVzc1xyXG5cdFx0XHRcdFx0XHR2bS5yZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbiA9IGhvbWVBZGRyZXNzO1xyXG5cdFx0XHRcdFx0XHR2YXIgdG9BZGRyZXNzRGlzcGxheSA9IChob21lQWRkcmVzcy5OYW1lIHx8ICcnKSArIFwiIFwiICsgKGhvbWVBZGRyZXNzLkFkZHJlc3MgfHwgJycpICsgXCIgXCIgKyAoaG9tZUFkZHJlc3MuQ2l0eSB8fCAnJykgKyBcIiBcIiArIChob21lQWRkcmVzcy5aaXAgfHwgJycpO1xyXG5cdFx0XHRcdFx0ICAgIC8vXHJcblx0XHRcdFx0XHQgICAgLy8gT24gc2xvdyBjZWxsIGNvbm5lY3Rpb25zLCB0aGlzIGdldHMgYnJvYWRjYXN0IGJlZm9yZSByZXNlcnZhdGlvbkZvcm1EaXJlY3RpdmUuanMgZ2V0cyBsb2FkZWQuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNvIHRoZSBob21lIGFkZHJlc3MgaXMgTkVWRVIgRElTUExBWUVEISEhICBZb3UgY2FuIHRlc3QgdGhpcyBieSB0aHJvdHRsaW5nIGNvbm5lY3Rpb24gYXQgMjAwMCBrYnMuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gJGJyb2FkY2FzdCBhZnRlciB3YWl0aW5nIDQgc2Vjb25kcy5cclxuXHRcdFx0XHRcdCAgICAvL1xyXG5cdFx0XHRcdFx0XHQkc2NvcGUuJGJyb2FkY2FzdCgnaG9tZUxvY2F0aW9uJywgaG9tZUFkZHJlc3MpO1xyXG5cdFx0XHRcdFx0XHQkc2NvcGUuJGJyb2FkY2FzdCgnaG9tZUxvY2F0aW9uVGV4dCcsIHRvQWRkcmVzc0Rpc3BsYXkpO1xyXG5cdFx0XHRcdFx0XHQkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdCAgICAkc2NvcGUuJGJyb2FkY2FzdCgnaG9tZUxvY2F0aW9uJywgaG9tZUFkZHJlc3MpO1xyXG5cdFx0XHRcdFx0XHQgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2hvbWVMb2NhdGlvblRleHQnLCB0b0FkZHJlc3NEaXNwbGF5KTtcclxuXHRcdFx0XHRcdFx0ICAgICRzY29wZS4kYnJvYWRjYXN0KCdob21lTG9jYXRpb25EaXNhYmxlJywgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdH0sIDQwMDApXHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQvLyBhc2sgcGFzc2VuZ2VyIHRvIGNyZWF0ZSBhIGhvbWUgYWRkcmVzc1xyXG5cdFx0XHRcdFx0XHR2YXIgZGl2aXNpb25QYXJhbWV0ZXJzID0gRGl2aXNpb25TZXJ2aWNlLmdldFN5c3RlbVBhcmFtZXRlcnMoKTtcclxuXHRcdFx0XHRcdFx0aWYgKCEgZGl2aXNpb25QYXJhbWV0ZXJzLkRyb3BvZmZIb21lTG9jYXRpb25FZGl0KSB7XHJcblx0XHRcdFx0XHRcdFx0Ly8gZ2V0IGhlbHAgcGhvbmUgbnVtYmVyXHJcblx0XHRcdFx0XHRcdFx0dmFyIGhlbHBQaG9uZSA9IERpdmlzaW9uU2VydmljZS5nZXRTdXBwb3J0UGhvbmVOdW1iZXIoKTtcclxuXHRcdFx0XHRcdFx0XHR2YXIgbWVzc2FnZSA9IFwiUGxlYXNlIGNhbGwgSGVscCBkZXNrIGF0IFwiICsgaGVscFBob25lICsgXCIgYW5kIGFzayB0aGVtIHRvIGNyZWF0ZSBhIEhvbWUgQWRkcmVzcyBmb3IgeW91LlwiO1xyXG5cdFx0XHRcdFx0XHRcdE1lc3NhZ2VCb3guaW5mbygnSG9tZSBBZGRyZXNzIGlzIFJlcXVpcmVkJywgbWVzc2FnZSkudGhlbihmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHQkd2luZG93Lmhpc3RvcnkuYmFjaygpO1xyXG5cdFx0XHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdC8vIHBhc3NlbmdlciBoYXMgbm90IHNldCBoaXMgaG9tZSBsb2NhdGlvbiwgYW5kIG1heSBlZGl0IGl0LCBzbyBzaG93IGhvbWUgYWRkcmVzcyBlZGl0b3IgYXMgYSBtb2RhbFxyXG5cdFx0XHRcdFx0XHRcdCR1aWJNb2RhbC5vcGVuKHtcclxuXHRcdFx0XHRcdFx0XHRcdGFuaW1hdGlvbjogdHJ1ZSxcclxuXHRcdFx0XHRcdFx0XHRcdGJhY2tkcm9wOiBmYWxzZSxcclxuXHRcdFx0XHRcdFx0XHRcdHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3Byb2ZpbGUvaG9tZS1hZGRyZXNzLW1vZGFsLmh0bWwnLFxyXG5cdFx0XHRcdFx0XHRcdFx0Y29udHJvbGxlcjogZnVuY3Rpb24gKCkgeyB9LFxyXG5cdFx0XHRcdFx0XHRcdFx0c2l6ZTogJydcclxuXHRcdFx0XHRcdFx0XHR9KS5jbG9zZWQudGhlbihmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdFx0XHQvLyBob21lIGFkZHJlc3Mgd2FzIGNoYW5nZWQgLSByZWxvYWQgdGhlIHBhZ2VcclxuXHRcdFx0XHRcdFx0XHRcdCRzdGF0ZS5yZWxvYWQoKTtcclxuXHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gKGVycikge1xyXG5cdFx0XHRcdCAgICBjb25zb2xlLmxvZygnRXJyb3IgZ2V0dGluZyBob21lIGxvY2F0aW9uJyk7XHJcblx0XHRcdFx0ICAgIGNvbnNvbGUubG9nKGVycik7XHJcblx0XHRcdFx0fSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZShjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAoIWF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgUmVkaXJlY3Rpb25TZXJ2aWNlLnNhdmUoJy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zJyk7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnbG9naW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpdmlzaW9uSWQgIT0gbnVsbCAmJiBkaXZpc2lvbklkICE9IHVuZGVmaW5lZCAmJiBkaXZpc2lvbklkICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKHBvcHVsYXRlRGl2aXNpb25QYXJhbWV0ZXJzKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9yZXNlcnZhdGlvbnMuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgICB2bS5kaXNhYmxlU2Nyb2xsID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgIH07XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAvL2RlYnVnZ2VyO1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdTY2hlZHVsZVNlcnZpY2UnLCBTY2hlZHVsZVNlcnZpY2UpO1xyXG4gICAgU2NoZWR1bGVTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ0NvbmZpZ0ZhY3RvcnknLCAnYXV0aFNlcnZpY2UnLCAnZW52JywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnJHJvb3RTY29wZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNjaGVkdWxlU2VydmljZSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnksIGF1dGhTZXJ2aWNlLCBlbnYsIGxvY2FsU3RvcmFnZVNlcnZpY2UsICRyb290U2NvcGUpIHtcclxuICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgIGdldEN1cnJlbnRVc2VyOiBnZXRDdXJyZW50VXNlcixcclxuICAgICAgICBnZXRQYXNzZGF0YWxsOiBnZXRQYXNzZGF0YWxsLFxyXG4gICAgICAgIGdldHBhc3NlbmdlcjogZ2V0cGFzc2VuZ2VyLFxyXG4gICAgICAgIHNjaGVkdWxlcG9zdDogc2NoZWR1bGVwb3N0LFxyXG4gICAgICAgIGNhbmNlbHBvc3Q6IGNhbmNlbHBvc3QsXHJcbiAgICAgICAgZ2V0bGFzdHJpcGRldGFpbHM6IGdldGxhc3RyaXBkZXRhaWxzLFxyXG4gICAgICAgIHVwZGF0ZUVtYWlsUGhvbmVhbmRBZGRyZXNzOiB1cGRhdGVFbWFpbFBob25lYW5kQWRkcmVzcyxcclxuICAgICAgICBnZXRBY3RpdmVSdW5zOiBnZXRBY3RpdmVSdW5zLFxyXG4gICAgICAgIGdldFNlcnZpY2VBcmVhTG9jYXRpb246IGdldFNlcnZpY2VBcmVhTG9jYXRpb24sXHJcbiAgICAgICAgZ2V0RHJpdmVyR1BTOiBnZXREcml2ZXJHUFMsXHJcbiAgICAgICAgZ2V0U2VhcmNoUGFzc2FuZ2VyOiBnZXRTZWFyY2hQYXNzYW5nZXIsXHJcbiAgICAgICAgZ2V0UGFzdFJ1bnM6IGdldFBhc3RSdW5zLFxyXG4gICAgICAgIHNhdmVQYXN0VHJpcDogc2F2ZVBhc3RUcmlwLFxyXG4gICAgICAgIGdldFBhc3NlbmdlclRyaXBzOiBnZXRQYXNzZW5nZXJUcmlwcyxcclxuICAgICAgICBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb246IGdldFNlcnZpY2VEYXRlQnlEaXZpc2lvbixcclxuICAgICAgICBnZXRTdGF0ZXM6IGdldFN0YXRlcyxcclxuICAgICAgICBzZWFyY2hQYXNzZW5nZXI6IHNlYXJjaFBhc3NlbmdlcixcclxuICAgICAgICB0cmlwc0ZvclNlcnZpY2VEYXRlOiB0cmlwc0ZvclNlcnZpY2VEYXRlLFxyXG4gICAgICAgIGdldFRyaXBDYW5jZWxTdGF0dXNMaXN0OiBnZXRUcmlwQ2FuY2VsU3RhdHVzTGlzdFxyXG4gICAgfTtcclxuICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgdmFyIHZhbHVlO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiB0cmlwc0ZvclNlcnZpY2VEYXRlKHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgdmFyIHVybCA9IGVudi5vbmVNVkFwaVVybCAgKyAncGFzc2VuZ2VyLycgKyBwYXNzZW5nZXJJZCArICcvdHJpcHNGb3JTZXJ2aWNlRGF0ZSc7XHJcblxyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgdXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBzZWFyY2hQYXNzZW5nZXIoZGl2aXNpb25JbmZvLCBwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IG9uZU1WVVJMICsgXCJwYXNzZW5nZXIvc2VhcmNoL1wiICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHVybCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRTdGF0ZXMoKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgIHVybDogJy4uL1Bhc3Nlbmdlci9nZXRTdGF0ZXM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcigpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICcuLi9PcGVyYXRpb24vR2V0Q3VycmVudFVzZXInO1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldFBhc3NkYXRhbGwoKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnLi4vUGFzc2VuZ2VyL2dldHBhc3NEYXRhYXV0bz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldHBhc3NlbmdlcihwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJy4uL1Bhc3Nlbmdlci9HZXRQYXNzRGV0YWlsQnlQYXNzSWQ/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHsgUGFzc2VuZ2VySWQ6IHBhc3NlbmdlcklkIH0sXHJcbiAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcclxuICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuICAgIGZ1bmN0aW9uIGdldFBhc3NlbmdlclRyaXBzKGRpdmlzaW9uSWQsIHBhc3NlbmdlcklkLCBmcm9tRGF0ZSwgdG9EYXRlKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IG9uZU1WVVJMICsgJ3Bhc3Nlbmdlci8nICsgcGFzc2VuZ2VySWQgKycvdHJpcHMvJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbURhdGUgKyAnLycgKyB0b0RhdGUgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICAvL2RhdGE6IEpTT04uc3RyaW5naWZ5KHBhc3NlbmdlclRyaXBQYXJhbSksXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gc2NoZWR1bGVwb3N0KHNjaGVkdWxlVHJpcFJlcXBhcmFtKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IG9uZU1WVVJMICsgJ3Bhc3Nlbmdlci8nICsgc2NoZWR1bGVUcmlwUmVxcGFyYW0uUGFzc2VuZ2VySUQgKyAnL3RyaXAvc2NoZWR1bGUnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHNjaGVkdWxlVHJpcFJlcXBhcmFtKSxcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL2NhbGwgYXBpIHRvIGNhbmNlbCB0cmlwXHJcbiAgICBmdW5jdGlvbiBjYW5jZWxwb3N0KGNhbmNlbHJlcSkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdwYXNzZW5nZXIvJyArIGNhbmNlbHJlcS5QYXNzZW5nZXJJRCArICcvdHJpcC9jYW5jZWwnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGNhbmNlbHJlcSksXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgLy9jYWxsIGFwaSB0byBnZXQgdGhlIGxhc3QgYWN0aXZlIHRyaXAgZGV0YWlsc1xyXG4gICAgZnVuY3Rpb24gZ2V0bGFzdHJpcGRldGFpbHMocGFzc2VuZ2VySUQpIHtcclxuICAgIFx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgXHRcdENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgIFx0XHRcdGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICBcdFx0XHRcdC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgIFx0XHRcdFx0dmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdwYXNzZW5nZXIvJyArIHBhcnNlSW50KHBhc3NlbmdlcklEKSArICcvYWN0aXZlVHJpcD9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgXHRcdFx0XHQkaHR0cCh7XHJcbiAgICBcdFx0XHRcdFx0bWV0aG9kOiAnR0VUJyxcclxuICAgIFx0XHRcdFx0XHQndXJsJzogc2VydmljZVVybCxcclxuICAgIFx0XHRcdFx0XHRkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICBcdFx0XHRcdFx0Q29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICBcdFx0XHRcdH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICBcdFx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KFwiaGFzQWN0aXZlVHJpcENoYW5nZWRcIiwgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSk7XHJcbiAgICBcdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICBcdFx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgIFx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgXHRcdFx0XHR9KTtcclxuICAgIFx0XHRcdH1cclxuICAgIFx0XHRcdGVsc2Uge1xyXG4gICAgXHRcdFx0XHQkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgIFx0XHRcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICBcdFx0XHR9XHJcbiAgICBcdFx0fSk7XHJcbiAgICBcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUVtYWlsUGhvbmVhbmRBZGRyZXNzKG5ld3Bhc3Nlbmdlcikge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJy9QYXNzZW5nZXIvVXBkYXRlRW1haWxQaG9uZWFuZEFkZHJlc3MnO1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShuZXdwYXNzZW5nZXIpLFxyXG4gICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIixcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldFNlcnZpY2VBcmVhTG9jYXRpb24oZGl2aXNpb25JZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyBcImRpdmlzaW9uL1wiICsgZGl2aXNpb25JZCArIFwiL3NlcnZpY2VBcmVhP3JuZD1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCIsXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXREcml2ZXJHUFModHJpcElkKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnLi4vUGFzc2VuZ2VyL0dldERyaXZlckdQUz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICAgICAgVHJpcElkOiB0cmlwSWRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCIsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL1NlYXJjaCBwYXNzYW5nZXIgIGJ5IGNsaWVudHBhc3NhbmdlcmlkXHJcbiAgICBmdW5jdGlvbiBnZXRTZWFyY2hQYXNzYW5nZXIoQ2xpZW50UGFzc2FuZ2VySUQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICcuLi9QYXNzZW5nZXIvR2V0U2VhcmNoUGFzc2FuZ2VyP0NsaWVudFBhc3NhbmdlcklEPScgKyBDbGllbnRQYXNzYW5nZXJJRDtcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIixcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vY2FsbCBhcGkgdG8gZ2V0IHRoZSBhY3RpdmUgcnVucyBmb3IgY3VycmVudCBzZXJ2aWNlIGRhdGVcclxuICAgIGZ1bmN0aW9uIGdldEFjdGl2ZVJ1bnMoZGl2aXNpb25JZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdEaXNwYXRjaC9HZXRSdW5zP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoeyBcIkRpdmlzaW9uSWRcIjogZGl2aXNpb25JZCwgXCJTZXJ2aWNlRGF0ZVwiOiBudWxsIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL2NhbGwgYXBpIHRvIGdldCB0aGUgcGFzdCBydW5zIGZvciB0aGUgc2VydmljZSBkYXRlXHJcbiAgICBmdW5jdGlvbiBnZXRQYXN0UnVucyhkaXZpc2lvbklkLCBzZXJ2aWNlRGF0ZSkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdEaXNwYXRjaC9HZXRQYXN0UnVucz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsgXCJEaXZpc2lvbklkXCI6IGRpdmlzaW9uSWQsIFwiU2VydmljZURhdGVcIjogc2VydmljZURhdGUgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vY2FsbCBhcGkgdG8gdGhlIHRyaXBzIGluIHRoZSBwYXN0XHJcbiAgICBmdW5jdGlvbiBzYXZlUGFzdFRyaXAoc2F2ZVRyaXBSZXFwYXJhbSkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdEaXNwYXRjaC9JbnNlcnRQYXN0VHJpcCc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoc2F2ZVRyaXBSZXFwYXJhbSksXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgLy9jYWxsIGFwaSB0byBnZXQgdGhlIHNlcnZpY2UgZGF0ZSBmb3IgdGhlIGRpdmlzaW9uXHJcbiAgICBmdW5jdGlvbiBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oZGl2aXNpb25JZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdkaXZpc2lvbi8nICsgZGl2aXNpb25JZCArICcvc2VydmljZURhdGU/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldFRyaXBDYW5jZWxTdGF0dXNMaXN0KClcclxuICAgIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAncGFzc2VuZ2VyL2dldENhbmNlbGxhdGlvblJlYXNvbnM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgfVxyXG59XHJcbn0pKCk7XHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1RyaXBOZWdvdGlhdGlvbkxvZ1NlcnZpY2UnLCBUcmlwTmVnb3RpYXRpb25Mb2dTZXJ2aWNlKTtcclxuXHJcbiAgICBUcmlwTmVnb3RpYXRpb25Mb2dTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFRyaXBOZWdvdGlhdGlvbkxvZ1NlcnZpY2UoJGh0dHAsICRxLCBlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgYWRkQXBwcm92YWxMb2c6IGFkZEFwcHJvdmFsTG9nLFxyXG4gICAgICAgICAgICBhZGRSZWplY3Rpb25Mb2c6YWRkUmVqZWN0aW9uTG9nXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkQXBwcm92YWxMb2codHJpcFJlcXVlc3RJZCwgbmVnb3RpYXRpb25Mb2dJZCwgbW9kaWZpZWRCeSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgX3VybCA9IGVudi5vbmVNVkFwaVVybCArIFwidHJpcE5lZ290aWF0aW9uTG9nL2FjY2VwdC9cIiArIHRyaXBSZXF1ZXN0SWQgKyAnLycgKyBuZWdvdGlhdGlvbkxvZ0lkICsgJy8nICsgbW9kaWZpZWRCeTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkUmVqZWN0aW9uTG9nKHRyaXBSZXF1ZXN0SWQsIG1vZGlmaWVkQnkpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIF91cmwgPSBlbnYub25lTVZBcGlVcmwgKyBcInRyaXBOZWdvdGlhdGlvbkxvZy9yZWplY3QvXCIgKyB0cmlwUmVxdWVzdElkICsgJy8nICsgbW9kaWZpZWRCeTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0ZvcmdvdFBhc3N3b3JkQ29udHJvbGxlcicsIEZvcmdvdFBhc3N3b3JkQ29udHJvbGxlcik7XHJcblxyXG4gICAgRm9yZ290UGFzc3dvcmRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnZW52JywgJ1Bhc3N3b3JkU2VydmljZScsICdhdXRoU2VydmljZScsICd2Y1JlY2FwdGNoYVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1BvcnRhbFV0aWxpdHlTZXJ2aWNlJywgJ01lc3NhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRm9yZ290UGFzc3dvcmRDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCBlbnYsIFBhc3N3b3JkU2VydmljZSwgYXV0aFNlcnZpY2UsIHZjUmVjYXB0Y2hhU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBQb3J0YWxVdGlsaXR5U2VydmljZSwgTWVzc2FnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLmNhcHRjaGFQdWJsaWNLZXkgPSBlbnYuY2FwdGNoYVB1YmxpY0tleTtcclxuICAgICAgICB2bS5XaWRnZXRDcmVhdGUgPSB3aWRnZXRDcmVhdGU7XHJcbiAgICAgICAgdm0uc2V0Q2FwdGNoYVJlc3BvbnNlID0gc2V0Q2FwdGNoYVJlc3BvbnNlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLnZlcmlmeUVtYWlsID0gdmVyaWZ5RW1haWw7XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3aWRnZXRJZCA9IC0xO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRDYXB0Y2hhUmVzcG9uc2UocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UudmVyaWZ5Q2FwdGNoYShyZXNwb25zZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKVxyXG4gICAgICAgICAgICAgICAgICAgIHZjUmVjYXB0Y2hhU2VydmljZS5yZWxvYWQod2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdpZGdldENyZWF0ZShfd2lkZ2V0SWQpIHtcclxuICAgICAgICAgICAgd2lkZ2V0SWQgPSBfd2lkZ2V0SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbk9uZU1WJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHZlcmlmeUVtYWlsKCkge1xyXG5cclxuICAgICAgICAgICAgUGFzc3dvcmRTZXJ2aWNlLlNlbmRQYXNzY29kZSh2bS5FbWFpbCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd2ZXJpZnktdXBkYXRlLXBhc3N3b3JkJywgeyBvYmo6IHsgZW1haWw6IHZtLkVtYWlsIH0gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihyZXNwb25zZS5kYXRhLnJlc3VsdC5DaGFuZ2VTdGF0dXNEZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL2xvZ2luL2ZvcmdvdC1wYXNzd29yZC5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1vbmVtdi1sb2dpbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93UmVjYXB0Y2hhID0gIWVudi5pc0lvbmljO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICBpZiAoIVBvcnRhbFV0aWxpdHlTZXJ2aWNlLmhhc1ZhbHVlKGRpdmlzaW9uSWQpKVxyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKFwiZGl2aXNpb25cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIExvZ2luQ29udHJvbGxlcik7XHJcblxyXG4gICAgTG9naW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckc2NvcGUnLCAnJHJvb3RTY29wZScsIFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdlbnYnLCAnTWVzc2FnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0NvbmZpZ0ZhY3RvcnknLFxyXG4gICAgICAgICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnU2VydmljZUFyZWFTZXJ2aWNlJywgJyR0aW1lb3V0JywgJyR3aW5kb3cnLCdQYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIExvZ2luQ29udHJvbGxlcigkbG9jYXRpb24sICRzY29wZSwgJHJvb3RTY29wZSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgZW52LCBNZXNzYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBDb25maWdGYWN0b3J5LCBHZW9Mb2NhdGlvblNlcnZpY2UsIFNlcnZpY2VBcmVhU2VydmljZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LCAkd2luZG93LCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7ICAgICAgICBcclxuICAgICAgICB2YXIgZGl2aXNpb24gPSB7fTtcclxuICAgICAgICB2YXIgZGl2aXNpb25TdXBwb3J0c0ZlZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5tZXNzYWdlID0gXCJcIjtcclxuICAgICAgICAvL3ZtLmFsaWFzID0gJyc7XHJcbiAgICAgICAgdm0ucHJvdmlkZXJzID0gW107XHJcbiAgICAgICAgJHNjb3BlLmhpZGVIZWFkZXIgPSAkbG9jYXRpb24ucGF0aCgpID09PSAnL2xvZ2luJztcclxuICAgICAgICB2bS5pc0FtYXpvblByb3ZpZGVyID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLm5hdmlnYXRlVG9Ib21lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uYWxsb3dlZFRvTG9naW5PclJlZ2lzdGVyID0gZmFsc2U7XHJcbiAgICAgICAgdm0ubG9naW5PclJlZ2lzdGVyTWVzc2FnZSA9ICcnO1xyXG4gICAgICAgIHZtLmhhc0dwc0JlZW5DaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnV2hhdHMgTmV3Jyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ0xhdGVzdCBTZXJ2aWNlIFVwZGF0ZXMnKTtcclxuICAgICAgICB2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXREaXZpc2lvbkluZm8oKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ob25EaXZpc2lvblN1Y2Nlc3MsIG9uRGl2aXNpb25GYWlsdXJlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTeXN0ZW1QYXJhbXMoKSB7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnlcclxuICAgICAgICAgICAgICAgIC5nZXREaXZpc2lvblBhcmFtZXRlcnMoZGl2aXNpb24uRGl2aXNpb25JRClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uU3VwcG9ydHNGZWVkID0gcGFyYW1zLkRpdmlzaW9uU3VwcG9ydHNGZWVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gZXZhbChwYXJhbXMuRGl2aXNpb25TdXBwb3J0c0ZlZWQudG9Mb3dlckNhc2UoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsbG93UmVnaXN0ZXJJZmZHcHNJc09uID0gcGFyYW1zLkFsbG93UmVnaXN0ZXJJZmZHcHNJc09uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBldmFsKHBhcmFtcy5BbGxvd1JlZ2lzdGVySWZmR3BzSXNPbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxsb3dSZWdpc3RlcklmZkdwc0lzT24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzR3BzRW5hYmxlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsb3dlZFRvTG9naW5PclJlZ2lzdGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmhhc0dwc0JlZW5DaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzR3BzRW5hYmxlZCgpIHtcclxuICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFBvc2l0aW9uKClcclxuICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpc0luU2VydmljZUFyZWEocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVMb2dpbignWW91ciBkZXZpY2UgaXMgdW5hYmxlIHRvIGRldGVybWluZSB5b3VyIEdQUyBsb2NhdGlvbi4nKTtcclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTG9naW4oJ0dQUyBtdXN0IGJlIGVuYWJsZWQgdG8gdXNlIHRoaXMgYXBwbGljYXRpb24uJyk7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0luU2VydmljZUFyZWEocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgdm0uaGFzR3BzQmVlbkNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBTZXJ2aWNlQXJlYVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5pc0luU2VydmljZUFyZWEoZGl2aXNpb24uRGl2aXNpb25JRCwgcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLCBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICFyZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTG9naW4oJ1lvdSBtdXN0IGJlIHdpdGhpbiB0aGUgc2VydmljZSBhcmVhIHRvIGxvZ2luIG9yIHJlZ2lzdGVyLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsb3dlZFRvTG9naW5PclJlZ2lzdGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTG9naW4oJ1dlIGFyZSB1bmFibGUgdG8gdmVyaWZ5IHlvdXIgR1BTIGxvY2F0aW9uLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkaXNhYmxlTG9naW4obWVzc2FnZSkge1xyXG4gICAgICAgICAgICB2bS5oYXNHcHNCZWVuQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmFsbG93ZWRUb0xvZ2luT3JSZWdpc3RlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5sb2dpbk9yUmVnaXN0ZXJNZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgICAgICAgLy8gbmF2aWdhdGUgdG8gZGFzaGJvYXJkIGFmdGVyIDEwIHNlY29uZHMuXHJcbiAgICAgICAgICAgIHZtLnJlZGlyZWN0VGltZW91dCA9ICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVwbGFjZSgnIy8nKTtcclxuICAgICAgICAgICAgfSwgMTAwMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBraWxsIHRoZSB0aW1lb3V0IGlmIHRoZSB1c2VyIG5hdmlnYXRlcyBhd2F5IGJlZm9yZSAxMCBzZWNvbmRzLlxyXG4gICAgICAgICRzY29wZS4kb24oXCIkZGVzdHJveVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5yZWRpcmVjdFRpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh2bS5yZWRpcmVjdFRpbWVvdXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZnVuY3Rpb24gb25EaXZpc2lvblN1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbiA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0uYWxpYXMgPSBkaXZpc2lvbi5BbGlhcztcclxuICAgICAgICAgICAgICAgIHZhciBsb2dpbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5BbGxvd2VkTG9naW5zO1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb3ZpZGVycyA9IGxvZ2lucy5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm92aWRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0FtYXpvblByb3ZpZGVyID0gcHJvdmlkZXJzW2ldLnRvTG93ZXJDYXNlKCkgPT0gXCJhbWF6b25cIjtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wcm92aWRlcnMucHVzaCh7ICduYW1lJzogcHJvdmlkZXJzW2ldIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGdldFN5c3RlbVBhcmFtcygpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gb25EaXZpc2lvbkZhaWx1cmUoZXJyb3IpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCJkYXNoYm9hcmQvXCIpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICB2bS5pb25pY1VzZUV4dGVybmFsTGluayA9IGVudi5pb25pYyA9PSBudWxsID8gZmFsc2UgOiAgZW52LmlvbmljLmFwcFZlcnNpb24gPT0gJ3Y5LjYuNTInO1xyXG5cclxuICAgICAgICB2bS5hdXRoRXh0ZXJuYWxQcm92aWRlciA9IGZ1bmN0aW9uIChwcm92aWRlcikge1xyXG4gICAgICAgICAgICBpZiAocHJvdmlkZXIgPT0gJ09uZU1WJyB8fCBwcm92aWRlciA9PSAnT25lIE1WJylcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdsb2dpbk9uZU1WJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvdmlkZXIgPT0gJ0dvb2dsZScgJiYgJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1jb3Jkb3ZhJykpIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdsb2dpbkdvb2dsZUlvbmljJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlZGlyZWN0VXJpID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArICcnO1xyXG4gICAgICAgICAgICAvLyBmb3IgSU9OSUNcclxuICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGxhdGZvcm0taW9zJykgfHwgJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1hbmRyb2lkJykpIHtcclxuICAgICAgICAgICAgICAgIC8vIGZvciB0aGUgbW9iaWxlIElPTklDIGFwcCBpT1MgYW5kIEFuZHJvaWQgdmVyc2lvbiwgXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGEgZHVtbXkgVVJMIHRoYXQgd2lsbCB3b3JrIGluIHRoZSBJbkFwcEJyb3dzZXIgcGx1Z2luXHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFVyaSA9ICdodHRwOi8vbG9jYWxob3N0L2NhbGxiYWNrLyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGxhdGZvcm0tYnJvd3NlcicpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBmb3IgcnVubmluZyBJT05JQyB2ZXJzaW9uIGxvY2FsbHkuXHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFVyaSArPSAnL2luZGV4LmlvbmljLmh0bWwjJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICB2YXIgZXh0ZXJuYWxQcm92aWRlclVybCA9IGVudi5hdXRoU2VydmVyVXJsICArIFwiQWNjb3VudC9FeHRlcm5hbExvZ2luP3Byb3ZpZGVyPVwiICsgcHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIiZyZXNwb25zZV90eXBlPXRva2VuJmNsaWVudF9pZD1cIiArIGVudi5hdWRpZW5jZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJnJlZGlyZWN0X3VyaT1cIiArIHJlZGlyZWN0VXJpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCImZGl2aXNpb25TdXBwb3J0c0ZlZWQ9XCIgKyBkaXZpc2lvblN1cHBvcnRzRmVlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJmRpdmlzaW9uSWQ9XCIgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICAvLyBJZiBib2R5IGhhcyBjbGFzcyAncGxhdGZvcm0tY29yZG92YScsIHRoZW4gd2UgYXJlIG9uIGEgbW9iaWxlIGRldmljZS5cclxuICAgICAgICAgICAgLy8gV2hlbiBvbiBhIG1vYmlsZSBkZXZpY2UsIHdlIG5lZWQgdG8gdXNlIHRoZSBjb3Jkb3ZhIGluYXBwYnJvd3NlclxyXG4gICAgICAgICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1jb3Jkb3ZhJykpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAnX2JsYW5rJztcclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gJ2xvY2F0aW9uPW5vLHRvb2xiYXI9eWVzLGNsZWFyY2FjaGU9eWVzLGNsZWFyc2Vzc2lvbmNhY2hlPXllcyxjbG9zZWJ1dHRvbmNhcHRpb249QmFjayB0byBQYXNzZW5nZXIgQXBwLHRvb2xiYXI9eWVzLHRyYW5zaXRpb25zdHlsZT1jb3ZlcnZlcnRpY2FsJztcclxuICAgICAgICAgICAgICAgIHZhciByZWYgPSB3aW5kb3cub3BlbihleHRlcm5hbFByb3ZpZGVyVXJsLCB0YXJnZXQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgcmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC51cmwuaW5kZXhPZignaHR0cDovL2xvY2FsaG9zdC9jYWxsYmFjay8jJykgPT0gMCB8fCBldmVudC51cmwuaW5kZXhPZignZmlsZTovLy8jLycpID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0xvY2F0aW9uID0gZXZlbnQudXJsLnN1YnN0cmluZyhldmVudC51cmwuaW5kZXhPZignIycpLCBldmVudC51cmwubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IG5ld0xvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlcnJvcicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2FkZXJyb3I6JyArIEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGV4dGVybmFsUHJvdmlkZXJVcmw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL2xvZ2luL2xvZ2luLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLWxvZ2luLWNsYXNzJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgIFxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ09uZU1WTG9naW5Db250cm9sbGVyJywgT25lTVZMb2dpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE9uZU1WTG9naW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckc2NvcGUnLCAnJHJvb3RTY29wZScsIFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdlbnYnLCAnTWVzc2FnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gT25lTVZMb2dpbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc2NvcGUsICRyb290U2NvcGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgZW52LCBNZXNzYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0ubG9naW4gPSBsb2dpbjtcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWxcclxuICAgICAgICB2bS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdMb2dpbicpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdXaXRoIHlvdXIgT05FTVYgYWNjb3VudCcpO1xyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBsb2dpbigpIHtcclxuICAgICAgICAgICAgLy9jYWxsIG9uZSBtdiBsb2dpblxyXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgIFVzZXJOYW1lOiB2bS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIFBhc3N3b3JkOiB2bS5wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uSWQ6IHZtLmRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICBQcm92aWRlcjogJ012TG9naW4nXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgLy93aWxsIGNhbGwgYSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luT25lTVYocmVxdWVzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2VkSW4nLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIC8vY2FsbCBtZXNzYWdlIHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWRcclxuICAgICAgICAgICAgICAgIGlmKGVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnJvci5NZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL2xvZ2luL29uZW12LWxvZ2luLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLW9uZW12LWxvZ2luJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1ZlcmlmeVVwZGF0ZVBhc3N3b3JkQ29udHJvbGxlcicsIFZlcmlmeVVwZGF0ZVBhc3N3b3JkQ29udHJvbGxlcik7XHJcblxyXG4gICAgVmVyaWZ5VXBkYXRlUGFzc3dvcmRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnJHN0YXRlUGFyYW1zJywgJyRsb2NhdGlvbicsJ2VudicsICdQYXNzd29yZFNlcnZpY2UnLCAnTWVzc2FnZVNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBWZXJpZnlVcGRhdGVQYXNzd29yZENvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGxvY2F0aW9uLCBlbnYsIFBhc3N3b3JkU2VydmljZSwgTWVzc2FnZVNlcnZpY2UsIGF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5zdWJtaXQgPSBzdWJtaXQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uY2FwdGNoYVB1YmxpY0tleSA9IGVudi5jYXB0Y2hhUHVibGljS2V5O1xyXG4gICAgICAgIHZtLldpZGdldENyZWF0ZSA9IHdpZGdldENyZWF0ZTtcclxuICAgICAgICB2bS5zZXRDYXB0Y2hhUmVzcG9uc2UgPSBzZXRDYXB0Y2hhUmVzcG9uc2U7XHJcbiAgICAgICAgdm0uZW1haWwgPSAoJHN0YXRlUGFyYW1zLm9iaikgPyAkc3RhdGVQYXJhbXMub2JqLmVtYWlsIDogXCJcIjtcclxuICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nLmVtYWlsKVxyXG4gICAgICAgICAgICAgICAgdm0uZW1haWwgPSBxdWVyeVN0cmluZy5lbWFpbDtcclxuICAgICAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nLmRpdmlzaW9uKVxyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb24gPSBxdWVyeVN0cmluZy5kaXZpc2lvbjtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICBcclxuXHJcbiAgICAgICAgdmFyIHdpZGdldElkID0gLTE7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldENhcHRjaGFSZXNwb25zZShyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBhdXRoU2VydmljZS52ZXJpZnlDYXB0Y2hhKHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgdmNSZWNhcHRjaGFTZXJ2aWNlLnJlbG9hZCh3aWRnZXRJZCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2lkZ2V0Q3JlYXRlKF93aWRnZXRJZCkge1xyXG4gICAgICAgICAgICB3aWRnZXRJZCA9IF93aWRnZXRJZDtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBzdWJtaXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHZtLm5ld1Bhc3N3b3JkICE9IHZtLnJlcGVhdE5ld1Bhc3N3b3JkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoXCJOZXcgYW5kIFJlcGVhdCBQYXNzd29yZHMgZG9uJ3QgbWF0Y2guXCIpXHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSAhdm0uaXNDbGlja2VkO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBUZW1wb3JhcnlDb2RlOiB2bS50ZW1wb3JhcnlDb2RlLFxyXG4gICAgICAgICAgICAgICAgRW1haWw6IHZtLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgTmV3UGFzc3dvcmQ6IHZtLm5ld1Bhc3N3b3JkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgUGFzc3dvcmRTZXJ2aWNlLlZlcmlmeUFuZFVwZGF0ZVBhc3N3b3JkKHBhc3N3b3JkRGF0YSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oXCJsb2dpbk9uZU1WXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1c0Rlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoXCJDb3VsZCBub3QgdXBkYXRlIHBhc3N3b3JkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9zaGFyZWQvbG9naW4vdmVyaWZ5LXVwZGF0ZS1wYXNzd29yZC5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1vbmVtdi1sb2dpbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93UmVjYXB0Y2hhID0gIWVudi5pc0lvbmljO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignRGl2aXNpb25zQ29udHJvbGxlcicsIERpdmlzaW9uc0NvbnRyb2xsZXIpO1xyXG5cclxuICAgIERpdmlzaW9uc0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHdpbmRvdycsICckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0dlb0xvY2F0aW9uU2VydmljZScsXHJcbiAgICAgICAgJ0NvbW1vblNlcnZpY2UnLCAnZW52JywnVXRpbGl0eUZhY3RvcnknXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEaXZpc2lvbnNDb250cm9sbGVyKCR3aW5kb3csICRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBEaXZpc2lvblNlcnZpY2UsIEdlb0xvY2F0aW9uU2VydmljZSwgQ29tbW9uU2VydmljZSwgZW52LFV0aWxpdHlGYWN0b3J5KSB7XHJcbiAgICAgICAgLy9maWd1cmUgb3V0IGdwcyBpcyBvbiBvciBvZmYuIElmIG9uIHRoZW4gZmluZCBkaXZpc2lvbnMgaW4gc2FtZSBzdGF0ZSBhbmQgc3RhdGUgZHJvcCBkb3duXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5kaXZpc2lvbnMgPSBbXTtcclxuICAgICAgICB2bS5zZWxlY3RlZERpdmlzaW9uID0gJyc7XHJcbiAgICAgICAgdm0uaXNEaXZpc2lvbkxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gdHJ1ZTtcclxuICAgICAgICB2bS5zdGF0ZXMgPSBbXTtcclxuICAgICAgICB2YXIgbm9EaXZpc2lvbiA9IHsgJ0FsaWFzJzogJy0tJywgJ0RpdmlzaW9uTmFtZSc6ICctLScgfTtcclxuICAgICAgICB2YXIgbm9TdGF0ZSA9IHsgJ05hbWUnOiAnLS0nLCAnSWQnOiAnLS0nIH07XHJcbiAgICAgICAgdm0uc2V0RGl2aXNpb24gPSBzZXREaXZpc2lvbjtcclxuICAgICAgICB2bS5mZXRjaERpdmlzaW9uc0ZvclNlbGVjdGVkU3RhdGUgPSBmZXRjaERpdmlzaW9uc0ZvclNlbGVjdGVkU3RhdGU7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVEaXZpc2lvbnMocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdCAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9ucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb25zLnNwbGljZSgwLCAwLCBub0RpdmlzaW9uKTtcclxuICAgICAgICAgICAgICAgIGlmIChlbnYuaXNJb25pYyAmJiBlbnYuaXNJb25pY0RldmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluIHBhc3NlbmdlciBhcHAsIGxldHMgc2VsZWN0IEFtYXpvbiwgb3IgcmVtb3ZlIGFtYXpvbiBmcm9tXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGRyb3AgZG93biBiYXNlZCBvbiBlbnYuaW9uaWMuZGl2aXNpb25OYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudi5pb25pYy5kaXZpc2lvbk5hbWUgPT0gJ2FtYXpvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXRzIEFtYXpvbiwgc2VsZWN0IEFtYXpvbiBhbmQgR09cclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREaXZpc2lvbiA9ICdhbWF6b24nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZXREaXZpc2lvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdCBBbWF6b24sIHJlbW92ZSBBbWF6b24gZnJvbSB0aGUgbGlzdC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4Y2x1c2lvbnMgPSBbMjA2XTsgLy8gYWRkIGFueSBkaXZpc2lvbnMgdGhhdCBoYXZlIHRoZWlyIG93biBhcHAgdG8gdGhpcyBhcnJheS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmRpdmlzaW9ucywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleGNsdXNpb25zLmluZGV4T2YocGFyc2VJbnQodmFsdWUuRGl2aXNpb25JRCkpICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0uZGl2aXNpb25zLmluZGV4T2YodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRGl2aXNpb24gPSB2bS5kaXZpc2lvbnNbMF0uQWxpYXM7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0RpdmlzaW9uTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGlmIChlbnYuaXNJb25pYyAmJiBlbnYuaXNJb25pY0RldmljZSAmJiBlbnYuaW9uaWMuZGl2aXNpb25OYW1lID09ICdhbWF6b24nKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJdHMgQW1hem9uLCBzZWxlY3QgQW1hem9uIGFuZCBHT1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREaXZpc2lvbiA9ICdhbWF6b24nO1xyXG4gICAgICAgICAgICAgICAgdm0uc2V0RGl2aXNpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCkudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBsYXRpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZVxyXG4gICAgICAgICAgICAgICAgdmFyIGxvbmdpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbnNCeUxvY2F0aW9uKGxhdGl0dWRlLCBsb25naXR1ZGUpLnRoZW4ocG9wdWxhdGVEaXZpc2lvbnMsIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzRGl2aXNpb25Mb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIENvbW1vblNlcnZpY2UuR2V0U3RhdGVzV2l0aERpdmlzaW9ucygpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdGVzID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXRlcy5zcGxpY2UoMCwgMCwgbm9TdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRTdGF0ZSA9IHZtLnN0YXRlc1swXS5JZDtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignJywgXCJDb3VsZCBub3QgbG9hZCBzdGF0ZXMgbGlzdC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvL0RpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbnMoKVxyXG4gICAgICAgICAgICAvLyAgICAudGhlbihwb3B1bGF0ZURpdmlzaW9ucywgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICB2bS5pc0RpdmlzaW9uTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlbG9hZFBhZ2UgPSBmdW5jdGlvbiAoKSB7ICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7IH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldERpdmlzaW9uKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWREaXZpc2lvbiAhPSBub0RpdmlzaW9uLkFsaWFzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWxpYXMgPSB2bS5zZWxlY3RlZERpdmlzaW9uO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC8nICsgYWxpYXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGZldGNoRGl2aXNpb25zRm9yU2VsZWN0ZWRTdGF0ZSgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkU3RhdGUgIT0gbm9TdGF0ZS5JZCkge1xyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICB2bS5kaXZpc2lvbnMuc3BsaWNlKDAsIDAsIG5vRGl2aXNpb24pO1xyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uQnlTdGF0ZSh2bS5zZWxlY3RlZFN0YXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHBvcHVsYXRlRGl2aXNpb25zLCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNEaXZpc2lvbkxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICBpZiAoZW52LmlzSW9uaWMpIHtcclxuICAgICAgICAgICAgdm0uZW52ID0gZW52LmlvbmljLmVudjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2bS5lbnYgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgIH1cclxuICAgIFxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xvZ291dENvbnRyb2xsZXInLCBMb2dvdXRDb250cm9sbGVyKTtcclxuXHJcbiAgICBMb2dvdXRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgJ2F1dGhTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTG9nb3V0Q29udHJvbGxlcigkbG9jYXRpb24sICRyb290U2NvcGUsYXV0aFNlcnZpY2UpIHtcclxuICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ091dCgpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZG91dCcsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1VuYWJsZSB0byBzaWduLW91dCB1c2VyLicpO1xyXG4gICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTWluQXBwU3VwcG9ydENvbnRyb2xsZXInLCBNaW5BcHBTdXBwb3J0Q29udHJvbGxlcik7XHJcblxyXG4gICAgTWluQXBwU3VwcG9ydENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnRHluYW1pY0NvbnRlbnRTZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1pbkFwcFN1cHBvcnRDb250cm9sbGVyKCRyb290U2NvcGUsICRsb2NhdGlvbiwgRHluYW1pY0NvbnRlbnRTZXJ2aWNlLCBQYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZhciBfZXJyb3IgPSAnVGhpcyB2ZXJzaW9uIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQuIFBsZWFzZSBkb3dubG9hZCB0aGUgbGF0ZXN0IHZlcnNpb24gZnJvbSBhcHAgc3RvcmUnO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdBcHAgRXJyb3InKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnVGhpcyB2ZXJzaW9uIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQnKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGlmIChEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpKVxyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgIC5nZXREaXZpc2lvbkluZm8oKVxyXG4gICAgICAgICAgICAgICAgIC50aGVuKGhhbmRsZVN1Y2Nlc3MsIGhhbmRsZUZhaWx1cmUpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBoYW5kbGVGYWlsdXJlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVTdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpdmlzaW9uID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB2bS5FcnJvck1lc3NhZ2UgPSBkaXZpc2lvbi5NaW5BcHBFcnJvclxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVGYWlsdXJlKCkge1xyXG4gICAgICAgICAgICB2bS5FcnJvck1lc3NhZ2UgPSBfZXJyb3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIC8vdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9zaGFyZWQvd2hhdHMtbmV3L3doYXRzLW5ldy5odG1sJztcclxuICAgICAgICAvL3ZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXdoYXRzLW5ldyBjYXJkJztcclxuICAgICAgICAvL3ZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIC8vdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSB0cnVlO1xyXG4gICAgICAgIC8vdm0uaW9uaWNQdWxsaW5nVGV4dCA9ICdSZWZyZXNoJztcclxuICAgICAgICAvL3ZtLmlvbmljUmVmcmVzaGluZ1RleHQgPSAnTG9hZGluZyc7XHJcbiAgICAgICAgLy92bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIC8vdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAvLyAgICBnZXREYXRhKCk7XHJcbiAgICAgICAgLy8gICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XHJcblxyXG4gICAgICAgIC8vfVxyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuY29udHJvbGxlcignbmF2JywgbmF2KTtcclxuXHJcblxyXG4gICAgbmF2LiRpbmplY3QgPSBbICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCAnJHVpYk1vZGFsJywgJyR0aW1lb3V0JywgJyRpbnRlcnZhbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2F1dGhTZXJ2aWNlJywgJ1NjaGVkdWxlU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbmF2KCRzY29wZSwkbG9jYXRpb24sICRyb290U2NvcGUsICR1aWJNb2RhbCwgJHRpbWVvdXQsICRpbnRlcnZhbCxcclxuICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgU2NoZWR1bGVTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG5cclxuICAgICAgICAkc2NvcGUudGl0bGUgPSAnTU9CSSc7XHJcbiAgICAgICAgJHNjb3BlLmhhc0FjdGl2ZVRyaXAgPSBmYWxzZTtcclxuICAgICAgICB2YXIgYXV0b1JlZnJlc2ggPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIG1vZGFsVmVoaWNsZUFycml2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIG1vZGFsVmVoaWNsZUFycml2ZWQgPSBmYWxzZTtcclxuICAgICAgICAkc2NvcGUucGFyZW50U3RhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGFsbG93ZWRTZXJ2aWNlcyA9ICBEaXZpc2lvblNlcnZpY2UuZ2V0QWxsb3dlZFNlcnZpY2VzKCk7ICAgICAgIFxyXG5cclxuICAgICAgICB2YXIgbWVudXMgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImNvbW11dGVyXCIsXHJcbiAgICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgICAgXCJ1cmxcIjogXCJjb21tdXRlci9ob21lLWNvbW11dGVyXCIsXHJcbiAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDYsXHJcbiAgICAgICAgICAgICAgICBcImNsYXNzXCI6IFwibGluay0tY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICAgIFwibGV2ZWxcIjogMSxcclxuICAgICAgICAgICAgICAgIFwiaXNTZXJ2aWNlTWVudVwiIDp0cnVlLFxyXG4gICAgICAgICAgICAgICAgXCJzdWJQYWdlc1wiOiBbXHJcbiAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkFkdmFuY2VkIFJlc2VydmF0aW9uc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJ1cmxcIjogXCJjb21tdXRlci9hZHYtc2NoZWR1bGUtc2V0dXBcIixcclxuICAgICAgICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImNvbW11dGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJvcmRlclwiOiA3XHJcbiAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkJ1cyBTdG9wc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJ1cmxcIjogXCJjb21tdXRlci9hbGwtc3RvcHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImNvbW11dGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDhcclxuICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiUHVibGlzaGVkIFNjaGVkdWxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImNvbW11dGVyL3B1Ymxpc2hlZC1zY2hlZHVsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICAgICAgICAgIFwib3JkZXJcIjogOVxyXG4gICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcImRydFwiLFxyXG4gICAgICAgICAgICAgIFwiaXNTZXJ2aWNlTWVudVwiIDp0cnVlLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMTAsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJvbi1kZW1hbmQvcmVzZXJ2YXRpb25zXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiZHJ0XCIsXHJcbiAgICAgICAgICAgICAgXCJjbGFzc1wiOiBcImxpbmstLWRlbWFuZFwiLFxyXG4gICAgICAgICAgICAgIFwic2hvd09mZmxpbmVcIjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAxLFxyXG4gICAgICAgICAgICAgIFwic3ViUGFnZXNcIjogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkFjdGl2ZSBUcmlwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJ1cmxcIjogXCJvbi1kZW1hbmQvYWN0aXZlLXRyaXBcIixcclxuICAgICAgICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJkcnRcIixcclxuICAgICAgICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2hvd0FjdGl2ZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDExXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXVxyXG5cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiZml4ZWRcIixcclxuICAgICAgICAgICAgICBcImlzU2VydmljZU1lbnVcIiA6dHJ1ZSxcclxuICAgICAgICAgICAgICBcInVybFwiOiBcImZpeGVkLXJvdXRlL2xhbmRpbmdcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJmaXhlZFwiLFxyXG4gICAgICAgICAgICAgIFwiY2xhc3NcIjogXCJsaW5rLS1maXhlZFwiLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMTIsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAxLFxyXG4gICAgICAgICAgICAgIHN1YlBhZ2VzOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiUm91dGVzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJ1cmxcIjogXCJmaXhlZC1yb3V0ZS9hbGxSb3V0ZXNcIixcclxuICAgICAgICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJmaXhlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwib3JkZXJcIjogMTNcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiU3RvcHNcIixcclxuICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImZpeGVkLXJvdXRlL3N0b3BzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiZml4ZWRcIixcclxuICAgICAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDE0XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlNjaGVkdWxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJ1cmxcIjogXCJmaXhlZC1yb3V0ZS9zY2hlZHVsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImZpeGVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJvcmRlclwiOiAxNVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJQdWJsaXNoZWQgU2NoZWR1bGVcIixcclxuICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImh0dHA6Ly90aGVidXMubW9iaS9jb250ZW50L2RvY3VtZW50cy9hbXotcHVibGlzaGVkLXNjaGVkdWxlLnBkZlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImZpeGVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJpc0V4dGVybmFsXCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJvcmRlclwiOiAxNlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIF1cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTXkgVHJpcHNcIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcInBhc3Nlbmdlci10cmlwc1wiLFxyXG4gICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImRydCxjb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgIFwiY2xhc3NcIjogXCJsaW5rLS10cmlwc1wiLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMTcsXHJcbiAgICAgICAgICAgICAgXCJzaG93T2ZmbGluZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICBcImxldmVsXCI6IDEgICAgICAgICAgIFxyXG4gICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAvL3NoYXJlZCBQYWdlc1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIlVzZXIgUHJvZmlsZVwiLFxyXG4gICAgICAgICAgICAgIFwiaWRcIjogXCJtZW51UHJvZmlsZVwiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwic2hhcmVkL3Byb2ZpbGVcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlcixmcixkcnRcIixcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFwiaXNQcm9maWxlTWVudVwiOiB0cnVlLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjAsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIkNoYW5nZSBQYXNzd29yZFwiLFxyXG4gICAgICAgICAgICAgIFwiaWRcIjogXCJjaGFuZ2VQYXNzd29yZFwiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwiY2hhbmdlLXBhc3N3b3JkXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXIsZnIsZHJ0XCIsXHJcbiAgICAgICAgICAgICAgXCJzaG93T2ZmbGluZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICBcImlzT25lTVZcIjogdHJ1ZSxcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDIxLFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNYW5hZ2UgVmVoaWNsZXNcIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcImNvbW11dGVyL215LXZlaGljbGVzXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjIsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIldoYXQncyBOZXdcIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcIm5ld3NcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlcixmcixkcnRcIixcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDIzLFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJQb2xpY2llc1wiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwiY29tbXV0ZXIvcG9saWN5XCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDI0LFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTdXBwb3J0XCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJzdXBwb3J0XCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDI1LFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOb3RpZmljYXRpb25zXCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJub3RpZmljYXRpb25zXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXIsZnIsZHJ0XCIsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAyNixcclxuICAgICAgICAgICAgICBcImxldmVsXCI6IDJcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiU2V0dGluZ3NcIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcInNldHRpbmdzXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXIsZHJ0LGZyXCIsXHJcbiAgICAgICAgICAgICAgXCJzaG93T2ZmbGluZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDI3LFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTaWduIGluXCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJsb2dpblwiLFxyXG4gICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImNvbW11dGVyLGRydFwiLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjgsXHJcbiAgICAgICAgICAgICAgXCJzaG93T2ZmbGluZVwiOiB0cnVlLFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTaWduIG91dFwiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwibG9nb3V0XCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXIsZHJ0XCIsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAyOSxcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICAkc2NvcGUucGFnZWxpbmsgPSBmdW5jdGlvbiAodXJsLCBhcHAsIHNob3dBc01vZGFsLCBldmVudCwgaXNFeHRlcm5hbCkge1xyXG4gICAgICAgICAgICBpZiAoYXBwICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pb25pY1RvZ2dsZU1lbnUoKVxyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAvL2lmIHdlIGhhdmUgbXVsdGlwbGUgbW9kYWxzIG5lZWRlZCBvbiBtZW51IGNsaWNrcyB0b21vcnJvdywgd2UgbmVlZCB0byBwYXNzIGNvbnRyb2xsZXIgYW5kIG1hcmt1cCBhcyBtZW51IHByb3BlcnRpZXMuXHJcbiAgICAgICAgICAgIGlmIChzaG93QXNNb2RhbCkge1xyXG4gICAgICAgICAgICAgICAgc2hvd05vdGlmaWNhdGlvbk1vZGFsKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWFuZ3VsYXIuaXNVbmRlZmluZWQoaXNFeHRlcm5hbCkgJiYgaXNFeHRlcm5hbCkge1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX3N5c3RlbScsICcnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh1cmwpXHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgodXJsKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgJGxvY2F0aW9uLnBhdGgoJyMnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd05vdGlmaWNhdGlvbk1vZGFsKCkge1xyXG5cclxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvc2hhcmVkL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnTm90aWZpY2F0aW9uQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyByZXR1cm5zIHRydWUgaWYgdGhlIGN1cnJlbnQgcm91dGVyIHVybCBtYXRjaGVzIHRoZSBwYXNzZWQgaW4gdXJsXHJcbiAgICAgICAgLy8gc28gdmlld3MgY2FuIHNldCAnYWN0aXZlJyBvbiBsaW5rcyBlYXNpbHlcclxuICAgICAgICAkc2NvcGUuaXNBY3RpdmUgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXNDb21tdXRlckxpbmsobmFtZSkgfHwgaXNNeVRyaXBzTGluayhuYW1lKSB8fCBpc0RydExpbmsobmFtZSkgfHwgaXNGaXhlZFJvdXRlTGluayhuYW1lKTsgICAgICAgICAgICBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc015VHJpcHNMaW5rKG5hbWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gbmFtZSA9PSAnTXkgVHJpcHMnIFxyXG4gICAgICAgICAgICAgICAgICAgICYmICgkbG9jYXRpb24ucGF0aCgpID09ICcvcGFzc2VuZ2VyLXRyaXBzJyk7XHJcbiAgICAgICAgfSAgICBcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNEcnRMaW5rKG5hbWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKS5pbmRleE9mKCdvbi1kZW1hbmQnKSA+IC0xICYmIG5hbWUgPT09ICdkcnQnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNDb21tdXRlckxpbmsobmFtZSl7XHJcbiAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpLmluZGV4T2YoJ2NvbW11dGVyJykgPiAtMSAmJiBuYW1lID09PSAnY29tbXV0ZXInO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNGaXhlZFJvdXRlTGluayhuYW1lKXtcclxuICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCkuaW5kZXhPZignZml4ZWQtcm91dGUnKSA+IC0xICYmIG5hbWUgPT09ICdmaXhlZCc7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLmNsb3NlRHJvcERvd24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pc29wZW4gPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuZ29CYWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI3BhZ2Utd3JhcHBlcicpLmFkZENsYXNzKCdiYWNrJyk7XHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI3BhZ2Utd3JhcHBlcicpLnJlbW92ZUNsYXNzKCdiYWNrJyk7XHJcbiAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIG9ubGluZU1lbnVzKG1lbnUpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGFuZ3VsYXIuaXNVbmRlZmluZWQobWVudS5zaG93T2ZmbGluZSkgfHwgIW1lbnUuc2hvd09mZmxpbmU7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgbWVudS5pc1Byb2ZpbGVNZW51KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzaG93IHByb2ZpbGUgbWVudSBvbmx5IGlmIGRyb3BvZmYgSG9tZSBsb2NhdGlvbiBvbmx5IGlzIHRydWVcclxuICAgICAgICAgICAgICAgIC8vIG5vdGU6IHJlbW92ZSB0aGlzIGxpbWl0YXRpb24gd2hlbiBub24gaG9tZSBsb2NhdGlvbiBpdGVtcyBhcmUgYWRkZWQgdG8gUHJvZmlsZVxyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtID0gRGl2aXNpb25TZXJ2aWNlLmdldFN5c3RlbVBhcmFtZXRlcnMoKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHBhcmFtLkRyb3BvZmZIb21lTG9jYXRpb25Pbmx5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgbWVudS5pc09uZU1WKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5sb2dpblByb3ZpZGVyID09PSBcIk12TG9naW5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBvZmZsaW5lTWVudXMobWVudSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc1VuZGVmaW5lZChtZW51LnNob3dPZmZsaW5lKSB8fCBtZW51LnNob3dPZmZsaW5lO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFsbG93ZWRGb3JEaXZpc2lvbihtZW51KSB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChhbGxvd2VkU2VydmljZXMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZW51U2VydmljZXMgPSBtZW51LnNlcnZpY2Uuc3BsaXQoJywnKTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lbnVTZXJ2aWNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7ajxhbGxvd2VkU2VydmljZXMubGVuZ3RoO2orKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGFsbG93ZWRTZXJ2aWNlc1tqXS5uYW1lLnRvTG93ZXJDYXNlKCkgPT0gbWVudVNlcnZpY2VzW2ldLnRvTG93ZXJDYXNlKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc29ydEJ5T3JkZXIoYSwgYikge1xyXG4gICAgICAgICAgICByZXR1cm4gYS5vcmRlciA+IGIub3JkZXI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29weShvKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBvKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvZ2dsZU1lbnUoKSB7XHJcbiAgICAgICAgICAgIHZhciBsb2dpblByZWRpY2F0ZSA9IGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSA/IG9ubGluZU1lbnVzIDogb2ZmbGluZU1lbnVzO1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25QcmVkaWNhdGUgPSBhbGxvd2VkRm9yRGl2aXNpb247XHJcblxyXG4gICAgICAgICAgICB2YXIgcHJvY2Vzc2VkTWVudXMgPSBtZW51c1xyXG4gICAgICAgICAgICAgIC5tYXAoY29weSlcclxuICAgICAgICAgICAgICAuZmlsdGVyKGRpdmlzaW9uUHJlZGljYXRlKVxyXG4gICAgICAgICAgICAgIC5maWx0ZXIobG9naW5QcmVkaWNhdGUpXHJcbiAgICAgICAgICAgICAgLnNvcnQoc29ydEJ5T3JkZXIpO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9jZXNzZWRNZW51cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb2Nlc3NlZE1lbnVzW2ldLnN1YlBhZ2VzKVxyXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZE1lbnVzW2ldLnN1YlBhZ2VzID0gcHJvY2Vzc2VkTWVudXNbaV1cclxuICAgICAgICAgICAgICAgICAgICAuc3ViUGFnZXNcclxuICAgICAgICAgICAgICAgICAgICAubWFwKGNvcHkpXHJcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihkaXZpc2lvblByZWRpY2F0ZSlcclxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGxvZ2luUHJlZGljYXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zb3J0KHNvcnRCeU9yZGVyKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnBhZ2VzID0gc2V0UGFnZXMocHJvY2Vzc2VkTWVudXMpOyAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFBhZ2VzKHBhZ2VzKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXBhZ2VzKSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAgICAgdmFyIG1lbnVzID0gW107XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhZ2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAnYWxpYXMnOiBnZXRNZW51TmFtZShwYWdlc1tpXSksXHJcbiAgICAgICAgICAgICAgICAgICAgJ25hbWUnIDogcGFnZXNbaV0ubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAnb3JkZXInOiBwYWdlc1tpXS5vcmRlcixcclxuICAgICAgICAgICAgICAgICAgICAnc2VydmljZSc6IHBhZ2VzW2ldLnNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3Nob3dBc01vZGFsJzogcGFnZXNbaV0uc2hvd0FzTW9kYWwsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogcGFnZXNbaV0uY2xhc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3Nob3dBY3RpdmUnOiBwYWdlc1tpXS5zaG93QWN0aXZlLFxyXG4gICAgICAgICAgICAgICAgICAgICdsZXZlbCc6IHBhZ2VzW2ldLmxldmVsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VzW2ldLnVybClcclxuICAgICAgICAgICAgICAgICAgICBwYWdlLnVybCA9IHBhZ2VzW2ldLnVybDtcclxuICAgICAgICAgICAgICAgIGlmIChwYWdlc1tpXS5zdWJQYWdlcylcclxuICAgICAgICAgICAgICAgICAgICBwYWdlLnN1YlBhZ2VzID0gc2V0UGFnZXMocGFnZXNbaV0uc3ViUGFnZXMpO1xyXG4gICAgICAgICAgICAgICAgcGFnZS5pc0V4dGVybmFsID0gcGFnZXNbaV0uaXNFeHRlcm5hbDtcclxuICAgICAgICAgICAgICAgIG1lbnVzLnB1c2gocGFnZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1lbnVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWVudU5hbWUobWVudSl7XHJcblxyXG4gICAgICAgICAgICBpZighbWVudS5pc1NlcnZpY2VNZW51KSByZXR1cm4gbWVudS5uYW1lO1xyXG5cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDtpIDxhbGxvd2VkU2VydmljZXMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICBpZihtZW51LnNlcnZpY2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhhbGxvd2VkU2VydmljZXNbaV0ubmFtZS50b0xvd2VyQ2FzZSgpKSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWxsb3dlZFNlcnZpY2VzW2ldLmFsaWFzO1xyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0QWN0aXZlVHJpcE1lbnVJdGVtKGZsYWcpIHtcclxuICAgICAgICAgICAgb3V0ZXI6IGZvciAodmFyIG0gaW4gJHNjb3BlLnBhZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnBhZ2VzW21dLm5hbWUgPT0gXCJkcnRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlubmVyOiBmb3IgKHZhciBzdWJNIGluICRzY29wZS5wYWdlc1ttXS5zdWJQYWdlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnBhZ2VzW21dLnN1YlBhZ2VzW3N1Yk1dLm5hbWUgPT0gXCJBY3RpdmUgVHJpcFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFnZXNbbV0uc3ViUGFnZXNbc3ViTV0uc2hvd0FjdGl2ZSA9IGZsYWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ2hlY2tWZWhpY2xlU3RhdHVzRm9yVHJpcChwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICBpZiAoIWFuZ3VsYXIuaXNVbmRlZmluZWQoT25lTXZTZXJ2aWNlcy5nZXREcnRJbmZvKCkpICYmIGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSAnJztcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRsYXN0cmlwZGV0YWlscyhwYXNzZW5nZXJJZCwgZGl2aXNpb25JZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0QWN0aXZlVHJpcE1lbnVJdGVtKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRBY3RpdmVUcmlwTWVudUl0ZW0oZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudFRyaXBEZXRhaWxzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW9kYWxWZWhpY2xlQXJyaXZpbmcgJiYgY3VycmVudFRyaXBEZXRhaWxzLlRyaXBJRCAhPSBudWxsICYmIGN1cnJlbnRUcmlwRGV0YWlscy5QaWNrVXBHZW9mZW5jZVRpbWUgIT0gbnVsbCAmJiBjdXJyZW50VHJpcERldGFpbHMuU3RhcnRUaW1lID09IG51bGwgJiYgY3VycmVudFRyaXBEZXRhaWxzLk9yaWdpbkRlcGFydFRpbWUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tb2RlbGluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm1vZGFsX19oZWFkZXJcIiA+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGg0IGNsYXNzPVwibW9kYWwtdGl0bGVcIj5JbmZvPC9oND4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsX18tYm9keVwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxwPllvdXIgdmVoaWNsZSB3aWxsIGJlIGFycml2aW5nIHNvb248L3A+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsX19mb290ZXJcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ0bi13YXJuaW5nXCIgdHlwZT1cImJ1dHRvblwiIG5nLWNsaWNrPVwiY2xvc2UoKVwiPk9LPC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGU6ICRzY29wZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxWZWhpY2xlQXJyaXZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFtb2RhbFZlaGljbGVBcnJpdmVkICYmIGN1cnJlbnRUcmlwRGV0YWlscy5UcmlwSUQgIT0gbnVsbCAmJiBjdXJyZW50VHJpcERldGFpbHMuU3RhcnRUaW1lICE9IG51bGwgJiYgY3VycmVudFRyaXBEZXRhaWxzLk9yaWdpbkRlcGFydFRpbWUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGFsVmVoaWNsZUFycml2aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxWZWhpY2xlQXJyaXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vZGVsaW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCIgPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxoMyBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+SW5mbzwvaDM+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+WW91ciB2ZWhpY2xlIGhhcyBqdXN0IGFycml2ZWQ8L3A+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXdhcm5pbmdcIiB0eXBlPVwiYnV0dG9uXCIgbmctY2xpY2s9XCJjbG9zZSgpXCI+T0s8L2J1dHRvbj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFZlaGljbGVBcnJpdmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BBdXRvUmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDaGVja1ZlaGljbGVTdGF0dXNGb3JUcmlwJywgZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5tb2RlbGluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIG1vZGFsVmVoaWNsZUFycml2ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgbW9kYWxWZWhpY2xlQXJyaXZpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWZyZXNoKCkge1xyXG4gICAgICAgICAgICAkc2NvcGUucGFnZXMgPSBbXTtcclxuICAgICAgICAgICAgYWxsb3dlZFNlcnZpY2VzID0gIERpdmlzaW9uU2VydmljZS5nZXRBbGxvd2VkU2VydmljZXMoKTtcclxuICAgICAgICAgICAgdG9nZ2xlTWVudSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoYXV0b1JlZnJlc2gpICYmICEkcm9vdFNjb3BlLm5hdkF1dG9SZWZyZXNoSXNSdW5uaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBhdXRvUmVmcmVzaCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgQ2hlY2tWZWhpY2xlU3RhdHVzRm9yVHJpcChhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxNTAwMCk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5hdkF1dG9SZWZyZXNoSXNSdW5uaW5nID0gIWFuZ3VsYXIuaXNVbmRlZmluZWQoYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHN0b3BBdXRvUmVmcmVzaCgpXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BBdXRvUmVmcmVzaCgpIHtcclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGF1dG9SZWZyZXNoKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICAgICAgYXV0b1JlZnJlc2ggPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLm5hdkF1dG9SZWZyZXNoSXNSdW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignbG9nZ2VkSW4nLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJlZnJlc2goKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dnZWRvdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJlZnJlc2goKTtcclxuICAgICAgICAgICAgc3RvcEF1dG9SZWZyZXNoKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAgICRzY29wZS4kb24oJ2RpdmlzaW9uQ2hhbmdlZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVmcmVzaCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBzaG93IGFjdGl2ZSB0cmlwIG1lbnUgaXRlbSBvbmx5IGlmIHVzZXIgaGFzIGFuIGFjdGl2ZSB0cmlwXHJcbiAgICAgICAgJHNjb3BlLiRvbignaGFzQWN0aXZlVHJpcENoYW5nZWQnLCBmdW5jdGlvbiAoZXZlbnQsIGhhc0FjdGl2ZVRyaXApIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5oYXNBY3RpdmVUcmlwICE9IGhhc0FjdGl2ZVRyaXApIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5oYXNBY3RpdmVUcmlwID0gaGFzQWN0aXZlVHJpcDtcclxuICAgICAgICAgICAgICAgIHNldEFjdGl2ZVRyaXBNZW51SXRlbShoYXNBY3RpdmVUcmlwKTtcclxuICAgICAgICAgICAgICAgIHJlZnJlc2goKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pOyAgICAgICBcclxuXHJcbiAgICAgICAgcmVmcmVzaCgpO1xyXG5cclxuXHJcblxyXG4gICAgICAgICRzY29wZS50b2dnbGVHcm91cElvbmljID0gZnVuY3Rpb24gKGdyb3VwLCBpc1BhcmVudCkge1xyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5pc0dyb3VwU2hvd25Jb25pYyhncm91cCkpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93bkdyb3VwSW9uaWMgPSBncm91cDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpc1BhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3duR3JvdXBJb25pYyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS53aXBlTG9jYWxTdG9yYWdlSW5mbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2dvIDEnKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdpb25pY1Nob3dTcGxhc2hTY3JlZW4nKTtcclxuICAgICAgICAgICAgJHNjb3BlLmlvbmljVG9nZ2xlTWVudSgpO1xyXG4gICAgICAgICAgICB2YXIgaW9uaWNDSENQT24gPSB3aW5kb3cubG9jYWxTdG9yYWdlWydpb25pY0NIQ1BPbiddID8gd2luZG93LmxvY2FsU3RvcmFnZVsnaW9uaWNDSENQT24nXSA6ICd0cnVlJztcclxuICAgICAgICAgICAgdmFyIGxvY2FsRW52ID0gd2luZG93LmxvY2FsU3RvcmFnZVsnZW52J10gPyB3aW5kb3cubG9jYWxTdG9yYWdlWydlbnYnXSA6ICctZGV2JztcclxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5jbGVhcigpO1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlWydpb25pY0NIQ1BPbiddID0gaW9uaWNDSENQT247XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2VbJ2VudiddID0gbG9jYWxFbnY7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKCcjL25hdi9kaXZpc2lvbicpO1xyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpO1xyXG4gICAgICAgICAgICB9LCA1MDApXHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuaXNHcm91cFNob3duSW9uaWMgPSBmdW5jdGlvbiAoZ3JvdXApIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zaG93bkdyb3VwSW9uaWMgPT09IGdyb3VwO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5pb25pY1RvZ2dsZU1lbnUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnaW9uaWNUb2dnbGVMZWZ0TWVudScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdOb3RpZmljYXRpb25Db250cm9sbGVyJywgTm90aWZpY2F0aW9uQ29udHJvbGxlcik7XHJcblxyXG4gICAgTm90aWZpY2F0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWwnLCdOb3RpZmljYXRpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE5vdGlmaWNhdGlvbkNvbnRyb2xsZXIoJHVpYk1vZGFsLCBOb3RpZmljYXRpb25TZXJ2aWNlLCBQYWdlU2VydmljZSwgYXV0aFNlcnZpY2UsIE9uZU12U2VydmljZXMpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdOb3RpZmljYXRpb25zJztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdOb3RpZmljYXRpb25zJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ1NlcnZpY2UgdXBkYXRlcycpO1xyXG4gICAgICAgIHZtLmNvbW11dGVyQWxlcnRzID0gW107XHJcbiAgICAgICAgdm0uZnJOb3RpZmljYXRpb25zID0gW107XHJcblxyXG4gICAgICAgIHZtLmlzRnJOb3RpZmljYXRpb25Mb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICB2bS5pc0NvbW11dGVyQWxlcnRMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNDb21tdXRlck5vdGlmaWNhdGlvbkxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5pc0RSVE5vdGlmaWNhdGlvbkxvYWRpbmcgPSBmYWxzZTsgICAgICAgICAgIFxyXG4gICAgICAgIHZtLmhhc0NvbW11dGVyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaGFzRml4ZWRSb3V0ZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmhhc0RSVCA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2bS5jb21tdXRlckluZm8gPSBPbmVNdlNlcnZpY2VzLmdldENvbW11dGVySW5mbygpO1xyXG4gICAgICAgIHZtLmZpeGVkUm91dGVJbmZvID0gT25lTXZTZXJ2aWNlcy5nZXRGaXhlZFJvdXRlSW5mbygpO1xyXG4gICAgICAgIHZtLmRydEluZm8gPSBPbmVNdlNlcnZpY2VzLmdldERydEluZm8oKTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgLy8gICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIHZtLnNob3dUcmlwSW5mbyA9IHNob3dUcmlwSW5mbztcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dUcmlwSW5mbyhub3RpZmljYXRpb24pIHtcclxuICAgICAgICAgICAgc2hvd0NvbW11dGVyVHJpcEluZm8obm90aWZpY2F0aW9uLkxpbmtlZElkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dDb21tdXRlclRyaXBJbmZvKHRyaXBJZCkge1xyXG4gICAgICAgICAgICB2YXIgY29tbXV0ZXJUcmlwTW9kYWwgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9zaGFyZWQvdHJpcHMvY29tbXV0ZXItdHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlclRyaXBNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpcElkOiB0cmlwSWRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb21tdXRlclRyaXBNb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jYW5jZWxsZWQgfHwgcmVzcG9uc2UuaXNNb2RpZmllZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldENvbW11dGVyTm90aWZpY2F0aW9ucygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuXHJcbiAgICAgICAgdm0uaXNsb2dnZWRJbiA9IGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgaWYoIWFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29tbXV0ZXJJbmZvKSl7XHJcbiAgICAgICAgICAgICAgICB2bS5oYXNDb21tdXRlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBnZXRDb21tdXRlck5vdGlmaWNhdGlvbnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZighYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5maXhlZFJvdXRlSW5mbykpe1xyXG4gICAgICAgICAgICAgICAgdm0uaGFzRml4ZWRSb3V0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBnZXRGaXhlZFJvdXRlTm90aWZpY2F0aW9ucygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmRydEluZm8pKXtcclxuICAgICAgICAgICAgICAgIHZtLmhhc0RSVCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBnZXREUlROb3RpZmljYXRpb25zKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Rml4ZWRSb3V0ZU5vdGlmaWNhdGlvbnMoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzRnJOb3RpZmljYXRpb25Mb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgTm90aWZpY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldEZpeGVkUm91dGVOb3RpZmljYXRpb24oKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmZyTm90aWZpY2F0aW9ucyA9IHJlc3BvbnNlLmRhdGEubm90aWZpY2F0aW9ucztcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5mck5vdGlmaWNhdGlvbnMsIGZ1bmN0aW9uIChub3RpZmljYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uVGl0bGUgPSBub3RpZmljYXRpb24ubGlua1RpdGxlO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5NZXNzYWdlID0gbm90aWZpY2F0aW9uLnRleHQ7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHZtLmlzRnJOb3RpZmljYXRpb25Mb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNGck5vdGlmaWNhdGlvbkxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRDb21tdXRlck5vdGlmaWNhdGlvbnMoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQ29tbXV0ZXJOb3RpZmljYXRpb25Mb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgTm90aWZpY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldENvbW11dGVyTm90aWZpY2F0aW9ucygpXHJcbiAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICB2bS5Db21tdXRlck5vdGlmaWNhdGlvbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICB2bS5pc0NvbW11dGVyTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgdm0uaXNDb21tdXRlck5vdGlmaWNhdGlvbkxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERSVE5vdGlmaWNhdGlvbnMoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzRFJUTm90aWZpY2F0aW9uTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIE5vdGlmaWNhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXREUlROb3RpZmljYXRpb25zKClcclxuICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIHZtLkRSVE5vdGlmaWNhdGlvbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICB2bS5pc0RSVE5vdGlmaWNhdGlvbkxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgIHZtLmlzRFJUTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcblx0XCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5cdGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKFwib25lTVZBcHBcIilcclxuICAgICAgICAuZGlyZWN0aXZlKFwibm90aWZpY2F0aW9uSXRlbVwiLCBub3RpZmljYXRpb25JdGVtKTtcclxuXHJcblx0ZnVuY3Rpb24gbm90aWZpY2F0aW9uSXRlbSgpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdHJlc3RyaWN0OiBcIkVcIixcclxuXHRcdFx0c2NvcGU6IHtcclxuXHRcdFx0XHRkYXRhOiBcIj1cIlxyXG5cdFx0XHR9LFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogXCJhcHAvbW9kdWxlcy9zaGFyZWQvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1pdGVtLmNvbXBvbmVudC5odG1sXCJcclxuXHRcdH07XHJcblxyXG5cdH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ05vdGlmaWNhdGlvblNlcnZpY2UnLCBOb3RpZmljYXRpb25TZXJ2aWNlKTtcclxuXHJcbiAgICBOb3RpZmljYXRpb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudicsICdhdXRoU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBOb3RpZmljYXRpb25TZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBhdXRoU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXRTZXJ2aWNlQWxlcnRzOiBnZXRTZXJ2aWNlQWxlcnRzLFxyXG4gICAgICAgICAgICBnZXRGaXhlZFJvdXRlTm90aWZpY2F0aW9uOiBnZXRGaXhlZFJvdXRlTm90aWZpY2F0aW9uLFxyXG4gICAgICAgICAgICBnZXRDb21tdXRlck5vdGlmaWNhdGlvbnM6IGdldENvbW11dGVyTm90aWZpY2F0aW9ucyxcclxuICAgICAgICAgICAgZ2V0RFJUTm90aWZpY2F0aW9uczogZ2V0RFJUTm90aWZpY2F0aW9uc1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlcnZpY2VBbGVydHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcm91dGUgPSBhdXRoU2VydmljZS5pc0xvZ2dlZEluKCkgPyAnL3NlcnZpY2VBbGVydHNGb3JVc2VyLycgKyBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQgOiAnL3NlcnZpY2VBbGVydHMnO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAnY29tbW9uLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgcm91dGUgKyBcIj9ybmQ9XCIgKyBEYXRlLnBhcnNlKG5ldyBEYXRlKCkpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXRGaXhlZFJvdXRlTm90aWZpY2F0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkZpeGVkUm91dGVBcGlVcmwgKyBcIm5vdGlmaWNhdGlvbnMvXCIgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldENvbW11dGVyTm90aWZpY2F0aW9ucygpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpID8gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgOiAwO1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gcGFzc2VuZ2VySWQgPT0gMFxyXG4gICAgICAgICAgICAgICAgPyBlbnYub25lTVZBcGlVcmwgKyBcIm5vdGlmaWNhdGlvbnMvY29tbXV0ZXIvXCIgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpXHJcbiAgICAgICAgICAgICAgICA6IGVudi5vbmVNVkFwaVVybCArIFwibm90aWZpY2F0aW9ucy9jb21tdXRlci9cIiArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBwYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiB1cmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBnZXREUlROb3RpZmljYXRpb25zKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICBpZiAoIWF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSlcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGVudi5vbmVNVkFwaVVybCArIFwibm90aWZpY2F0aW9ucy9EUlQvXCIgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy8nICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogdXJsXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQ2hhbmdlUGFzc3dvcmRDb250cm9sbGVyJywgQ2hhbmdlUGFzc3dvcmRDb250cm9sbGVyKTtcclxuXHJcbiAgICBDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJyxcclxuICAgICAgICAnYXV0aFNlcnZpY2UnLCAnZW52JywgJ01lc3NhZ2VTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZScsICdQYWdlU2VydmljZScsICdQYXNzd29yZFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIoJGxvY2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UsIGVudiwgTWVzc2FnZVNlcnZpY2UsIERpdmlzaW9uU2VydmljZSwgUGFnZVNlcnZpY2UsIFBhc3N3b3JkU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uY2hhbmdlUGFzc3dvcmQgPSBjaGFuZ2VQYXNzd29yZDtcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWw7XHJcbiAgICAgICAgdm0uZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnQ2hhbmdlIFBhc3N3b3JkJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ1VwZGF0ZSB5b3VyIHBhc3N3b3JkJyk7XHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBjaGFuZ2VQYXNzd29yZCgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLm5ld1Bhc3N3b3JkICE9PSB2bS5uZXdQYXNzd29yZFJldHlwZSkge1xyXG4gICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKFwiTmV3IFBhc3N3b3JkIGFuZCBSZXR5cGUgUGFzc3dvcmQgZG8gbm90IG1hdGNoXCIpO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9jYWxsIG9uZSBtdiBsb2dpblxyXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgIFVzZXJOYW1lOiB2bS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIE9sZFBhc3N3b3JkOiB2bS5vbGRQYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIE5ld1Bhc3N3b3JkOiB2bS5uZXdQYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uSWQ6IHZtLmRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICBQYXNzZW5nZXJJZDogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICBQcm92aWRlcjogJ012TG9naW4nXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy93aWxsIGNhbGwgYSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIFBhc3N3b3JkU2VydmljZS5DaGFuZ2VQYXNzd29yZChyZXF1ZXN0KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQuQ2hhbmdlU3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dTdWNjZXNzKFwiUGFzc3dvcmQgQ2hhbmdlZCBzdWNjZXNzZnVsbHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm9sZFBhc3N3b3JkID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubmV3UGFzc3dvcmQgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5uZXdQYXNzd29yZFJldHlwZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1c0Rlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIC8vY2FsbCBtZXNzYWdlIHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWRcclxuICAgICAgICAgICAgICAgIGlmIChlcnJvcilcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoZXJyb3IuTWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL3NoYXJlZC9wcm9maWxlL2NoYW5nZS1wYXNzd29yZC5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1vbmVtdi1sb2dpbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cdGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnaG9tZUFkZHJlc3NEaXJlY3RpdmUnLCBob21lQWRkcmVzc0RpcmVjdGl2ZSk7XHJcblxyXG5cdGhvbWVBZGRyZXNzRGlyZWN0aXZlLiRpbmplY3QgPSBbJyR3aW5kb3cnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0xvY2F0aW9uRmFjdG9yeScsICdhdXRoU2VydmljZScsICdQcm9maWxlU2VydmljZScsICdDb21tb25TZXJ2aWNlJywgJ1V0aWxpdHlGYWN0b3J5JywgJyR1aWJNb2RhbFN0YWNrJ107XHJcblxyXG5cdGZ1bmN0aW9uIGhvbWVBZGRyZXNzRGlyZWN0aXZlKCR3aW5kb3csIERpdmlzaW9uU2VydmljZSwgTG9jYXRpb25GYWN0b3J5LCBhdXRoU2VydmljZSwgUHJvZmlsZVNlcnZpY2UsIENvbW1vblNlcnZpY2UsIFV0aWxpdHlGYWN0b3J5LCAkdWliTW9kYWxTdGFjaykge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0Y29udHJvbGxlcjogaG9tZUFkZHJlc3NDb250cm9sbGVyLFxyXG5cdFx0XHRyZXBsYWNlOiB0cnVlLFxyXG5cdFx0XHRyZXN0cmljdDogJ0UnLFxyXG5cdFx0XHRzY29wZToge1xyXG5cdFx0XHRcdEhvbWVBZGRyZXNzOiAnPT9kYXRhJyxcclxuXHRcdFx0XHRpbnZhbGlkOiAnPT9pbnZhbGlkJ1xyXG5cdFx0XHR9LFxyXG5cdFx0XHR0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC9wcm9maWxlL2hvbWVBZGRyZXNzLmh0bWwnXHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBob21lQWRkcmVzc0NvbnRyb2xsZXIoJHNjb3BlLCAkdWliTW9kYWxTdGFjaykge1xyXG5cdFx0XHQvLyBpbml0aWFsaXplIGJpbmRpbmdzXHJcblx0XHRcdCRzY29wZS5oYXNNb2RhbFBhcmVudCA9ICR1aWJNb2RhbFN0YWNrLmdldFRvcCgpICE9PSB1bmRlZmluZWQ7XHJcblx0XHRcdCRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcclxuXHRcdFx0JHNjb3BlLmludmFsaWQgPSB0cnVlO1xyXG5cdFx0XHQkc2NvcGUuaGFzSG9tZUFkZHJlc3MgPSBmYWxzZTtcclxuXHRcdFx0JHNjb3BlLmlzQ29udGFpbmVyTWFuYWdpbmdEYXRhID0gJHNjb3BlLkhvbWVBZGRyZXNzICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIC8vIElmIEhvbWVBZGRyZXNzIGlzIHBhc3NlZCBmcm9tIHRoZSBjYWxsZXIsIHVzZSBpdC5cclxuXHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzID0gJHNjb3BlLkhvbWVBZGRyZXNzID09IG51bGwgPyB7fSA6ICRzY29wZS5Ib21lQWRkcmVzcztcclxuXHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoID0ge307XHJcblx0XHRcdCRzY29wZS5nb29nbGVMb2NhdGlvbnMgPSBbXTtcclxuXHRcdFx0JHNjb3BlLnN0YXRlcyA9IFtdO1xyXG5cdFx0XHQkc2NvcGUuY291bnRyaWVzID0gW3sgbmFtZTogJ1VuaXRlZCBTdGF0ZXMnLCBjb2RlOiAnVVNBJyB9XTtcclxuXHJcblx0XHRcdC8vIGluaXRpYWxpemUgZ2xvYmFsc1xyXG5cdFx0XHQkc2NvcGUuZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcblx0XHRcdCRzY29wZS5wYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG5cdFx0XHQkc2NvcGUuc3VibWl0dGVkID0gZmFsc2U7XHJcblx0XHRcdCRzY29wZS5BZGRFZGl0ID0gdHJ1ZTtcclxuXHRcdFx0JHNjb3BlLnppcGNvZGUgPSBcIlwiO1xyXG5cdFx0XHQkc2NvcGUuc3RhdGVhYmJyID0gXCJcIjtcclxuXHRcdFx0JHNjb3BlLmlzVmFsaWRaaXAgPSBmYWxzZTtcclxuXHRcdFx0JHNjb3BlLmFsbG93RWRpdEhvbWVBZGRyZXNzID0gZmFsc2U7XHJcblx0XHRcdCRzY29wZS5zaG93SG9tZUFkZHJlc3MgPSBmYWxzZTtcclxuXHRcdFx0JHNjb3BlLmRhdGFTZXJ2aWNlVG8gPSBMb2NhdGlvbkZhY3RvcnkuZGF0YVNlcnZpY2VUbztcclxuXHJcblx0XHRcdC8vIHBvcHVsYXRlIFN0YXRlcyBsaXN0XHJcblx0XHRcdENvbW1vblNlcnZpY2UuR2V0QWxsU3RhdGVzKCkudGhlbihcclxuXHRcdFx0XHRmdW5jdGlvbiAocmVzdWx0KSB7XHJcblx0XHRcdFx0XHQkc2NvcGUuc3RhdGVzID0gcmVzdWx0O1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0ZnVuY3Rpb24gKGVycikge1xyXG5cdFx0XHRcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignJywgXCJDb3VsZCBub3QgbG9hZCBzdGF0ZXMgbGlzdC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIilcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdC8vIHJldHVybiB1c2VyIHRvIHByZXZpb3VzIHNjcmVlblxyXG5cdFx0XHQkc2NvcGUuQ2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdCR1aWJNb2RhbFN0YWNrLmRpc21pc3NBbGwoKTtcclxuXHRcdFx0XHQkd2luZG93Lmhpc3RvcnkuYmFjaygpO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gdXNlciBzZWxlY3RlZCBhIGhvbWUgbG9jYXRpb25cclxuXHRcdFx0JHNjb3BlLlNlbGVjdGVkSG9tZUFkZHJlc3MgPSBmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuXHRcdFx0XHQvLyByZW1lbWJlciBzdWl0ZVxyXG5cdFx0XHRcdHZhciBzdWl0ZSA9ICRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaC5TdWl0ZTtcclxuXHJcblx0XHRcdFx0Ly8gc2V0IGhvbWUgbG9jYXRpb25cclxuXHRcdFx0XHQkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2ggPSBhbmd1bGFyLmNvcHkobG9jYXRpb24pO1xyXG5cdFx0XHRcdCRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaC5TdWl0ZSA9IHN1aXRlO1xyXG5cclxuXHRcdFx0XHQvLyBnZXQgdGhlIHN0YXRlIElkXHJcblx0XHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoLlN0YXRlSWQgPSAkc2NvcGUuc3RhdGVzLmZpbHRlcihmdW5jdGlvbiAocykgeyByZXR1cm4gcy5BYmJyID09IGxvY2F0aW9uLlN0YXRlIH0pWzBdLklkO1xyXG5cdFx0XHRcdCRzY29wZS5Ib21lQWRkcmVzcyA9IGFuZ3VsYXIuY29weSgkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2gpO1xyXG5cclxuXHRcdFx0XHQvLyBjbGljayB0aGUgbGlzdCByYWRpbyBidXR0b24gZm9yIHRoaXMgYWRkcmVzc1xyXG5cdFx0XHRcdCRzY29wZS5Ib21lQWRkcmVzc0dvb2dsZVBsYWNlSWQgPSBsb2NhdGlvbi5Hb29nbGVQbGFjZUlkO1xyXG5cclxuXHRcdFx0XHQkc2NvcGUuaW52YWxpZCA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvLyBzZWFyY2ggZm9yIGhvbWUgbG9jYXRpb25zIGJhc2VkIG9uIHVzZXIgaW5wdXQgdG8gc2VhcmNoIGZpZWxkc1xyXG5cdFx0XHQkc2NvcGUuR29vZ2xlU2VhcmNoID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdCRzY29wZS5pbnZhbGlkID0gdHJ1ZTtcclxuXHRcdFx0XHQkc2NvcGUuZ29vZ2xlTG9jYXRpb25zID0gW107XHJcblx0XHRcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiSG9tZSBBZGRyZXNzIC0gU2VhcmNoXCIsIFwiU2VhcmNoaW5nIGZvciBtYXRjaGluZyBhZGRyZXNzZXMuIFBsZWFzZSB3YWl0LlwiKTtcclxuXHRcdFx0XHR2YXIgc3RhdGUgPSAkc2NvcGUuc3RhdGVzLmZpbHRlcihmdW5jdGlvbiAocykgeyByZXR1cm4gcy5JZCA9PSAkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2guU3RhdGVJZDsgfSlbMF07XHJcblx0XHRcdFx0dmFyIHNlYXJjaFN0cmluZyA9ICgkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2guQWRkcmVzcyB8fCBcIlwiKSArICcsICcgKyAoJHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoLkNpdHkgfHwgXCJcIikgKyAnLCAnICsgKChzdGF0ZSAmJiBzdGF0ZS5BYmJyKSB8fCBcIlwiKSArICcsICcgKyAoJHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoLlppcCB8fCBcIlwiKTtcclxuXHRcdFx0XHRMb2NhdGlvbkZhY3RvcnkuZ2V0TG9jYXRpb25zKHNlYXJjaFN0cmluZywgdHJ1ZSwgJHNjb3BlLmRpdmlzaW9uSWQsICRzY29wZS5wYXNzZW5nZXJJZCwgdHJ1ZSkudGhlbihmdW5jdGlvbiAobG9jYXRpb25zKSB7XHJcblx0XHRcdFx0XHQvLyBjb252ZXJ0IEdvb2dsZSBsb2NhdGlvbiBzZWFyY2ggdG8gT25lTVYgTG9jYXRpb24gb2JqZWN0XHJcblx0XHRcdFx0XHRmb3IgKHZhciBsID0gMDsgbCA8IGxvY2F0aW9ucy5kYXRhLmxlbmd0aDsgbCsrKSB7XHJcblx0XHRcdFx0XHRcdHZhciBhZGRyZXNzID0gbG9jYXRpb25zLmRhdGFbbF0ubG9jO1xyXG5cdFx0XHRcdFx0XHR2YXIgbG9jYXRpb24gPSB7fTtcclxuXHRcdFx0XHRcdFx0dmFyIGFkZCA9IFwiXCIsIHN0cmVldE51bWJlciA9IFwiXCIsIHN0cmVldE5hbWUgPSBcIlwiO1xyXG5cdFx0XHRcdFx0XHRmb3IgKHZhciBpIGluIGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzKSB7XHJcblx0XHRcdFx0XHRcdFx0dmFyIGFkZHJlc3NDb21wb25lbnQgPSBhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXTtcclxuXHRcdFx0XHRcdFx0XHRpZiAoYWRkcmVzc0NvbXBvbmVudC50eXBlc1swXSA9PSBcInN0cmVldF9udW1iZXJcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0c3RyZWV0TnVtYmVyID0gYWRkcmVzc0NvbXBvbmVudC5zaG9ydF9uYW1lO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChhZGRyZXNzQ29tcG9uZW50LnR5cGVzWzBdID09IFwicm91dGVcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0c3RyZWV0TmFtZSA9IGFkZHJlc3NDb21wb25lbnQuc2hvcnRfbmFtZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAoYWRkcmVzc0NvbXBvbmVudC50eXBlc1swXSA9PSBcImxvY2FsaXR5XCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGxvY2F0aW9uLkNpdHkgPSBhZGRyZXNzQ29tcG9uZW50LnNob3J0X25hbWU7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGFkZHJlc3NDb21wb25lbnQudHlwZXNbMF0gPT0gXCJhZG1pbmlzdHJhdGl2ZV9hcmVhX2xldmVsXzFcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0bG9jYXRpb24uU3RhdGUgPSBhZGRyZXNzQ29tcG9uZW50LnNob3J0X25hbWU7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGFkZHJlc3NDb21wb25lbnQudHlwZXNbMF0gPT0gXCJwb3N0YWxfY29kZVwiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRsb2NhdGlvbi5aaXAgPSBhZGRyZXNzQ29tcG9uZW50LnNob3J0X25hbWU7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly9kbyBub3RoaW5nXHJcblx0XHRcdFx0XHRcdFx0XHR2YXIgdCA9IGFkZHJlc3NDb21wb25lbnQ7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGxvY2F0aW9uLkFkZHJlc3MgPSBzdHJlZXROdW1iZXIgKyAnICcgKyBzdHJlZXROYW1lXHJcblx0XHRcdFx0XHRcdGxvY2F0aW9uLk5hbWUgPSBhZGRyZXNzLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG5cdFx0XHRcdFx0XHRsb2NhdGlvbi5MYXRpdHVkZSA9IGFkZHJlc3MuZ2VvbWV0cnkubG9jYXRpb24ubGF0O1xyXG5cdFx0XHRcdFx0XHRsb2NhdGlvbi5Mb25naXR1ZGUgPSBhZGRyZXNzLmdlb21ldHJ5LmxvY2F0aW9uLmxuZztcclxuXHRcdFx0XHRcdFx0bG9jYXRpb24uR29vZ2xlUGxhY2VJZCA9IGFkZHJlc3MucGxhY2VfaWQ7XHJcblxyXG5cdFx0XHRcdFx0XHQkc2NvcGUuZ29vZ2xlTG9jYXRpb25zLnB1c2gobG9jYXRpb24pO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGlmICgkc2NvcGUuZ29vZ2xlTG9jYXRpb25zLmxlbmd0aCA9PSAwKSB7XHJcblx0XHRcdFx0XHRcdEFkZHJlc3NOb3RGb3VuZCgpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0JHNjb3BlLmhhc0hvbWVBZGRyZXNzID0gdHJ1ZTsgLy9hc3N1bWUgdXNlciB3aWxsIGNob29zZSBhIGhvbWUgYWRkcmVzc1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHRcdEFkZHJlc3NOb3RGb3VuZCgpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gdXNlciBtZXNzYWdlIGlmIG5vIGFkZHJlc3NlcyBhcmUgZm91bmRcclxuXHRcdFx0ZnVuY3Rpb24gQWRkcmVzc05vdEZvdW5kKCkge1xyXG5cdFx0XHRcdFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0ZpbmQgSG9tZSBBZGRyZXNzJywgXCJIb21lIGxvY2F0aW9uIG5vdCBmb3VuZC4gUGxlYXNlIGNoYW5nZSBhZGRyZXNzIGFuZCB0cnkgYWdhaW4uXCIpXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIHVwZGF0ZSBob21lIGFkZHJlc3NcclxuXHRcdFx0JHNjb3BlLlVwZGF0ZUhvbWVBZGRyZXNzID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFByb2ZpbGVTZXJ2aWNlLlVwZGF0ZUhvbWVBZGRyZXNzKCRzY29wZS5wYXNzZW5nZXJJZCwgJHNjb3BlLkhvbWVBZGRyZXNzKVxyXG5cdFx0XHRcdFx0LnRoZW4oXHJcblx0XHRcdFx0XHRmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdFx0XHRcdFx0dmFyIG1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuXHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuXHRcdFx0XHRcdFx0XHQkc2NvcGUuc3VibWl0dGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0XHRVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoJ1N1Y2Nlc3MnLCBtZXNzYWdlKTtcclxuXHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGlmICgkc2NvcGUuaGFzTW9kYWxQYXJlbnQpIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0JHVpYk1vZGFsU3RhY2suZGlzbWlzc0FsbCgpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRcdFx0JHdpbmRvdy5oaXN0b3J5LmJhY2soKTtcclxuXHRcdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHR9LCAwKTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHRVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIG1lc3NhZ2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9LFxyXG5cdFx0XHRcdFx0ZnVuY3Rpb24gKGVycikge1xyXG5cdFx0XHRcdFx0XHR2YXIgbWVzc2FnZSA9IGVyci5kYXRhLlJlc3VsdDtcclxuXHRcdFx0XHRcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBtZXNzYWdlKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0dmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdC8vIGRldGVybWluZSBpZiBob21lIGxvY2F0aW9uIHNob3VsZCBiZSBkaXNwbGF5ZWRcclxuXHRcdFx0ICAgICRzY29wZS5zaG93SG9tZUFkZHJlc3MgPSBQcm9maWxlU2VydmljZS5TaG93SG9tZUFkZHJlc3MoKTtcclxuXHRcdFx0ICAgIGlmICgkc2NvcGUuc2hvd0hvbWVBZGRyZXNzKSB7XHJcblx0XHRcdFx0XHQvLyBkZXRlcm1pbmUgaWYgcGFzc2VuZ2VyIG1heSBlZGl0IGhvbWUgbG9jYXRpb25cclxuXHRcdFx0XHRcdCRzY29wZS5hbGxvd0VkaXRIb21lQWRkcmVzcyA9IFByb2ZpbGVTZXJ2aWNlLkFsbG93RWRpdEhvbWVBZGRyZXNzKCk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0ICAgIC8vIHJlYWQgY3VycmVudCBwYXNzZW5nZXIgaG9tZSBhZGRyZXNzIGlmIG5vdCBpbiB0aGUgUHJvZmlsZSBwYWdlXHJcblx0XHRcdFx0aWYgKCEkc2NvcGUuaXNDb250YWluZXJNYW5hZ2luZ0RhdGEpIHtcclxuXHRcdFx0XHQgICAgUHJvZmlsZVNlcnZpY2UuR2V0SG9tZUFkZHJlc3MoJHNjb3BlLnBhc3NlbmdlcklkKVxyXG5cdFx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblx0XHRcdFx0XHQgICAgJHNjb3BlLkhvbWVBZGRyZXNzID0gcmVzcG9uc2UgPT0gbnVsbCA/IHt9IDogcmVzcG9uc2U7XHJcblx0XHRcdFx0XHQgICAgJHNjb3BlLmludmFsaWQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdH0sXHJcblx0XHRcdFx0XHRmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0XHQgICAgJHNjb3BlLmVycm9yID0gZXJyLmVycm9yX2Rlc2NyaXB0aW9uO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fSBcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8vIHVwZGF0ZSB0aGUgU3VpdGUgc2VwYXJhdGVseVxyXG5cdFx0XHQkc2NvcGUuaXNVcGRhdGluZ1N1aXRlID0gZmFsc2U7XHJcblx0XHRcdCRzY29wZS4kd2F0Y2goXHJcblx0XHRcdFwiSG9tZUFkZHJlc3NTZWFyY2guU3VpdGVcIixcclxuXHRcdFx0ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdCRzY29wZS5pc1VwZGF0aW5nU3VpdGUgPSB0cnVlO1xyXG5cdFx0XHRcdCRzY29wZS5Ib21lQWRkcmVzcy5TdWl0ZSA9ICRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaC5TdWl0ZTtcclxuXHRcdFx0fSwgdHJ1ZSk7XHJcblxyXG5cdFx0XHQvLyBIb21lQWRkcmVzcyBpcyBsb2FkZWQgZWl0aGVyIGZyb20gdGhlIGNvbnRhaW5pbmcgcGFnZSwgb3IgZnJvbSB0aGlzIGNvbnRyb2xcclxuXHRcdFx0JHNjb3BlLiR3YXRjaChcclxuXHRcdFx0XCJIb21lQWRkcmVzc1wiLCBcclxuICAgICAgICAgICAgXHJcblx0XHRcdGZ1bmN0aW9uIChzb3VyY2UsIGRhdGEpIHtcclxuXHRcdFx0ICAgIGlmICgkc2NvcGUuaXNVcGRhdGluZ1N1aXRlID09IHRydWUpIHtcclxuXHRcdFx0ICAgICAgICAkc2NvcGUuaXNVcGRhdGluZ1N1aXRlID0gZmFsc2U7XHJcblx0XHRcdCAgICB9XHJcblx0XHRcdCAgICAkc2NvcGUuaGFzSG9tZUFkZHJlc3MgPSBmYWxzZTtcclxuXHRcdFx0ICAgICRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaCA9IHt9O1xyXG5cdFx0XHQgICAgaWYgKCRzY29wZS5Ib21lQWRkcmVzcykge1xyXG5cdFx0XHQgICAgICAgICRzY29wZS5oYXNIb21lQWRkcmVzcyA9ICRzY29wZS5Ib21lQWRkcmVzcy5Hb29nbGVQbGFjZUlkO1xyXG5cdFx0XHQgICAgICAgICRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaCA9IGFuZ3VsYXIuY29weSgkc2NvcGUuSG9tZUFkZHJlc3MpO1xyXG5cdFx0XHQgICAgICAgIGlmICgkc2NvcGUuSG9tZUFkZHJlc3MgJiYgJHNjb3BlLkhvbWVBZGRyZXNzLkdvb2dsZVBsYWNlSWQpIHtcclxuXHRcdFx0ICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBnbG9iYWxzXHJcblx0XHRcdCAgICAgICAgICAgICRzY29wZS5nb29nbGVMb2NhdGlvbnMgPSBbXTtcclxuXHJcblx0XHRcdCAgICAgICAgICAgIC8vIGxvYWQgYW5kIHNlbGVjdCB0aGUgY3VycmVudCBob21lIGFkZHJlc3MsIGlmIGFueVxyXG5cdFx0XHQgICAgICAgICAgICBpZiAoJHNjb3BlLkhvbWVBZGRyZXNzICYmICRzY29wZS5Ib21lQWRkcmVzcy5Hb29nbGVQbGFjZUlkICYmICRzY29wZS5Ib21lQWRkcmVzcy5Hb29nbGVQbGFjZUlkICE9IFwiXCIpIHtcclxuXHRcdFx0ICAgICAgICAgICAgICAgICRzY29wZS5nb29nbGVMb2NhdGlvbnMucHVzaCgkc2NvcGUuSG9tZUFkZHJlc3MpO1xyXG5cdFx0XHQgICAgICAgICAgICAgICAgJHNjb3BlLmludmFsaWQgPSBmYWxzZTtcclxuXHRcdFx0ICAgICAgICAgICAgfVxyXG5cclxuXHRcdFx0ICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcclxuXHRcdFx0ICAgICAgICB9XHJcblx0XHRcdCAgICB9XHJcblx0XHRcdFx0XHJcblx0XHRcdH0sIHRydWUpO1xyXG5cclxuXHRcdFx0XHJcblx0XHQgICAgLy9cclxuXHRcdCAgICAvLyAkb25Jbml0IGRvZXMgbm90IHdvcmsgaW4gSW9uaWMgd29ybGQuXHJcblx0XHQgICAgLy8gbXVzdCBleGVjdXRlIGFjdGl2YXRlKCkgb3RoZXJ3aXNlLCBhZGQgZnVuY3Rpb24gdG8gJG9uSW5pdC5cclxuXHRcdCAgICAvL1xyXG5cdFx0XHRpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdpcy1pb25pYycpKSB7XHJcblx0XHRcdCAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcblx0XHRcdCAgICAgICAgYWN0aXZhdGUoKTtcclxuXHRcdFx0ICAgIH0pXHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdCAgICB0aGlzLiRvbkluaXQgPSBhY3RpdmF0ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cdGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgUHJvZmlsZUNvbnRyb2xsZXIpO1xyXG5cclxuXHRQcm9maWxlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJHdpbmRvdycsICdEaXZpc2lvblNlcnZpY2UnLCAnTG9jYXRpb25GYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJywgJ1Byb2ZpbGVTZXJ2aWNlJywgJ0NvbW1vblNlcnZpY2UnLCAnVXRpbGl0eUZhY3RvcnknLCAnTG9jYXRpb25TZXJ2aWNlJywgJ01lc3NhZ2VTZXJ2aWNlJywgJ1JlZGlyZWN0aW9uU2VydmljZScsJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG5cdGZ1bmN0aW9uIFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkd2luZG93LCBEaXZpc2lvblNlcnZpY2UsIExvY2F0aW9uRmFjdG9yeSwgYXV0aFNlcnZpY2UsIFByb2ZpbGVTZXJ2aWNlLCBDb21tb25TZXJ2aWNlLCBVdGlsaXR5RmFjdG9yeSwgTG9jYXRpb25TZXJ2aWNlLCBNZXNzYWdlU2VydmljZSwgUmVkaXJlY3Rpb25TZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG5cdFx0Ly8gaW5pdGlhbGl6ZSBnbG9iYWxzXHJcblx0XHR2YXIgdm0gPSB0aGlzO1xyXG5cdFx0dm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnUHJvZmlsZScpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdMYXRlc3QgU2VydmljZSBVcGRhdGVzJyk7XHJcblx0XHR2bS5sb2FkaW5nID0gdHJ1ZTtcclxuXHRcdHZtLmludmFsaWQgPSB0cnVlO1xyXG5cdFx0dm0ucGFzc2VuZ2VyID0ge307XHJcblx0XHR2bS5wYXNzZW5nZXIuSG9tZUFkZHJlc3MgPSB7fTtcclxuXHRcdHZtLnBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcblx0XHR2bS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuXHRcdHZtLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG5cclxuXHRcdC8vIHVwZGF0ZSBwcm9maWxlXHJcblx0XHR2bS5DYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdCR3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHZtLlVwZGF0ZVByb2ZpbGUgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdC8vIHVwZGF0ZSBob21lIGFkZHJlc3NcclxuXHRcdFx0UHJvZmlsZVNlcnZpY2UuVXBkYXRlUHJvZmlsZSh2bS5wYXNzZW5nZXIpXHJcbiAgICAgICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgXHR2YXIgbWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgXHRpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgXHRcdHZtLnN1Ym1pdHRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKCdTdWNjZXNzJywgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBcdFx0XHQkd2luZG93Lmhpc3RvcnkuYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgXHRcdH0sIDApO1xyXG4gICAgICAgICAgICAgICAgXHR9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgXHRcdFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBcdHZhciBtZXNzYWdlID0gZXJyLmRhdGEuUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgXHRVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHZhciBhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0aWYgKCFhdXRoU2VydmljZS5pc0xvZ2dlZEluKCkpIHtcclxuXHRcdFx0XHRSZWRpcmVjdGlvblNlcnZpY2Uuc2F2ZSgnL3NoYXJlZC9wcm9maWxlJyk7XHJcblx0XHRcdFx0JGxvY2F0aW9uLnBhdGgoJ2xvZ2luJyk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0dm0uc2hvd0hvbWVBZGRyZXNzID0gUHJvZmlsZVNlcnZpY2UuU2hvd0hvbWVBZGRyZXNzKCk7XHJcblx0XHRcdFx0aWYgKHZtLnNob3dIb21lQWRkcmVzcykge1xyXG5cdFx0XHRcdFx0Ly8gZGV0ZXJtaW5lIGlmIHBhc3NlbmdlciBtYXkgZWRpdCBob21lIGxvY2F0aW9uXHJcblx0XHRcdFx0ICAgIHZtLmFsbG93RWRpdEhvbWVBZGRyZXNzID0gUHJvZmlsZVNlcnZpY2UuQWxsb3dFZGl0SG9tZUFkZHJlc3MoKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIHJlYWQgY3VycmVudCBwYXNzZW5nZXIgcHJvZmlsZSBpbmZvXHJcblx0XHRcdFx0UHJvZmlsZVNlcnZpY2UuR2V0UHJvZmlsZSh2bS5wYXNzZW5nZXJJZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdFx0XHQgICAgdm0ucGFzc2VuZ2VyID0gcmVzcG9uc2U7XHJcblx0XHRcdFx0ICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0XHR2bS5lcnJvciA9IGVyci5lcnJvcl9kZXNjcmlwdGlvbjtcclxuXHRcdFx0XHRcdHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHQgICAgLy9cclxuXHQgICAgLy8gJG9uSW5pdCBkb2VzIG5vdCB3b3JrIGluIElvbmljIHdvcmxkLlxyXG5cdCAgICAvLyBtdXN0IGV4ZWN1dGUgYWN0aXZhdGUoKSBvdGhlcndpc2UsIGFkZCBmdW5jdGlvbiB0byAkb25Jbml0LlxyXG5cdCAgICAvL1xyXG5cdFx0aWYgKCQoJ2JvZHknKS5oYXNDbGFzcygnaXMtaW9uaWMnKSkge1xyXG5cdFx0ICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuXHRcdCAgICAgICAgYWN0aXZhdGUoKTtcclxuXHRcdCAgICB9KVxyXG5cdFx0fSBlbHNlIHtcclxuXHRcdCAgICB2bS4kb25Jbml0ID0gYWN0aXZhdGU7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHRcdHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3Byb2ZpbGUvcHJvZmlsZS5odG1sJztcclxuXHRcdHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXByb2ZpbGUgY2FyZCc7XHJcblx0XHR2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuXHRcdHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcblx0XHQvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHR9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdEaXNwbGF5UHVzaE1lc3NhZ2VDb250cm9sbGVyJywgRGlzcGxheVB1c2hNZXNzYWdlQ29udHJvbGxlcik7XHJcblxyXG4gICAgRGlzcGxheVB1c2hNZXNzYWdlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsJ21lc3NhZ2VUaXRsZScsJ21lc3NhZ2VCb2R5JywnbWVzc2FnZVR5cGUnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEaXNwbGF5UHVzaE1lc3NhZ2VDb250cm9sbGVyKCR1aWJNb2RhbEluc3RhbmNlLCBtZXNzYWdlVGl0bGUsIG1lc3NhZ2VCb2R5LCBtZXNzYWdlVHlwZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0ubWVzc2FnZVR5cGUgPSBtZXNzYWdlVHlwZTtcclxuICAgICAgICB2bS5tZXNzYWdlVGl0bGUgPSBtZXNzYWdlVGl0bGU7XHJcbiAgICAgICAgdm0ubWVzc2FnZUJvZHkgPSBtZXNzYWdlQm9keTtcclxuICAgICAgICBjb25zb2xlLmxvZygnbW9kYWwnLCB2bSk7XHJcbiAgICAgICAgdm0uY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHsgJ3Jlc3VsdCc6ICdvaycgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignRXh0ZXJuYWxSZWdpc3RyYXRpb25Db250cm9sbGVyJywgRXh0ZXJuYWxSZWdpc3RyYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBFeHRlcm5hbFJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyR0aW1lb3V0JywgJyRyb290U2NvcGUnLCAndmNSZWNhcHRjaGFTZXJ2aWNlJyxcclxuICAgICAgICAnYXV0aFNlcnZpY2UnLCAnVmVyaWZpY2F0aW9uU2VydmljZScsICdlbnYnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0NvbmZpZ0ZhY3RvcnknLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRXh0ZXJuYWxSZWdpc3RyYXRpb25Db250cm9sbGVyKCRsb2NhdGlvbiwgJHRpbWVvdXQsICRyb290U2NvcGUsIHZjUmVjYXB0Y2hhU2VydmljZSwgYXV0aFNlcnZpY2UsXHJcbiAgICAgICAgVmVyaWZpY2F0aW9uU2VydmljZSwgZW52LCBEaXZpc2lvblNlcnZpY2UsIENvbmZpZ0ZhY3RvcnksIFJlZGlyZWN0aW9uU2VydmljZSwgUGFnZVNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyIHdpZGdldElkID0gLTE7XHJcbiAgICAgICAgdm0uY2FwdGNoYVB1YmxpY0tleSA9IGVudi5jYXB0Y2hhUHVibGljS2V5O1xyXG4gICAgICAgIHZtLldpZGdldENyZWF0ZSA9IHdpZGdldENyZWF0ZTtcclxuICAgICAgICB2bS5zZXRDYXB0Y2hhUmVzcG9uc2UgPSBzZXRDYXB0Y2hhUmVzcG9uc2U7XHJcblxyXG4gICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNhdmVkU3VjY2Vzc2Z1bGx5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLm9yZ2FuaXNhdGlvbklkTGFiZWwgPSAnJztcclxuICAgICAgICB2bS5zaG93T3JnYW5pc2F0aW9uSWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93QWxsb3dTbXMgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93Rmlyc3ROYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0xhc3ROYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0NsaWVudFRlbGVwaG9uZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmFsbG93U21zID0gZmFsc2U7XHJcbiAgICAgICAgdm0udGVsTnVtID0gJyc7XHJcbiAgICAgICAgdm0uY2xpZW50UGFzc2VuZ2VySWQgPSAnJztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdOZXcgQWNjb3VudCcpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdDcmVhdGUgYSBPTkVNViBMb2dpbicpO1xyXG5cclxuICAgICAgICB2YXIgZmVlZFR5cGUgPSAnJztcclxuICAgICAgICB2YXIgcmVnaXN0cmF0aW9uRmFpbGVkTXNnID0gXCJGYWlsZWQgdG8gcmVnaXN0ZXIuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCI7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldENhcHRjaGFSZXNwb25zZShyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBhdXRoU2VydmljZS52ZXJpZnlDYXB0Y2hhKHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgdmNSZWNhcHRjaGFTZXJ2aWNlLnJlbG9hZCh3aWRnZXRJZCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2lkZ2V0Q3JlYXRlKF93aWRnZXRJZCkge1xyXG4gICAgICAgICAgICB3aWRnZXRJZCA9IF93aWRnZXRJZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG5cclxuICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSW5mbygpXHJcbiAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBmZWVkVHlwZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uRmVlZFR5cGUuRmVlZFR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZtLnJlZ2lzdGVyRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLnVzZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgcHJvdmlkZXI6IGF1dGhTZXJ2aWNlLmV4dGVybmFsQXV0aERhdGEucHJvdmlkZXIsXHJcbiAgICAgICAgICAgICAgICBleHRlcm5hbEFjY2Vzc1Rva2VuOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLmV4dGVybmFsQWNjZXNzVG9rZW4sICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25JZDogZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YS5maXJzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICBsYXN0TmFtZTogYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YS5sYXN0TmFtZVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdm0uZmlyc3ROYW1lID0gdm0ucmVnaXN0ZXJEYXRhLmZpcnN0TmFtZTtcclxuICAgICAgICAgICAgdm0ubGFzdE5hbWUgPSB2bS5yZWdpc3RlckRhdGEubGFzdE5hbWU7XHJcbiAgICAgICAgICAgIHZtLnByb3ZpZGVyID0gdm0ucmVnaXN0ZXJEYXRhLnByb3ZpZGVyO1xyXG5cclxuICAgICAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUodm0ucHJvdmlkZXIgKycgU2lnbiBVcCcpO1xyXG5cclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeVxyXG4gICAgICAgICAgICAgICAgLmdldERpdmlzaW9uUGFyYW1ldGVycyhkaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ub3JnYW5pc2F0aW9uSWRMYWJlbCA9IHBhcmFtcy5PcmdhbmlzYXRpb25JZExhYmVsID8gcGFyYW1zLk9yZ2FuaXNhdGlvbklkTGFiZWwgOiAnQ2xpZW50IFBhc3NlbmdlciBJZCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dPcmdhbmlzYXRpb25JZCA9IHBhcmFtcy5TaG93T3JnYW5pc2F0aW9uSWQgPyBldmFsKHBhcmFtcy5TaG93T3JnYW5pc2F0aW9uSWQudG9Mb3dlckNhc2UoKSk6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93QWxsb3dTbXMgPSBwYXJhbXMuU2hvd0FsbG93U21zID8gZXZhbChwYXJhbXMuU2hvd0FsbG93U21zLnRvTG93ZXJDYXNlKCkpOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0ZpcnN0TmFtZSA9IHBhcmFtcy5TaG93Rmlyc3ROYW1lID8gZXZhbChwYXJhbXMuU2hvd0ZpcnN0TmFtZS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93TGFzdE5hbWUgPSBwYXJhbXMuU2hvd0xhc3ROYW1lID8gZXZhbChwYXJhbXMuU2hvd0xhc3ROYW1lLnRvTG93ZXJDYXNlKCkpIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0NsaWVudFRlbGVwaG9uZSA9IHBhcmFtcy5TaG93Q2xpZW50VGVsZXBob25lID8gZXZhbChwYXJhbXMuU2hvd0NsaWVudFRlbGVwaG9uZS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBSZWRpcmVjdGlvblNlcnZpY2UucmVkaXJlY3RUbygnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucmVnaXN0ZXJFeHRlcm5hbCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcclxuICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gdHJ1ZTsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIFZlcmlmaWNhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgLnBhc3NlbmdlckV4aXN0cyh2bS5jbGllbnRQYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzICE9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gcmVnaXN0cmF0aW9uRmFpbGVkTXNnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICBpZiAoZmVlZFR5cGUgPT0gJ0ZlZWRPbmx5JyAmJiAhcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAvL2Nhbid0IHJlZ2lzdGVyIGFzIHBhc3NlbmdlciBub3QgZm91bmQgZm9yIGRpdmlzaW9uIHRoYXQgaXMgZmVlZCBvbmx5L1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBcIlBhc3NlbmdlciBub3QgZm91bmQuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGRpdmlzaW9uU3VwcG9ydHNGZWVkKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgbW9iaWxlTm8gPSB2bS50ZWxOdW07XHJcbiAgICAgICAgICAgIGlmIChtb2JpbGVObyAmJiBtb2JpbGVObyAhPSAnJylcclxuICAgICAgICAgICAgICAgIG1vYmlsZU5vID0gXCIrMVwiICsgbW9iaWxlTm87XHJcbiAgICAgICAgICBcclxuICAgICAgICAgICAgdm0ucmVnaXN0ZXJEYXRhLnRlbGVwaG9uZU51bWJlciA9IG1vYmlsZU5vO1xyXG4gICAgICAgICAgICB2bS5yZWdpc3RlckRhdGEuYWxsb3dTbXMgPSB2bS5hbGxvd1NtcztcclxuICAgICAgICAgICAgdm0ucmVnaXN0ZXJEYXRhLmRpdmlzaW9uU3VwcG9ydHNGZWVkID0gZGl2aXNpb25TdXBwb3J0c0ZlZWQ7XHJcbiAgICAgICAgICAgIHZtLnJlZ2lzdGVyRGF0YS5jbGllbnRQYXNzZW5nZXJJZCA9IHZtLmNsaWVudFBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICB2bS5yZWdpc3RlckRhdGEuZmlyc3ROYW1lID0gdm0uZmlyc3ROYW1lO1xyXG4gICAgICAgICAgICB2bS5yZWdpc3RlckRhdGEubGFzdE5hbWUgPSB2bS5sYXN0TmFtZTtcclxuXHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnJlZ2lzdGVyRXh0ZXJuYWwodm0ucmVnaXN0ZXJEYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2F2ZWRTdWNjZXNzZnVsbHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lcigpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBlcnJvci5NZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2Y1JlY2FwdGNoYVNlcnZpY2UucmVsb2FkKHdpZGdldElkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciBzdGFydFRpbWVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdGltZXIgPSAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZXIpO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2dnZWRJbicsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgUmVkaXJlY3Rpb25TZXJ2aWNlLnJlZGlyZWN0KCk7XHJcbiAgICAgICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL3NoYXJlZC9yZWdpc3RyYXRpb24vZXh0ZXJuYWwtcmVnaXN0cmF0aW9uLmh0bWwnO1xyXG4gICAgICAgIC8vVE9ETyBLZXZpbi4gUGxlYXNlIGFkZCBjb3JyZWN0IGN1c3RvbSBjbGFzcyBuYW1lLlxyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXRlbXBsYXRlLWV4dGVybmFsLXJlZ2lzdHJhdGlvbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93UmVjYXB0Y2hhID0gIWVudi5pc0lvbmljO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ09uZU1WUmVnaXN0cmF0aW9uQ29udHJvbGxlcicsIE9uZU1WUmVnaXN0cmF0aW9uQ29udHJvbGxlcik7XHJcblxyXG4gICAgT25lTVZSZWdpc3RyYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckc2NvcGUnLCAnJHJvb3RTY29wZScsXHJcbiAgICAgICAgJ2F1dGhTZXJ2aWNlJywgJ2VudicsICdNZXNzYWdlU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnQ29uZmlnRmFjdG9yeScsICd2Y1JlY2FwdGNoYVNlcnZpY2UnLCdWZXJpZmljYXRpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gT25lTVZSZWdpc3RyYXRpb25Db250cm9sbGVyKCRsb2NhdGlvbiwgJHNjb3BlLCAkcm9vdFNjb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UsIGVudiwgTWVzc2FnZVNlcnZpY2UsIERpdmlzaW9uU2VydmljZSwgQ29uZmlnRmFjdG9yeSwgdmNSZWNhcHRjaGFTZXJ2aWNlLCBWZXJpZmljYXRpb25TZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIHZtLnJlZ2lzdGVyID0gcmVnaXN0ZXI7ICAgICAgICBcclxuICAgICAgICB2bS5jYXB0Y2hhUHVibGljS2V5ID0gZW52LmNhcHRjaGFQdWJsaWNLZXk7XHJcbiAgICAgICAgdm0uV2lkZ2V0Q3JlYXRlID0gd2lkZ2V0Q3JlYXRlO1xyXG4gICAgICAgIHZtLnNldENhcHRjaGFSZXNwb25zZSA9IHNldENhcHRjaGFSZXNwb25zZTtcclxuICAgICAgICB2bS5tZXNzYWdlID0gJyc7ICAgICAgICBcclxuICAgICAgICB2bS5vcmdhbmlzYXRpb25JZExhYmVsID0gJyc7XHJcbiAgICAgICAgdm0uc2hvd09yZ2FuaXNhdGlvbklkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0FsbG93U21zID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0ZpcnN0TmFtZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dMYXN0TmFtZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dDbGllbnRUZWxlcGhvbmUgPSBmYWxzZTtcclxuICAgICAgICB2YXIgd2lkZ2V0SWQgPSAtMTtcclxuICAgICAgICB2YXIgZGl2aXNpb25JZCA9IC0xO1xyXG4gICAgICAgIHZhciBmZWVkVHlwZSA9ICcnO1xyXG4gICAgICAgIHZtLmNsaWVudFBhc3NlbmdlcklkID0gJyc7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnTmV3IEFjY291bnQnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnQ3JlYXRlIGEgT05FTVYgTG9naW4nKTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpe1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBzZXRDYXB0Y2hhUmVzcG9uc2UocmVzcG9uc2Upe1xyXG4gICAgICAgICAgICBhdXRoU2VydmljZS52ZXJpZnlDYXB0Y2hhKHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmKCFyZXN1bHQuc3VjY2VzcylcclxuICAgICAgICAgICAgICAgICAgICB2Y1JlY2FwdGNoYVNlcnZpY2UucmVsb2FkKHdpZGdldElkKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdpZGdldENyZWF0ZShfd2lkZ2V0SWQpe1xyXG4gICAgICAgICAgICB3aWRnZXRJZCA9IF93aWRnZXRJZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKCkge1xyXG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XHJcbiAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFZlcmlmaWNhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgLnBhc3NlbmdlckV4aXN0cyh2bS5jbGllbnRQYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgIT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBcIkZhaWxlZCB0byByZWdpc3Rlci4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgaWYgKGZlZWRUeXBlID09ICdGZWVkT25seScgJiYgIXJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgLy9jYW4ndCByZWdpc3RlciBhcyBwYXNzZW5nZXIgbm90IGZvdW5kIGZvciBkaXZpc2lvbiB0aGF0IGlzIGZlZWQgb25seS9cclxuICAgICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gXCJQYXNzZW5nZXIgbm90IGZvdW5kLlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyVXNlcihyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgIH0pOyAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyVXNlcihkaXZpc2lvblN1cHBvcnRzRmVlZCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIG1vYmlsZU5vID0gdm0ucGhvbmVOdW1iZXI7XHJcbiAgICAgICAgICAgIGlmIChtb2JpbGVObyAmJiBtb2JpbGVObyAhPSAnJylcclxuICAgICAgICAgICAgICAgIG1vYmlsZU5vID0gXCIrMVwiICsgbW9iaWxlTm87XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVnaXN0cmF0aW9uT2JqZWN0ID0ge1xyXG4gICAgICAgICAgICAgICAgVGVsZXBob25lTnVtYmVyOiBtb2JpbGVObyxcclxuICAgICAgICAgICAgICAgIEFsbG93U01TOiB2bS5zZW5kU01TLFxyXG4gICAgICAgICAgICAgICAgVXNlck5hbWU6IHZtLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgUGFzc3dvcmQ6IHZtLnBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgQ29uZmlybVBhc3N3b3JkOiB2bS5jb25maXJtUGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBDbGllbnRQYXNzZW5nZXJJZDogdm0uY2xpZW50UGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICBEaXZpc2lvbklkOiBkaXZpc2lvbklkLFxyXG4gICAgICAgICAgICAgICAgRmlyc3ROYW1lOiB2bS5maXJzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICBMYXN0TmFtZTogdm0ubGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICBQcm92aWRlcjogJ012TG9naW4nLFxyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25TdXBwb3J0c0ZlZWQ6IGRpdmlzaW9uU3VwcG9ydHNGZWVkXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnJlZ2lzdGVyT25lTVYocmVnaXN0cmF0aW9uT2JqZWN0KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2VkSW4nLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBlcnJvci5NZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAod2lkZ2V0SWQgIT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2Y1JlY2FwdGNoYVNlcnZpY2UucmVsb2FkKHdpZGdldElkKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcblxyXG4gICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuXHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JbmZvKClcclxuICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICBmZWVkVHlwZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uRmVlZFR5cGUuRmVlZFR5cGU7XHJcbiAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0RGl2aXNpb25QYXJhbWV0ZXJzKGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgdm0ub3JnYW5pc2F0aW9uSWRMYWJlbCA9IHBhcmFtcy5PcmdhbmlzYXRpb25JZExhYmVsID8gcGFyYW1zLk9yZ2FuaXNhdGlvbklkTGFiZWwgOiAnUGFzc2VuZ2VyIElkJztcclxuICAgICAgICAgICAgICAgIHZtLnNob3dPcmdhbmlzYXRpb25JZCA9IHBhcmFtcy5TaG93T3JnYW5pc2F0aW9uSWQgPyBldmFsKHBhcmFtcy5TaG93T3JnYW5pc2F0aW9uSWQudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNob3dBbGxvd1NtcyA9IHBhcmFtcy5TaG93QWxsb3dTbXMgPyBldmFsKHBhcmFtcy5TaG93QWxsb3dTbXMudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNob3dGaXJzdE5hbWUgPSBwYXJhbXMuU2hvd0ZpcnN0TmFtZSA/IGV2YWwocGFyYW1zLlNob3dGaXJzdE5hbWUudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnNob3dMYXN0TmFtZSA9IHBhcmFtcy5TaG93TGFzdE5hbWUgPyBldmFsKHBhcmFtcy5TaG93TGFzdE5hbWUudG9Mb3dlckNhc2UoKSkgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0NsaWVudFRlbGVwaG9uZSA9IHBhcmFtcy5TaG93Q2xpZW50VGVsZXBob25lID8gZXZhbChwYXJhbXMuU2hvd0NsaWVudFRlbGVwaG9uZS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9uSGFzRmVlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9zaGFyZWQvcmVnaXN0cmF0aW9uL29uZW12LXJlZ2lzdHJhdGlvbi5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICcnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd1JlY2FwdGNoYSA9ICFlbnYuaXNJb25pYztcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcblxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignU2V0dGluZ3NDb250cm9sbGVyJywgU2V0dGluZ3NDb250cm9sbGVyKTtcclxuXHJcbiAgICBTZXR0aW5nc0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHJvb3RTY29wZScsICdTZXR0aW5nc1NlcnZpY2UnLCAnYXV0aFNlcnZpY2UnLCAnVXRpbGl0eUZhY3RvcnknLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXR0aW5nc0NvbnRyb2xsZXIoJHJvb3RTY29wZSwgU2V0dGluZ3NTZXJ2aWNlLCBhdXRoU2VydmljZSwgVXRpbGl0eUZhY3RvcnksIFBhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5pc1NldHRpbmdzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlzU2V0dGluZ3NMb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5pc1NldHRpbmdzVXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5zZXR0aW5ncyA9IG51bGw7XHJcbiAgICAgICAgdm0udXBkYXRlU2V0dGluZ3MgPSB1cGRhdGVTZXR0aW5ncztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdTZXR0aW5ncycpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdNYW5hZ2UgQXBwIFNldHRpbmdzJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGdldFNldHRpbmdzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNldHRpbmdzKCkge1xyXG4gICAgICAgICAgICB2bS5pc1NldHRpbmdzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmlzU2V0dGluZ3NMb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgU2V0dGluZ3NTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgIC5nZXRTZXR0aW5ncyhhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmxlbmd0aCA+IDEwKVxyXG4gICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXNwb25zZS5zdWJzdHJpbmcoKHJlc3BvbnNlLmxlbmd0aC0xMCkpO1xyXG4gICAgICAgICAgICAgICB2bS5jbGllbnRUZWxlcGhvbmUgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgICAgdm0uaXNTZXR0aW5nc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgdm0uaXNTZXR0aW5nc0xvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgIHZtLmlzU2V0dGluZ3NMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZXR0aW5ncygpIHtcclxuICAgICAgICAgICAgdm0uaXNTZXR0aW5nc1VwZGF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdmFyIG1vYmlsZU5vID0gdm0uY2xpZW50VGVsZXBob25lO1xyXG4gICAgICAgICAgICBpZiAobW9iaWxlTm8gIT0gXCJcIiAmJiAhaXNOYU4obW9iaWxlTm8pICYmIG1vYmlsZU5vID4gMCkge1xyXG4gICAgICAgICAgICAgICAgbW9iaWxlTm8gPSBcIisxXCIgKyBtb2JpbGVObztcclxuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcIlBhc3NlbmdlcklkXCI6IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiQ2xpZW50VGVsZXBob25lXCI6IG1vYmlsZU5vXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTZXR0aW5nc1NlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgIC51cGRhdGVTZXR0aW5ncyhzZXR0aW5ncylcclxuICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoJ1N1Y2Nlc3MnLCAnU2V0dGluZ3MgdXBkYXRlcyBzdWNlc3NmdWxseScpO1xyXG4gICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdDb3VsZCBub3QgdXBkYXRlIHNldHRpbmdzJyk7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICB2bS5pc1NldHRpbmdzVXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgIGdldFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAnQ291bGQgbm90IHVwZGF0ZSBzZXR0aW5ncycpO1xyXG4gICAgICAgICAgICAgICAgICAgdm0uaXNTZXR0aW5nc1VwZGF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICBnZXRTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlcicpO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNTZXR0aW5nc1VwZGF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL3NoYXJlZC9zZXR0aW5ncy9zZXR0aW5ncy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1zZXR0aW5ncyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljUHVsbGluZ1RleHQgPSAnUmVmcmVzaCBTZXR0aW5ncyc7XHJcbiAgICAgICAgdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nIFNldHRpbmdzJztcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLnJlZnJlc2ggPSBmdW5jdGlvbiAocmVmcmVzaGVyKSB7XHJcbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdTZXR0aW5nc1NlcnZpY2UnLCBTZXR0aW5nc1NlcnZpY2UpO1xyXG5cclxuICAgIFNldHRpbmdzU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZXR0aW5nc1NlcnZpY2UoJGh0dHAsICRxLCBlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0U2V0dGluZ3M6IGdldFNldHRpbmdzLFxyXG4gICAgICAgICAgICB1cGRhdGVTZXR0aW5nczogdXBkYXRlU2V0dGluZ3NcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U2V0dGluZ3MocGFzc2VuZ2VySWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArIFwicGFzc2VuZ2VyL1wiICsgcGFzc2VuZ2VySWQgKyAnL3NldHRpbmdzJyArIFwiP3JuZD1cIiArIERhdGUucGFyc2UobmV3IERhdGUoKSk7XHJcbiAgICAgICAgICAgICRodHRwLmdldChzZXJ2aWNlVXJsKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlLmRhdGEuZXJyb3JzKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZXR0aW5ncyhzZXR0aW5ncykge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdwYXNzZW5nZXIvc2V0dGluZ3MnO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KHNlcnZpY2VVcmwsIHNldHRpbmdzKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlLmRhdGEuZXJyb3JzKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTdXBwb3J0Q29udHJvbGxlcicsIFN1cHBvcnRDb250cm9sbGVyKTtcclxuXHJcbiAgICBTdXBwb3J0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdEeW5hbWljQ29udGVudFNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTdXBwb3J0Q29udHJvbGxlcigkcm9vdFNjb3BlLCRsb2NhdGlvbiwgRHluYW1pY0NvbnRlbnRTZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnU3VwcG9ydCcpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdGQVEnKTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhKCkge1xyXG4gICAgICAgICAgICBEeW5hbWljQ29udGVudFNlcnZpY2UuZ2V0U3VwcG9ydEZBUSgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRhdGEgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5GQVFDb250ZW50O1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7IFxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NvbWV0aGluZyBpcyB3cm9uZycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGdldERhdGEoKTtcclxuICAgICAgICAvLyAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIC8vIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3N1cHBvcnQvc3VwcG9ydC5odG1sJztcclxuICAgICAgICAvLyB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1zdXBwb3J0IGNhcmQnO1xyXG4gICAgICAgIC8vIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gdHJ1ZTtcclxuICAgICAgICAvLyB2bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2ggU3VwcG9ydCc7XHJcbiAgICAgICAgLy8gdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nIFN1cHBvcnQnO1xyXG4gICAgICAgIC8vIHZtLmlvbmljU3Bpbm5lciA9ICdzcGlyYWwnOyAvLyBub25lIHRvIGRpc2FibGUuXHJcbiAgICAgICAgLy8gdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAvLyAgICAgZ2V0RGF0YSgpO1xyXG4gICAgICAgIC8vICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihcclxuICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlcicsIENvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgICAgIENvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsICckdWliTW9kYWwnLCAnJHJvb3RTY29wZScsICd0cmlwSWQnLCAnYXV0aFNlcnZpY2UnLFxyXG4gICAgICAgICAgICAnTWFwU2VydmljZScsICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnTWFwSWNvblNlcnZpY2UnLCAndmVoaWNsZVNlcnZpY2UnXTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ29tbXV0ZXJUcmlwTW9kYWxDb250cm9sbGVyKCR1aWJNb2RhbEluc3RhbmNlLCAkdWliTW9kYWwsICRyb290U2NvcGUsIHRyaXBJZCwgYXV0aFNlcnZpY2UsXHJcbiAgICAgICAgICAgICBNYXBTZXJ2aWNlLCBSZXNlcnZhdGlvblNlcnZpY2UsIE1hcEljb25TZXJ2aWNlLCB2ZWhpY2xlU2VydmljZSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgIHZhciBpc01vZGlmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBtYXJrZXJFdmVudHMgPSBbeyBldmVudDogJ2NsaWNrJywgY2FsbGJhY2s6IGljb25DbGlja0hhbmRsZXIgfV07XHJcbiAgICAgICAgICAgIHZhciBub1ZlaGljbGUgPSB7IGlkOiBudWxsLCBsaWNlbmNlcGxhdGU6ICctLScgfTtcclxuXHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ucmVzZXJ2YXRpb25JbmZvID0ge307XHJcbiAgICAgICAgICAgIHZtLmRldGFpbHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5tYXJrZXJzID0gW107XHJcbiAgICAgICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbENvbW11dGVyVHJpcDtcclxuICAgICAgICAgICAgdm0ubW9kaWZ5UmVzZXJ2YXRpb24gPSBtb2RpZnlSZXNlcnZhdGlvbjsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdm0uY2xvc2UgPSBjbG9zZTtcclxuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBleGlzdGluZ1ZlaGljbGVJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdm0udmVoaWNsZUZvclJlc2VydmF0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB2bS5pc1dhaXRsaXN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJhdGluZyA9IDA7XHJcbiAgICAgICAgICAgIHZtLmNhblJhdGVUcmlwID0gY2FuUmF0ZVRyaXA7XHJcbiAgICAgICAgICAgIHZtLnNob3dSYXRpbmdNb2RhbCA9IHNob3dSYXRpbmdNb2RhbDtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2hvd1JhdGluZ01vZGFsKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjYW5SYXRlVHJpcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL2ZlZWRiYWNrLW1vZGFsL2NvbW11dGVyLWZlZWRiYWNrLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlckZlZWRiYWNrTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZWRiYWNrSW5mbzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbklkOiB2bS5yZXNlcnZhdGlvbkluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0aW5nOiB2bS5zZWxlY3RlZFJhdGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50OiAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHJlc3VsdCkgJiYgcmVzdWx0LmlzU2F2ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UmVzZXJ2YXRpb24odm0ucmVzZXJ2YXRpb25JbmZvLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc21pc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplTWFwKCkge1xyXG4gICAgICAgICAgICAgICAgdm0ubWFwID0gTWFwU2VydmljZS5pbml0aWFsaXplTWFwKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICAgICAgZ2V0UmVzZXJ2YXRpb24odHJpcElkKTtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxpemVNYXAoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0TWFwRGF0YSgpIHtcclxuICAgICAgICAgICAgICAgIGJ1aWxkUXJDb2RlKCk7XHJcbiAgICAgICAgICAgICAgICBzZXRNYXJrZXJzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRSZXNlcnZhdGlvbihyZXNlcnZhdGlvbklkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFJlc2VydmF0aW9uQnlJZChwYXNzZW5nZXJJZCwgcmVzZXJ2YXRpb25JZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXNlcnZhdGlvbkluZm8gPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0V2FpdGxpc3RlZFN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1ZlaGljbGVJZCA9IHZtLnJlc2VydmF0aW9uSW5mby52ZWhpY2xlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmF0aW5nID0gdm0ucmVzZXJ2YXRpb25JbmZvLmZlZWRiYWNrUmF0aW5nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRQYXNzZW5nZXJWZWhpY2xlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRNYXBEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhblJhdGVUcmlwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjYW5SYXRlVHJpcCgpIHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm0ucmVzZXJ2YXRpb25JbmZvLmZlZWRiYWNrUmF0aW5nID09IG51bGwgfHwgdm0ucmVzZXJ2YXRpb25JbmZvLmZlZWRiYWNrUmF0aW5nID09IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0V2FpdGxpc3RlZFN0YXR1cygpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzV2FpdGxpc3RlZCA9IHZtLnJlc2VydmF0aW9uSW5mby5zdGF0dXMgPT0gJ1dhaXRsaXN0ZWQnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRQYXNzZW5nZXJWZWhpY2xlcygpIHtcclxuICAgICAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLmdldFZlaGljbGVzRm9yUGFzc2VuZ2VyKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcy5zcGxpY2UoMCwgMCwgbm9WZWhpY2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzLnB1c2gobm9WZWhpY2xlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0ucGFzc2VuZ2VyVmVoaWNsZXNbaV0uaWQgPT0gZXhpc3RpbmdWZWhpY2xlSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVGb3JSZXNlcnZhdGlvbiA9IHZtLnBhc3NlbmdlclZlaGljbGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGJ1aWxkUXJDb2RlKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpY2tldFFSY29kZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBscXJjb2RlID0gbmV3IFFSQ29kZShlbCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdm0ucmVzZXJ2YXRpb25JbmZvLmVuY3J5cHRlZElkLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvcnJlY3RMZXZlbDogMSxcclxuICAgICAgICAgICAgICAgICAgICB1c2VTVkc6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbENvbW11dGVyVHJpcCgpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXNlcnZhdGlvbiA9XHJcbiAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uSWQ6IHZtLnJlc2VydmF0aW9uSW5mby5pZCxcclxuICAgICAgICAgICAgICAgICAgIHJvdXRlTmFtZTogdm0ucmVzZXJ2YXRpb25JbmZvLnJvdXRlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiBwYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdm0ucmVzZXJ2YXRpb25JbmZvLnBpY2t1cFRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbkRhdGU6IHZtLnJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbkRhdGVcclxuICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kYWxDYW5jZWxSZXNlcnZhdGlvbiA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9jYW5jZWwtcmVzZXJ2YXRpb24tbW9kYWwvY2FuY2VsLXJlc2VydmF0aW9uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDYW5jZWxSZXNlcnZhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFyaWFMYWJlbGxlZEJ5OiAnQ2FuY2VsIHJlc2VydmF0aW9uJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uSW5mbzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc2VydmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBtb2RhbENhbmNlbFJlc2VydmF0aW9uLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVzZXJ2YXRpb25DaGFuZ2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYW5jZWxsZWQnOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBtb2RpZnlSZXNlcnZhdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb2RpZnlSZXNlcnZhdGlvbk1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL21vZGlmeS1yZXNlcnZhdGlvbi1tb2RhbC9tb2RpZnktcmVzZXJ2YXRpb24tcGlja3VwLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RpZnlSZXNlcnZhdGlvblBpY2t1cCBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgYXJpYUxhYmVsbGVkQnk6ICdNb2RpZnkgcmVzZXJ2YXRpb24gdGltZScsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2bS5yZXNlcnZhdGlvbkluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2RpZnlSZXNlcnZhdGlvbk1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZWZyZXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTW9kaWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRSZXNlcnZhdGlvbihyZXNwb25zZS5yZXNlcnZhdGlvbklkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpY29uQ2xpY2tIYW5kbGVyKG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VycygpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlTWFya2VycygpO1xyXG4gICAgICAgICAgICAgICAgTWFwU2VydmljZS5zZXRNYXBCb3VuZHModm0ubWFya2VycywgbWFya2VyRXZlbnRzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlTWFya2VycygpIHtcclxuICAgICAgICAgICAgICAgIHZtLm1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHZtLnJlc2VydmF0aW9uSW5mby5waWNrdXBMYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnJlc2VydmF0aW9uSW5mby5waWNrdXBMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogZ2V0TWFwSWNvbigncGlja3VwJywgdm0ucmVzZXJ2YXRpb25JbmZvLnNjaGVkdWxlVHlwZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdm0ucmVzZXJ2YXRpb25JbmZvLnBpY2t1cFN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHZtLnJlc2VydmF0aW9uSW5mby5waWNrdXBBZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5tYXJrZXJzLnB1c2goXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogdm0ucmVzZXJ2YXRpb25JbmZvLmRyb3BvZmZMYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiB2bS5yZXNlcnZhdGlvbkluZm8uZHJvcG9mZkxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogZ2V0TWFwSWNvbignZHJvcG9mZicsIHZtLnJlc2VydmF0aW9uSW5mby5zY2hlZHVsZVR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2bS5yZXNlcnZhdGlvbkluZm8uZHJvcG9mZlN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiB2bS5yZXNlcnZhdGlvbkluZm8uZHJvcG9mZkFkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7XHJcbiAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ2lzTW9kaWZpZWQnOiBpc01vZGlmaWVkXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWFwSWNvbihzdG9wdHlwZSwgc2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdG9wdHlwZSA9PT0gJ3BpY2t1cCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZWR1bGUgPT09ICdBTScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlclN0b3BJY29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWFwSWNvblNlcnZpY2UuZ2V0Q29tbXV0ZXJIdWJJY29uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZWR1bGUgPT09ICdQTScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlclN0b3BJY29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWFwSWNvblNlcnZpY2UuZ2V0Q29tbXV0ZXJIdWJJY29uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pKCk7IiwiIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuY29udHJvbGxlcignVHJpcERldGFpbHNNb2RhbENvbnRyb2xsZXInLCBUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgVHJpcERldGFpbHNNb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHVpYk1vZGFsSW5zdGFuY2UnLCAnJHRpbWVvdXQnLCAndHJpcE1vZGFsUmVxdWVzdCcsICd1aUdtYXBJc1JlYWR5JywgJ01hcFNlcnZpY2UnLCAnTWFwSWNvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlcigkdWliTW9kYWxJbnN0YW5jZSwgJHRpbWVvdXQsIHRyaXBNb2RhbFJlcXVlc3QsIHVpR21hcElzUmVhZHksIE1hcFNlcnZpY2UsIE1hcEljb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIG1hcmtlckV2ZW50cyA9IFt7IGV2ZW50OiAnY2xpY2snLCBjYWxsYmFjazogaWNvbkNsaWNrSGFuZGxlciB9XTtcclxuXHJcblxyXG4gICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICB2bS5wYXNzZW5nZXJUcmlwID0gdHJpcE1vZGFsUmVxdWVzdC5wYXNzZW5nZXJUcmlwO1xyXG4gICAgICAgIHZtLm9wdGlvbnMgPSB0eXBlb2YgdHJpcE1vZGFsUmVxdWVzdC5vcHRpb25zID09ICdzdHJpbmcnID8gSlNPTi5wYXJzZSh0cmlwTW9kYWxSZXF1ZXN0Lm9wdGlvbnMpIDogdHJpcE1vZGFsUmVxdWVzdC5vcHRpb25zO1xyXG4gICAgICAgIHZtLnNlcnZpY2VEYXRlID0gdHJpcE1vZGFsUmVxdWVzdC5zZXJ2aWNlRGF0ZTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5tYXAgPSBNYXBTZXJ2aWNlLmluaXRpYWxpemVNYXAoKTtcclxuICAgICAgIFxyXG5cclxuICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLm1hcmtlcnMgPSBbXTtcclxuICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB2bS5wYXNzZW5nZXJUcmlwLnN0YXJ0TGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnBhc3NlbmdlclRyaXAuc3RhcnRMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBpY29uOiBNYXBJY29uU2VydmljZS5nZXREcnRQaWNrdXBJY29uKCksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2bS5wYXNzZW5nZXJUcmlwLnN0YXJ0TmFtZSxcclxuICAgICAgICAgICAgICAgIGFkZHJlc3MgOiB2bS5wYXNzZW5nZXJUcmlwLnN0YXJ0QWRkcmVzc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB2bS5wYXNzZW5nZXJUcmlwLmVuZExhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiB2bS5wYXNzZW5nZXJUcmlwLmVuZExvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIGljb246IE1hcEljb25TZXJ2aWNlLmdldERydERyb3BvZmZJY29uKCksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2bS5wYXNzZW5nZXJUcmlwLmVuZE5hbWUsXHJcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiB2bS5wYXNzZW5nZXJUcmlwLmVuZEFkZHJlc3NcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBNYXBTZXJ2aWNlLnNldE1hcEJvdW5kcyh2bS5tYXJrZXJzLG1hcmtlckV2ZW50cyk7XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGljb25DbGlja0hhbmRsZXIobW9kZWwpIHtcclxuICAgICAgICAgICAgdm0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gY2FuY2VsVHJpcCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbic6ICdjYW5jZWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLmNsb3NlTW9kYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb24nOiAnY2xvc2UnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRpc3BsYXlSYXRpbmdPcHRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5wYXNzZW5nZXJUcmlwLlN0YXR1cyA9PT0gJ0VuZCcgfHxcclxuICAgICAgICAgICAgICAgICh2bS5wYXNzZW5nZXJUcmlwLlN0YXR1cyA9PT0gJ1Jlc2VydmVkJyAmJiAodm0uc2VydmljZURhdGUgPiB2bS5wYXNzZW5nZXJUcmlwLnNlcnZpY2VEYXRlKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1Bhc3NlbmdlclRyaXBzQ3RybCcsIFBhc3NlbmdlclRyaXBzQ3RybCk7XHJcblxyXG4gICAgUGFzc2VuZ2VyVHJpcHNDdHJsLiRpbmplY3QgPSBbJyRzdGF0ZScsICckdWliTW9kYWwnLCAnYXV0aFNlcnZpY2UnLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJyxcclxuICAgICAnTHV1bUxpbmtlZFNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJywnQ29uZmlnRmFjdG9yeScsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFBhc3NlbmdlclRyaXBzQ3RybCgkc3RhdGUsICR1aWJNb2RhbCwgYXV0aFNlcnZpY2UsIFJlc2VydmF0aW9uU2VydmljZSwgUGFnZVNlcnZpY2UsXHJcbiAgICAgICAgIEx1dW1MaW5rZWRTZXJ2aWNlLE9uZU12U2VydmljZXMsQ29uZmlnRmFjdG9yeSxEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnBhc3RUcmlwcyA9IFtdO1xyXG4gICAgICAgIHZtLmZ1dHVyZVRyaXBzID0gW107XHJcbiAgICAgICAgdm0udG9kYXlzVHJpcHMgPSBbXTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdQYXNzZW5nZXIgVHJpcHMnKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZSgnTXkgVHJpcHMnKTtcclxuXHJcbiAgICAgICAgdm0uYWRkcmVzc1Jlc3QgPSBudWxsO1xyXG4gICAgICAgIHZtLmNlbnRlckxhdExvbmc7XHJcbiAgICAgICAgdm0ub25UcmlwQ2FuY2VsbGVkID0gb25UcmlwQ2FuY2VsbGVkO1xyXG4gICAgICAgIHZtLnNob3dUcmlwRGV0YWlscyA9IHNob3dUcmlwRGV0YWlscztcclxuXHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuICAgICAgICBvcHRpb25zLnJlc2VydmF0aW9uVHlwZSA9ICdjdXJyZW50JztcclxuICAgICAgICBvcHRpb25zLk9wZXJhdG9ySWQgPSAnJztcclxuICAgICAgICBvcHRpb25zLmlzUGFzc2VuZ2VyID0gdHJ1ZTtcclxuICAgICAgICBvcHRpb25zLnJlbG9hZFRyaXBzID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICB2bS5jdXJyZW50UGFzc2VuZ2VyID0geyBcIklkXCI6IHBhc3NlbmdlcklkIH07IFxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICghYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpKVxyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XHJcblxyXG4gICAgICAgIHZtLmNvbW11dGVySW5mbyA9IE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCk7XHJcbiAgICAgICAgdm0uZHJ0SW5mbyA9IE9uZU12U2VydmljZXMuZ2V0RHJ0SW5mbygpOyAgICBcclxuXHJcbiAgICAgICAgdm0uaGFzQ29tbXV0ZXIgPSAhYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb21tdXRlckluZm8pO1xyXG4gICAgICAgIHZtLmhhc0RydCA9ICFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmRydEluZm8pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlOyAgICAgICAgXHJcbiAgICAgICAgdm0udG90YWxUcmlwc0NvdW50ID0gMDtcclxuICAgIFxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBMdXVtTGlua2VkU2VydmljZS52ZXJpZnkoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQpO1xyXG4gICAgICAgICAgICBwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICBnZXRVcGNvbWluZ1RyaXBzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVcGNvbWluZ1RyaXBzKCkge1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuZ2V0QWxsUmVzZXJ2YXRpb25zRm9yUGFzc2VuZ2VyKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlVHJpcHMocmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlVHJpcHModHJpcHMpIHtcclxuICAgICAgICAgICAgdm0ucGFzdFRyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLmZ1dHVyZVRyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLnRvZGF5c1RyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLnRvdGFsVHJpcHNDb3VudCA9IDA7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRyaXBzKSByZXR1cm47ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICB2bS50b3RhbFRyaXBzQ291bnQgPSB0cmlwcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHJpcCA9IHRyaXBzW2ldOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyZSA9IG1vbWVudCgpLmRheU9mWWVhcigpIC0gbW9tZW50KHRyaXBzW2ldLnJlc2VydmF0aW9uRGF0ZSkuZGF5T2ZZZWFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBhcmUgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3RUcmlwcy5wdXNoKHRyaXApO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29tcGFyZSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZnV0dXJlVHJpcHMucHVzaCh0cmlwKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB2bS50b2RheXNUcmlwcy5wdXNoKHRyaXBzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1RyaXBEZXRhaWxzKHRyaXApIHtcclxuICAgICAgICAgICAgdmFyIGNvbW11dGVyVHJpcE1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9zaGFyZWQvdHJpcHMvY29tbXV0ZXItdHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlclRyaXBNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZCA6dHJ1ZSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlwSWQ6IHRyaXAuaWRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb21tdXRlclRyaXBNb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jYW5jZWxsZWQgfHwgcmVzcG9uc2UuaXNNb2RpZmllZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFVwY29taW5nVHJpcHMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlRGl2aXNpb25QYXJhbWV0ZXJzKCkge1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldERpdmlzaW9uUGFyYW1ldGVycyhkaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wcm9taXNlV2luZG93ID0gcGFyYW1zLlByb21pc2VXaW5kb3c7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLkRpdmlzaW9uSWQgPSBkaXZpc2lvbklkO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5iYXRjaERheXMgPSBwYXJhbXMuQmF0Y2hEYXlzID8gZXZhbChwYXJhbXMuQmF0Y2hEYXlzKSA6IDc7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLm1pbkZyb21EYXlzID0gcGFyYW1zLk1pbkZyb21EYXlzID8gZXZhbChwYXJhbXMuTWluRnJvbURheXMpIDogMzA7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbiA9IHBhcmFtcy5BbGxvd0FkdmFuY2VkUmVzZXJ2YXRpb24gPyBldmFsKHBhcmFtcy5BbGxvd0FkdmFuY2VkUmVzZXJ2YXRpb24udG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2hvd0NhbmNlbE9wdGlvbnMgPSBwYXJhbXMuQ2FuY2VsUmVhc29uUmVxdWlyZWQgPyBldmFsKHBhcmFtcy5DYW5jZWxSZWFzb25SZXF1aXJlZC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0ZhcmluZyA9IHBhcmFtcy5BbGxvd0ZhcmluZyA/IGV2YWwocGFyYW1zLkFsbG93RmFyaW5nLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93TG9jYXRpb25Ob3RlcyA9IHBhcmFtcy5BbGxvd0xvY2F0aW9uTm90ZXMgPyBldmFsKHBhcmFtcy5BbGxvd0xvY2F0aW9uTm90ZXMpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93Q2hpbGRyZW4gPSBwYXJhbXMuQWxsb3dDaGlsZHJlbiA/IGV2YWwocGFyYW1zLkFsbG93Q2hpbGRyZW4pIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93TXVsdGlwbGVTZWF0Qm9va2luZyA9IHBhcmFtcy5BbGxvd011bHRpcGxlU2VhdEJvb2tpbmcgPyBldmFsKHBhcmFtcy5BbGxvd011bHRpcGxlU2VhdEJvb2tpbmcudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLnVzZXJSZXNlcnZhdGlvbk9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gb25UcmlwQ2FuY2VsbGVkKCkge31cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY09uVG91Y2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIE5lZWQgdG8gcmVzaXplIHRoZSBzY3JlZW4gaWYgb25lIG9mIHRoZSB0cmlwIGNhcmRzIGlzIGNsaWNrZWQuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnaW9uaWNTY3JvbGxSZXNpemUnLCB7IGFjdGlvbjogJ3Jlc2l6ZScgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC90cmlwcy9teS10cmlwcy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy5teS10cmlwcyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljUHVsbGluZ1RleHQgPSAnUmVmcmVzaCBUcmlwcyc7XHJcbiAgICAgICAgdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nIFRyaXBzJztcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLnJlZnJlc2ggPSBmdW5jdGlvbiAocmVmcmVzaGVyKSB7XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIC8vIGNoYW5nZSB0aGlzIGZsYWcgdG8gdHJpZ2dlciB0aGUgbXktdHJpcHMgZGlyZWN0aXZlIHRvIHJlbG9hZC5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgb3B0aW9ucy5yZWxvYWRUcmlwcyA9ICFvcHRpb25zLnJlbG9hZFRyaXBzO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwib25lTVZBcHBcIikuZGlyZWN0aXZlKCd0cmlwQ2FyZERpcmVjdGl2ZScsIHRyaXBDYXJkRGlyZWN0aXZlKTtcclxuICAgIHRyaXBDYXJkRGlyZWN0aXZlLiRpbmplY3QgPSBbJyR1aWJNb2RhbCcsICdVdGlsaXR5RmFjdG9yeSddO1xyXG4gICAgZnVuY3Rpb24gdHJpcENhcmREaXJlY3RpdmUoJHVpYk1vZGFsLCBVdGlsaXR5RmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICB0cmlwOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiAnQCcsXHJcbiAgICAgICAgICAgICAgICB0cmlwVHlwZTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25TZXJ2aWNlRGF0ZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dUcmlwUmF0aW5nOiBcIj1cIixcclxuICAgICAgICAgICAgICAgIG5vdGlmeU9uQ2FuY2VsOiBcIj1vblRyaXBDYW5jZWxcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC90cmlwcy90cmlwQ2FyZC5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd0cmlwJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcInN0cmluZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXNzZW5nZXJUcmlwID0gSlNPTi5wYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhc3NlbmdlclRyaXAgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJUcmlwID0gSlNPTi5wYXJzZSgkc2NvcGUudHJpcCk7XHJcbiAgICAgICAgICAgICRzY29wZS5vcHRzID0gSlNPTi5wYXJzZSgkc2NvcGUub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICRzY29wZS5zZXJ2aWNlRGF0ZSA9ICRzY29wZS5kaXZpc2lvblNlcnZpY2VEYXRlO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmRldGFpbHNNb2RhbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgdmFyIHRyaXBEZXRhaWwgPSAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3RyaXBzL2RydC10cmlwLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpcE1vZGFsUmVxdWVzdCA6IGZ1bmN0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJUcmlwOiAkc2NvcGUucGFzc2VuZ2VyVHJpcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiAkc2NvcGUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlRGF0ZTogJHNjb3BlLnNlcnZpY2VEYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgdHJpcERldGFpbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gJ2NhbmNlbCcpXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCgkc2NvcGUucGFzc2VuZ2VyVHJpcCk7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5nZXREaXNwbGF5U3RhdHVzID0gZnVuY3Rpb24gKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9ICdDYW5jZWxsZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdOby1zaG93JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gJ05vIHNob3cnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdVbi1zY2hlZHVsZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAnUmVzZXJ2ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHJpcFRvQ2FuY2VsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJZCxcclxuICAgICAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiB0cmlwLlBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICdmcm9tJzogdHJpcC5zdGFydE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RvJzogdHJpcC5lbmROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZWRUaW1lJzogdHJpcC5zY2hlZFBpY2t1cFRpbWVcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsQ2FuY2VsVHJpcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1wcm9tcHQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBUb0NhbmNlbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyaXBUb0NhbmNlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbE9wdGlvbnM6ICRzY29wZS5vcHRzLnNob3dDYW5jZWxPcHRpb25zXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxDYW5jZWxUcmlwLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcyhcIlN1Y2Nlc3MhXCIsIFwiVHJpcCBjYW5jZWxsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKCRzY29wZS5ub3RpZnlPbkNhbmNlbCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vdGlmeU9uQ2FuY2VsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIlVuYWJsZSB0byBjYW5jZWwgdGhlIHRyaXAuXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ212UGFzc2VuZ2VyVHJpcHMnLCB1c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlKTtcclxuXHJcbiAgICB1c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlLiRpbmplY3QgPSBbJyRmaWx0ZXInLCAnJGludGVydmFsJywgJyR1aWJNb2RhbCcsXHJcbiAgICAgICAgJ1V0aWxpdHlGYWN0b3J5JywgJ1NjaGVkdWxlU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiB1c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlKCAkZmlsdGVyLCAgJGludGVydmFsLCAkdWliTW9kYWwsIFxyXG4gICAgICAgIFV0aWxpdHlGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UsICBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiBmYWxzZSxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIHBhc3NlbmdlcjogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbmV3VHJpcDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogJ0AnLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25JZDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbm90aWZ5VHJpcENhbmNlbGxlZDogJz1vblRyaXBDYW5jZWxsZWQnLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dUcmlwUmF0aW5nOiBcIj1cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC90cmlwcy91c2VyUmVzZXJ2YXRpb25zLmh0bWwnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGhlcmUgdG8gdHJpZ2dlciBzY29wZS5pbml0KCkgd2hlbiB0aGlzIGV2ZW50IGZpcnN0IG9jY3Vycy5cclxuICAgICAgICAgICAgLy8gSW4gdGhlIE1vYmlsZSBBcHAsICdvcHRpb25zJyBnZXRzIGxvYWRlZCBzbyBmYXN0IHRoYXQgYnkgdGhlIHRpbWVcclxuICAgICAgICAgICAgLy8gdGhlICR3YXRjaCgnb3B0aW9ucycpIG9jY3VycywgdGhlIHZhbHVlIGlzIHRoZSBzYW1lLlxyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbFJ1biA9IHRydWU7IFxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ29wdGlvbnMnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUgfHwgaW5pdGlhbFJ1bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0cyA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRzID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFJ1biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmluaXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlcigkc2NvcGUsIE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHZhciBvcGVyYXRvcklkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB2YXIgYmF0Y2hEYXlzID0gNzsgLy9nZXQgZnJvbSBzeXN0ZW0gcGFyYW1zXHJcbiAgICAgICAgICAgIHZhciBtaW5Gcm9tRGF5cyA9IDMwO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZUZvcm1hdCA9ICdNTS1ERC1ZWVlZJztcclxuICAgICAgICAgICAgJHNjb3BlLmlzQ2FuY2VsbGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciBhdXRvUmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdmFyIGF1dG9SZWZyZXNoQWN0aXZlVHJpcCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJzID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuY29tbXV0ZXJJbmZvID0gT25lTXZTZXJ2aWNlcy5nZXRDb21tdXRlckluZm8oKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRydEluZm8gPSBPbmVNdlNlcnZpY2VzLmdldERydEluZm8oKTsgICAgXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUub3B0cyA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmVUcmlwID0ge1xyXG4gICAgICAgICAgICAgICAgVHJpcElkOiBudWxsXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VyRnV0dXJlVHJpcHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlclBhc3RUcmlwcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VyQWN0aXZlVHJpcHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc2VuZ2VyICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFzcyA9IEpTT04ucGFyc2UoJHNjb3BlLnBhc3Nlbmdlcik7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VySWQgPSBwYXNzID8gcGFzcy5JZCA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RhYnMgPSAhYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUuY29tbXV0ZXJJbmZvKSAmJiAhYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUuZHJ0SW5mbyk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5nZXREaXNwbGF5U3RhdHVzID0gZnVuY3Rpb24gKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9ICdDYW5jZWxlZCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTm8tc2hvdyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9ICdObyBTaG93J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2YXRlID0gZnVuY3Rpb24gKHBhc3Nlbmdlcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlcklkID0gcGFzc2VuZ2VyLklkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5kaXNwbGF5UmF0aW5nT3B0aW9uID0gZnVuY3Rpb24gKHBhc3NlbmdlclRyaXApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXNzZW5nZXJUcmlwLlN0YXR1cyA9PT0gJ0VuZCcgfHxcclxuICAgICAgICAgICAgICAgICAgICAocGFzc2VuZ2VyVHJpcC5TdGF0dXMgPT09ICdSZXNlcnZlZCdcclxuICAgICAgICAgICAgICAgICAgICAmJiAoJHNjb3BlLnNlcnZpY2VEYXRlID4gcGFzc2VuZ2VyVHJpcC5zZXJ2aWNlRGF0ZSkpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJpcFRvQ2FuY2VsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJZCxcclxuICAgICAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiB0cmlwLlBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICdmcm9tJzogdHJpcC5zdGFydE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RvJzogdHJpcC5lbmROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZWRUaW1lJzogdHJpcC5zY2hlZFBpY2t1cFRpbWVcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsQ2FuY2VsVHJpcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1wcm9tcHQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlwVG9DYW5jZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmlwVG9DYW5jZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxPcHRpb25zOiAkc2NvcGUub3B0cy5zaG93Q2FuY2VsT3B0aW9uc1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIG1vZGFsQ2FuY2VsVHJpcC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc0NhbmNlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoXCJTdWNjZXNzIVwiLCBcIlRyaXAgY2FuY2VsbGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRUcmlwc0ZvclBhc3NlbmdlcihudWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiVW5hYmxlIHRvIGNhbmNlbCB0aGUgdHJpcC5cIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pc1Bhc3NlbmdlciA9ICRzY29wZS5vcHRzLmlzUGFzc2VuZ2VyO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uVHlwZSA9ICRzY29wZS5vcHRzLnJlc2VydmF0aW9uVHlwZTtcclxuICAgICAgICAgICAgICAgIGRpdmlzaW9uSWQgPSAkc2NvcGUub3B0cy5EaXZpc2lvbklkO1xyXG4gICAgICAgICAgICAgICAgb3BlcmF0b3JJZCA9ICRzY29wZS5vcHRzLk9wZXJhdG9ySWQ7XHJcbiAgICAgICAgICAgICAgICBiYXRjaERheXMgPSAkc2NvcGUub3B0cy5iYXRjaERheXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3B0cy5hdXRvUmVmcmVzaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBtaW5Gcm9tRGF5cyA9ICRzY29wZS5vcHRzLm1pbkZyb21EYXlzO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNTdGFydERwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNFbmR0RHAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlID0geyAnZnJvbSc6IHVuZGVmaW5lZCwgJ3RvJzogdW5kZWZpbmVkIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWluRnJvbURhdGVBbGxvd2VkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1heEZyb21EYXRlQWxsb3dlZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5taW5Ub0RhdGVBbGxvd2VkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1heFRvRGF0ZUFsbG93ZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd01hcCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5pc1Bhc3NlbmdlcilcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZhdGUoJHNjb3BlLnBhc3Nlbmdlcik7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZURhdGVCeURpdmlzaW9uKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VydmljZURhdGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlcnZpY2VEYXRlID0gc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldENhbGVuZGFyRGF0ZXMoc2VydmljZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSAkc2NvcGUub3B0cy5hdXRvUmVmcmVzaCA/IHNldEF1dG9SZWZyZXNoIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0VHJpcHNGb3JQYXNzZW5nZXIoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCJGYWlsZWQgdG8gZ2V0IFNlcnZpY2UgRGF0ZS5cIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRBdXRvUmVmcmVzaCgpIHtcclxuICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoQWN0aXZlVHJpcCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aXZlVHJpcCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgMzAwMDApO1xyXG4gICAgICAgICAgICAgICAgYXV0b1JlZnJlc2ggPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFRyaXBzRm9yUGFzc2VuZ2VyKCk7XHJcbiAgICAgICAgICAgICAgICB9LCA2MDAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEFjdGl2ZVRyaXAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXNzID0gSlNPTi5wYXJzZSgkc2NvcGUucGFzc2VuZ2VyKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJJZCA9IHBhc3MgPyBwYXNzLklkIDogdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0bGFzdHJpcGRldGFpbHMoJHNjb3BlLnBhc3NlbmdlcklkLCBkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUucGFzc2VuZ2VyRnV0dXJlVHJpcHMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlVHJpcCA9ICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5wYXNzZW5nZXJGdXR1cmVUcmlwcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IFRyaXBJZDogcmVzcG9uc2UuZGF0YS5yZXN1bHQuVHJpcElEIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZVRyaXAubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IGFjdGl2ZVRyaXBbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyaXBJZDogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaylcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldENhbGVuZGFyRGF0ZXMoc2VydmljZURhdGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmlzUGFzc2VuZ2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUub3B0cy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGUudG8gPSBtb21lbnQoc2VydmljZURhdGUpLmZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZS50byA9IG1vbWVudChzZXJ2aWNlRGF0ZSkuYWRkKGJhdGNoRGF5cywgJ2QnKS5mb3JtYXQoZGF0ZUZvcm1hdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRlLmZyb20gPSBtb21lbnQoc2VydmljZURhdGUpLmFkZCgtbWluRnJvbURheXMsICdkJykuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkTW9tZW50RGF0ZSA9IG1vbWVudChzZXJ2aWNlRGF0ZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZS5mcm9tID0gc2VsZWN0ZWRNb21lbnREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRlLnRvID0gc2VsZWN0ZWRNb21lbnREYXRlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWF4VG9EYXRlID0gbW9tZW50KHNlbGVjdGVkTW9tZW50RGF0ZSwgZGF0ZUZvcm1hdCkuYWRkKGJhdGNoRGF5cywgJ2QnKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWluVG9EYXRlQWxsb3dlZCA9IHNlbGVjdGVkTW9tZW50RGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWF4VG9EYXRlQWxsb3dlZCA9IG5ldyBEYXRlKG1heFRvRGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5Gcm9tRGF0ZSA9IG1vbWVudChzZWxlY3RlZE1vbWVudERhdGUsIGRhdGVGb3JtYXQpLmFkZCgtbWluRnJvbURheXMsICdkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pbkZyb21EYXRlQWxsb3dlZCA9IG5ldyBEYXRlKG1pbkZyb21EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWF4RnJvbURhdGVBbGxvd2VkID0gc2VsZWN0ZWRNb21lbnREYXRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLm9uVHJpcENhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGdldFRyaXBzRm9yUGFzc2VuZ2VyKG51bGwsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tRGF0ZSA9ICRzY29wZS5kYXRlLmZyb207XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWluVG9EYXRlQWxsb3dlZCA9IGZyb21EYXRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzQmVmb3JlKCRzY29wZS5kYXRlLnRvLCAkc2NvcGUuZGF0ZS5mcm9tKSlcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZS50byA9IGFuZ3VsYXIuY29weSgkc2NvcGUuZGF0ZS5mcm9tKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnZXRUcmlwc0ZvclBhc3NlbmdlcigpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaXNCZWZvcmUoZnJvbSwgdG8pIHtcclxuICAgICAgICAgICAgICAgIHZhciBkaWZmID0gbmV3IERhdGUoZnJvbSkuZ2V0VGltZSgpIDw9IG5ldyBEYXRlKHRvKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGlmZjtcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRUcmlwc0ZvclBhc3NlbmdlcihjYWxsYmFjaywgaXNGcm9tQ2FuY2VsKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyb21EYXRlID0gJGZpbHRlcignZGF0ZScpKCRzY29wZS5kYXRlLmZyb20sICd5eXl5LU1NLWRkJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9EYXRlID0gJGZpbHRlcignZGF0ZScpKCRzY29wZS5kYXRlLnRvLCAneXl5eS1NTS1kZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwYXNzID0gSlNPTi5wYXJzZSgkc2NvcGUucGFzc2VuZ2VyKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJJZCA9IHBhc3MgPyBwYXNzLklkIDogdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFBhc3NlbmdlclRyaXBzKGRpdmlzaW9uSWQsICRzY29wZS5wYXNzZW5nZXJJZCwgZnJvbURhdGUsIHRvRGF0ZSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBUcmlwcyhyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aXZlVHJpcChjYWxsYmFjaylcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzRnJvbUNhbmNlbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGl2ZVRyaXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBlcnJvcm1zZy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcFRyaXBzKHRyaXBzKSB7XHJcbiAgICAgICAgICAgICAgICBhZGRQcm9taXNlV2luZG93QW5kRXBvY2hUb1RyaXAodHJpcHMpO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJQYXN0VHJpcHMgPSBnZXRUcmlwcyh0cmlwcywgZmlsdGVyUGFzdFRyaXBzLCBzb3J0UGFzdFRyaXBzKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJGdXR1cmVUcmlwcyA9IGdldEZ1dHVyZVRyaXBzKHRyaXBzKTsvLywgZmlsdGVyRnV0dXJlVHJpcHMsIHNvcnRGdXR1cmVUcmlwcyk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZ1dHVyZVRyaXBzKHRyaXBzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnV0dXJlVHJpcHMgPSBhbmd1bGFyLmNvcHkodHJpcHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnBhc3NlbmdlclBhc3RUcmlwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmlwSWQgPSAkc2NvcGUucGFzc2VuZ2VyUGFzdFRyaXBzW2ldLlRyaXBJZDtcclxuICAgICAgICAgICAgICAgICAgICBmdXR1cmVUcmlwcyA9ICRmaWx0ZXIoJ2ZpbHRlcicpKGZ1dHVyZVRyaXBzLCB7IFRyaXBJZDogJyEnICsgdHJpcElkIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1dHVyZVRyaXBzO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNvcnRGdXR1cmVUcmlwcyhhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5zY2hlZEVwb2NoIC0gYi5zY2hlZEVwb2NoO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGFzdFRyaXBzKHRyaXApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGl2aXNpb25FcG9jaCA9IG1vbWVudC50eihEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSkuZm9ybWF0KCd4Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyaXAuU3RhdHVzID09PSAnQ2FuY2VsJ1xyXG4gICAgICAgICAgICAgICAgICAgIHx8IHRyaXAuU3RhdHVzID09PSAnTm8tc2hvdydcclxuICAgICAgICAgICAgICAgICAgICB8fCB0cmlwLlN0YXR1cyA9PT0gJ0VuZCdcclxuICAgICAgICAgICAgICAgICAgICB8fCAvL3RyaXAuU3RhdHVzID09PSAnUmVzZXJ2ZWQnICYmIFxyXG4gICAgICAgICAgICAgICAgICAgICAgIHRyaXAuc2VydmljZURhdGUgPCAkc2NvcGUuc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzb3J0UGFzdFRyaXBzKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBiLnNjaGVkRXBvY2ggLSBhLnNjaGVkRXBvY2g7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRyaXBzKHRyaXBzLCBmaWx0ZXIsIHNvcnQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSB0cmlwcy5maWx0ZXIoZmlsdGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZC5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcmVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBtYXBQcm9taXNlV2luZG93QW5kRXBvY2godHJpcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2VXaW5kb3cgPSAkc2NvcGUub3B0cy5wcm9taXNlV2luZG93O1xyXG4gICAgICAgICAgICAgICAgdHJpcC5zY2hlZEVwb2NoID0gbW9tZW50LnR6KHRyaXAuc2NoZWRQaWNrdXBUaW1lLCBEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSkuZm9ybWF0KCd4Jyk7XHJcbiAgICAgICAgICAgICAgICB0cmlwLmVzdEVwb2NoID0gbW9tZW50LnR6KHRyaXAuZXN0aW1hdGVkUGlja3VwVGltZSwgRGl2aXNpb25TZXJ2aWNlLmdldFRpbWVab25lKCkpLmZvcm1hdCgneCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0cmlwLmVzdGltYXRlZFBpY2t1cFRpbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBwaWNrdXBUaW1lID0gdHJpcC5zY2hlZFBpY2t1cFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgcHJvbWlzZVdpbmRvd3NFbmRUaW1lID0gRGF0ZUZhY3RvcnkuZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWUocGlja3VwVGltZSwgcHJvbWlzZVdpbmRvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90cmlwLnByb21pc2VXaW5kb3dTdGFydFRpbWUgPSAkZmlsdGVyKCdkYXRlJykocGlja3VwVGltZSwgJ2g6bW0gYScpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdHJpcC5wcm9taXNlV2luZG93RW5kVGltZSA9ICRmaWx0ZXIoJ2RhdGUnKShwcm9taXNlV2luZG93c0VuZFRpbWUsICdoOm1tIGEnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0UGlja3VwV2luZG93VGltZSA9IG5ldyBtb21lbnQodHJpcC5zdGFydFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRQaWNrdXBXaW5kb3dUaW1lID0gbmV3IG1vbWVudCh0cmlwLmVuZFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXAucHJvbWlzZVdpbmRvd1N0YXJ0VGltZSA9IHN0YXJ0UGlja3VwV2luZG93VGltZS5mb3JtYXQoJ2g6bW0gQScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXAucHJvbWlzZVdpbmRvd0VuZFRpbWUgPSBlbmRQaWNrdXBXaW5kb3dUaW1lLmZvcm1hdCgnaDptbSBBJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmlwLnZlaGljbGVMaWNlbnNlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaXAudmVoaWNsZUxpY2Vuc2UgPSBcIk4vQVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkUHJvbWlzZVdpbmRvd0FuZEVwb2NoVG9UcmlwKHRyaXBzKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJpcHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwUHJvbWlzZVdpbmRvd0FuZEVwb2NoKHRyaXBzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE1hcEluZm8odHJpcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcEluZm8gPVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2FjdGl2ZVRyaXBSdW5JZCc6IHRyaXAuUnVuSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdGcm9tTGF0JzogdHJpcC5zdGFydExhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnRnJvbUxvbmcnOiB0cmlwLnN0YXJ0TG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnVG9MYXQnOiB0cmlwLmVuZExhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnVG9Mb25nJzogdHJpcC5lbmRMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJZFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hcEluZm87XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFkZE5ld1RyaXAgPSBmdW5jdGlvbiAodHJpcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRyaXBEYXRlID0gbW9tZW50KHRyaXAuU2NoZWR1bGVkUGlja3VwVGltZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgLy9pZiBuZXcgdHJpcCBmYWxscyBiZXR3ZWVuIGV4aXN0aW5nIHNlbGVjdGVkIGRhdGVzIFxyXG4gICAgICAgICAgICAgICAgaWYgKGlzQmVmb3JlKCRzY29wZS5kYXRlLmZyb20sIHRyaXBEYXRlKSAmJiBpc0JlZm9yZSh0cmlwRGF0ZSwgJHNjb3BlLmRhdGUudG8pKVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFRyaXBzRm9yUGFzc2VuZ2VyKCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGF1dG9SZWZyZXNoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChhdXRvUmVmcmVzaEFjdGl2ZVRyaXApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChhdXRvUmVmcmVzaEFjdGl2ZVRyaXApO1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoQWN0aXZlVHJpcCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignV2hhdHNOZXdDb250cm9sbGVyJywgV2hhdHNOZXdDb250cm9sbGVyKTtcclxuXHJcbiAgICBXaGF0c05ld0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsICdEeW5hbWljQ29udGVudFNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBXaGF0c05ld0NvbnRyb2xsZXIoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBEeW5hbWljQ29udGVudFNlcnZpY2UsIFBhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdXaGF0cyBOZXcnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnTGF0ZXN0IFNlcnZpY2UgVXBkYXRlcycpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhKCkge1xyXG4gICAgICAgICAgICBEeW5hbWljQ29udGVudFNlcnZpY2UuZ2V0V2hhdHNOZXdEYXRhKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmRhdGEgPSByZXNwb25zZS5kYXRhLnJlc3VsdDsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0RGF0YSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3doYXRzLW5ldy93aGF0cy1uZXcuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtd2hhdHMtbmV3IGNhcmQnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2gnO1xyXG4gICAgICAgIHZtLmlvbmljUmVmcmVzaGluZ1RleHQgPSAnTG9hZGluZyc7XHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgICAgICBnZXREYXRhKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignVmVyaWZpY2F0aW9uQ29udHJvbGxlcicsIFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHRpbWVvdXQnLCAnJHJvb3RTY29wZScsJ2F1dGhTZXJ2aWNlJywgJ1ZlcmlmaWNhdGlvblNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1JlZGlyZWN0aW9uU2VydmljZScsICdQYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFZlcmlmaWNhdGlvbkNvbnRyb2xsZXIoJHRpbWVvdXQsICRyb290U2NvcGUsIGF1dGhTZXJ2aWNlLCBWZXJpZmljYXRpb25TZXJ2aWNlLCAgRGl2aXNpb25TZXJ2aWNlLCBSZWRpcmVjdGlvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNhdmVkU3VjY2Vzc2Z1bGx5ID0gZmFsc2U7XHJcbiAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xyXG4gICAgICAgIHZtLmNvZGUgPSAnJztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdWZXJpZmljYXRpb24nKTtcclxuXHJcbiAgICAgICAgdmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5yZWdpc3RlckRhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YS51c2VyTmFtZSxcclxuICAgICAgICAgICAgICAgIHByb3ZpZGVyOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLnByb3ZpZGVyLFxyXG4gICAgICAgICAgICAgICAgZXh0ZXJuYWxBY2Nlc3NUb2tlbjogYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YS5leHRlcm5hbEFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25JZDogRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSxcclxuICAgICAgICAgICAgICAgIGRpdmlzaW9uU3VwcG9ydHNGZWVkOiBmYWxzZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnVmVyaWZ5IHlvdXIgJyArIGF1dGhTZXJ2aWNlLmV4dGVybmFsQXV0aERhdGEucHJvdmlkZXIgKycgYWNjb3VudCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgUmVkaXJlY3Rpb25TZXJ2aWNlLnJlZGlyZWN0VG8oJ2Rhc2hib2FyZC8nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnJlZ2lzdGVyRXh0ZXJuYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcclxuICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHZtLmNvZGUudHJpbSgpICE9PSAnJylcclxuICAgICAgICAgICAgICAgIHZhbGlkYXRlKCk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICdWYWxpZGF0aW9uIGNvZGUgbWlzc2luZy4nO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciB2YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgVmVyaWZpY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLnZhbGlkYXRlKHZtLmNvZGUudHJpbSgpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IFwiSW52YWxpZCBjb2RlLlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5NZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWdpc3RlcigpIHsgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhdXRoU2VydmljZS5yZWdpc3RlckV4dGVybmFsKHZtLnJlZ2lzdGVyRGF0YSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNhdmVkU3VjY2Vzc2Z1bGx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHN0YXJ0VGltZXIoKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gXCJBbiBlcnJvciBvY2N1cmVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiXHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciBzdGFydFRpbWVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdGltZXIgPSAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZXIpO1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2dnZWRJbicsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgUmVkaXJlY3Rpb25TZXJ2aWNlLnJlZGlyZWN0KCk7XHJcbiAgICAgICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL3NoYXJlZC92ZXJpZmljYXRpb24vdmVyaWZpY2F0aW9uLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXRlbXBsYXRlLXZlcmlmaWNhdGlvbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdWZXJpZmljYXRpb25TZXJ2aWNlJywgVmVyaWZpY2F0aW9uU2VydmljZSk7XHJcblxyXG4gICAgVmVyaWZpY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsJyRxJywnZW52JywnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVmVyaWZpY2F0aW9uU2VydmljZSgkaHR0cCwgJHEsIGVudiwgRGl2aXNpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIHZhbGlkYXRlOiB2YWxpZGF0ZSxcclxuICAgICAgICAgICAgcGFzc2VuZ2VyRXhpc3RzOiBwYXNzZW5nZXJFeGlzdHNcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGUoa2V5KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgICsgJ2RpdmlzaW9uLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnL1ZhbGlkYXRlP2tleT0nICsga2V5O1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoc2VydmljZVVybClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBhc3NlbmdlckV4aXN0cyhjbGllbnRQYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaU9yZ1VybCArICdwYXNzZW5nZXIvZXhpc3RzLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy8nICsgY2xpZW50UGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwLmdldChzZXJ2aWNlVXJsKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0FkZFZlaGljbGVDb250cm9sbGVyJywgQWRkVmVoaWNsZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIEFkZFZlaGljbGVDb250cm9sbGVyLiRpbmplY3QgPSBbJ2F1dGhTZXJ2aWNlJywgJ3ZlaGljbGVTZXJ2aWNlJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ2F0bGVhc3RPbmVWZWhpY2xlRXhpc3QnLCckdGltZW91dCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEFkZFZlaGljbGVDb250cm9sbGVyKGF1dGhTZXJ2aWNlLCB2ZWhpY2xlU2VydmljZSwgJHVpYk1vZGFsSW5zdGFuY2UsIGF0bGVhc3RPbmVWZWhpY2xlRXhpc3QsJHRpbWVvdXQpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnZlaGljbGVJbmZvID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLmF0bGVhc3RPbmVWZWhpY2xlRXhpc3QgPSBhdGxlYXN0T25lVmVoaWNsZUV4aXN0O1xyXG4gICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcclxuICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmVycm9yTWVzc2FnZSA9ICdBZGQgZmFpbGVkJztcclxuICAgICAgICB2bS5zaG93TWVzc2FnZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBwYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkOyAgICAgICAgXHJcbiAgICAgICAgdmFyIGlzQWRkZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5tYXhZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpICsgMTtcclxuICAgICAgICB2bS5pc1llYXJWYWxpZCA9IGlzWWVhclZhbGlkO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREZWZhdWx0VmVoaWNsZUluZm8oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICB5ZWFyOiAnJyxcclxuICAgICAgICAgICAgICAgIG1ha2U6ICcnLFxyXG4gICAgICAgICAgICAgICAgbW9kZWw6ICcnLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6ICcnLFxyXG4gICAgICAgICAgICAgICAgbGljZW5jZVBsYXRlOiAnJywgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpc0RlZmF1bHQ6ICF2bS5hdGxlYXN0T25lVmVoaWNsZUV4aXN0LFxyXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IHRydWVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzWWVhclZhbGlkKCkge1xyXG4gICAgICAgICAgICBpZiAodm0udmVoaWNsZUluZm8ueWVhciAhPT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2bS52ZWhpY2xlSW5mby55ZWFyID49ICcxOTMwJyAmJiB2bS52ZWhpY2xlSW5mby55ZWFyIDw9IHZtLm1heFllYXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd01lc3NhZ2UobXNnKSB7XHJcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBtc2c7XHJcbiAgICAgICAgICAgIHZtLnNob3dNZXNzYWdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd01lc3NhZ2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgNTAwMCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBpc0FkZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkKCkpIHtcclxuICAgICAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLnNhdmUodm0udmVoaWNsZUluZm8sIHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVJbmZvLmlkID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcmVzZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZUluZm8gPSBnZXREZWZhdWx0VmVoaWNsZUluZm8oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXNBZGRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHsgJ2lzQWRkZWQnOiBpc0FkZGVkIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZShcIkludmFsaWQgSW5wdXQhXCIpO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gISh2bS52ZWhpY2xlSW5mby5jb2xvciA9PT0gJycgfHwgdm0udmVoaWNsZUluZm8uY29sb3IudHJpbSgpID09ICcnXHJcbiAgICAgICAgICAgIHx8IHZtLnZlaGljbGVJbmZvLmxpY2VuY2VQbGF0ZSA9PT0gJycgfHwgdm0udmVoaWNsZUluZm8ubGljZW5jZVBsYXRlLnRyaW0oKSA9PSAnJ1xyXG4gICAgICAgICAgICAgICAgfHwgdm0udmVoaWNsZUluZm8ubWFrZSA9PT0gJycgfHwgdm0udmVoaWNsZUluZm8ubWFrZS50cmltKCkgPT0gJydcclxuICAgICAgICAgICAgICAgIHx8IHZtLnZlaGljbGVJbmZvLm1vZGVsID09PSAnJyB8fCB2bS52ZWhpY2xlSW5mby5tb2RlbC50cmltKCkgPT0gJydcclxuICAgICAgICAgICAgICAgIHx8IHZtLnZlaGljbGVJbmZvLnllYXIgPT09ICcnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBcclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoeydpc0FkZGVkJyA6IGlzQWRkZWR9KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIHZtLnZlaGljbGVJbmZvID0gZ2V0RGVmYXVsdFZlaGljbGVJbmZvKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdDYW5jZWxSZXNlcnZhdGlvbkNvbnRyb2xsZXInLCBDYW5jZWxSZXNlcnZhdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIENhbmNlbFJlc2VydmF0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAncmVzZXJ2YXRpb25JbmZvJywgJ1Jlc2VydmF0aW9uU2VydmljZScsICdTdG9wRGF0YVNlcnZpY2UnLCAnTWVzc2FnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBDYW5jZWxSZXNlcnZhdGlvbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkdWliTW9kYWxJbnN0YW5jZSwgcmVzZXJ2YXRpb25JbmZvLCBSZXNlcnZhdGlvblNlcnZpY2UsIFN0b3BEYXRhU2VydmljZSwgTWVzc2FnZVNlcnZpY2UpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnJlc2VydmF0aW9uSW5mbyA9IHJlc2VydmF0aW9uSW5mbztcclxuICAgICAgICB2bS5yb3V0ZU5hbWUgPSB2bS5yZXNlcnZhdGlvbkluZm8ucm91dGVOYW1lO1xyXG4gICAgICAgIHZtLnN0YXJ0VGltZSA9IHZtLnJlc2VydmF0aW9uSW5mby5zdGFydFRpbWU7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25EYXRlID0gbW9tZW50KHZtLnJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbkRhdGUpLmZvcm1hdCgnTU0vREQvWVlZWScpO1xyXG4gICAgICAgIHZtLmNhbmNlbEVycm9yID0gZmFsc2U7XHJcbiAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmVycm9yTWVzc2FnZSA9ICdTb3JyeSwgd2Ugd2VyZSB1bmFibGUgdG8gY2FuY2VsIHRoaXMgcmVzZXJ2YXRpb24uJzsgICAgXHJcblxyXG4gICAgICAgIHZtLmNhbmNlbFJlc2VydmF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5kaXNhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHZtLnJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbklkKSB7XHJcbiAgICAgICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuY2FuY2VsUmVzZXJ2YXRpb24odm0ucmVzZXJ2YXRpb25JbmZvLnBhc3NlbmdlcklkLCB2bS5yZXNlcnZhdGlvbkluZm8ucmVzZXJ2YXRpb25JZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoeyAnYWN0aW9uJzogJ2Nsb3NlJywgJ2lzQ2FuY2VsJzogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jYW5jZWxFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdCAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT0gJ0ZhaWx1cmUnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0uY2FuY2VsRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuTWFrZURpc2FibGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5kaXNhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNb2RpZnlSZXNlcnZhdGlvblBpY2t1cCcsIE1vZGlmeVJlc2VydmF0aW9uUGlja3VwKTtcclxuXHJcbiAgICBNb2RpZnlSZXNlcnZhdGlvblBpY2t1cC4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJyxcclxuICAgICAgICAndmVoaWNsZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJywgJ3Jlc2VydmF0aW9uJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTW9kaWZ5UmVzZXJ2YXRpb25QaWNrdXAoJGxvY2F0aW9uLCAkdWliTW9kYWxJbnN0YW5jZSwgUmVzZXJ2YXRpb25TZXJ2aWNlLFxyXG4gICAgICAgIHZlaGljbGVTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UsYXV0aFNlcnZpY2UsIHJlc2VydmF0aW9uKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZhciBwYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG4gICAgICAgIHZhciBuZXdSZXNlcnZhdGlvbkluZm8gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIG5vVmVoaWNsZSA9IHsgaWQ6IG51bGwsIGxpY2VuY2VwbGF0ZTogJy0tJyB9O1xyXG5cclxuICAgICAgICB2bS5yZXNlcnZhdGlvbkluZm8gPSByZXNlcnZhdGlvbjtcclxuICAgICAgICB2bS5tZXNzYWdlID0gXCJcIjtcclxuICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmN1cnJlbnRUcmlwSWQgPSB2bS5yZXNlcnZhdGlvbkluZm8udHJpcElkO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkVHJpcElkID0gdm0ucmVzZXJ2YXRpb25JbmZvLnRyaXBJZDtcclxuICAgICAgICB2bS5hdmFpbGFibGVQYXJraW5nID0gMDtcclxuICAgICAgICB2bS5zZWxlY3RlZFZlaGljbGVJZCA9IGFuZ3VsYXIuY29weSh2bS5yZXNlcnZhdGlvbkluZm8udmVoaWNsZUlkKTtcclxuICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdm0ubWFuYWdlVmVoaWNsZSA9IG1hbmFnZVZlaGljbGU7XHJcbiAgICAgICAgdm0ubW9kaWZ5VHJpcCA9IG1vZGlmeVRyaXA7XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xyXG5cclxuICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgIC5pc1dhaXRsaXN0QWxsb3dlZEJ5RGl2aXNpb24oKVxyXG4gICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBnZXRBbHRlcm5hdGVUcmlwcygpO1xyXG4gICAgICAgICAgICBnZXRQYXNzZW5nZXJWZWhpY2xlcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XHJcbiAgICAgICAgICAgICAgICAnYWN0aW9uJzogJ2Nsb3NlJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYW5hZ2VWZWhpY2xlKCkge1xyXG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLm1hbmFnZVBhcmtpbmdGb3JSZXNlcnZhdGlvbihwYXNzZW5nZXJJZCwgdm0ucmVzZXJ2YXRpb25JbmZvLmlkLCB2bS5zZWxlY3RlZFZlaGljbGVJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtc2cgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBtc2c7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdhY3Rpb24nOiAnY2xvc2UnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncmVmcmVzaCc6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdyZXNlcnZhdGlvbklkJzogcmVzcG9uc2UuZGF0YS5yZXN1bHQuaWRcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsdGVybmF0ZVRyaXBzKCkge1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgIC5nZXRBbGxUcmlwc0ZvckN1cnJlbnRSZXNlcnZhdGlvbih2bS5yZXNlcnZhdGlvbkluZm8uaWQsIHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICB2bS50cmlwcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LmFsdFRyaXBzO1xyXG4gICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVQYXJraW5nID0gdm0udHJpcHNbMF0uYXZhaWxhYmxlUGFya2luZztcclxuICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBhc3NlbmdlclZlaGljbGVzKCkge1xyXG4gICAgICAgICAgICB2ZWhpY2xlU2VydmljZS5nZXRWZWhpY2xlc0ZvclBhc3NlbmdlcihwYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXMgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzLnNwbGljZSgwLCAwLCBub1ZlaGljbGUpO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzLnB1c2gobm9WZWhpY2xlKTsgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbW9kaWZ5VHJpcCgpIHtcclxuICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5tZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgLm1vZGlmeVJlc2VydmF0aW9uKHZtLnJlc2VydmF0aW9uSW5mby5pZCwgdm0uc2VsZWN0ZWRUcmlwSWQsIHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0Lm1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnYWN0aW9uJzogJ2Nsb3NlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZnJlc2gnOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncmVzZXJ2YXRpb25JZCc6IHJlc3BvbnNlLmRhdGEucmVzdWx0LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBlcnJvcjtcclxuICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW5pdCgpO1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuXHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmNvbnRyb2xsZXIoJ0NvbW11dGVyRmVlZGJhY2tNb2RhbENvbnRyb2xsZXInLCBDb21tdXRlckZlZWRiYWNrTW9kYWxDb250cm9sbGVyKTtcclxuXHJcbiAgICBDb21tdXRlckZlZWRiYWNrTW9kYWxDb250cm9sbGVyLiRpbmplY3QgPSBbJyR1aWJNb2RhbEluc3RhbmNlJywgJ1V0aWxpdHlGYWN0b3J5JywgJ0NvbmZpZ0ZhY3RvcnknLCAnRmVlZGJhY2tTZXJ2aWNlJywgJ2ZlZWRiYWNrSW5mbyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIENvbW11dGVyRmVlZGJhY2tNb2RhbENvbnRyb2xsZXIoJHVpYk1vZGFsSW5zdGFuY2UsVXRpbGl0eUZhY3RvcnksIENvbmZpZ0ZhY3RvcnksIEZlZWRiYWNrU2VydmljZSwgZmVlZGJhY2tJbmZvKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5mZWVkYmFja0luZm8gPSBhbmd1bGFyLmNvcHkoZmVlZGJhY2tJbmZvKTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIHZtLnNhdmVGZWVkYmFjayA9IHNhdmVGZWVkYmFjaztcclxuXHJcblxyXG4gICAgICAgIHZtLmRpc2FibGVTdWJtaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5mZWVkYmFja0luZm8ucmF0aW5nIDw9IDAgfHwgdm0uZmVlZGJhY2tJbmZvLnJhdGluZyA9PSBudWxsO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe2lzU2F2ZWQ6ZmFsc2V9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlRmVlZGJhY2soKSB7ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBGZWVkYmFja1NlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5hZGRDb21tdXRlckZlZWRiYWNrKFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIENvbW1lbnQ6IHZtLmZlZWRiYWNrSW5mby5jb21tZW50LnRyaW0oKSxcclxuICAgICAgICAgICAgICAgICAgICBSYXRpbmc6IHZtLmZlZWRiYWNrSW5mby5yYXRpbmdcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5mZWVkYmFja0luZm8ucmVzZXJ2YXRpb25JZClcclxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoXCJTdWNjZXNzIVwiLCBcIkZlZWRiYWNrIHNhdmVkIHN1Y2Nlc3NmdWxseVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7aXNTYXZlZCA6dHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCJDb3VsZCBub3Qgc2F2ZSBmZWVkYmFja1wiKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3I6IC0gJyArIHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiQ291bGQgbm90IHNhdmUgZmVlZGJhY2tcIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3I6IC0gJyArIHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdSZW1vdmVWZWhpY2xlQ29uZmlybWF0aW9uQ29udHJvbGxlcicsIFJlbW92ZVZlaGljbGVDb25maXJtYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBSZW1vdmVWZWhpY2xlQ29uZmlybWF0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCckdWliTW9kYWxJbnN0YW5jZScsJ3ZlaGljbGVTZXJ2aWNlJywnaWQnLCdhdXRoU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJlbW92ZVZlaGljbGVDb25maXJtYXRpb25Db250cm9sbGVyKCRsb2NhdGlvbiwgJHVpYk1vZGFsSW5zdGFuY2UsIHZlaGljbGVTZXJ2aWNlLCBpZCwgYXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5pc1JlbW92aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLnJlbW92ZVZlaGljbGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzUmVtb3ZpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2ZWhpY2xlU2VydmljZS5yZW1vdmVWZWhpY2xlKGlkLCBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHsgcmVtb3ZlZDogdHJ1ZSB9KTsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdCAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCAhPT0gJycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7IHJlbW92ZWQ6IGZhbHNlLCBlcnJvck1lc3NhZ2U6IHJlc3BvbnNlLmRhdGEucmVzdWx0IH0pO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKHtyZW1vdmVkOmZhbHNlfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Jlc2VydmF0aW9uTWFwQ29udHJvbGxlcicsIFJlc2VydmF0aW9uTWFwQ29udHJvbGxlcik7XHJcblxyXG4gICAgUmVzZXJ2YXRpb25NYXBDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9jYXRpb24nLCAnJHRpbWVvdXQnLCAnJGh0dHAnLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCckaW50ZXJ2YWwnLFxyXG4gICAgICAgICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAgJ1N0b3BEYXRhU2VydmljZScsICd1aUdtYXBJc1JlYWR5JywgJ0xvY2F0aW9uU2VydmljZScsICdyZXNlcnZhdGlvbl9zdG9wcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJlc2VydmF0aW9uTWFwQ29udHJvbGxlcigkc2NvcGUsICRsb2NhdGlvbiwgJHRpbWVvdXQsICRodHRwLCAkdWliTW9kYWxJbnN0YW5jZSwgJGludGVydmFsLFxyXG4gICAgICAgIEdlb0xvY2F0aW9uU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlLHVpR21hcElzUmVhZHksIExvY2F0aW9uU2VydmljZSwgcmVzZXJ2YXRpb25fc3RvcHMpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ1NjaGVkdWxlIFN0b3BzJztcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdm0uc3RvcE1hcmtlciA9IFtdO1xyXG4gICAgICAgIHZhciBhdXRvUmVmcmVzaE1hcmtlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2bS5tYXAgPSB7XHJcbiAgICAgICAgICAgIC8vIGh0dHA6Ly9hbmd1bGFyLWdvb2dsZS1tYXBzLm9yZy91c2VcclxuICAgICAgICAgICAgY2VudGVyOiB7XHJcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogNDMuNzU1MTQyMjExOTE0MDYsXHJcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IC0xMTYuNTc1OTczNTEwNzQyMTlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgem9vbTogMTAsXHJcbiAgICAgICAgICAgIGxpbmVTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgY29sb3I6ICcjMzMzJyxcclxuICAgICAgICAgICAgICAgIHdlaWdodDogNSxcclxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuN1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG4gICAgICAgIHZtLm15TG9jYXRpb25JY29uID0ge1xyXG4gICAgICAgICAgICB1cmw6IG15TG9jYXRpb25QaW4sXHJcbiAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDQyLCA0MiksXHJcbiAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyMCwgMjApXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25TdG9wcyA9IHJlc2VydmF0aW9uX3N0b3BzO1xyXG4gICAgICAgIGlmICh2bS5yZXNlcnZhdGlvblN0b3BzLmlkICE9IG51bGwgfHwgdm0ucmVzZXJ2YXRpb25TdG9wcy5pZCAhPSAnJylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh2bS5yZXNlcnZhdGlvblN0b3BzLnNjaGVkdWxlVHlwZSA9PSAnQU0nKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pY29uID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmVlbi5zdmcnXHJcbiAgICAgICAgICAgICAgICB2bS5odWJJY29uID0gJ2ltYWdlcy9waW4taHViLnN2ZydcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5zdG9wTWFya2VyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICdzdG9wSWQnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cFN0b3BJZCwgJ3N0b3BOYW1lJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBTdG9wTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cExhdGl0dWRlLCAnbG9uZ2l0dWRlJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiB2bS5pY29uLCAnYWRkcmVzcyc6IHZtLnJlc2VydmF0aW9uU3RvcHMucGlja3VwQWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2bS5zdG9wTWFya2VyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICdzdG9wSWQnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZTdG9wSWQsICdzdG9wTmFtZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZlN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZkxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5kcm9wb2ZmTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICdpY29uJzogdm0uaHViSWNvbiwgJ2FkZHJlc3MnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZBZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLmljb24gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZXkuc3ZnJ1xyXG4gICAgICAgICAgICAgICAgdm0uaHViSWNvbiA9ICdpbWFnZXMvcGluLWh1Yi5zdmcnXHJcblxyXG4gICAgICAgICAgICAgICAgdm0uc3RvcE1hcmtlci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAnc3RvcElkJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBTdG9wSWQsICdzdG9wTmFtZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMucGlja3VwU3RvcE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBMYXRpdHVkZSwgJ2xvbmdpdHVkZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMucGlja3VwTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICdpY29uJzogdm0uaHViSWNvbiwgJ2FkZHJlc3MnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cEFkZHJlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdm0uc3RvcE1hcmtlci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAnc3RvcElkJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5kcm9wb2ZmU3RvcElkLCAnc3RvcE5hbWUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZTdG9wTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZMYXRpdHVkZSwgJ2xvbmdpdHVkZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZkxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAnaWNvbic6IHZtLmljb24sICdhZGRyZXNzJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5kcm9wb2ZmQWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBhdXRvUmVmcmVzaE1hcmtlciA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGdldE15TG9jYXRpb24oKTtcclxuICAgICAgICB9LCAxMDAwMCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldE15TG9jYXRpb24oKVxyXG4gICAgICAgIHsgICAgICAgICAgICBcclxuICAgICAgICAgIEdlb0xvY2F0aW9uU2VydmljZS5nZXRDdXJyZW50UG9zaXRpb24oKSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbiA9PSB1bmRlZmluZWQgfHwgcG9zaXRpb24gPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzdG9wQXV0b1JlZnJlc2hNYXJrZXIoKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLm15TG9jYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJjb29yZHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxhdGl0dWRlXCI6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsb25naXR1ZGVcIjogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgXCJpY29uXCI6IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBib3VuZHMgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uc3RvcE1hcmtlciwgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhzdG9wLmxhdGl0dWRlLCBzdG9wLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL21hcmtlciBjbGljayBmdW5jdGlvblxyXG4gICAgICAgIHZtLm1hcmtlckV2ZW50ID0ge1xyXG4gICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGdNYXJrZXIsIGV2ZW50TmFtZSwgbW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChtb2RlbC4kaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL25hdmlnYXRlVG9TZWxlY3RlZFN0b3AobW9kZWwuY29vcmRzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRMb2NhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldEdlb0xvY2F0aW9uKHZtLnNlbGVjdGVkTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKG1vZGVsLmNvb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY29vcmRzID0gbW9kZWwuY29vcmRzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzdG9wQXV0b1JlZnJlc2hNYXJrZXIoKTtcclxuICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgICAgICAgICB2bS5pc0RvbmUgPSB0cnVlO1xyXG4gICAgICAgfTtcclxuXHJcbiAgICAgICBmdW5jdGlvbiBzdG9wQXV0b1JlZnJlc2hNYXJrZXIoKSB7XHJcbiAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGF1dG9SZWZyZXNoTWFya2VyKSkge1xyXG4gICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGF1dG9SZWZyZXNoTWFya2VyKTtcclxuICAgICAgICAgICAgICAgYXV0b1JlZnJlc2hNYXJrZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgfTtcclxuXHJcbiAgICAgICAkc2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgIHN0b3BBdXRvUmVmcmVzaE1hcmtlcigpO1xyXG4gICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignUmVzZXJ2YXRpb25Db250cm9sbGVyJywgUmVzZXJ2YXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBSZXNlcnZhdGlvbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3Jlc2VydmF0aW9uSW5mbycsICckaW50ZXJ2YWwnLCAnJHJvb3RTY29wZScsXHJcbiAgICAgICAgJ2lzQWRkJywgJ1Jlc2VydmF0aW9uU2VydmljZScsICdNZXNzYWdlU2VydmljZScsICd2ZWhpY2xlU2VydmljZScsICdTdG9wRGF0YVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUmVzZXJ2YXRpb25Db250cm9sbGVyKCRsb2NhdGlvbiwgJHVpYk1vZGFsSW5zdGFuY2UsIHJlc2VydmF0aW9uSW5mbywgJGludGVydmFsLCAkcm9vdFNjb3BlLFxyXG4gICAgICAgIGlzQWRkLCBSZXNlcnZhdGlvblNlcnZpY2UsIE1lc3NhZ2VTZXJ2aWNlLCB2ZWhpY2xlU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLmlzQWRkID0gaXNBZGQ7XHJcbiAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlzUmVzZXJ2ZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5oYXNWZWhpY2xlcyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLm5lZWRzUGFya2luZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnZlaGljbGVzID0gW107XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRWZWhpY2xlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLmxvYWRpbmdWZWhpY2xlcyA9IHRydWU7XHJcbiAgICAgICAgdm0uaXNBTVJlc2VydmF0aW9uID0gcmVzZXJ2YXRpb25JbmZvLnNjaGVkdWxlVHlwZSA9PT0gXCJBTVwiO1xyXG4gICAgICAgIHZtLnBhcmtpbmdOb3RBdmFpbGFibGUgPSBmYWxzZTtcclxuICAgICAgICB2bS5ub1BhcmtpbmdNZXNzYWdlID0gXCJQYXJraW5nIG5vdCBhdmFpbGFibGUuXCI7XHJcbiAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZ1Nsb3RzID0gMDtcclxuICAgICAgICB2bS5pc1BhcmtpbmdBdHRhY2hlZFRvUmVzZXJ2YXRpb24gPSB0cnVlO1xyXG4gICAgICAgIHZtLnJlc2VydmF0aW9uRGF0YSA9IHJlc2VydmF0aW9uSW5mbztcclxuICAgICAgICB2bS51cGRhdGVMYWJlbHMgPSB1cGRhdGVMYWJlbHM7XHJcbiAgICAgICAgdmFyIGF2YWlsYWJsZVNlYXRzID0gMDtcclxuICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gdHJ1ZTtcclxuICAgICAgICB2bS5udW1Db21wYW5pb25zID0gW107XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRDb21wYW5pb25zID0gMDtcclxuXHJcblxyXG4gICAgICAgIHZhciBub1ZlaGljbGUgPSB7ICdsaWNlbmNlcGxhdGUnOiAnLS0nLCAnaWQnOiB1bmRlZmluZWQgfTtcclxuXHJcbiAgICAgICAgdm0ucmVzZXJ2ZSA9IHJlc2VydmU7XHJcblxyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgIC5pc1dhaXRsaXN0QWxsb3dlZEJ5RGl2aXNpb24oKVxyXG4gICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgIGdldEF2YWlsYWJsZVNlYXRzKCk7XHJcbiAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICBnZXRBdmFpbGFibGVTZWF0cygpO1xyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVMYWJlbHMoKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QpXHJcbiAgICAgICAgICAgICAgICBzZXRSZXNlcnZhdGlvbkxhYmVscygpO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc1BhcmtpbmdTZWxlY3RlZEFuZFVuQXZhaWxhYmxlKCkgfHwgYXZhaWxhYmxlU2VhdHMgPCAxICsgdm0uc2VsZWN0ZWRDb21wYW5pb25zKVxyXG4gICAgICAgICAgICAgICAgICAgIHNldFdhaXRsaXN0TGFiZWxzKCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0UmVzZXJ2YXRpb25MYWJlbHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNQYXJraW5nU2VsZWN0ZWRBbmRVbkF2YWlsYWJsZSgpIHtcclxuICAgICAgICAgICAgaWYgKCF2bS5pc0FNUmVzZXJ2YXRpb24pIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB2bS5zZWxlY3RlZFZlaGljbGUgIT09IG5vVmVoaWNsZVxyXG4gICAgICAgICAgICAgICAgICAgICYmIHZtLmF2YWlsYWJsZVBhcmtpbmdTbG90cyA8PSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlU2VhdHMoKSB7XHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5nZXRBdmFpbGFibGVTZWF0c0ZvclRyaXAocmVzZXJ2YXRpb25JbmZvLnRyaXAudHJpcElkLCBEYXRlLnBhcnNlKHJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbkRhdGUpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VmVoaWNsZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlU2VhdHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5hdmFpbGFibGVDYXBhY2l0eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LmFsbG93ZWRDb21wYW5pb25zID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSByZXNwb25zZS5kYXRhLnJlc3VsdC5hbGxvd2VkQ29tcGFuaW9uczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubnVtQ29tcGFuaW9ucy5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0UmVzZXJ2YXRpb25MYWJlbHMoKSB7XHJcbiAgICAgICAgICAgIHZtLmJ0blRleHQgPSAnUmVzZXJ2ZSBTZWF0JztcclxuICAgICAgICAgICAgdm0ubW9kYWxUZXh0ID0gJ1Jlc2VydmUgYSBzZWF0JztcclxuICAgICAgICAgICAgdm0ubW9kYWxTdWNjZXNzVGV4dCA9ICdSZXNlcnZhdGlvbiBDcmVhdGVkJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldFdhaXRsaXN0TGFiZWxzKCkge1xyXG4gICAgICAgICAgICB2bS5idG5UZXh0ID0gJ0FkZCBUbyBXYWl0bGlzdCc7XHJcbiAgICAgICAgICAgIHZtLm1vZGFsVGV4dCA9ICdBZGQgdG8gd2FpdGxpc3QnO1xyXG4gICAgICAgICAgICB2bS5tb2RhbFN1Y2Nlc3NUZXh0ID0gJ0FkZGVkIFRvIFdhaXRsaXN0JztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBhcmtpbmdJbmZvKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKCF2bS5pc0FNUmVzZXJ2YXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZUxhYmVscygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAuZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wKHJlc2VydmF0aW9uSW5mby5waWNrdXBTdG9wLmlkLCByZXNlcnZhdGlvblRpbWVzcGFuKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZ1Nsb3RzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uYXZhaWxhYmxlUGFya2luZ1Nsb3RzIDw9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucGFya2luZ05vdEF2YWlsYWJsZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlTGFiZWxzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0luZm9ybWF0aW9uKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VmVoaWNsZXMoKSB7XHJcbiAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLmdldFZlaGljbGVzRm9yUGFzc2VuZ2VyKHJlc2VydmF0aW9uSW5mby5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZ2V0UGFya2luZ0luZm8oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZXMuc3BsaWNlKDAsIDAsIG5vVmVoaWNsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRWZWhpY2xlID0gZmluZERlZmF1bHQodm0udmVoaWNsZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmhhc1ZlaGljbGVzID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmlzQU1SZXNlcnZhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubmVlZHNQYXJraW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXZtLnZlaGljbGVzIHx8IHZtLnZlaGljbGVzLmxlbmd0aCA9PT0gMClcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFZlaGljbGUgPSBub1ZlaGljbGU7XHJcblxyXG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1ZlaGljbGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0uaGFzVmVoaWNsZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmdWZWhpY2xlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaW5kRGVmYXVsdCh2ZWhpY2xlcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZlaGljbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmVoaWNsZXNbaV0uaXNEZWZhdWx0KSByZXR1cm4gdmVoaWNsZXNbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5vVmVoaWNsZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNlcnZhdGlvblRpbWVzcGFuKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gRGF0ZS5wYXJzZShyZXNlcnZhdGlvbkluZm8ucmVzZXJ2YXRpb25EYXRlKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXJ2ZSgpIHtcclxuICAgICAgICAgICAgdm0uZGlzYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciByZXNlcnZhdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICdwaWNrdXBTdG9wSWQnOiByZXNlcnZhdGlvbkluZm8ucGlja3VwU3RvcC5pZCxcclxuICAgICAgICAgICAgICAgICdkcm9wb2ZmU3RvcElkJzogcmVzZXJ2YXRpb25JbmZvLmRyb3BvZmZTdG9wLmlkLFxyXG4gICAgICAgICAgICAgICAgJ3RyaXBJZCc6IHJlc2VydmF0aW9uSW5mby50cmlwLnRyaXBJZCxcclxuICAgICAgICAgICAgICAgICdyZXNlcnZhdGlvbkRhdGUnOiByZXNlcnZhdGlvbkluZm8ucmVzZXJ2YXRpb25EYXRlLFxyXG4gICAgICAgICAgICAgICAgJ3Bhc3NlbmdlcklkJzogcmVzZXJ2YXRpb25JbmZvLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgJ2RpdmlzaW9uSWQnOiByZXNlcnZhdGlvbkluZm8uZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgICdyb3V0ZUlkJzogcmVzZXJ2YXRpb25JbmZvLnRyaXAucm91dGVJZCxcclxuICAgICAgICAgICAgICAgICdzY2hlZHVsZSc6IHJlc2VydmF0aW9uSW5mby5zY2hlZHVsZVR5cGUsXHJcbiAgICAgICAgICAgICAgICAnY29tcGFuaW9ucycgOnZtLnNlbGVjdGVkQ29tcGFuaW9uc1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5uZWVkc1BhcmtpbmcgJiYgIWFuZ3VsYXIuaXNVbmRlZmluZWQodm0uc2VsZWN0ZWRWZWhpY2xlLmlkKSkge1xyXG4gICAgICAgICAgICAgICAgcmVzZXJ2YXRpb24udmVoaWNsZUlkID0gdm0uc2VsZWN0ZWRWZWhpY2xlLmlkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuYWRkUmVzZXJ2YXRpb25zKHJlc2VydmF0aW9uSW5mby5wYXNzZW5nZXJJZCwgW3Jlc2VydmF0aW9uXSkudGhlbihoYW5kbGVSZXNlcnZhdGlvblN1Y2Nlc3MpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVJlc2VydmF0aW9uU3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LmVycm9ycyAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5lcnJvcnMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93SW5mb3JtYXRpb24ocmVzcG9uc2UuZGF0YS5yZXN1bHQuZXJyb3JzWzBdKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBnZXRSZXNlcnZhdGlvbihyZXNlcnZhdGlvbkluZm8ucGFzc2VuZ2VySWQsIHJlc3BvbnNlLmRhdGEucmVzdWx0LmlkWzBdKTtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93SW5mb3JtYXRpb24oXCJFcnJvciBwcm9jZXNzaW5nIHJlc2VydmF0aW9uLlwiKTtcclxuXHJcbiAgICAgICAgICAgIHZtLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRSZXNlcnZhdGlvbihwYXNzZW5nZXJJZCwgcklkKSB7XHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5nZXRSZXNlcnZhdGlvbkJ5SWQocGFzc2VuZ2VySWQsIHJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1Jlc2VydmVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLmNvbmZpcm1hdGlvbk51bWJlciA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LmNvbmZpcm1hdGlvbk51bWJlcjtcclxuICAgICAgICAgICAgICAgIC8vaGlkZSBwYXJraW5nIHNlY3Rpb24gaWYgbm90IHNlbGVjdGVkLlxyXG4gICAgICAgICAgICAgICAgaWYgKCF2bS5uZWVkc1BhcmtpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNQYXJraW5nQXR0YWNoZWRUb1Jlc2VydmF0aW9uID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLmdldEF2YWlsYWJsZVBhcmtpbmdzRm9yU3RvcChyZXNlcnZhdGlvbkluZm8ucGlja3VwU3RvcC5pZCwgcmVzZXJ2YXRpb25UaW1lc3BhbigpKVxyXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLmF2YWlsYWJsZVBhcmtpbmdTbG90cyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb24nOiAnY2xvc2UnLCAnaXNSZXNlcnZlZCc6IHZtLmlzUmVzZXJ2ZWRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ubmF2aWdhdGVUb1Jlc2VydmF0aW9uUGFnZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbic6ICdyZXNlcnZhdGlvbidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ubmF2aWdhdGVUb0FkZFZlaGljbGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XHJcbiAgICAgICAgICAgICAgICAnYWN0aW9uJzogJ3ZlaGljbGUnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuTWFrZURpc2FibGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5kaXNhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGluaXQoKTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignU3RvcHNNYXBDb250cm9sbGVyJywgU3RvcHNNYXBDb250cm9sbGVyKTtcclxuXHJcbiAgICBTdG9wc01hcENvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJ0dlb0xvY2F0aW9uU2VydmljZScsXHJcbiAgICAgICAgJ1N0b3BEYXRhU2VydmljZScsICd1aUdtYXBJc1JlYWR5JywgJ0xvY2F0aW9uU2VydmljZScsICckaHR0cCcsICckdGltZW91dCcsXHJcbiAgICAgICAgJ3NjaGVkdWxlX3N0b3BzJywgJ3JvdXRlRGF0YScsICckdWliTW9kYWxJbnN0YW5jZScsICckd2luZG93J107XHJcblxyXG4gICAgZnVuY3Rpb24gU3RvcHNNYXBDb250cm9sbGVyKCRsb2NhdGlvbiwgR2VvTG9jYXRpb25TZXJ2aWNlLFxyXG4gICAgICAgIFN0b3BEYXRhU2VydmljZSwgdWlHbWFwSXNSZWFkeSwgTG9jYXRpb25TZXJ2aWNlLCAkaHR0cCwgJHRpbWVvdXQsXHJcbiAgICAgICAgc2NoZWR1bGVfc3RvcHMsIHJvdXRlRGF0YSwgJHVpYk1vZGFsSW5zdGFuY2UsICR3aW5kb3cpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdTY2hlZHVsZSBTdG9wcydcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdm0uc3RvcE1hcmtlciA9IFtdO1xyXG4gICAgICAgIHZtLm1hcCA9IHtcclxuICAgICAgICAgICAgLy8gaHR0cDovL2FuZ3VsYXItZ29vZ2xlLW1hcHMub3JnL3VzZVxyXG4gICAgICAgICAgICBjZW50ZXI6IHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiA0My43NTUxNDIyMTE5MTQwNixcclxuICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogLTExNi41NzU5NzM1MTA3NDIxOVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB6b29tOiAxMCxcclxuICAgICAgICAgICAgbGluZVN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjogJyMzMzMnLFxyXG4gICAgICAgICAgICAgICAgd2VpZ2h0OiA1LFxyXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMC43XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBteVN0eWxlcyA9IFtcclxuICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInBvaVwiLFxyXG4gICAgICAgICAgICAgICBlbGVtZW50VHlwZTogXCJsYWJlbHNcIixcclxuICAgICAgICAgICAgICAgc3R5bGVyczogW1xyXG4gICAgICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwib2ZmXCIgfVxyXG4gICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgfSxcclxuICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0XCIsXHJcbiAgICAgICAgICAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMuaWNvblwiLFxyXG4gICAgICAgICAgICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IG15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBidXNTdG9wR3JlZW4sIGJ1c1N0b3BHcmV5LCBodWJJY29uLCBwaWNrdXBJY29uO1xyXG4gICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuICAgICAgICAgICAgYnVzU3RvcEdyZWVuID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmVlbi5wbmcnO1xyXG4gICAgICAgICAgICBidXNTdG9wR3JleSA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5wbmcnO1xyXG4gICAgICAgICAgICBodWJJY29uID0gJ2ltYWdlcy9waW4taHViLnBuZyc7XHJcbiAgICAgICAgICAgIHBpY2t1cEljb24gPSAnaW1hZ2VzL3Bpbl9waWNrdXAucG5nJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGJ1c1N0b3BHcmVlbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JlZW4uc3ZnJztcclxuICAgICAgICAgICAgYnVzU3RvcEdyZXkgPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZXkuc3ZnJztcclxuICAgICAgICAgICAgaHViSWNvbiA9ICdpbWFnZXMvcGluLWh1Yi5zdmcnO1xyXG4gICAgICAgICAgICBwaWNrdXBJY29uID0gJ2ltYWdlcy9waW5fcGlja3VwLnN2Zyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zY2hlZHVsZVN0b3BzID0gc2NoZWR1bGVfc3RvcHM7XHJcblxyXG4gICAgICAgIGlmICh2bS5zY2hlZHVsZVN0b3BzLklzQU0pIHsvLyBUQkQgYWRkIHRoaXMgZmllbGRcclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLnNjaGVkdWxlU3RvcHMuc3RvcHMsIGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pY29uID0geyB1cmw6IGJ1c1N0b3BHcmVlbiB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0b3AuaXNIdWIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pY29uID0geyB1cmw6IGh1Ykljb24gfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0uc3RvcE1hcmtlci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAnc3RvcElkJzogc3RvcC5zdG9wSWQsICdzdG9wTmFtZSc6IHN0b3AubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiBzdG9wLmxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogc3RvcC5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiB2bS5pY29uLFxyXG4gICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJzogc3RvcC5hZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uc2NoZWR1bGVTdG9wcy5zdG9wcywgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgIHZtLmljb24gPSB7IHVybDogYnVzU3RvcEdyZXkgfTtcclxuICAgICAgICAgICAgICAgIGlmIChzdG9wLmlzSHViKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaWNvbiA9IHsgdXJsOiBodWJJY29uIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLnN0b3BNYXJrZXIucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3N0b3BJZCc6IHN0b3Auc3RvcElkLCAnc3RvcE5hbWUnOiBzdG9wLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogc3RvcC5sYXRpdHVkZSwgJ2xvbmdpdHVkZSc6IHN0b3AubG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICdpY29uJzogdm0uaWNvbixcclxuICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcyc6IHN0b3AuYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uaWNvbiA9ICdpbWFnZXMvcGluX3BpY2t1cC5zdmcnO1xyXG4gICAgICAgIHZtLmljb24gPSB7IHVybDogcGlja3VwSWNvbiB9O1xyXG4gICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuXHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJvdXRlRGF0YSAhPSBudWxsICYmIHJvdXRlRGF0YS5sZW5ndGggPiAwKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRlY29kZWRQYXRoID0gZ29vZ2xlLm1hcHMuZ2VvbWV0cnkuZW5jb2RpbmcuZGVjb2RlUGF0aChyb3V0ZURhdGFbMF0ubGluZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IGRlY29kZWRQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbnM6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLlN5bWJvbFBhdGguRk9SV0FSRF9PUEVOX0FSUk9XLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDIuNVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6ICcyNXB4JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAnMjAwcHgnLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDFcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxpbmVTdHJva2UgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IGRlY29kZWRQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZUNvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMS4wLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogOCxcclxuICAgICAgICAgICAgICAgICAgICB6aW5kZXg6IDBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgbGluZS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgbGluZVN0cm9rZS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkZWNvZGVkUGF0aCAmJiBkZWNvZGVkUGF0aC5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRlY29kZWRQYXRoLCBmdW5jdGlvbiAobCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhsLmxhdCgpLCBsLmxuZygpKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uc3RvcE1hcmtlciwgZnVuY3Rpb24gKG0pIHtcclxuICAgICAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcobS5sYXRpdHVkZSwgbS5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZtLnBvbHlsaW5lcyA9IFt7XHJcbiAgICAgICAgICAgIGlkOiAxLFxyXG4gICAgICAgICAgICBwYXRoOiB2bS5wYXRoLFxyXG4gICAgICAgICAgICBzdHJva2U6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiAnIzYwNjBGQicsXHJcbiAgICAgICAgICAgICAgICB3ZWlnaHQ6IDVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBnZW9kZXNpYzogdHJ1ZSxcclxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICB9XTtcclxuXHJcbiAgICAgICAgLy9tYXJrZXIgY2xpY2sgZnVuY3Rpb25cclxuICAgICAgICB2bS5tYXJrZXJFdmVudCA9IHtcclxuICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uIChnTWFya2VyLCBldmVudE5hbWUsIG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kZWwuJGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9uYXZpZ2F0ZVRvU2VsZWN0ZWRTdG9wKG1vZGVsLmNvb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkTG9jYXRpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5zZWxlY3RlZExvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0U3RvcChtb2RlbC5jb29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICAgICAgICAgIHZtLmlzRG9uZSA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2JhY2tDb250cm9sJywgYmFja0NvbnRyb2wpO1xyXG5cclxuICAgIGJhY2tDb250cm9sLiRpbmplY3QgPSBbJyR3aW5kb3cnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBiYWNrQ29udHJvbCgkd2luZG93KSB7XHJcblxyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6dHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGU6ICc8YnV0dG9uIGNsYXNzPVwiZ28tYmFja1wiIG5nLWNsaWNrPVwiZ29CYWNrKClcIj5CYWNrPC9idXR0b24+J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlcigkc2NvcGUsJHdpbmRvdykge1xyXG4gICAgICAgICAgICAkc2NvcGUuZ29CYWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJHdpbmRvdy5oaXN0b3J5LmJhY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZpbHRlcigncm91dGVTdG9wc05hbWUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAocm91dGVMb25nTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlTG9uZ05hbWUgJiYgcm91dGVMb25nTmFtZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0SW5kZXggPSByb3V0ZUxvbmdOYW1lLmluZGV4T2YoXCItXCIpICsgMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kSW5kZXggPSByb3V0ZUxvbmdOYW1lLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm91dGVMb25nTmFtZS5zdWJzdHJpbmcoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmlsdGVyKCdyb3V0ZVNob3J0TmFtZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyb3V0ZUxvbmdOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocm91dGVMb25nTmFtZSAmJiByb3V0ZUxvbmdOYW1lLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZEluZGV4ID0gcm91dGVMb25nTmFtZS5pbmRleE9mKFwiLVwiKSAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlTG9uZ05hbWUuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgncm91dGVDYXJkJywgcm91dGVDYXJkKTtcclxuXHJcbiAgICByb3V0ZUNhcmQuJGluamVjdCA9IFsnJHdpbmRvdyddO1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiByb3V0ZUNhcmQoJHdpbmRvdykge1xyXG4gICAgICAgIC8vIFVzYWdlOlxyXG4gICAgICAgIC8vICAgICA8cm91dGUtY2FyZD48L3JvdXRlLWNhcmQ+XHJcbiAgICAgICAgLy8gQ3JlYXRlczpcclxuICAgICAgICAvLyBcclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcclxuICAgICAgICAgICAgc2NvcGU6IHsgcm91dGVJbmZvOiAnPScsIG9uU2VsZWN0OiAnJicsIHBpbm5hYmxlOiAnPSd9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2ZpeGVkLXJvdXRlL2RpcmVjdGl2ZXMvcm91dGUtY2FyZC9yb3V0ZS1jYXJkLmh0bWwnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJyb3V0ZUluZm9cIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgLy9UaGlzIGdldHMgY2FsbGVkIHdoZW4gZGF0YSBjaGFuZ2VzLlxyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucm91dGVJbmZvID0gSlNPTi5wYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnJvdXRlSW5mbyA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRzY29wZSwgJGxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZhdGVUcmlwID0gYWN0aXZhdGVUcmlwO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZhdGVSb3V0ZSA9IGFjdGl2YXRlUm91dGU7XHJcbiAgICAgICAgICAgICRzY29wZS5nb3RvUm91dGVXaXRoU3RvcHMgPSBnb3RvUm91dGVXaXRoU3RvcHM7XHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmF0ZSA9IGFjdGl2YXRlO1xyXG4gICAgICAgICAgICAvLyRzY29wZS5pc1JvdXRlU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXAgPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlzQW55VHJpcEFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucm91dGVJbmZvLnRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yb3V0ZUluZm8udHJpcHNbaV0uaXNBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXAgPSAkc2NvcGUucm91dGVJbmZvLnRyaXBzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0FueVRyaXBBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGlmICghaXNBbnlUcmlwQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yb3V0ZUluZm8gJiYgJHNjb3BlLnJvdXRlSW5mby50cmlwcyAmJiAhJHNjb3BlLmFjdGl2ZVRyaXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXAgPSAkc2NvcGUucm91dGVJbmZvLnRyaXBzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucm91dGVJbmZvLnRyaXBzWzBdLmlzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZVRyaXAodHJpcCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXAgPSB0cmlwO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucm91dGVJbmZvLnRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucm91dGVJbmZvLnRyaXBzW2ldID09PSB0cmlwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yb3V0ZUluZm8udHJpcHNbaV0uaXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yb3V0ZUluZm8udHJpcHNbaV0uaXNBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZVJvdXRlKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJvdXRlSW5mby5pc1NlbGVjdGVkID0gISRzY29wZS5yb3V0ZUluZm8uaXNTZWxlY3RlZFxyXG4gICAgICAgICAgICAgICAgLy9TZW5kIGJhY2sgdGhlIHNlbGVjdGVkIHJvdXRlIHRvIHBhcmVudCBjb250cm9sbGVyXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9uU2VsZWN0ICYmIHR5cGVvZiAkc2NvcGUub25TZWxlY3QgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub25TZWxlY3QoeyBzY2hlZHVsZTogJHNjb3BlLnJvdXRlSW5mbyB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdvdG9Sb3V0ZVdpdGhTdG9wcygpIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiZml4ZWQtcm91dGUvcm91dGVzL1wiICsgJHNjb3BlLnJvdXRlSW5mby5yb3V0ZS5pZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7ICBcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnc3RvcEFycml2YWxJbmZvJywgc3RvcEFycml2YWxJbmZvKTtcclxuXHJcbiAgICBzdG9wQXJyaXZhbEluZm8uJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIHN0b3BBcnJpdmFsSW5mbygpIHtcclxuXHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgbGluazogbGluayxcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlciwgICAgICAgICAgICBcclxuICAgICAgICAgICAgc2NvcGU6IHsgcm91dGVBcnJpdmFsOiAnPScsIHNlbGVjdGVkU3RvcElkOic9JyB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2ZpeGVkLXJvdXRlL2RpcmVjdGl2ZXMvc3RvcC1hcnJpdmFsLWluZm8vc3RvcC1hcnJpdmFsLWluZm8uaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlcigkc2NvcGUpIHtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEFycml2YWxJbmRleCA9IDA7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0Fycml2YWxzID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRBcnJpdmFsSW5kZXggPSBpbmRleDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHggPSAkc2NvcGUuc2VsZWN0ZWRTdG9wSWQ7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNZW51Q29udHJvbGxlcicsIE1lbnVDb250cm9sbGVyKTtcclxuXHJcbiAgICBNZW51Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNZW51Q29udHJvbGxlcigkc2NvcGUpIHtcclxuICAgICAgICAvL3ZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgJHNjb3BlLm9uSGFtbWVyID0gZnVuY3Rpb24gb25IYW1tZXIgKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5ldmVudFR5cGUgPSBldmVudC50eXBlO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC50eXBlKTtcclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5jYXJvdXNlbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG5hdlRleHQ6IFtcIlwiLCBcIlwiXSxcclxuICAgICAgICAgICAgcmVzcG9uc2l2ZUNsYXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbmF2OiB0cnVlLFxyXG4gICAgICAgICAgICBvbkRyYWc6bm9zY3JvbGwsXHJcbiAgICAgICAgICAgIG9uRHJhZ2dlZDpnb3Njcm9sbCwgXHJcblxyXG4gICAgICAgICAgICByZXNwb25zaXZlOiB7XHJcbiAgICAgICAgICAgICAgICAwOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VQYWRkaW5nOiAzNCxcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFBvc2l0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAzNzU6e1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlUGFkZGluZzogMzQsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgNzY4OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VQYWRkaW5nOiAxNixcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFBvc2l0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICA5OTI6IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogMyxcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVBhZGRpbmc6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBtZXJnZUZpdDp0cnVlXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbm9zY3JvbGwoZXZlbnQpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCdodG1sJykuYWRkQ2xhc3MoJ25vLXNjcm9sbCcpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZ29zY3JvbGwoZXZlbnQpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCdodG1sJykucmVtb3ZlQ2xhc3MoJ25vLXNjcm9sbCcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ293bENhcm91c2VsJywgTVZPd2xDYXJvdXNlbCk7XHJcblxyXG4gICAgTVZPd2xDYXJvdXNlbC4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gTVZPd2xDYXJvdXNlbCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICB0cmFuc2NsdWRlOiBmYWxzZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5pbml0Q2Fyb3VzZWwgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHByb3ZpZGUgYW55IGRlZmF1bHQgb3B0aW9ucyB5b3Ugd2FudFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXN0b21PcHRpb25zID0gc2NvcGUuJGV2YWwoJChlbGVtZW50KS5hdHRyKCdkYXRhLW9wdGlvbnMnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29tYmluZSB0aGUgdHdvIG9wdGlvbnMgb2JqZWN0c1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBjdXN0b21PcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRPcHRpb25zW2tleV0gPSBjdXN0b21PcHRpb25zW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGluaXQgY2Fyb3VzZWxcclxuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLm93bENhcm91c2VsKGRlZmF1bHRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1JhdGluZ01vZGFsQ29udHJvbGxlcicsIFJhdGluZ01vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgUmF0aW5nTW9kYWxDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckaHR0cCcsICdVdGlsaXR5RmFjdG9yeScsXHJcbiAgICAgICAgJ0NvbmZpZ0ZhY3RvcnknLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAndHJpcCcsICdzZWxlY3RlZFJhdGluZycsICdGZWVkYmFja1NlcnZpY2UnLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBSYXRpbmdNb2RhbENvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgVXRpbGl0eUZhY3RvcnksIENvbmZpZ0ZhY3RvcnksXHJcbiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UsIHRyaXAsIHNlbGVjdGVkUmF0aW5nLCBGZWVkYmFja1NlcnZpY2UsIGF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50cmlwID0gdHJpcDtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIHZtLnNhdmVGZWVkYmFjayA9IHNhdmVGZWVkYmFjaztcclxuXHJcbiAgICAgICAgdm0uZmVlZGJhY2sgPSB7XHJcbiAgICAgICAgICAgIHJhdGluZzogc2VsZWN0ZWRSYXRpbmcsXHJcbiAgICAgICAgICAgIGNvbW1lbnQ6ICcnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGlzYWJsZVN1Ym1pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmICh2bS5mZWVkYmFjay5yYXRpbmcgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZUZlZWRiYWNrKCkge1xyXG4gICAgICAgICAgICB2YXIgZmVlZGJhY2tSZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgUGFzc2VuZ2VyUmF0aW5nOiB2bS5mZWVkYmFjay5yYXRpbmcsXHJcbiAgICAgICAgICAgICAgICBDb21tZW50OiB2bS5mZWVkYmFjay5jb21tZW50LFxyXG4gICAgICAgICAgICAgICAgVHJpcElkOiB2bS50cmlwLlRyaXBJZCxcclxuICAgICAgICAgICAgICAgIENyZWF0ZWRCeTogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWRcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIEZlZWRiYWNrU2VydmljZS5TYXZlRmVlZGJhY2soZmVlZGJhY2tSZXF1ZXN0KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcyhcIlN1Y2Nlc3MhXCIsIFwiRmVlZGJhY2sgc2F2ZWQgc3VjY2Vzc2Z1bGx5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKGZlZWRiYWNrUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIkNvdWxkIG5vdCBzYXZlIGZlZWRiYWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtICcgKyByZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIkNvdWxkIG5vdCBzYXZlIGZlZWRiYWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gJyArIHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKFwib25lTVZBcHBcIikuZGlyZWN0aXZlKCdzdGFyUmF0aW5nRGlyZWN0aXZlJywgc3RhclJhdGluZ0RpcmVjdGl2ZSk7XHJcblxyXG4gICAgZnVuY3Rpb24gc3RhclJhdGluZ0RpcmVjdGl2ZSgpIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIHRyaXBJbmZvOiAnPScsXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBhbGxvd1RyaXBSYXRpbmc6ICdAJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmF0aW5nLWNvbXBvbmVudC9zdGFyUmF0aW5nLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyIDogY29udHJvbGxlckZ1bmN0aW9uXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlckZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5qc1RyaXBJbmZvID0gJHNjb3BlLnRyaXBJbmZvOyAvL0pTT04ucGFyc2UoJHNjb3BlLnRyaXBJbmZvKTtcclxuICAgICAgICAgICAgJHNjb3BlLmpzT3B0aW9ucyA9IEpTT04ucGFyc2UoJHNjb3BlLm9wdGlvbnMpO1xyXG4gICAgICAgICAgICAkc2NvcGUucmF0aW5nID0gJHNjb3BlLmpzVHJpcEluZm8ucmF0aW5nO1xyXG4gICAgICAgICAgICAkc2NvcGUucmF0aW5nQ29tbWVudCA9ICRzY29wZS5qc1RyaXBJbmZvLnJhdGluZ0NvbW1lbnQ7XHJcbiAgICAgICAgICAgICRzY29wZS5tdlJlYWRPbmx5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2V0UmF0aW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy9sZXQgdG9kYXkgPSBuZXcgRGF0ZSgkc2NvcGUuc2VydmljZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VEYXRlID0gbmV3IERhdGUoJHNjb3BlLmpzVHJpcEluZm8uc2VydmljZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyclJlc3RyaWN0ZWRWYWx1ZXMgPSBbXCJOby1zaG93XCIsIFwiQ2FuY2VsXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWxsb3dUcmlwUmF0aW5nID09IGZhbHNlICYmICRzY29wZS5qc1RyaXBJbmZvLnJhdGluZyA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm12UmVhZE9ubHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcnJSZXN0cmljdGVkVmFsdWVzLmluZGV4T2YoJHNjb3BlLmpzVHJpcEluZm8uU3RhdHVzKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tdlJlYWRPbmx5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5qc1RyaXBJbmZvLnJhdGluZyA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5tdlJlYWRPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1JhdGluZ01vZGFsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tdlJlYWRPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9yYXRpbmctY29tcG9uZW50L3JhdGluZ01vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSYXRpbmdNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpcDogJHNjb3BlLmpzVHJpcEluZm8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUmF0aW5nOiAkc2NvcGUucmF0aW5nXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZChpdGVtKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmF0aW5nID0gaXRlbS5QYXNzZW5nZXJSYXRpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yYXRpbmdDb21tZW50ID0gaXRlbS5Db21tZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuanNUcmlwSW5mby5yYXRpbmdDb21tZW50ID0gaXRlbS5Db21tZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuanNUcmlwSW5mby5yYXRpbmcgPSBpdGVtLlBhc3NlbmdlclJhdGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm12UmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJhdGluZyA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBkaXNtaXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc2V0UmF0aW5nKCk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiXX0=
